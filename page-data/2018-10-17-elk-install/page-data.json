{
    "componentChunkName": "component---src-templates-blog-post-js",
    "path": "/2018-10-17-elk-install/",
    "result": {"data":{"site":{"siteMetadata":{"title":"LRF"}},"markdownRemark":{"id":"9e93593c-2b75-5d99-ac31-cd338a87fd54","excerpt":"ELK 一、ElasticSearch 1、安装 下载： 解压： 修改配置文件： 启动： 2、常见报错 1、修改配置文件错误 错误信息： 错误原因：配置文件中的”:“后面要有一个空格 解决办法：修改配置文件 2、max_map_count错误 错误信息： 错误原因： 文件中的值过小 解决办法：在root…","html":"<h1>ELK</h1>\n<h2>一、ElasticSearch</h2>\n<h3>1、安装</h3>\n<ul>\n<li>下载：<code class=\"language-text\">wget -c https://artifacts.elastic.co/downloads/elasticsearch/elasticsearch-5.2.2.tar.gz</code></li>\n<li>解压：<code class=\"language-text\">tar -xzvf elasticsearch-5.2.2.tar.gz</code></li>\n<li>修改配置文件：<code class=\"language-text\">vi elasticsearch.yml</code></li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">cluster.name: my-application\nnode.name: node-1\npath.data: /data/home/elas/data\npath/logs: /data/home/elas/logs\nnetwork.host: 255.255.255.255(机器ip)\nhttp.port: 9200</code></pre></div>\n<ul>\n<li>启动：<code class=\"language-text\">./bin/elasticsearch</code></li>\n</ul>\n<h3>2、常见报错</h3>\n<h5>1、修改配置文件错误</h5>\n<ul>\n<li>错误信息：<code class=\"language-text\">Failed to load settings from ....,nested: MarkedYAMLException[while scanning a simple key</code></li>\n<li>错误原因：配置文件中的”:“后面要有一个空格</li>\n<li>解决办法：修改配置文件</li>\n</ul>\n<h5>2、max_map_count错误</h5>\n<ul>\n<li>错误信息：<code class=\"language-text\">max virtual memory areas vm.max_map_count [65530] likely too low, increase to at least [262144]</code></li>\n<li>错误原因：<code class=\"language-text\">/etc/sysctl.conf</code> 文件中的值过小</li>\n<li>解决办法：在root用户下方可更改，在配置文件中加入 <code class=\"language-text\">vm.max_map_count=655360</code></li>\n<li>使其生效命令：<code class=\"language-text\"> sysctl -p</code></li>\n</ul>\n<h5>3、系统最大打开文件数</h5>\n<ul>\n<li>错误信息：<code class=\"language-text\">max file descriptors [65535] for elasticsearch process likely too low, increase to at least [65536]</code></li>\n<li>错误原因：系统打开文件数受限，<code class=\"language-text\">/etc/security/limits.conf</code></li>\n<li>解决办法：在root用户下，</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">vi /etc/security/limits.conf\n//*代表所有用户，可更换为只指定自己需要的用户\n*    soft    nproc   65536\n*    hard    nproc   65536\n*    soft    nofile  65536\n*    hard    nofile  65536</code></pre></div>\n<p>要使其生效还必须修改elasticsearch的配置文件.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">vi ./elasticsearch.yml\ndiscovery.zen.ping.unicast.hosts: [\"255.255.255.255\"]\ndiscovery.zen.minimum_master_nodes: 3</code></pre></div>\n<ul>\n<li>使其生效：退出当前用户：<code class=\"language-text\">logout</code>，重新登录就生效了.</li>\n</ul>\n<h5>4、系统版本问题</h5>\n<ul>\n<li>错误信息：<code class=\"language-text\">ERROR: bootstrap checks failed\nsystem call filters failed to install; check the logs and fix your configuration or disable system call filters at your own risk</code></li>\n<li>错误原因：这是在因为Centos6不支持SecComp，而ES5.2.0默认bootstrap.system_call_filter为true进行检测，所以导致检测失败，失败后直接导致ES不能启动。</li>\n<li>解决办法：</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">vi ./elasticsearch.yml\nbootstrap.memory_lock: false\nbootstrap.system_call_filter: false</code></pre></div>\n<h5>5、访问elasticsearch的url报503错误</h5>\n<ul>\n<li>错误：请求URL报503错误</li>\n<li>错误原因：elasticsearch中没有index，可以理解为没有数据库</li>\n<li>解决办法：添加index</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">//创建一个名为customer的index\ncurl -XPUT 'localhost:9200/customer?pretty&amp;pretty'</code></pre></div>\n<h5>6、最大线程数</h5>\n<ul>\n<li>错误信息：<code class=\"language-text\">max number of threads [1024] for user [lish] likely too low, increase to at least [2048]</code></li>\n<li>解决办法：要有root权限，<code class=\"language-text\">vi /etc/security/limits.d/90-nproc.conf</code></li>\n<li>修改：<code class=\"language-text\">* soft nproc 2048</code></li>\n<li>生效：用户退出，重连就生效了</li>\n</ul>\n<blockquote>\n<p>参考：<a href=\"http://blog.csdn.net/cardinalzbk/article/details/54924511\">http://blog.csdn.net/cardinalzbk/article/details/54924511</a></p>\n</blockquote>\n<h2>二、LogStach</h2>\n<h3>1、安装</h3>\n<ul>\n<li>下载：<code class=\"language-text\">wget -c https://artifacts.elastic.co/downloads/logstash/logstash-5.2.2.tar.gz</code></li>\n<li>解压：<code class=\"language-text\">tar -xzvf logstash-5.2.2.tar.gz</code></li>\n<li>修该配置文件：</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">//新建的配置文件：log4j_to_es.conf\ninput {\n        log4j{\n                mode => \"server\"\n                host => \"255.255.255.255\" #when mode is server,listen this host,when mode is client ,client this host\n                port => \"4567\"\n        }\n}\nfilter {\n\n        }\noutput{\n                elasticsearch{\n                        action => \"index\"\n                        hosts  => [\"255.255.255.255:9200\"]  #eleasticsearch host,can be array,when model is cluster\n                        index  =>\"applog\"\n                }\n}</code></pre></div>\n<ul>\n<li>启动：<code class=\"language-text\">./bin/logstash -f ./config/log4j_to_es.conf</code></li>\n</ul>\n<h2>三、Kibana</h2>\n<h3>1、安装</h3>\n<ul>\n<li>下载：<code class=\"language-text\">wget -c https://artifacts.elastic.co/downloads/kibana/kibana-5.2.2-linux-x86_64.tar.gz</code></li>\n<li>解压：<code class=\"language-text\">tar -xzvf kibana-5.2.2-linux-x86_64.tar.gz</code></li>\n<li>配置文件：</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">server.port: 5601\nserver.host: \"255.255.255.255\"\nelasticsearch.url: \"http://255.255.255.255:9200\"\nkibana.index: \".kibana\"</code></pre></div>\n<ul>\n<li>启动：<code class=\"language-text\">./bin/kibana</code></li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">//启动成功信息\n[listening] Server running at http://255.255.255.255:5601</code></pre></div>\n<h2>四、安装x-pakc插件</h2>\n<blockquote>\n<p>更详细的可以看我写的<code class=\"language-text\">x-pack</code>安装和破解篇。</p>\n</blockquote>\n<p><em>eleasticsearch版本必须是5.0以上</em></p>\n<blockquote>\n<p>x-pack是elasticsearch的一个扩展包，将安全，警告，监视，图形和报告功能捆绑在一个易于安装的软件包中，也是官方推荐的。</p>\n</blockquote>\n<h3>1、elasticsearch</h3>\n<ul>\n<li>进入elasticsearch：<code class=\"language-text\">bin/elasticsearch-plugin install x-pack</code></li>\n<li>配置elasticsearch.yml：<code class=\"language-text\">action.auto_create_index: .security,.monitoring*,.watches,.triggered_watches,.watcher-history*</code></li>\n<li>启动</li>\n</ul>\n<h3>2、kianda</h3>\n<ul>\n<li>\n<p>下载：<code class=\"language-text\">bin/kibana-plugin install x-pack</code>    比较耗时，请耐心等待</p>\n</li>\n<li>\n<p>启动</p>\n</li>\n<li>\n<p>运行：浏览器输入<code class=\"language-text\">http://255.255.255.255:5601/</code>,此时需要输入用户名和密码，默认用户名是<code class=\"language-text\">elastic</code>,密码<code class=\"language-text\">changeme</code></p>\n</li>\n<li>\n<p>卸载插件：</p>\n</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">bin/elasticsearch-plugin install x-pack\nbin/elasticsearch-plugin remove x-pack\nbin/kibana-plugin install x-pack\nbin/kibana-plugin remove x-pack</code></pre></div>","frontmatter":{"title":"elk 搭建","date":"October 17, 2018","description":null}},"previous":{"fields":{"slug":"/2018-10-17-es-single-node-install/"},"frontmatter":{"title":"es 单节点部署多个服务"}},"next":{"fields":{"slug":"/2018-10-17-new-spring-boot-stater/"},"frontmatter":{"title":"自定义 spring-boot-stater"}}},"pageContext":{"id":"9e93593c-2b75-5d99-ac31-cd338a87fd54","previousPostId":"49b922e5-b3a3-5733-a981-db8e3bf800c4","nextPostId":"102591c3-13ea-5192-81b9-6e8b774f5b48"}},
    "staticQueryHashes": ["2841359383","3257411868"]}