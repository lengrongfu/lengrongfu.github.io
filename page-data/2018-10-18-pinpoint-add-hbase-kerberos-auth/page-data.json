{
    "componentChunkName": "component---src-templates-blog-post-js",
    "path": "/2018-10-18-pinpoint-add-hbase-kerberos-auth/",
    "result": {"data":{"site":{"siteMetadata":{"title":"LRF"}},"markdownRemark":{"id":"d3a24941-4d5d-56ac-89bc-b3af21572d4d","excerpt":"原生是不支持的的认证的，经过修改源码，现已在版本之后支持了这一功能，并入到项目主分支中，以后可以直接使用。 开源地址: https://github.com/naver/pinpoint kerberos…","html":"<blockquote>\n<p><code class=\"language-text\">pinpoint</code> 原生是不支持的<code class=\"language-text\">hbase</code>的<code class=\"language-text\">kerberos</code>认证的，经过修改源码，现已在<code class=\"language-text\">1.8</code>版本之后支持了这一功能，并入到项目主分支中，以后可以直接使用。</p>\n</blockquote>\n<p>开源地址: <a href=\"https://github.com/naver/pinpoint\">https://github.com/naver/pinpoint</a></p>\n<h1>kerberos 认证简介</h1>\n<blockquote>\n<p><code class=\"language-text\">Kerberos</code> 是一种基于对称密钥的身份认证协议，它作为一个独立的第三方的身份认证服务，可以为其服务提供身份认证功能，且支持<code class=\"language-text\">SSO</code>(即客户端身份认证后，可以访问多个服务如HBase/HDFS等).\n<code class=\"language-text\">Kerberos</code> 协议过程主要有两个阶段，第一个阶段是<code class=\"language-text\">KDC</code>对<code class=\"language-text\">client</code>的身份认证,第二个阶段是<code class=\"language-text\">service</code>对<code class=\"language-text\">client</code>的身份认证.</p>\n</blockquote>\n<p><img src=\"DingTalk20171127114504.png\" alt=\"原理图\"></p>\n<ul>\n<li>KDC: Kerberos的服务端程序</li>\n<li>Client: 需要访问服务的用户(principal)，KDC和Service会对用户的身份进行认证</li>\n<li>Service: 集成了Kerberos的服务，如HDFS/YARN/HBase等</li>\n</ul>\n<h2>1、KDC对Client身份认证</h2>\n<p>当客户端用户访问一个集成了<code class=\"language-text\">Kerberos</code>的服务之前，需要先通过<code class=\"language-text\">KDC</code>的身份认证.若身份认证通过则客户端会拿到一个<code class=\"language-text\">TGT</code>,后续就可以拿该<code class=\"language-text\">TGT</code>去访问集成了<code class=\"language-text\">Kerberos</code>的服务。</p>\n<h2>2、Service对Client身份认证</h2>\n<p>当该客户端拿到<code class=\"language-text\">TGT</code>之后，就可以继续访问<code class=\"language-text\">Service</code>服务。它回使用<code class=\"language-text\">TGT</code>以及需要访问的服务名称去<code class=\"language-text\">KDC</code>获取<code class=\"language-text\">SGT</code>,然后使用<code class=\"language-text\">SGT</code>去访问服务<code class=\"language-text\">Service</code>，<code class=\"language-text\">Service</code>会利用相关信息对<code class=\"language-text\">Client</code>进行身份认证,认证通过后就可以正常访问<code class=\"language-text\">Service</code>服务。</p>\n<h1>Hbase kerberos 认证</h1>\n<h2>1、修改源码</h2>\n<blockquote>\n<p><code class=\"language-text\">pinpoint</code>中的<code class=\"language-text\">hbase</code>相关代码都是在<code class=\"language-text\">commons-hbase</code>这个项目中，连接都是通过<code class=\"language-text\">PooledHTableFactory.java</code> 这个类创建的，因此修改代码的地方就是这个类，并且只需要添加上<code class=\"language-text\">hbase</code>认证代码即可.</p>\n</blockquote>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\">     <span class=\"token keyword\">public</span> <span class=\"token class-name\">PooledHTableFactory</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Configuration</span> config<span class=\"token punctuation\">,</span> <span class=\"token class-name\">ExecutorService</span> executor<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n         <span class=\"token class-name\">Objects</span><span class=\"token punctuation\">.</span><span class=\"token function\">requireNonNull</span><span class=\"token punctuation\">(</span>config<span class=\"token punctuation\">,</span> <span class=\"token string\">\"config must not be null\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n         <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>executor <span class=\"token operator\">=</span> <span class=\"token class-name\">Objects</span><span class=\"token punctuation\">.</span><span class=\"token function\">requireNonNull</span><span class=\"token punctuation\">(</span>executor<span class=\"token punctuation\">,</span> <span class=\"token string\">\"executor must not be null\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n         <span class=\"token keyword\">try</span> <span class=\"token punctuation\">{</span>\n             <span class=\"token class-name\">String</span> authEnable <span class=\"token operator\">=</span> config<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"hbase.kerberos.auth\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n             <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span><span class=\"token class-name\">StringUtils</span><span class=\"token punctuation\">.</span><span class=\"token function\">isEmpty</span><span class=\"token punctuation\">(</span>authEnable<span class=\"token punctuation\">)</span> <span class=\"token operator\">&amp;&amp;</span> <span class=\"token class-name\">Boolean</span><span class=\"token punctuation\">.</span><span class=\"token function\">parseBoolean</span><span class=\"token punctuation\">(</span>authEnable<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n                 <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">StringUtils</span><span class=\"token punctuation\">.</span><span class=\"token function\">isEmpty</span><span class=\"token punctuation\">(</span>config<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"hbase.kerberos.keytab.path\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n                     <span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">KerberosException</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">ErrorType</span><span class=\"token punctuation\">.</span>KDC_ERR_NONE<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                 <span class=\"token punctuation\">}</span>\n                 <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"hbase.zookeeper.quorum:\"</span><span class=\"token operator\">+</span>config<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"hbase.zookeeper.quorum\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                 <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"hbase.kerberos.keytab.path:\"</span><span class=\"token operator\">+</span>config<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"hbase.kerberos.keytab.path\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                 <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"hbase.kerberos.user:\"</span><span class=\"token operator\">+</span>config<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"hbase.kerberos.user\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n \n                 config<span class=\"token punctuation\">.</span><span class=\"token function\">set</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"hbase.security.authentication\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"kerberos\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                 config<span class=\"token punctuation\">.</span><span class=\"token function\">set</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"hadoop.security.authentication\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"kerberos\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                 config<span class=\"token punctuation\">.</span><span class=\"token function\">set</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"hbase.master.kerberos.principal\"</span><span class=\"token punctuation\">,</span>config<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"hbase.master.kerberos.principal\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                 config<span class=\"token punctuation\">.</span><span class=\"token function\">set</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"hbase.regionserver.kerberos.principal\"</span><span class=\"token punctuation\">,</span>config<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"hbase.regionserver.kerberos.principal\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                 <span class=\"token class-name\">UserGroupInformation</span><span class=\"token punctuation\">.</span><span class=\"token function\">setConfiguration</span><span class=\"token punctuation\">(</span>config<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                 <span class=\"token class-name\">String</span> kerberosUser <span class=\"token operator\">=</span> config<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"hbase.kerberos.user\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                 <span class=\"token class-name\">String</span> kerberosPath <span class=\"token operator\">=</span> config<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"hbase.kerberos.keytab.path\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                 <span class=\"token class-name\">UserGroupInformation</span><span class=\"token punctuation\">.</span><span class=\"token function\">loginUserFromKeytab</span><span class=\"token punctuation\">(</span>kerberosUser<span class=\"token punctuation\">,</span> kerberosPath<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n             <span class=\"token punctuation\">}</span>\n             <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>connection <span class=\"token operator\">=</span> <span class=\"token class-name\">ConnectionFactory</span><span class=\"token punctuation\">.</span><span class=\"token function\">createConnection</span><span class=\"token punctuation\">(</span>config<span class=\"token punctuation\">,</span> executor<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n         <span class=\"token punctuation\">}</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">Exception</span> e<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n             <span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">HbaseSystemException</span><span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n         <span class=\"token punctuation\">}</span>\n     <span class=\"token punctuation\">}</span></code></pre></div>\n<p>只添加了<code class=\"language-text\">if</code>里面的所以代码，值都通过配置文件传入，设置了开关，可以启用或者禁用认证功能。</p>\n<h2>2、添加配置</h2>\n<blockquote>\n<p>添加<code class=\"language-text\">hbase.properties</code>的配置</p>\n</blockquote>\n<div class=\"gatsby-highlight\" data-language=\"properties\"><pre class=\"language-properties\"><code class=\"language-properties\"><span class=\"token comment\"># kerberos</span>\n<span class=\"token comment\"># 是否启用或者禁用</span>\n<span class=\"token attr-name\">hbase.kerberos.auth</span><span class=\"token punctuation\">=</span><span class=\"token attr-value\">true</span>\n<span class=\"token comment\"># kerberos 用户</span>\n<span class=\"token attr-name\">hbase.kerberos.user</span><span class=\"token punctuation\">=</span><span class=\"token attr-value\">test_add@HADOOP.COM</span>\n<span class=\"token comment\"># keytab 认证文件路径</span>\n<span class=\"token attr-name\">hbase.kerberos.keytab.path</span><span class=\"token punctuation\">=</span><span class=\"token attr-value\">./test_add.keytab</span>\n<span class=\"token comment\"># 默认配置</span>\n<span class=\"token attr-name\">hbase.master.kerberos.principal</span><span class=\"token punctuation\">=</span><span class=\"token attr-value\">hbase/_HOST@HADOOP.COM</span>\n<span class=\"token attr-name\">hbase.regionserver.kerberos.principal</span><span class=\"token punctuation\">=</span><span class=\"token attr-value\">hbase/_HOST@HADOOP.COM</span>\n</code></pre></div>\n<blockquote>\n<p>添加 <code class=\"language-text\">applicationContext-hbase.xml</code>的配置.</p>\n</blockquote>\n<div class=\"gatsby-highlight\" data-language=\"xml\"><pre class=\"language-xml\"><code class=\"language-xml\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>bean</span> <span class=\"token attr-name\">id</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>hbaseConfiguration<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">class</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>com.navercorp.pinpoint.common.hbase.HbaseConfigurationFactoryBean<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>property</span> <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>properties<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>props</span><span class=\"token punctuation\">></span></span>\n                <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>prop</span> <span class=\"token attr-name\">key</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>hbase.zookeeper.quorum<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>${hbase.client.host}<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>prop</span><span class=\"token punctuation\">></span></span>\n                <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>prop</span> <span class=\"token attr-name\">key</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>hbase.zookeeper.property.clientPort<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>${hbase.client.port}<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>prop</span><span class=\"token punctuation\">></span></span>\n\n               <span class=\"token comment\">&lt;!--Root ZNode for HBase in ZooKeeper.--></span>\n                <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>prop</span> <span class=\"token attr-name\">key</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>zookeeper.znode.parent<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>${hbase.zookeeper.znode.parent:/hbase}<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>prop</span><span class=\"token punctuation\">></span></span>\n                 <span class=\"token comment\">&lt;!-- hbase default:true --></span>\n                <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>prop</span> <span class=\"token attr-name\">key</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>hbase.ipc.client.tcpnodelay<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>${hbase.ipc.client.tcpnodelay}<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>prop</span><span class=\"token punctuation\">></span></span>\n                <span class=\"token comment\">&lt;!-- hbase default:60000 --></span>\n                <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>prop</span> <span class=\"token attr-name\">key</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>hbase.rpc.timeout<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>${hbase.rpc.timeout}<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>prop</span><span class=\"token punctuation\">></span></span>\n                <span class=\"token comment\">&lt;!-- hbase default:Integer.MAX_VALUE --></span>\n                <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>prop</span> <span class=\"token attr-name\">key</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>hbase.client.operation.timeout<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>${hbase.client.operation.timeout}<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>prop</span><span class=\"token punctuation\">></span></span>\n\n                <span class=\"token comment\">&lt;!-- hbase socket read timeout. default: 200000--></span>\n                <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>prop</span> <span class=\"token attr-name\">key</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>hbase.ipc.client.socket.timeout.read<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>${hbase.ipc.client.socket.timeout.read}<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>prop</span><span class=\"token punctuation\">></span></span>\n                <span class=\"token comment\">&lt;!-- socket write timeout. hbase default: 600000--></span>\n                 <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>prop</span> <span class=\"token attr-name\">key</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>hbase.ipc.client.socket.timeout.write<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>${hbase.ipc.client.socket.timeout.write}<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>prop</span><span class=\"token punctuation\">></span></span>\n \n                 <span class=\"token comment\">&lt;!-- hbase async put operation. --></span>\n                 <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>prop</span> <span class=\"token attr-name\">key</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>hbase.client.async.enable<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>${hbase.client.async.enable:false}<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>prop</span><span class=\"token punctuation\">></span></span>\n                 <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>prop</span> <span class=\"token attr-name\">key</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>hbase.client.async.in.queuesize<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>${hbase.client.async.in.queuesize:10000}<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>prop</span><span class=\"token punctuation\">></span></span>\n                 <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>prop</span> <span class=\"token attr-name\">key</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>hbase.tablemultiplexer.flush.period.ms<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>${hbase.client.async.flush.period.ms:100}<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>prop</span><span class=\"token punctuation\">></span></span>\n                 <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>prop</span> <span class=\"token attr-name\">key</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>hbase.client.max.retries.in.queue<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>${hbase.client.async.max.retries.in.queue:10}<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>prop</span><span class=\"token punctuation\">></span></span>\n                <span class=\"token comment\">&lt;!--hbase kerberos--></span>\n                <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>prop</span> <span class=\"token attr-name\">key</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>hbase.kerberos.auth<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>${hbase.kerberos.auth:false}<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>prop</span><span class=\"token punctuation\">></span></span>\n                <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>prop</span> <span class=\"token attr-name\">key</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>hbase.kerberos.user<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>${hbase.kerberos.user:test}<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>prop</span><span class=\"token punctuation\">></span></span>\n                <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>prop</span> <span class=\"token attr-name\">key</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>hbase.kerberos.keytab.path<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>${hbase.kerberos.keytab.path:/tmp}<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>prop</span><span class=\"token punctuation\">></span></span>\n                <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>prop</span> <span class=\"token attr-name\">key</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>hbase.master.kerberos.principal<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>${hbase.master.kerberos.principal:test}<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>prop</span><span class=\"token punctuation\">></span></span>\n                <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>prop</span> <span class=\"token attr-name\">key</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>hbase.regionserver.kerberos.principal<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>${hbase.regionserver.kerberos.principal:test}<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>prop</span><span class=\"token punctuation\">></span></span>\n            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>props</span><span class=\"token punctuation\">></span></span>\n        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>property</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>bean</span><span class=\"token punctuation\">></span></span></code></pre></div>\n<h2>3、添加启动参数配置到<code class=\"language-text\">tomcat</code>中</h2>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">$ <span class=\"token function\">vim</span> bin/catalina.sh\n<span class=\"token comment\"># 添加krb配置文件</span>\n<span class=\"token assign-left variable\">CATALINA_OPTS</span><span class=\"token operator\">=</span><span class=\"token string\">\"<span class=\"token variable\">$CATALINA_OPTS</span> -Djava.security.krb5.conf=./krb5.conf\"</span>\n<span class=\"token comment\"># 开启krb认证的bug日志</span>\n<span class=\"token assign-left variable\">CATALINA_OPTS</span><span class=\"token operator\">=</span><span class=\"token string\">\"<span class=\"token variable\">$CATALINA_OPTS</span> -Dsun.security.krb5.debug=true\"</span>\n<span class=\"token assign-left variable\">CATALINA_OPTS</span><span class=\"token operator\">=</span><span class=\"token string\">\"<span class=\"token variable\">$CATALINA_OPTS</span> -Djavax.security.auth.useSubjectCredsOnly=true\"</span></code></pre></div>\n<p>** 上面步骤都完成之后即可进行重启使用。**</p>","frontmatter":{"title":"pinpoint 添加 hbase kerberos认证","date":"October 18, 2018","description":null}},"previous":{"fields":{"slug":"/2018-10-17-mysql-install/"},"frontmatter":{"title":"mysql-install"}},"next":{"fields":{"slug":"/2018-10-31-ZooKeeper-kerberos/"},"frontmatter":{"title":"ZooKeeper kerberos 客户端认证"}}},"pageContext":{"id":"d3a24941-4d5d-56ac-89bc-b3af21572d4d","previousPostId":"361c6315-592d-55bd-bb6d-a065e0710779","nextPostId":"84135c67-f846-55d4-a025-3caa663f25ca"}},
    "staticQueryHashes": ["2841359383","3257411868"]}