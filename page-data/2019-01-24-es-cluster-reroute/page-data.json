{
    "componentChunkName": "component---src-templates-blog-post-js",
    "path": "/2019-01-24-es-cluster-reroute/",
    "result": {"data":{"site":{"siteMetadata":{"title":"LRF"}},"markdownRemark":{"id":"bb2e560f-b4b7-5122-a190-cd22d828ab93","excerpt":"…","html":"<blockquote>\n<p><code class=\"language-text\">ES</code>集群重新路由命令可以显示的执行包括特定命令的集群重新路由分配命令。例如，可以显示地将分片从一个节点移动到另一个节点，可以取消分配。</p>\n</blockquote>\n<h1>使用</h1>\n<h2>支持的命令如下</h2>\n<ul>\n<li><code class=\"language-text\">move</code>\n将现有的分片迁移到其他节点。接受 <code class=\"language-text\">index</code>和<code class=\"language-text\">shard</code>索引名称和分片编号，<code class=\"language-text\">from_node</code>节点移动分片<code class=\"language-text\">from</code>，以及<code class=\"language-text\">to_node</code>节点将分片移动到。</li>\n<li><code class=\"language-text\">cancel</code>\n取消分享碎片（或恢复）。接受<code class=\"language-text\">index </code>和<code class=\"language-text\">shard</code>索引名称和分片编号，以及<code class=\"language-text\">node</code>取消分片分配的节点。它还接受<code class=\"language-text\">allow_primary</code>标志以明确指定允许取消主分片的分配。这可以用于强制从主分片重新同步现有副本，方法是取消它们并允许它们通过标准重新分配过程重新初始化。</li>\n<li><code class=\"language-text\">allocate_replica</code>\n将未分配的副本分片分配给节点。接受<code class=\"language-text\">index</code>和<code class=\"language-text\">shard</code>索引名称和分片编号，并将分片分配给<code class=\"language-text\">node</code>。</li>\n</ul>\n<h2>使用场景</h2>\n<ul>\n<li><code class=\"language-text\">move</code>\n主要是想要手动控制分片分配到某台固定的机器上。把<code class=\"language-text\">node_1</code>上的<code class=\"language-text\">index_name</code>移动到<code class=\"language-text\">node_2</code>节点上，可能会有各种原因需要进行迁移，比如<code class=\"language-text\">node_1</code>机器的磁盘不够了或者是其他原因等。</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"json\"><pre class=\"language-json\"><code class=\"language-json\">POST _cluster/reroute\n<span class=\"token punctuation\">{</span>\n  <span class=\"token property\">\"commands\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n    <span class=\"token punctuation\">{</span>\n      <span class=\"token property\">\"move\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token property\">\"index\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"index_name\"</span><span class=\"token punctuation\">,</span>\n        <span class=\"token property\">\"shard\"</span><span class=\"token operator\">:</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span>\n        <span class=\"token property\">\"from_node\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"node_1\"</span><span class=\"token punctuation\">,</span>\n        <span class=\"token property\">\"to_node\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"node_2\"</span>\n      <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">]</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<ul>\n<li><code class=\"language-text\">cancel</code>\n主要是把移动中的分片取消，这个是因为其他原因导致分片重新分配了，但是又不想让它重新分配，所以只能取消分片分配的过程。如下是<code class=\"language-text\">node_1</code>这台机器上的<code class=\"language-text\">index_name</code>的分片号<code class=\"language-text\">0</code>进行了移动，所以取消它。</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"json\"><pre class=\"language-json\"><code class=\"language-json\">POST _cluster/reroute\n<span class=\"token punctuation\">{</span>\n  <span class=\"token property\">\"commands\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n    <span class=\"token punctuation\">{</span>\n      <span class=\"token property\">\"cancel\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token property\">\"index\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"index_name\"</span><span class=\"token punctuation\">,</span>\n        <span class=\"token property\">\"shard\"</span><span class=\"token operator\">:</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span>\n        <span class=\"token property\">\"node\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"node_1\"</span>\n      <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">]</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<h1>参考文档</h1>\n<ul>\n<li><a href=\"https://www.elastic.co/guide/en/elasticsearch/reference/5.4/cluster-reroute.html\">https://www.elastic.co/guide/en/elasticsearch/reference/5.4/cluster-reroute.html</a></li>\n</ul>","frontmatter":{"title":"ES cluster reroute","date":"January 24, 2019","description":null}},"previous":{"fields":{"slug":"/2019-01-04-2018-2019/"},"frontmatter":{"title":"18年的回顾,19年的展望"}},"next":{"fields":{"slug":"/2019-02-27-go1-12/"},"frontmatter":{"title":"go1.12 发行说明"}}},"pageContext":{"id":"bb2e560f-b4b7-5122-a190-cd22d828ab93","previousPostId":"18bc7adc-12b9-554b-9d64-db3797f0e472","nextPostId":"055486ef-7753-55cb-bef9-104d4a0e2586"}},
    "staticQueryHashes": ["2841359383","3257411868"]}