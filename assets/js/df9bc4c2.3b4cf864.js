"use strict";(self.webpackChunkblogs=self.webpackChunkblogs||[]).push([[8830],{2969:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>o,contentTitle:()=>c,default:()=>h,frontMatter:()=>r,metadata:()=>l,toc:()=>d});var s=t(4848),i=t(8453);const r={slug:"distribution-auth",title:"Distribution Auth Type",authors:["rongfu"],tags:["\u955c\u50cf\u4ed3\u5e93"]},c=void 0,l={permalink:"/blog/distribution-auth",editUrl:"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/blog/2022-08-05-distribution-auth.md",source:"@site/blog/2022-08-05-distribution-auth.md",title:"Distribution Auth Type",description:"Distribution Auth\u8ba4\u8bc1\u6d41\u7a0b\u4ecb\u7ecd",date:"2022-08-05T00:00:00.000Z",tags:[{inline:!1,label:"\u955c\u50cf\u4ed3\u5e93",permalink:"/blog/tags/distribution",description:"\u955c\u50cf\u4ed3\u5e93"}],readingTime:3.2,hasTruncateMarker:!0,authors:[{name:"Leng Student",title:"Softwore Developer",url:"https://github.com/lengrongfu",image_hrl:"https://avatars.githubusercontent.com/u/15009201?v=4",socials:{github:"https://github.com/lengrongfu"},key:"rongfu",page:null}],frontMatter:{slug:"distribution-auth",title:"Distribution Auth Type",authors:["rongfu"],tags:["\u955c\u50cf\u4ed3\u5e93"]},unlisted:!1,prevItem:{title:"Github Contribute \u6ce8\u610f\u4e8b\u9879",permalink:"/blog/github-contribute"},nextItem:{title:"Kubernetes Scheduler",permalink:"/blog/Kubernetes-Scheduler"}},o={authorsImageUrls:[void 0]},d=[{value:"htpasswd",id:"htpasswd",level:2},{value:"silly",id:"silly",level:2},{value:"token",id:"token",level:2}];function a(e){const n={a:"a",blockquote:"blockquote",code:"code",h2:"h2",img:"img",li:"li",ol:"ol",p:"p",pre:"pre",ul:"ul",...(0,i.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.p,{children:"Distribution Auth\u8ba4\u8bc1\u6d41\u7a0b\u4ecb\u7ecd"}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.a,{href:"https://github.com/distribution/distribution",children:(0,s.jsx)(n.code,{children:"Distribution"})})," \u662f\u4e00\u4e2a\u6309\u7167 ",(0,s.jsx)(n.code,{children:"OCI"})," \u7684\u89c4\u8303\u5b9e\u73b0\u7684\u4e00\u4e2a\u5236\u54c1\u5e93\u7ba1\u7406\u5de5\u5177\uff0c\u5b83\u63d0\u4f9b\u4e86\u4e09\u79cd\u7684\u8ba4\u8bc1\u65b9\u5f0f\uff0c",(0,s.jsx)(n.code,{children:"htpasswd"}),"\u3001",(0,s.jsx)(n.code,{children:"silly"}),"\u3001",(0,s.jsx)(n.code,{children:"token"}),"\uff0c\u5728 ",(0,s.jsx)(n.code,{children:"Distribution"})," \u9879\u76ee\u4e2d\u91c7\u7528\u7684\u662f\u7b56\u7565\u6a21\u5f0f\u3002"]}),"\n",(0,s.jsx)(n.p,{children:"\u5b83\u7684\u8ba4\u8bc1\u6d41\u7a0b\u5982\u4e0b\u56fe\u6240\u793a\uff1a"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{alt:"auth",src:t(5569).A+"",width:"610",height:"781"})}),"\n",(0,s.jsx)(n.h2,{id:"htpasswd",children:"htpasswd"}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.code,{children:"htpasswd"})," \u662f\u4e00\u79cd\u5728\u7cfb\u7edf\u4e2d\uff0c\u5b83\u5305\u542b\u4e00\u4e2a ",(0,s.jsx)(n.code,{children:"htpasswd"})," \u7684\u6587\u4ef6\uff08\u6587\u4ef6\u5185\u5bb9\u662f\u521d\u59cb\u7684\u7528\u6237\u540d",(0,s.jsx)(n.code,{children:"docker"}),"\uff0c\u4ee5\u53ca\u4e00\u4e2a\u4f7f\u7528\u7279\u5b9a\u7b97\u6cd5\u968f\u673a\u751f\u6210\u7684\u5bc6\u7801\uff09\u4ee5\u53ca\u5982\u4f55\u89e3\u6790\u8fd9\u4e2a\u6587\u4ef6\u7684\u7b97\u6cd5\uff08\u76ee\u524d\u53ea\u80fd\u4f7f\u7528 ",(0,s.jsx)(n.code,{children:"bcrypt"})," \u52a0\u5bc6\u7b97\u6cd5\uff09\u3002"]}),"\n",(0,s.jsx)(n.p,{children:"\u914d\u7f6e\u683c\u5f0f\u5982\u4e0b\uff1a"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-yaml",children:"auth:\n  htpasswd:\n    realm: harbor-registry-basic-realm\n    path: /etc/registry/passwd\n"})}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:["\u542f\u52a8\u8fc7\u7a0b\u4e2d\u4f1a\u6821\u9a8c ",(0,s.jsx)(n.code,{children:"path"})," \u5bf9\u5e94\u7684\u6587\u4ef6\u662f\u5426\u5b58\u5728\uff0c\u5982\u679c\u4e0d\u5b58\u5728\uff0c\u5c31\u521b\u5efa\u5e76\u5199\u5165\u5185\u5bb9\uff0c\u5185\u5bb9\u4e3a\u7528\u6237\uff1a",(0,s.jsx)(n.code,{children:"docker"}),", \u5bc6\u7801\u4e3a\u968f\u673a\u751f\u6210\u5e76\u52a0\u5bc6\u5b58\u50a8\u3002"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:"\u7528\u6237\u5728\u8bf7\u6c42\u8fc7\u7a0b\u4e2d\uff0c\u6bcf\u4e2a\u8bf7\u6c42\u90fd\u4f1a\u8fdb\u5165\u914d\u7f6e\u597d\u7684\u8bbf\u95ee\u63a7\u5236\u5668\u4e2d\uff0c\u8fdb\u884c\u6743\u9650\u9a8c\u8bc1\u3002"}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:["\u4f1a\u9996\u5148\u5224\u65ad ",(0,s.jsx)(n.code,{children:"Header"})," \u4e2d\u662f\u5426\u5b58\u5728 ",(0,s.jsx)(n.code,{children:"Authorization"})," \u5b57\u6bb5\u503c\uff0c\u5e76\u6b63\u786e\u89e3\u6790\uff1b\u5982\u679c\u4e0d\u5b58\u5728\uff0c\u5219\u8ba4\u4e3a\u65e0\u6548\u8ba4\u8bc1\u3002"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:"\u5982\u679c\u5b58\u5728\u7528\u6237\u5bc6\u7801\u5219\u4f1a\u548c\u6587\u4ef6\u4e2d\u5199\u5165\u7684\u5185\u5bb9\u8fdb\u884c\u5bf9\u6bd4\uff0c\u786e\u4fdd\u662f\u4e00\u81f4\u7684\uff08\u63d0\u793a\uff1a\u5728\u5bf9\u6bd4\u4e4b\u524d\u7cfb\u7edf\u4f1a\u5148\u6821\u9a8c\u8fd9\u4e2a\u6587\u4ef6\u662f\u5426\u88ab\u4fee\u6539\u8fc7\uff0c\u5982\u679c\u88ab\u4fee\u6539\u8fc7\u5c31\u4f1a\u4ece\u65b0\u751f\u6210\u6587\u4ef6\u5185\u5bb9\uff09\u3002"}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"silly",children:"silly"}),"\n",(0,s.jsxs)(n.p,{children:["\u8fd9\u4e2a\u4e3b\u8981\u662f\u7528\u4e8e\u6d4b\u8bd5\u7684\uff0c\u662f\u7b80\u5355\u529f\u80fd\u7684\u5b9e\u73b0\uff1b\u5b83\u4e3b\u8981\u662f\u68c0\u67e5 ",(0,s.jsx)(n.code,{children:"Header"})," \u4e2d\u662f\u5426\u5b58\u5728 ",(0,s.jsx)(n.code,{children:"Authorization"})," \u5e76\u4e14\u503c\u975e\u7a7a\uff0c\u5982\u679c\u662f\u5c31\u8fdb\u884c\u6388\u6743\u901a\u8fc7\u3002"]}),"\n",(0,s.jsx)(n.h2,{id:"token",children:"token"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{alt:"auth",src:t(6568).A+"",width:"472",height:"360"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-yaml",children:"auth:\n  token:\n    realm: https://localhost:5011/auth\n    service: Authentication\n    issuer: Sample Issuer\n    rootCertBundle: /mnt/local/certs/RootCA.crt\n"})}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.code,{children:"token"})," \u8ba4\u8bc1\u9700\u8981\u501f\u52a9\u5916\u90e8\u8ba4\u8bc1\u670d\u52a1\uff0c\u53ef\u4ee5\u5b9e\u73b0\u8d44\u6e90\u3001\u6743\u9650\u7684\u7ba1\u7406\uff0c",(0,s.jsx)(n.code,{children:"distribution"})," \u7684\u54cd\u5e94\u7684\u65f6\u5019\u4f1a\u8fd4\u56de\u7ed9\u7528\u6237 ",(0,s.jsx)(n.code,{children:"scope"})," \u5c31\u662f\u8d44\u6e90\u6743\u9650"]}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:["\u542f\u52a8\u8fc7\u7a0b\u4f1a\u6821\u9a8c ",(0,s.jsx)(n.code,{children:"token"})," \u914d\u7f6e\u7684\u53c2\u6570\u662f\u5426\u6b63\u786e\uff0c\u5e76\u4e14\u6821\u9a8c ",(0,s.jsx)(n.code,{children:"tls"})," \u8bc1\u4e66\u3002"]}),"\n",(0,s.jsxs)(n.li,{children:["\u7528\u6237\u8bf7\u6c42\u65f6\uff0c\u4f1a\u4ece ",(0,s.jsx)(n.code,{children:"Header"})," \u4e2d\u83b7\u53d6\u8ba4\u8bc1\u4fe1\u606f\uff0c\u5982\u679c\u6ca1\u6709\u8ba4\u8bc1\uff0c\u5219\u4f1a\u6839\u636e\u662f\u5426\u914d\u7f6e ",(0,s.jsx)(n.code,{children:"autoRedirect"})," \u4ee5\u53ca\u91cd\u5b9a\u5411\u5730\u5740 ",(0,s.jsx)(n.code,{children:"realm"}),"\u3002"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"distribution"})," \u4f1a\u8fd4\u56de ",(0,s.jsx)(n.code,{children:"401"})," \u7684\u8bf7\u6c42\uff0c\u5e76\u643a\u5e26",(0,s.jsx)(n.code,{children:"WWW-Authenticate"})," \u544a\u8bc9\u5ba2\u6237\u7aef\u6539\u5982\u4f55\u5411\u8ba4\u8bc1\u670d\u52a1\u8fdb\u884c\u8ba4\u8bc1\u3002"]}),"\n"]}),"\n",(0,s.jsxs)(n.blockquote,{children:["\n",(0,s.jsxs)(n.p,{children:["\u5982\uff1a\u4e00\u4e2a\u672a\u6388\u6743\u7684\u7528\u6237\u6b63\u5728 ",(0,s.jsx)(n.code,{children:"Push"}),"\u955c\u50cf\u5230 ",(0,s.jsx)(n.code,{children:"samalba/my-app"})," repoName \u4e2d\uff0c\u5c31\u4f1a\u8fd4\u56de"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"scope: \u6388\u6743\u8303\u56f4"}),"\n",(0,s.jsx)(n.li,{children:"service: \u6388\u6743\u670d\u52a1"}),"\n",(0,s.jsx)(n.li,{children:"realm: \u8ba4\u8bc1\u670d\u52a1"}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-shell",children:'HTTP/1.1 401 Unauthorized\nContent-Type: application/json; charset=utf-8\nDocker-Distribution-Api-Version: registry/2.0\nWww-Authenticate: Bearer realm="https://auth.docker.io/token",service="registry.docker.io",scope="repository:samalba/my-app:pull,push"\nDate: Thu, 10 Sep 2015 19:32:31 GMT\nContent-Length: 235\nStrict-Transport-Security: max-age=31536000\n\n{"errors":[{"code":"UNAUTHORIZED","message":"access to the requested resource is not authorized","detail":[{"Type":"repository","Name":"samalba/my-app","Action":"pull"},{"Type":"repository","Name":"samalba/my-app","Action":"push"}]}]}\n'})}),"\n",(0,s.jsxs)(n.ol,{start:"4",children:["\n",(0,s.jsxs)(n.li,{children:["\u5982\u679c\u5f00\u542f\u81ea\u52a8\u91cd\u5b9a\u5411\uff0c\u5219\u8bf7\u6c42\u7684\u5c31\u662f ",(0,s.jsx)(n.code,{children:"distribution"})," host \u7684\u63a5\u53e3\uff1a",(0,s.jsx)(n.code,{children:"https://%s/auth/token"}),"\uff0c\u6ca1\u6709\u5219\u8d70\u7528\u6237\u914d\u7f6e",(0,s.jsx)(n.code,{children:"realm"})]}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(a,{...e})}):a(e)}},5569:(e,n,t)=>{t.d(n,{A:()=>s});const s=t.p+"assets/images/auth-02304b74ba61487a8263ce6a891a474d.png"},6568:(e,n,t)=>{t.d(n,{A:()=>s});const s=t.p+"assets/images/v2-registry-auth-df4a5006246cd127c0d0c30510537f50.png"},8453:(e,n,t)=>{t.d(n,{R:()=>c,x:()=>l});var s=t(6540);const i={},r=s.createContext(i);function c(e){const n=s.useContext(r);return s.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:c(e.components),s.createElement(r.Provider,{value:n},e.children)}}}]);