"use strict";(self.webpackChunkblogs=self.webpackChunkblogs||[]).push([[3804],{6394:(e,d,n)=>{n.r(d),n.d(d,{assets:()=>s,contentTitle:()=>o,default:()=>a,frontMatter:()=>l,metadata:()=>r,toc:()=>t});var i=n(4848),c=n(8453);const l={slug:"Kubernetes-Scheduler",title:"Kubernetes Scheduler",authors:["rongfu"],tags:["Kubernetes","Kubernetes Scheduler"]},o="Kubernetes Scheduler",r={permalink:"/blog/Kubernetes-Scheduler",editUrl:"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/blog/2022-07-11-Kubernetes-Scheduler.md",source:"@site/blog/2022-07-11-Kubernetes-Scheduler.md",title:"Kubernetes Scheduler",description:"Kubernetes Scheduler \u57fa\u672c\u4f7f\u7528\u6982\u5ff5",date:"2022-07-11T00:00:00.000Z",tags:[{inline:!1,label:"Kubernetes",permalink:"/blog/tags/kubernetes",description:"kubernetes"},{inline:!1,label:"Kubernetes Scheduler",permalink:"/blog/tags/kubernetes-scheduler",description:"Kubernetes Scheduler"}],readingTime:10.29,hasTruncateMarker:!0,authors:[{name:"Leng",title:"Softwore Developer",url:"https://github.com/lengrongfu",image_hrl:"https://avatars.githubusercontent.com/u/15009201?v=4",socials:{github:"https://github.com/lengrongfu"},key:"rongfu",page:null}],frontMatter:{slug:"Kubernetes-Scheduler",title:"Kubernetes Scheduler",authors:["rongfu"],tags:["Kubernetes","Kubernetes Scheduler"]},unlisted:!1,prevItem:{title:"Distribution Auth Type",permalink:"/blog/distribution-auth"},nextItem:{title:"\u8bfb\u300a\u4e91\u8ba1\u7b97\u90a3\u4e9b\u4e8b\u513f\u300b",permalink:"/blog/\u8bfb\u4e91\u8ba1\u7b97\u90a3\u4e9b\u4e8b\u513f"}},s={authorsImageUrls:[void 0]},t=[{value:"Scheduler Workflow",id:"scheduler-workflow",level:2},{value:"Scheduler FrameWork",id:"scheduler-framework",level:2},{value:"Scheduler Plugin",id:"scheduler-plugin",level:2},{value:"Sort(\u6392\u5e8f)",id:"sort\u6392\u5e8f",level:3},{value:"1.PrioritySort",id:"1prioritysort",level:4},{value:"Filter(\u9884\u9009)",id:"filter\u9884\u9009",level:3},{value:"1. InterPodAffinity",id:"1-interpodaffinity",level:4},{value:"2. NodeAffinity",id:"2-nodeaffinity",level:4},{value:"3.NodeName",id:"3nodename",level:4},{value:"4.NodePorts",id:"4nodeports",level:4},{value:"5.NodeResourcesFit",id:"5noderesourcesfit",level:4},{value:"6.NodeUnschedulable",id:"6nodeunschedulable",level:4},{value:"7.NodeVolumeLimits",id:"7nodevolumelimits",level:4},{value:"8.PodTopologySpread",id:"8podtopologyspread",level:4},{value:"9.TaintToleration",id:"9tainttoleration",level:4},{value:"10.VolumeBinding",id:"10volumebinding",level:4},{value:"11.VolumeRestrictions",id:"11volumerestrictions",level:4},{value:"Score(\u4f18\u9009)",id:"score\u4f18\u9009",level:3},{value:"1.ImageLocality",id:"1imagelocality",level:4},{value:"2.InterPodAffinity",id:"2interpodaffinity",level:4},{value:"3.NodeAffinity",id:"3nodeaffinity",level:4},{value:"4.NodeResourcesBalancedAllocation",id:"4noderesourcesbalancedallocation",level:4},{value:"5.NodeResourcesFit",id:"5noderesourcesfit-1",level:4},{value:"6.PodTopologySpread",id:"6podtopologyspread",level:4},{value:"7.SelectorSpread",id:"7selectorspread",level:4},{value:"8.TaintToleration",id:"8tainttoleration",level:4},{value:"Binding(\u7ed1\u5b9a)",id:"binding\u7ed1\u5b9a",level:3},{value:"1. DefaultBind",id:"1-defaultbind",level:4},{value:"2.VolumeBinding",id:"2volumebinding",level:4},{value:"Preemption(\u62a2\u5360)",id:"preemption\u62a2\u5360",level:3},{value:"1.DefaultPreemption",id:"1defaultpreemption",level:4}];function h(e){const d={code:"code",h2:"h2",h3:"h3",h4:"h4",img:"img",li:"li",p:"p",pre:"pre",ul:"ul",...(0,c.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(d.p,{children:"Kubernetes Scheduler \u57fa\u672c\u4f7f\u7528\u6982\u5ff5"}),"\n",(0,i.jsx)(d.h2,{id:"scheduler-workflow",children:"Scheduler Workflow"}),"\n",(0,i.jsx)(d.p,{children:(0,i.jsx)(d.img,{alt:"schedule-workflow",src:n(6351).A+"",width:"1643",height:"863"})}),"\n",(0,i.jsxs)(d.p,{children:[(0,i.jsx)(d.code,{children:"Scheduler WorkFlow"}),"\u5b9a\u4e49\u4e86",(0,i.jsx)(d.code,{children:"Scheduler Cycle"}),"\u548c",(0,i.jsx)(d.code,{children:"Binding Cycle"}),"\uff0c\u5728",(0,i.jsx)(d.code,{children:"Scheduler Cycle"}),"\u4e2d\u6709\u4e32\u884c",(0,i.jsx)(d.code,{children:"Filter "}),"\u548c",(0,i.jsx)(d.code,{children:"Score"}),"\u4e24\u4e2a\u9636\u6bb5\uff0c",(0,i.jsx)(d.code,{children:"Bind"}),"\u662f\u5f02\u6b65\u5e76\u884c\u9636\u6bb5\u3002"]}),"\n",(0,i.jsx)(d.h2,{id:"scheduler-framework",children:"Scheduler FrameWork"}),"\n",(0,i.jsxs)(d.p,{children:[(0,i.jsx)(d.code,{children:"Scheduler FrameWork"}),"\u662f\u901a\u8fc7\u5728",(0,i.jsx)(d.code,{children:"Scheduler  Cycle"}),"\u4e2d\u901a\u8fc7\u9884\u7559\u6269\u5c55\u70b9\u6765\u8fdb\u884c\u6269\u5c55\u8c03\u5ea6\u6d41\u7a0b\uff0c",(0,i.jsx)(d.code,{children:"FrameWork"}),"\u9884\u7559\u4e86\u591a\u4e2a\u6269\u5c55\u70b9:"]}),"\n",(0,i.jsxs)(d.ul,{children:["\n",(0,i.jsxs)(d.li,{children:[(0,i.jsx)(d.code,{children:"QueueSortFunc() LessFunc"}),"\uff1a ",(0,i.jsx)(d.code,{children:"Pod"})," \u4ece\u961f\u5217\u4e2d\u83b7\u53d6\u7684\u4f18\u5148\u7ea7"]}),"\n",(0,i.jsxs)(d.li,{children:[(0,i.jsx)(d.code,{children:"PreFilter"}),"\uff1a \u5728\u8fc7\u6ee4\u4e4b\u524d\u6267\u884c"]}),"\n",(0,i.jsxs)(d.li,{children:[(0,i.jsx)(d.code,{children:"Filter"}),"\uff1a \u6267\u884c\u8fc7\u6ee4\u51fd\u6570"]}),"\n",(0,i.jsxs)(d.li,{children:[(0,i.jsx)(d.code,{children:"PostFilter"}),": \u6267\u884c\u62a2\u5360"]}),"\n",(0,i.jsxs)(d.li,{children:[(0,i.jsx)(d.code,{children:"PreScore"}),"\uff1a\u6267\u884c`Score\u4e4b\u524d\u6267\u884c"]}),"\n",(0,i.jsxs)(d.li,{children:[(0,i.jsx)(d.code,{children:"Score"}),": \u6267\u884c",(0,i.jsx)(d.code,{children:"Node"}),"\u6253\u5206"]}),"\n",(0,i.jsxs)(d.li,{children:[(0,i.jsx)(d.code,{children:"PreBind"}),": \u6267\u884c",(0,i.jsx)(d.code,{children:"Binding"}),"\u4e4b\u524d"]}),"\n",(0,i.jsxs)(d.li,{children:[(0,i.jsx)(d.code,{children:"Bind"}),"\uff1a \u6267\u884c",(0,i.jsx)(d.code,{children:"Binding"}),"\u52a8\u4f5c"]}),"\n",(0,i.jsxs)(d.li,{children:[(0,i.jsx)(d.code,{children:"PostBind"}),"\uff1a\u6267\u884c",(0,i.jsx)(d.code,{children:"Binding"}),"\u4e4b\u540e"]}),"\n"]}),"\n",(0,i.jsxs)(d.p,{children:["\u81ea\u5b9a\u4e49",(0,i.jsx)(d.code,{children:"Schedlue"}),"\u53ef\u4ee5\u901a\u8fc7\u76f4\u63a5\u5b9e\u73b0",(0,i.jsx)(d.code,{children:"Scheduler FrameWork"}),"\u4e2d\u66b4\u9732\u7684\u63a5\u53e3\uff0c\u7136\u540e\u5728\u542f\u52a8\u8fc7\u7a0b\u4e2d\u8fdb\u884c",(0,i.jsx)(d.code,{children:"Plugin"}),"\u6ce8\u518c\u5373\u53ef\u3002"]}),"\n",(0,i.jsx)(d.pre,{children:(0,i.jsx)(d.code,{className:"language-go",children:'func main() {\n\trand.Seed(time.Now().UTC().UnixNano())\n\tlogs.InitLogs()\n\tdefer logs.FlushLogs()\n\n\tcmd := app.NewSchedulerCommand(\n\t\tapp.WithPlugin(sample.Name, sample.New),\n\t)\n\tif err := cmd.Execute(); err != nil {\n\t\t_, _ = fmt.Fprintf(os.Stderr, "%v\\n", err)\n\t\tos.Exit(1)\n\t}\n}\n'})}),"\n",(0,i.jsx)(d.h2,{id:"scheduler-plugin",children:"Scheduler Plugin"}),"\n",(0,i.jsxs)(d.p,{children:["\u5982\u4e0b\u7684",(0,i.jsx)(d.code,{children:"Scheduler Plugin"}),"\u662f",(0,i.jsx)(d.code,{children:"kube-scheduler"}),"\u91cc\u9762\u5185\u5d4c\u7684\u63d2\u4ef6\uff0c\u6db5\u76d6\u4e86",(0,i.jsx)(d.code,{children:"WorkFlow"}),"\u91cc\u9762\u7684\u6240\u6709\u6d41\u7a0b\u3002"]}),"\n",(0,i.jsx)(d.h3,{id:"sort\u6392\u5e8f",children:"Sort(\u6392\u5e8f)"}),"\n",(0,i.jsx)(d.h4,{id:"1prioritysort",children:"1.PrioritySort"}),"\n",(0,i.jsxs)(d.p,{children:[(0,i.jsx)(d.code,{children:"PrioritySort"}),"\u4f18\u5148\u961f\u5217\u662f\u8fdb\u884c",(0,i.jsx)(d.code,{children:"Pod"}),"\u5728\u5165\u961f\u65f6\u7684\u6392\u5e8f\u51fd\u6570\uff0c\u6309\u627e",(0,i.jsx)(d.code,{children:"Pod"}),"\u7684\u4f18\u5148\u7ea7\u8fdb\u884c\u6392\u5e8f\uff0c\u901a\u8fc7\u8bfb\u53d6",(0,i.jsx)(d.code,{children:"pod.Spec.Priority"}),"\u5b57\u6bb5\u503c\u8fdb\u884c\u6392\u5e8f\uff0c\u5982\u679c\u672a\u8bbe\u7f6e",(0,i.jsx)(d.code,{children:"Pod"}),"\u7684\u4f18\u5148\u7ea7\u5219\u6309\u7167\u6dfb\u52a0\u5230\u961f\u5217\u7684\u65f6\u95f4\u5148\u540e\u8fdb\u884c\u6392\u5e8f\u3002"]}),"\n",(0,i.jsx)(d.pre,{children:(0,i.jsx)(d.code,{className:"language-Go",children:"p1 := pod1.Spec.Priority != nil ? *pod1.Spec.Priority : 0\np2 := pod2.Spec.Priority != nil ? *pod2.Spec.Priority : 0\nreturn (p1 > p2) || (p1 == p2 && pInfo1.Timestamp.Before(pInfo2.Timestamp))\n"})}),"\n",(0,i.jsx)(d.h3,{id:"filter\u9884\u9009",children:"Filter(\u9884\u9009)"}),"\n",(0,i.jsx)(d.h4,{id:"1-interpodaffinity",children:"1. InterPodAffinity"}),"\n",(0,i.jsxs)(d.p,{children:[(0,i.jsx)(d.code,{children:"InterPodAffinity"})," \u68c0\u67e5",(0,i.jsx)(d.code,{children:"Pod"}),"\u7684\u4eb2\u548c\u6027\u662f\u5426\u6ee1\u8db3\uff0c\u5b9e\u73b0\u4e86",(0,i.jsx)(d.code,{children:"PreFilterPlugin"}),"\u548c",(0,i.jsx)(d.code,{children:"FilterPlugin"}),"\u4e24\u4e2a\u63d2\u4ef6\uff1b"]}),"\n",(0,i.jsx)(d.h4,{id:"2-nodeaffinity",children:"2. NodeAffinity"}),"\n",(0,i.jsxs)(d.p,{children:[(0,i.jsx)(d.code,{children:"NodeAffinity"}),"\u662f",(0,i.jsx)(d.code,{children:"Node"}),"\u4eb2\u548c\u6027\u7684\u8fc7\u6ee4\uff0c\u901a\u8fc7",(0,i.jsx)(d.code,{children:"pod.Spec.Affinity.NodeAffinity "}),"\u662f\u5426\u914d\u7f6e",(0,i.jsx)(d.code,{children:"Node"}),"\u4eb2\u548c\u6027\u548c",(0,i.jsx)(d.code,{children:"Node"}),"\u8fdb\u884c",(0,i.jsx)(d.code,{children:"Match"}),"\u52a8\u4f5c\u3002"]}),"\n",(0,i.jsx)(d.h4,{id:"3nodename",children:"3.NodeName"}),"\n",(0,i.jsxs)(d.p,{children:[(0,i.jsx)(d.code,{children:"NodeName"}),"\u7528\u4e8e\u5728\u5bf9",(0,i.jsx)(d.code,{children:"pod.Spec.NodeName"}),"\u5b57\u6bb5\u503c\u7684\u5224\u65ad\uff0c\u5224\u65ad\u662f\u5426\u662f\u5f53\u524d\u7684",(0,i.jsx)(d.code,{children:"Node"}),"\uff0c\u5982\u679c\u6307\u5b9a\u4e86",(0,i.jsx)(d.code,{children:"pod.Spec.NodeName"}),"\u5e76\u4e14\u4e0d\u662f\u5f53\u524d\u7684\u8282\u70b9\uff0c\u5219\u8fd4\u56de",(0,i.jsx)(d.code,{children:"UnschedulableAndUnresolvable"}),"\u72b6\u6001\u3002"]}),"\n",(0,i.jsx)(d.h4,{id:"4nodeports",children:"4.NodePorts"}),"\n",(0,i.jsxs)(d.p,{children:[(0,i.jsx)(d.code,{children:"NodePorts"}),"\u7528\u4e8e\u68c0\u67e5\u8981\u542f\u7528\u7684\u7aef\u53e3\u662f\u5426\u5df2\u7ecf\u5728",(0,i.jsx)(d.code,{children:"Node"}),"\u4e0a\u4f7f\u7528\u8fc7\uff0c\u5982\u679c\u4f7f\u7528\u8fc7\u5219\u8fd4\u56de",(0,i.jsx)(d.code,{children:"Unschedulable"}),"\u72b6\u6001\u3002"]}),"\n",(0,i.jsx)(d.h4,{id:"5noderesourcesfit",children:"5.NodeResourcesFit"}),"\n",(0,i.jsxs)(d.p,{children:[(0,i.jsx)(d.code,{children:"NodeResourcesFit"})," \u68c0\u67e5\u8282\u70b9\u662f\u5426\u6709\u8db3\u591f\u7684\u8d44\u6e90\uff0c\u5982:",(0,i.jsx)(d.code,{children:"cpu"}),"\u3001",(0,i.jsx)(d.code,{children:"memory"}),"\u3001",(0,i.jsx)(d.code,{children:"gpu"}),"\u7b49\uff0c\u901a\u8fc7\u90a3\u53d6",(0,i.jsx)(d.code,{children:"max_resource(sum_pod, any_init_container)"}),"\u548c",(0,i.jsx)(d.code,{children:"node"}),"\u53ef\u5206\u914d\u7684\u8d44\u6e90\u6765\u5224\u65ad\u8282\u70b9\u662f\u5426\u8d44\u6e90\u8db3\u591f\u3002\u5982\u679c\u6709\u4efb\u4e00\u8d44\u6e90\u4e0d\u591f\uff0c\u6b64\u8282\u70b9\u5219\u4f1a\u8fd4\u56de\u8d44\u6e90\u4e0d\u8db3\u88ab\u8fc7\u6ee4\u3002"]}),"\n",(0,i.jsx)(d.h4,{id:"6nodeunschedulable",children:"6.NodeUnschedulable"}),"\n",(0,i.jsxs)(d.p,{children:[(0,i.jsx)(d.code,{children:"NodeUnschedulable"})," \u63d2\u4ef6\u8fc7\u6ee4\u8bbe\u7f6e",(0,i.jsx)(d.code,{children:"node.Spec.Unschedulable=true"}),"\u7684\u8282\u70b9\uff0c\u4f46\u662f\u5982\u679c",(0,i.jsx)(d.code,{children:"Pod"}),"\u8bbe\u7f6e\u4e86\u5bb9\u5fcd",(0,i.jsx)(d.code,{children:"Unschedulable"}),"\u7684\u6c61\u70b9\u5219\u4e0d\u8fc7\u6ee4\u3002"]}),"\n",(0,i.jsx)(d.h4,{id:"7nodevolumelimits",children:"7.NodeVolumeLimits"}),"\n",(0,i.jsxs)(d.p,{children:[(0,i.jsx)(d.code,{children:"NodeVolumeLimits"}),"\u662f\u4e00\u4e2a\u8282\u70b9\u68c0\u67e5",(0,i.jsx)(d.code,{children:"volume"}),"\u5bb9\u91cf\u7684\u63d2\u4ef6\uff1b \u6821\u9a8cPVC\u6307\u5b9a\u7684Provision\u5728CSI plugin\u6216\u975eCSI Plugin\uff08\u540e\u4e09\u4e2a\uff09\u4e0a\u62a5\u7684\u5355\u673a\u6700\u5927\u6302\u76d8\u6570\uff08\u5b58\u50a8\u63d2\u4ef6\u63d0\u4f9b\u65b9\u4e00\u822c\u5bf9\u6bcf\u4e2a\u8282\u70b9\u7684\u5355\u673a\u6700\u5927\u6302\u8f7d\u78c1\u76d8\u6570\u662f\u6709\u9650\u5236\u7684\uff09"]}),"\n",(0,i.jsx)(d.h4,{id:"8podtopologyspread",children:"8.PodTopologySpread"}),"\n",(0,i.jsxs)(d.p,{children:[(0,i.jsx)(d.code,{children:"PodTopologySpread"})," \u662f\u7528\u4e8e\u68c0\u67e5",(0,i.jsx)(d.code,{children:"Pod"}),"\u7684\u62d3\u6251\u903b\u8f91\u662f\u5426\u6ee1\u8db3\u6761\u4ef6\uff0c"]}),"\n",(0,i.jsx)(d.h4,{id:"9tainttoleration",children:"9.TaintToleration"}),"\n",(0,i.jsxs)(d.p,{children:[(0,i.jsx)(d.code,{children:"TaintToleration"}),"\u662f\u4e00\u4e2a\u6c61\u70b9\u5bb9\u5fcd\u5ea6\u7684\u63d2\u4ef6\uff0c\u7528\u4e8e\u68c0\u67e5",(0,i.jsx)(d.code,{children:"Pod"}),"\u662f\u5426\u80fd\u5bb9\u5fcd\u6b21\u6c61\u70b9\u3002",(0,i.jsx)(d.code,{children:"Taint"}),"\u6c61\u70b9\u662f",(0,i.jsx)(d.code,{children:"Node"}),"\u4e0a\u7684\u6807\u7b7e\uff0c",(0,i.jsx)(d.code,{children:"Toleration"}),"\u5bb9\u5fcd\u5ea6\u662f",(0,i.jsx)(d.code,{children:"Pod"}),"\u4e0a\u7684\u529f\u80fd\uff0c\u4e00\u4e2a\u5bb9\u5fcd\u5ea6\u548c\u4e00\u4e2a\u6c61\u70b9\u76f8\u201c\u5339\u914d\u201d\u662f\u6307\u5b83\u4eec\u6709\u4e00\u6837\u7684",(0,i.jsx)(d.code,{children:"key"}),"\u548c",(0,i.jsx)(d.code,{children:"value"}),"\u3002"]}),"\n",(0,i.jsx)(d.h4,{id:"10volumebinding",children:"10.VolumeBinding"}),"\n",(0,i.jsxs)(d.p,{children:[(0,i.jsx)(d.code,{children:"VolumeBinding"}),"\u68c0\u67e5",(0,i.jsx)(d.code,{children:"Pod"}),"\u6302\u8f7d\u7684",(0,i.jsx)(d.code,{children:"PVC"}),"\uff0c\u5982\u679c\u5176\u5bf9\u5e94",(0,i.jsx)(d.code,{children:"SC(StorageClass)"}),"\u7684",(0,i.jsx)(d.code,{children:"VolumeBindingMode"}),"\u662f",(0,i.jsx)(d.code,{children:"Immediate"}),"\u6a21\u5f0f\uff0c\u8be5",(0,i.jsx)(d.code,{children:"PVC"}),"\u5fc5\u987b\u5df2\u7ecf\u662f",(0,i.jsx)(d.code,{children:"bound"}),"\uff0c\u5426\u5219\u9700\u8981\u8fd4\u56de",(0,i.jsx)(d.code,{children:"UnschedulableAndUnresolvable"}),"\u3002"]}),"\n",(0,i.jsx)(d.h4,{id:"11volumerestrictions",children:"11.VolumeRestrictions"}),"\n",(0,i.jsxs)(d.p,{children:[(0,i.jsx)(d.code,{children:"VolumeRestrictions"})," \u68c0\u67e5\u6302\u8f7d\u8be5Node\u4e0a\u7684\u5377\u662f\u5426\u6ee1\u8db3\u5b58\u50a8\u63d0\u4f9b\u8005\u7684\u8981\u6c42"]}),"\n",(0,i.jsx)(d.h3,{id:"score\u4f18\u9009",children:"Score(\u4f18\u9009)"}),"\n",(0,i.jsx)(d.h4,{id:"1imagelocality",children:"1.ImageLocality"}),"\n",(0,i.jsxs)(d.p,{children:[(0,i.jsx)(d.code,{children:"ImageLocality"}),"\u662f\u4e00\u4e2a\u6253\u5206\u63d2\u4ef6\uff0c\u5bf9\u4e8e\u8c03\u5ea6",(0,i.jsx)(d.code,{children:"Pod"}),"\u7684\u955c\u50cf\u5df2\u7ecf\u5b58\u5728",(0,i.jsx)(d.code,{children:"Node"}),"\u4e0a\u7ed9\u8bc4\u5206\u3002\u5df2\u7ecf\u5b58\u5728\u7684\u955c\u50cf\u5e76\u4e14\u955c\u50cf\u8d8a\u5927\u7684\u5206\u8d8a\u9ad8\uff1b\uff08\u903b\u8f91\u5c31\u662f\u8d8a\u5927\u7684\u955c\u50cf\u5982\u679c\u88ab\u91cd\u65b0\u62c9\u53d6\u9700\u8981\u82b1\u8d39\u66f4\u591a\u7684\u65f6\u95f4\uff0c\u4f46\u662f\u5c0f\u7684\u955c\u50cf\u62c9\u8d77\u6765\u5c31\u5feb\uff0c\u6240\u4ee5\u955c\u50cf\u5b58\u5728\u5e76\u4e14\u8d8a\u5927\u7684\u5206\u8d8a\u9ad8\u5c31\u662f\u8fd9\u4e2a\u903b\u8f91\uff09;\u5982\u679c\u4e00\u4e2a\u8282\u70b9\u4e0a\u7684\u955c\u50cf\u603b\u5927\u5c0f",(0,i.jsx)(d.code,{children:"< 23Mb"}),"\u5219",(0,i.jsx)(d.code,{children:"node"}),"\u4f1a\u88ab\u6253",(0,i.jsx)(d.code,{children:"0"}),"\u5206\uff1b\u5982\u679c\u4e00\u4e2a\u8282\u70b9\u4e0a\u7684\u955c\u50cf\u603b\u5927\u4e8e",(0,i.jsx)(d.code,{children:"1G * \u5bb9\u5668\u6570"}),"\u5219\u4f1a\u88ab\u6253",(0,i.jsx)(d.code,{children:"1"}),"\u5206\u3002"]}),"\n",(0,i.jsx)(d.h4,{id:"2interpodaffinity",children:"2.InterPodAffinity"}),"\n",(0,i.jsxs)(d.p,{children:[(0,i.jsx)(d.code,{children:"InterPodAffinity"}),"\u5728",(0,i.jsx)(d.code,{children:"Pod"}),"\u4eb2\u548c\u6027\u4e4b\u95f4\u8ba1\u7b97\u4eb2\u548c\u6027\u7684\u7684\u5206\u503c\u3002"]}),"\n",(0,i.jsx)(d.h4,{id:"3nodeaffinity",children:"3.NodeAffinity"}),"\n",(0,i.jsxs)(d.p,{children:[(0,i.jsx)(d.code,{children:"NodeAffinity"}),"\u662f\u901a\u8fc7\u8282\u70b9\u7684\u4eb2\u548c\u6027\u6765\u8fdb\u884c\u8282\u70b9\u6253\u5206\u7684\uff0c",(0,i.jsx)(d.code,{children:"PreScore"})," \u4e3b\u8981\u903b\u8f91\u662f\u4ece",(0,i.jsx)(d.code,{children:"pod.Spec.Affinity.NodeAffinity.PreferredDuringSchedulingIgnoredDuringExecution"}),"\u5b57\u6bb5\u4e2d\u83b7\u53d6\u9996\u9009\u8282\u70b9\u4eb2\u548c\u914d\u7f6e\uff0c\u4e3b\u8981\u7684\u662f\u914d\u7f6e\u7684",(0,i.jsx)(d.code,{children:"weight"}),"\u5b57\u6bb5\u503c\uff0c\u5728\u901a\u8fc7",(0,i.jsx)(d.code,{children:"Label"}),"\u5339\u914d\u8fc7\u7a0b\u4e2d\uff0c\u53d1\u73b0",(0,i.jsx)(d.code,{children:"Node.Meta.Label"}),"\u662f\u5339\u914d",(0,i.jsx)(d.code,{children:"matchExpressions"}),"\u4e2d\u7684\u5b57\u6bb5\u5219",(0,i.jsx)(d.code,{children:"score += weight"}),"\uff0c\u8fd9\u6837\u8fd9\u4e2a\u8282\u70b9\u7684\u4f18\u5148\u7ea7\u5c31\u63d0\u9ad8\u4e86\u3002"]}),"\n",(0,i.jsx)(d.h4,{id:"4noderesourcesbalancedallocation",children:"4.NodeResourcesBalancedAllocation"}),"\n",(0,i.jsxs)(d.p,{children:[(0,i.jsx)(d.code,{children:"NodeResourcesBalancedAllocation"}),"\u8282\u70b9\u8d44\u6e90\u5747\u8861\u63d2\u4ef6\uff0c\u662f\u4e00\u4e2a\u901a\u8fc7",(0,i.jsx)(d.code,{children:"cpu"}),"\u548c",(0,i.jsx)(d.code,{children:"memory"}),"\u5bb9\u91cf\u5206\u6570\u4e4b\u95f4\u7684\u5dee\u5f02\uff0c\u6839\u636e\u4ed6\u4eec\u7684\u4f18\u5148\u7ea7\u8fdb\u884c\u6392\u540d\uff1b\u5bf9\u4e8e\u8d44\u6e90\u4f7f\u7528\u7387\u5747\u8861\u7684\u8282\u70b9\u5206\u503c\u66f4\u9ad8\u3002"]}),"\n",(0,i.jsx)(d.pre,{children:(0,i.jsx)(d.code,{children:'# ResourceSpec[{"name":"cpu","Weight":1},{"name":"memory","Weight":1}]\n\nstd =  \u03a3((fraction(i)-mean)^2)/len(resources)\n# std\u8ba1\u7b97\u53d6\u51b3\u4e8e\u9700\u8981\u5747\u8861\u51e0\u79cd\u8d44\u6e90\uff0c\u5982\u679c\u53ea\u6709cpu\u548cmemory\nstd=Abs( (cpuRequest1/cpuAllocable1 - memoryRequest1/memoryAllocable1) / 2 )\n# node\u6253\u5206\u5219\u7531\u5982\u4e0b\u8ba1\u7b97\nscore = (1 - std) * MaxNodeScore(100)\n'})}),"\n",(0,i.jsx)(d.h4,{id:"5noderesourcesfit-1",children:"5.NodeResourcesFit"}),"\n",(0,i.jsxs)(d.p,{children:[(0,i.jsx)(d.code,{children:"NodeResourcesFit"}),"\u6253\u5206\u5df2\u7ecf\u914d\u7f6e\u7684\u7b56\u7565\u8fdb\u884c\uff0c\u6709\u5982\u4e0b\u4e09\u79cd\uff1a"]}),"\n",(0,i.jsxs)(d.ul,{children:["\n",(0,i.jsxs)(d.li,{children:[(0,i.jsx)(d.code,{children:"LeastAllocated"}),": \u4f18\u5148\u5206\u914d\u8d44\u6e90\u6700\u5c11\u7684\u8282\u70b9\uff1b\u5c31\u662f\u8d44\u6e90\u5806\u53e0"]}),"\n",(0,i.jsxs)(d.li,{children:[(0,i.jsx)(d.code,{children:"MostAllocated"}),": \u4f18\u5148\u5206\u914d\u8d44\u6e90\u6700\u591a\u7684\u8282\u70b9\uff1b\u5c31\u662f\u8d44\u6e90\u6253\u6563"]}),"\n",(0,i.jsxs)(d.li,{children:[(0,i.jsx)(d.code,{children:"RequestedToCapacityRatio"}),": \u53ef\u4ee5\u81ea\u5b9a\u4e49\u51fd\u6570\uff0c\u5bf9\u8d44\u6e90\u5bb9\u91cf\u8fdb\u884c\u6253\u5206\u3002"]}),"\n"]}),"\n",(0,i.jsxs)(d.p,{children:[(0,i.jsx)(d.code,{children:"LeastAllocated"}),"\u8ba1\u7b97\u8282\u70b9\u5206\u503c\u903b\u8f91\uff1a",(0,i.jsx)(d.code,{children:"(cpu((capacity-requested)*MaxNodeScore*cpuWeight/capacity) + memory((capacity-requested)*MaxNodeScore*memoryWeight/capacity) + ...)/weightSum"})]}),"\n",(0,i.jsxs)(d.p,{children:["MostAllocated \u8ba1\u7b97\u8282\u70b9\u5206\u503c\u903b\u8f91\uff1a",(0,i.jsx)(d.code,{children:"(cpu(MaxNodeScore * sum(requested) / capacity) + memory(MaxNodeScore * sum(requested) / capacity) + ...) / weightSum"})]}),"\n",(0,i.jsxs)(d.p,{children:[(0,i.jsx)(d.code,{children:"capacity"}),"\u662f",(0,i.jsx)(d.code,{children:"allocable"})]}),"\n",(0,i.jsx)(d.h4,{id:"6podtopologyspread",children:"6.PodTopologySpread"}),"\n",(0,i.jsxs)(d.p,{children:[(0,i.jsx)(d.code,{children:"PodTopologySpread"}),"\u6743\u91cd\u4e3a2"]}),"\n",(0,i.jsx)(d.h4,{id:"7selectorspread",children:"7.SelectorSpread"}),"\n",(0,i.jsxs)(d.p,{children:[(0,i.jsx)(d.code,{children:"SelectorSpread"}),"\u662f\u4e00\u4e2a\u8ba1\u7b97\u9009\u62e9\u5668\u4f20\u64ad\u4f18\u5148\u7ea7\u7684\u6253\u5206\u63d2\u4ef6\uff1b"]}),"\n",(0,i.jsx)(d.h4,{id:"8tainttoleration",children:"8.TaintToleration"}),"\n",(0,i.jsxs)(d.p,{children:[(0,i.jsx)(d.code,{children:"TaintToleration\u8ba1\u7b97\u65e0\u6cd5\u5bb9\u5fcd\u6c61\u70b9\u7684\u4e00\u4e2a\u63d2\u4ef6\uff0c\u7528\u4e8e\u7ed9"}),"Pod \u65e0\u6cd5\u5bb9\u5fcd\u6c61\u70b9\u6253\u5206\uff0c\u6bcf\u4e00\u4e2a\u65e0\u6cd5\u5bb9\u5fcd\u5219",(0,i.jsx)(d.code,{children:"+1"}),"\uff0c\u6700\u540e\u5f97\u5230\u7684\u5c31\u662f",(0,i.jsx)(d.code,{children:"Node"}),"\u7684\u5206\u3002"]}),"\n",(0,i.jsx)(d.h3,{id:"binding\u7ed1\u5b9a",children:"Binding(\u7ed1\u5b9a)"}),"\n",(0,i.jsx)(d.h4,{id:"1-defaultbind",children:"1. DefaultBind"}),"\n",(0,i.jsxs)(d.p,{children:[(0,i.jsx)(d.code,{children:"DefaultBind"}),"\u662f\u901a\u8fc7\u4f7f\u7528",(0,i.jsx)(d.code,{children:"k8s client"}),"\u7ed1\u5b9a",(0,i.jsx)(d.code,{children:"Pod"}),"\u5230",(0,i.jsx)(d.code,{children:"Node"}),"\u3002\u7ed1\u5b9a\u6d41\u7a0b\u662f\u5148\u521b\u5efa\u4e00\u4e2a",(0,i.jsx)(d.code,{children:"Binding"}),"\u7c7b\u578b\u5bf9\u8c61\uff0c\u901a\u8fc7\u8bbe\u7f6e",(0,i.jsx)(d.code,{children:"Target"}),"\u5b57\u6bb5\u503c\uff0c\u6765\u8bb0\u5f55\u7ed1\u5b9a\u5bf9\u8c61\u7684\u76ee\u6807\u5bf9\u8c61\u3002"]}),"\n",(0,i.jsx)(d.pre,{children:(0,i.jsx)(d.code,{className:"language-go",children:'# Binding\u662f\u5c06\u4e00\u4e2a\u5bf9\u8c61\u4e0e\u53e6\u4e00\u4e2a\u5bf9\u8c61\u8054\u7cfb\u8d77\u6765\ntype Binding struct {\n\tmetav1.TypeMeta `json:",inline"`\n\tmetav1.ObjectMeta `json:"metadata,omitempty" protobuf:"bytes,1,opt,name=metadata"`\n\tTarget ObjectReference `json:"target" protobuf:"bytes,2,opt,name=target"`\n}\nbinding := &v1.Binding{\n\t\tObjectMeta: metav1.ObjectMeta{Namespace: p.Namespace, Name: p.Name, UID: p.UID},\n\t\tTarget:     v1.ObjectReference{Kind: "Node", Name: nodeName},\n}\n'})}),"\n",(0,i.jsxs)(d.p,{children:["\u521b\u5efa",(0,i.jsx)(d.code,{children:"Binding"}),"\u5bf9\u8c61\u4e4b\u540e\uff0c\u901a\u8fc7",(0,i.jsx)(d.code,{children:"Pods"}),"\u7684",(0,i.jsx)(d.code,{children:"Bind"}),"\u65b9\u6cd5\u5c31\u53ef\u4ee5\u8fdb\u884c\u7ed3\u679c\u7ed1\u5b9a\u3002\u6700\u7ec8\u662f\u521b\u5efa",(0,i.jsx)(d.code,{children:"Pod"}),"\u7684\u7ed1\u5b9a\u3002"]}),"\n",(0,i.jsx)(d.pre,{children:(0,i.jsx)(d.code,{className:"language-http",children:"POST /api/v1/namespaces/{namespace}/pods/{name}/binding\nnamespace: pod namespace\nname: binding \u540d\u5b57\nbody: Binding\u5bf9\u8c61\u7ed3\u6784\u4f53\n"})}),"\n",(0,i.jsx)(d.p,{children:"\u9009\u4e2d\u7684\u8282\u70b9\u5728\u548c\u5f85\u8c03\u5ea6Pod\u8fdb\u884cBind\u7684\u65f6\u5019\uff0c\u6709\u53ef\u80fd\u4f1aBind\u5931\u8d25\uff0c\u6b64\u65f6\u9700\u8981\u505a\u56de\u9000\uff0c\u628aPod\u7684Assumed\u72b6\u6001\u9000\u56deInitial\uff0c\u4eceNode\u91cc\u9762\u628aPod\u6570\u636e\u8d26\u672c\u64e6\u9664\u6389\uff0c\u4f1a\u628aPod\u91cd\u65b0\u4e22\u56de\u5230unschedulableQ\u961f\u5217\u91cc\u9762\u3002\u5728unschedulableQ\u91cc\uff0c\u5982\u679c\u4e00\u4e2aPod\u4e00\u5206\u949f\u6ca1\u8c03\u5ea6\u8fc7\uff0c\u5c31\u4f1a\u91cd\u65b0\u56de\u5230activeQ\u3002\u5b83\u7684\u8f6e\u8be2\u5468\u671f\u662f30s\u3002"}),"\n",(0,i.jsxs)(d.p,{children:["\u8c03\u5ea6\u5931\u8d25\u7684",(0,i.jsx)(d.code,{children:"Pod"}),"\u4f1a\u653e\u5230",(0,i.jsx)(d.code,{children:"backoffQ"}),"\uff0c\u5728",(0,i.jsx)(d.code,{children:"backoffQ"}),"\u91cc\u7b49\u5f85\u7684\u65f6\u95f4\u4f1a\u6bd4\u5728",(0,i.jsx)(d.code,{children:"unschedulableQ"}),"\u91cc\u66f4\u77ed\uff0c",(0,i.jsx)(d.code,{children:"backoffQ"}),"\u91cc\u7684\u964d\u7ea7\u7b56\u7565\u662f",(0,i.jsx)(d.code,{children:"2"}),"\u7684\u6307\u6570\u6b21\u5e42\u964d\u7ea7\u3002\u5047\u8bbe\u91cd\u8bd5\u7b2c\u4e00\u6b21\u4e3a",(0,i.jsx)(d.code,{children:"1s"}),"\uff0c\u90a3\u7b2c\u4e8c\u6b21\u5c31\u662f",(0,i.jsx)(d.code,{children:"2s"}),"\uff0c\u7b2c\u4e09\u6b21\u5c31\u662f",(0,i.jsx)(d.code,{children:"4s"}),"\uff0c\u4f46\u6700\u5927\u5230",(0,i.jsx)(d.code,{children:"10s"}),"\u3002"]}),"\n",(0,i.jsx)(d.h4,{id:"2volumebinding",children:"2.VolumeBinding"}),"\n",(0,i.jsxs)(d.p,{children:[(0,i.jsx)(d.code,{children:"VolumeBinding"}),"\u662f",(0,i.jsx)(d.code,{children:"PreBinding"}),"\u4f5c\u4e3a",(0,i.jsx)(d.code,{children:"Binding"}),"\u4e4b\u524d\u68c0\u67e5\u7684",(0,i.jsx)(d.code,{children:"Volume"}),"\u662f\u5426\u7ed1\u5b9a\u5230",(0,i.jsx)(d.code,{children:"Node"}),"\u4e0a\u9762\uff0c"]}),"\n",(0,i.jsx)(d.h3,{id:"preemption\u62a2\u5360",children:"Preemption(\u62a2\u5360)"}),"\n",(0,i.jsx)(d.h4,{id:"1defaultpreemption",children:"1.DefaultPreemption"}),"\n",(0,i.jsxs)(d.p,{children:[(0,i.jsx)(d.code,{children:"DefaultPreemption"}),"\u662f\u4e00\u4e2a",(0,i.jsx)(d.code,{children:"PostFilter"}),"\u63d2\u4ef6\uff0c\u5b9e\u73b0\u4e86\u9ed8\u8ba4\u62a2\u5360\u903b\u8f91\uff1b\u5f53\u9ad8\u4f18\u5148\u7ea7\u7684",(0,i.jsx)(d.code,{children:"Pod"}),"\u6ca1\u6709\u627e\u5230\u5408\u9002\u7684",(0,i.jsx)(d.code,{children:"Node"}),"\u65f6\uff0c\u4f1a\u6267\u884c",(0,i.jsx)(d.code,{children:"Preempt"}),"\u62a2\u5360\u7b97\u6cd5\uff0c\u62a2\u5360\u7684\u6d41\u7a0b\u3002"]}),"\n",(0,i.jsxs)(d.ul,{children:["\n",(0,i.jsxs)(d.li,{children:["\u4e00\u4e2a",(0,i.jsx)(d.code,{children:"Pod"}),"\u8fdb\u5165\u62a2\u5360\u7684\u65f6\u5019\uff0c\u9996\u5148\u4f1a\u5224\u65ad",(0,i.jsx)(d.code,{children:"Pod"}),"\u662f\u5426\u62e5\u6709\u62a2\u5360\u7684\u8d44\u683c\uff0c\u6709\u53ef\u80fd\u4e0a\u6b21\u5df2\u7ecf\u62a2\u5360\u8fc7\u4e00\u6b21\u3002"]}),"\n",(0,i.jsx)(d.li,{children:"\u5982\u679c\u7b26\u5408\u62a2\u5360\u8d44\u683c\uff0c\u4f1a\u5148\u5bf9\u6240\u6709\u7684\u8282\u70b9\u8fdb\u884c\u4e00\u6b21\u8fc7\u6ee4\uff0c\u8fc7\u6ee4\u51fa\u7b26\u5408\u8fd9\u6b21\u62a2\u5360\u8981\u6c42\u7684\u8282\u70b9\u3002\u7136\u540e"}),"\n",(0,i.jsxs)(d.li,{children:["\u6a21\u62df\u4e00\u6b21\u8c03\u5ea6\uff0c\u628a\u4f18\u5148\u7ea7\u4f4e\u7684",(0,i.jsx)(d.code,{children:"Pod"}),"\u5148\u79fb\u9664\u51fa\u53bb\uff0c\u518d\u5c1d\u8bd5\u80fd\u5426\u628a\u5f85\u62a2\u5360\u7684",(0,i.jsx)(d.code,{children:"Pod"}),"\u653e\u7f6e\u5230\u6b64\u8282\u70b9\u4e0a\u3002\u7136\u540e\u901a\u8fc7\u8fd9\u4e2a\u8fc7\u7a0b\u4ece\u8fc7\u6ee4\u5269\u4e0b\u7684\u8282\u70b9\u4e2d\u9009\u51fa\u4e00\u6279\u8282\u70b9\u8fdb\u884c\u62a2\u5360\u3002"]}),"\n",(0,i.jsxs)(d.li,{children:[(0,i.jsx)(d.code,{children:"ProcessPreemptionWithExtenders"}),"\u662f\u4e00\u4e2a\u6269\u5c55\u7684\u94a9\u5b50\uff0c\u7528\u6237\u53ef\u4ee5\u5728\u8fd9\u91cc\u52a0\u4e00\u4e9b\u81ea\u5df1\u62a2\u5360\u8282\u70b9\u7684\u7b56\u7565\u3002\u5982\u679c\u6ca1\u6709\u6269\u5c55\u7684\u94a9\u5b50\uff0c\u8fd9\u91cc\u9762\u4e0d\u505a\u4efb\u4f55\u52a8\u4f5c\u3002"]}),"\n",(0,i.jsxs)(d.li,{children:[(0,i.jsx)(d.code,{children:"PickOneNodeForPreemption"}),"\uff0c\u4ece\u4e0a\u9762\u9009\u51fa\u7684\u8282\u70b9\u91cc\u6311\u9009\u51fa\u6700\u5408\u9002\u7684\u4e00\u4e2a\u8282\u70b9\uff0c\u7b56\u7565\u5305\u62ec\uff1a","\n",(0,i.jsxs)(d.ul,{children:["\n",(0,i.jsxs)(d.li,{children:["\u4f18\u5148\u9009\u62e9\u6253\u7834",(0,i.jsx)(d.code,{children:"PDB"}),"\u6700\u5c11\u7684\u8282\u70b9\uff1b"]}),"\n",(0,i.jsxs)(d.li,{children:["\u5176\u6b21\u9009\u62e9\u5f85\u62a2\u5360",(0,i.jsx)(d.code,{children:"Pods"}),"\u4e2d\u6700\u5927\u4f18\u5148\u7ea7\u6700\u5c0f\u7684\u8282\u70b9\uff1b"]}),"\n",(0,i.jsxs)(d.li,{children:["\u518d\u6b21\u9009\u62e9\u5f85\u62a2\u5360",(0,i.jsx)(d.code,{children:"Pods"}),"\u4f18\u5148\u7ea7\u52a0\u548c\u6700\u5c0f\u7684\u8282\u70b9\uff1b"]}),"\n",(0,i.jsxs)(d.li,{children:["\u63a5\u4e0b\u6765\u9009\u62e9\u5f85\u62a2\u5360",(0,i.jsx)(d.code,{children:"Pods"}),"\u6570\u76ee\u6700\u5c0f\u7684\u8282\u70b9\uff1b"]}),"\n",(0,i.jsxs)(d.li,{children:["\u6700\u540e\u9009\u62e9\u62e5\u6709\u6700\u665a\u542f\u52a8",(0,i.jsx)(d.code,{children:"Pod"}),"\u7684\u8282\u70b9\uff1b"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(d.p,{children:["\u901a\u8fc7\u8fc7\u6ee4\u4e4b\u540e\uff0c\u4f1a\u9009\u51fa\u4e00\u4e2a\u6700\u5408\u9002\u7684\u8282\u70b9\u3002\u5bf9\u8fd9\u4e2a\u8282\u70b9\u4e0a\u5f85\u62a2\u5360\u7684",(0,i.jsx)(d.code,{children:"Pod"}),"\u8fdb\u884c",(0,i.jsx)(d.code,{children:"delete"}),"\uff0c\u5b8c\u6210\u62a2\u5360\u8fc7\u7a0b\u3002"]})]})}function a(e={}){const{wrapper:d}={...(0,c.R)(),...e.components};return d?(0,i.jsx)(d,{...e,children:(0,i.jsx)(h,{...e})}):h(e)}},6351:(e,d,n)=>{n.d(d,{A:()=>i});const i=n.p+"assets/images/schedule-workflow-258bff258660b628d176de7fd4f26c2e.jpeg"},8453:(e,d,n)=>{n.d(d,{R:()=>o,x:()=>r});var i=n(6540);const c={},l=i.createContext(c);function o(e){const d=i.useContext(l);return i.useMemo((function(){return"function"==typeof e?e(d):{...d,...e}}),[d,e])}function r(e){let d;return d=e.disableParentContext?"function"==typeof e.components?e.components(c):e.components||c:o(e.components),i.createElement(l.Provider,{value:d},e.children)}}}]);