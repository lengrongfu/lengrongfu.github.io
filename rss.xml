<?xml version="1.0" encoding="UTF-8"?><rss xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:content="http://purl.org/rss/1.0/modules/content/" xmlns:atom="http://www.w3.org/2005/Atom" version="2.0"><channel><title><![CDATA[Gatsby Starter Blog RSS Feed]]></title><description><![CDATA[记录学习、生活的点滴]]></description><link>https://lengrongfu.github.io</link><generator>GatsbyJS</generator><lastBuildDate>Thu, 22 Sep 2022 15:04:50 GMT</lastBuildDate><item><title><![CDATA[JSON Patch and JSON Merge Patch]]></title><description><![CDATA[JSON Patch and JSON Merge Patch  作为  的一种 , 近年来受到较多的关注，于是便提出关于使用  驱动  格式的想法，这种格式用声明式的形式来描述两个文档之间的差异，发布了两种格式来解决这个问题： RFC 6902 (JSON Patch…]]></description><link>https://lengrongfu.github.io/2022-09-22-jsonpatch-jsonmergepatch/</link><guid isPermaLink="false">https://lengrongfu.github.io/2022-09-22-jsonpatch-jsonmergepatch/</guid><pubDate>Thu, 22 Sep 2022 23:06:05 GMT</pubDate><content:encoded>&lt;h1&gt;JSON Patch and JSON Merge Patch&lt;/h1&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;PATCH&lt;/code&gt; 作为 &lt;code class=&quot;language-text&quot;&gt;HTTP&lt;/code&gt; 的一种 &lt;code class=&quot;language-text&quot;&gt;Method&lt;/code&gt;, 近年来受到较多的关注，于是便提出关于使用 &lt;code class=&quot;language-text&quot;&gt;JSON&lt;/code&gt; 驱动 &lt;code class=&quot;language-text&quot;&gt;PATCH&lt;/code&gt; 格式的想法，这种格式用声明式的形式来描述两个&lt;code class=&quot;language-text&quot;&gt;JSON&lt;/code&gt;文档之间的差异，&lt;code class=&quot;language-text&quot;&gt;IETF&lt;/code&gt;发布了两种格式来解决这个问题： &lt;a href=&quot;https://tools.ietf.org/html/rfc6902&quot;&gt;RFC 6902 (JSON Patch)&lt;/a&gt;和 &lt;a href=&quot;https://www.rfc-editor.org/rfc/rfc7396&quot;&gt;RFC 7396 (JSON Merge Patch)&lt;/a&gt;，两者各有优缺点，没有一种是可以适用于任何人的，让我们来看下他们的区别。&lt;/p&gt;
&lt;h2&gt;JSON PATCH&lt;/h2&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;JSON PATCH&lt;/code&gt; 的格式类似于数据库事物，它是一个 &lt;code class=&quot;language-text&quot;&gt;JSON Document,&lt;/code&gt;它基本上是由&lt;code class=&quot;language-text&quot;&gt;ADD&lt;/code&gt;、&lt;code class=&quot;language-text&quot;&gt;REMOVE&lt;/code&gt;、&lt;code class=&quot;language-text&quot;&gt;REPLACE&lt;/code&gt;、&lt;code class=&quot;language-text&quot;&gt;MOVE&lt;/code&gt;、&lt;code class=&quot;language-text&quot;&gt;COPY&lt;/code&gt; 一系列操作组成的。&lt;/p&gt;
&lt;p&gt;下面一个简单的示例描述了一个 &lt;code class=&quot;language-text&quot;&gt;JSON&lt;/code&gt; 的内容：&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;json&quot;&gt;&lt;pre class=&quot;language-json&quot;&gt;&lt;code class=&quot;language-json&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
	&lt;span class=&quot;token property&quot;&gt;&quot;users&quot;&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;
		&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;token property&quot;&gt;&quot;name&quot;&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;Alice&quot;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token property&quot;&gt;&quot;email&quot;&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;alice@example.org&quot;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
		&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;token property&quot;&gt;&quot;name&quot;&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;Bob&quot;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token property&quot;&gt;&quot;email&quot;&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;bob@example.org&quot;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
	&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;在这个 &lt;code class=&quot;language-text&quot;&gt;JSON&lt;/code&gt;中执行&lt;code class=&quot;language-text&quot;&gt;JSON PATCH&lt;/code&gt;操作，更改&lt;code class=&quot;language-text&quot;&gt;Alice&lt;/code&gt;的电子邮件，并且添加一个新的&lt;code class=&quot;language-text&quot;&gt;user&lt;/code&gt;到数组中：&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;json&quot;&gt;&lt;pre class=&quot;language-json&quot;&gt;&lt;code class=&quot;language-json&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;
	&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
		&lt;span class=&quot;token property&quot;&gt;&quot;op&quot;&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;replace&quot;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
		&lt;span class=&quot;token property&quot;&gt;&quot;path&quot;&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;/users/0/email&quot;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
		&lt;span class=&quot;token property&quot;&gt;&quot;value&quot;&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;alice@wonderland.org&quot;&lt;/span&gt;
	&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
	&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
		&lt;span class=&quot;token property&quot;&gt;&quot;op&quot;&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;add&quot;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
		&lt;span class=&quot;token property&quot;&gt;&quot;path&quot;&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;/users/-&quot;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
		&lt;span class=&quot;token property&quot;&gt;&quot;value&quot;&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
			&lt;span class=&quot;token property&quot;&gt;&quot;name&quot;&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;Christine&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
			&lt;span class=&quot;token property&quot;&gt;&quot;email&quot;&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;christine@example.org&quot;&lt;/span&gt;
		&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
	&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;它的结果将是：&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;json&quot;&gt;&lt;pre class=&quot;language-json&quot;&gt;&lt;code class=&quot;language-json&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
	&lt;span class=&quot;token property&quot;&gt;&quot;users&quot;&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;
		&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;token property&quot;&gt;&quot;name&quot;&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;Alice&quot;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token property&quot;&gt;&quot;email&quot;&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;alice@wonderland.org&quot;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
		&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;token property&quot;&gt;&quot;name&quot;&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;Bob&quot;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token property&quot;&gt;&quot;email&quot;&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;bob@example.org&quot;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
		&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;token property&quot;&gt;&quot;name&quot;&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;Christine&quot;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token property&quot;&gt;&quot;email&quot;&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;christine@example.org&quot;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
	&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;一个&lt;code class=&quot;language-text&quot;&gt;JSON PATCH&lt;/code&gt; 有以下几个基本元素描述而成：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;op &lt;/code&gt;健表示操作类型。&lt;/li&gt;
&lt;li&gt;操作的参数由其他元素描述。&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;path&lt;/code&gt;是指向作为操作目标的&lt;code class=&quot;language-text&quot;&gt;JSON&lt;/code&gt;中的指针，是一个必须存在的参数。&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;JSON PATCH&lt;/code&gt; 操作提供了一个 &lt;code class=&quot;language-text&quot;&gt;test&lt;/code&gt; 操作类型，它没有任何坏处，所以它不是一个数据操作运算符，它可以用来对执行过程进行断言，如果&lt;code class=&quot;language-text&quot;&gt;test&lt;/code&gt;评估结果为&lt;code class=&quot;language-text&quot;&gt;false&lt;/code&gt;,则可以中断执行。&lt;/p&gt;
&lt;h2&gt;JSON MERGE PATCH&lt;/h2&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;JSON MERGE PATCH&lt;/code&gt; 它描述了 &lt;code class=&quot;language-text&quot;&gt;json document&lt;/code&gt;的更改版本，与&lt;code class=&quot;language-text&quot;&gt;JSON PATCH&lt;/code&gt; 类似，区别在于它类似&lt;code class=&quot;language-text&quot;&gt;diff&lt;/code&gt;文件，只包含执行后应该不同的&lt;code class=&quot;language-text&quot;&gt;document&lt;/code&gt;节点。&lt;/p&gt;
&lt;p&gt;如下是一个简单的&lt;code class=&quot;language-text&quot;&gt;JSON&lt;/code&gt;文档，来说明&lt;code class=&quot;language-text&quot;&gt;JSON MERGE PATCH&lt;/code&gt;的格式：&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;json&quot;&gt;&lt;pre class=&quot;language-json&quot;&gt;&lt;code class=&quot;language-json&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
	&lt;span class=&quot;token property&quot;&gt;&quot;a&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;b&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
	&lt;span class=&quot;token property&quot;&gt;&quot;c&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
		&lt;span class=&quot;token property&quot;&gt;&quot;d&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;e&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
		&lt;span class=&quot;token property&quot;&gt;&quot;f&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;g&quot;&lt;/span&gt;
	&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;我们可以在上述的&lt;code class=&quot;language-text&quot;&gt;JSON&lt;/code&gt;中运行如下的&lt;code class=&quot;language-text&quot;&gt;MERGE PATCH&lt;/code&gt;:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;json&quot;&gt;&lt;pre class=&quot;language-json&quot;&gt;&lt;code class=&quot;language-json&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
	&lt;span class=&quot;token property&quot;&gt;&quot;a&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;z&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
	&lt;span class=&quot;token property&quot;&gt;&quot;c&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
		&lt;span class=&quot;token property&quot;&gt;&quot;f&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token null keyword&quot;&gt;null&lt;/span&gt;
	&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;这个将 &lt;code class=&quot;language-text&quot;&gt;a&lt;/code&gt; 的值改为 &lt;code class=&quot;language-text&quot;&gt;z&lt;/code&gt; ,并且将删除 &lt;code class=&quot;language-text&quot;&gt;c&lt;/code&gt;。&lt;/p&gt;
&lt;p&gt;它看着很简单，但是这种简单性也带来了限制：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;通过将&lt;code class=&quot;language-text&quot;&gt;key&lt;/code&gt;的值设置为&lt;code class=&quot;language-text&quot;&gt;null&lt;/code&gt;来进行删除，这本质上就导致用户不能主动设置&lt;code class=&quot;language-text&quot;&gt;null&lt;/code&gt;值。&lt;/li&gt;
&lt;li&gt;数组不能被&lt;code class=&quot;language-text&quot;&gt;PATCH&lt;/code&gt;操作，如果想将一个元素添加到数组中，或者改变它的任何元素，那么必须要提供一个完整的数据才能执行。&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;MERGE PATCH&lt;/code&gt;操作永远不会导致错误，任何格式错误的补丁都会被&lt;code class=&quot;language-text&quot;&gt;PATCH&lt;/code&gt;,所以它是一种自由的格式，这不一定是好的，因为我们可能需要在执行完&lt;code class=&quot;language-text&quot;&gt;MEGER PATCH&lt;/code&gt; 之后进行&lt;code class=&quot;language-text&quot;&gt;JSON SCHEMA&lt;/code&gt;的验证，错误就撤销&lt;code class=&quot;language-text&quot;&gt;PATCH&lt;/code&gt;，但是目前实现不了。&lt;/li&gt;
&lt;/ul&gt;
&lt;h2&gt;总结&lt;/h2&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;JOSN MERGE PATCH&lt;/code&gt; 是一种非常简单的格式，可用性有限，对于更复杂的用户，请使用&lt;code class=&quot;language-text&quot;&gt;JSON PATCH&lt;/code&gt;,由于它使用与任何&lt;code class=&quot;language-text&quot;&gt;JSON&lt;/code&gt;文档，该规范还提供了原子执行和执行前后执行&lt;code class=&quot;language-text&quot;&gt;test&lt;/code&gt;检查。&lt;/p&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;Kubernetes&lt;/code&gt; 的 &lt;code class=&quot;language-text&quot;&gt;PATCH&lt;/code&gt;是支持&lt;code class=&quot;language-text&quot;&gt;JSON MERGER PATCH&lt;/code&gt; 和 &lt;code class=&quot;language-text&quot;&gt;MERGE PATCH&lt;/code&gt;的，但是使用&lt;code class=&quot;language-text&quot;&gt;JSON MERGE PATCH&lt;/code&gt;的场景较少，也是建议使用&lt;code class=&quot;language-text&quot;&gt;JSON PATCH&lt;/code&gt;，最根本原因就是&lt;code class=&quot;language-text&quot;&gt;JSON MERGE PATCH&lt;/code&gt;的协议格式过于简单，难以应用在复杂场景。&lt;/p&gt;</content:encoded></item><item><title><![CDATA[Vscode Remote Golang开发环境打造]]></title><description><![CDATA[…]]></description><link>https://lengrongfu.github.io/2022-08-31-remote-golang-developer-env/</link><guid isPermaLink="false">https://lengrongfu.github.io/2022-08-31-remote-golang-developer-env/</guid><pubDate>Wed, 31 Aug 2022 23:06:05 GMT</pubDate><content:encoded>&lt;p&gt;通过&lt;code class=&quot;language-text&quot;&gt;Vscode&lt;/code&gt;打造远程开发环境，可以加快工作效率.&lt;/p&gt;
&lt;h2&gt;背景&lt;/h2&gt;
&lt;p&gt;我之前的开发环境一直都是使用 &lt;code class=&quot;language-text&quot;&gt;Mac + Goland&lt;/code&gt;，但是最近在编译一个程序的时候发现编译不通过，经过排查发现是 &lt;code class=&quot;language-text&quot;&gt;Mac&lt;/code&gt;上的 &lt;code class=&quot;language-text&quot;&gt;Make&lt;/code&gt; 语法出现了不兼容，于是想到了打造一套 &lt;code class=&quot;language-text&quot;&gt;Remote Linux + Vscode&lt;/code&gt; 的开发环境。&lt;/p&gt;
&lt;p&gt;刚好有一个大学时候的笔记本，重装为了 &lt;code class=&quot;language-text&quot;&gt;Ubuntu&lt;/code&gt; 系统，就用这个电脑来打造就可以，远程开发环境和本地开发环境相比，有利有弊；&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;对比&lt;/th&gt;
&lt;th&gt;本地环境&lt;/th&gt;
&lt;th&gt;远程环境&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;优点&lt;/td&gt;
&lt;td&gt;1.程序启动快，环境加载快。&lt;br /&gt; 2.不会受限于网络环境和地域环境。&lt;/td&gt;
&lt;td&gt;1. 可以使用较多资源，如内存、CPU、磁盘等。&lt;br /&gt;2. 减少对Mac环境的影响，使用Linux开发环境。&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;缺点&lt;/td&gt;
&lt;td&gt;1. 和本地系统绑定，有些软件在Mac下不能很好的执行和编辑&lt;br/&gt;2. 内存、资源这些都受限&lt;/td&gt;
&lt;td&gt;1. 这个原创环境只能在家里私有化网络环境下使用&lt;br /&gt;2.因为操作都是网络传输，所以初始化的时候比较慢。“&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h2&gt;基本环境&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;有一个远程的&lt;code class=&quot;language-text&quot;&gt;Linux&lt;/code&gt;环境，可以是&lt;code class=&quot;language-text&quot;&gt;Ubuntu&lt;/code&gt;，也可以是&lt;code class=&quot;language-text&quot;&gt;Centos&lt;/code&gt;，并打开远程连接&lt;code class=&quot;language-text&quot;&gt;ssh 22&lt;/code&gt;端口。&lt;/li&gt;
&lt;li&gt;本地机器安装&lt;code class=&quot;language-text&quot;&gt;Vscode&lt;/code&gt;。&lt;/li&gt;
&lt;/ul&gt;
&lt;h2&gt;远程环境&lt;/h2&gt;
&lt;p&gt;按照如下的流程配置开发环境；&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;本地Vscode安装扩展插件：在&lt;code class=&quot;language-text&quot;&gt;Vscode&lt;/code&gt;的扩展中搜索&lt;code class=&quot;language-text&quot;&gt;ssh&lt;/code&gt;插件，选择安装&lt;code class=&quot;language-text&quot;&gt;Remote - SSH&lt;/code&gt;这个插件。&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;创建&lt;code class=&quot;language-text&quot;&gt;ssh&lt;/code&gt;密钥：&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;shell&quot;&gt;&lt;pre class=&quot;language-shell&quot;&gt;&lt;code class=&quot;language-shell&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;# 执行如下的命令，就会在~/.ssh目录下生成 id_rsa_goland_developer_com、id_rsa_goland_developer_com.pub 两个文件&lt;/span&gt;
$ ssh-keygen -f id_rsa_goland_developer_com&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;ol start=&quot;3&quot;&gt;
&lt;li&gt;在&lt;code class=&quot;language-text&quot;&gt;Remote Linux&lt;/code&gt;上配置本地公钥，实现免密登录&lt;/li&gt;
&lt;/ol&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;shell&quot;&gt;&lt;pre class=&quot;language-shell&quot;&gt;&lt;code class=&quot;language-shell&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;# 把本地id_rsa_goland_developer_com.pub文件上传到远程机器上，并写入到 ~/.ssh/authorized_keys 文件中，也可以直接复制通过vim编辑写入&lt;/span&gt;
$ &lt;span class=&quot;token function&quot;&gt;cat&lt;/span&gt; id_rsa_goland_developer_com.pub &lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; ~/.ssh/authorized_keys&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;ol start=&quot;4&quot;&gt;
&lt;li&gt;点击&lt;code class=&quot;language-text&quot;&gt;remote ssh&lt;/code&gt;的&lt;code class=&quot;language-text&quot;&gt;Configure&lt;/code&gt;，选择第一个配置文件;&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/0b119d9dc7030a5cf399963dcd4814df/2643c/image-20220507210602712.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 22.151898734177216%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAECAYAAACOXx+WAAAACXBIWXMAAAsTAAALEwEAmpwYAAAA2klEQVQY0z3OQW7CMBBAUW5CCUmwZ2wnsZ2kDQQQqmhVqdvue/9D/ApXYvFWo/kzGwkjcVrRbmLXKMZFxCdEeoyPHDRykAEJGfUJlb7MXUhoSFg30NruaWP9f/B1fcf6TNV69ibQm4BqpNVUjo3zkTQuzF2mry1fVcNatUij7FpP1Tr25hEMU1no8wnjM40MhdGIulSC1iX8/Re5/DAvF6blRn67crp+ID5Tm1Aeqe3AZsxHtpVhu7e81A9SbGtbwgfNiB/p12+65ZM8nzle7sTpTIgLEiaMy09/nuJ70GZElSQAAAAASUVORK5CYII=&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;image-20220507210602712&quot;
        title=&quot;image-20220507210602712&quot;
        src=&quot;/static/0b119d9dc7030a5cf399963dcd4814df/f058b/image-20220507210602712.png&quot;
        srcset=&quot;/static/0b119d9dc7030a5cf399963dcd4814df/c26ae/image-20220507210602712.png 158w,
/static/0b119d9dc7030a5cf399963dcd4814df/6bdcf/image-20220507210602712.png 315w,
/static/0b119d9dc7030a5cf399963dcd4814df/f058b/image-20220507210602712.png 630w,
/static/0b119d9dc7030a5cf399963dcd4814df/40601/image-20220507210602712.png 945w,
/static/0b119d9dc7030a5cf399963dcd4814df/78612/image-20220507210602712.png 1260w,
/static/0b119d9dc7030a5cf399963dcd4814df/2643c/image-20220507210602712.png 1747w&quot;
        sizes=&quot;(max-width: 630px) 100vw, 630px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;ol start=&quot;5&quot;&gt;
&lt;li&gt;添加远程主机配置：&lt;/li&gt;
&lt;/ol&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;shell&quot;&gt;&lt;pre class=&quot;language-shell&quot;&gt;&lt;code class=&quot;language-shell&quot;&gt;Host GoDev
    User &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;user&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
    HostName &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;ip&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
    IdentityFile ~/.ssh/id_rsa_goland_developer_com&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;GoDev&lt;/code&gt;：远程主机的标示名称，可以随意取，方便识别就可以。&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;{user}&lt;/code&gt;：远程主机的用户，最好不要使用&lt;code class=&quot;language-text&quot;&gt;root&lt;/code&gt;，可以通过&lt;code class=&quot;language-text&quot;&gt;useradd&lt;/code&gt;命令新添加一个用户。&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;{ip}&lt;/code&gt;：远程主机的地址。&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;IdentityFile&lt;/code&gt;：用于远程登录的秘钥&lt;/li&gt;
&lt;/ul&gt;
&lt;ol start=&quot;6&quot;&gt;
&lt;li&gt;使用 &lt;code class=&quot;language-text&quot;&gt;VS CODE&lt;/code&gt; 连接远程开发机器&lt;/li&gt;
&lt;/ol&gt;
&lt;ul&gt;
&lt;li&gt;连接远程主机&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/8e3fc40944a0c49d91e7b36c51a6e40f/52c1b/image-20220507211751447.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 19.62025316455696%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAECAYAAACOXx+WAAAACXBIWXMAABYlAAAWJQFJUiTwAAAA40lEQVQY012Q2UrEQBBF8x0izpakl0ov6U5mBiVMBEXwQRHEnxDEAWE+/0jaNx/OhSoouKcqCQfG25laB3SXUZJoJWG6AV3IKPu3ayVTS6b5R20TSnKhWo7OPxde3z64WrUo5dDKs1aRnYo0psf4Pd1Cl0l+JPgRLwlve3pJ5HjAuBHjBqol8mFCwlhabmphPj3y+X3h63zh+eUdsT2DDUTjuTeOUTmOSrhrLbMSJuNpTCwmle4S1+uW1c6wqS03W412mWl+4nZ6YDiecHFPowM7E1kpz6YYeNY6lHlr+vKeRfkXBeJ9KCy7lkIAAAAASUVORK5CYII=&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;image-20220507211751447.png&quot;
        title=&quot;image-20220507211751447.png&quot;
        src=&quot;/static/8e3fc40944a0c49d91e7b36c51a6e40f/f058b/image-20220507211751447.png&quot;
        srcset=&quot;/static/8e3fc40944a0c49d91e7b36c51a6e40f/c26ae/image-20220507211751447.png 158w,
/static/8e3fc40944a0c49d91e7b36c51a6e40f/6bdcf/image-20220507211751447.png 315w,
/static/8e3fc40944a0c49d91e7b36c51a6e40f/f058b/image-20220507211751447.png 630w,
/static/8e3fc40944a0c49d91e7b36c51a6e40f/40601/image-20220507211751447.png 945w,
/static/8e3fc40944a0c49d91e7b36c51a6e40f/78612/image-20220507211751447.png 1260w,
/static/8e3fc40944a0c49d91e7b36c51a6e40f/52c1b/image-20220507211751447.png 2163w&quot;
        sizes=&quot;(max-width: 630px) 100vw, 630px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;连接成功后可以选择打开的工作目录&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/3f94674e799be0bc8891c6b2544de4a2/3f919/image-20220507212224603.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 23.417721518987342%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAFCAYAAABFA8wzAAAACXBIWXMAAAsTAAALEwEAmpwYAAABE0lEQVQY0z2QzW6DMBCEeZFGUGwwxjY/NuCQkKRpIiXqoe//NF9lDj3szmi0u5qdrBtX3Lii3URjJ7Sbd17bGRc2TL9g+wU3REw37zwsF+LpzhBO/9o4nffZLLXOr5S1IxeaojIUskU0A7qLKOPRdqRqHIXU5FJzqFoOteEgWz6EptQDfnvShTOZGY7Ey4v1+ma9vYnxTj9dEMpRtx5lAnaMVLonLxXqs+ZYSL4+JceyJpY1IWEuqIQmq9pxtzrM217aBJKWHKdjKQa/XOjTey7gXeDmPLfGsijLrByTcpyURTc9WdsvmHCl6SON9TQpPzMiVEelRzp/4vH65fb9s+NyfjBvT6RbECYgzYQ0AWHSXuAPZkub5pQArIEAAAAASUVORK5CYII=&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;image-20220507212224603.png&quot;
        title=&quot;image-20220507212224603.png&quot;
        src=&quot;/static/3f94674e799be0bc8891c6b2544de4a2/f058b/image-20220507212224603.png&quot;
        srcset=&quot;/static/3f94674e799be0bc8891c6b2544de4a2/c26ae/image-20220507212224603.png 158w,
/static/3f94674e799be0bc8891c6b2544de4a2/6bdcf/image-20220507212224603.png 315w,
/static/3f94674e799be0bc8891c6b2544de4a2/f058b/image-20220507212224603.png 630w,
/static/3f94674e799be0bc8891c6b2544de4a2/40601/image-20220507212224603.png 945w,
/static/3f94674e799be0bc8891c6b2544de4a2/78612/image-20220507212224603.png 1260w,
/static/3f94674e799be0bc8891c6b2544de4a2/3f919/image-20220507212224603.png 1771w&quot;
        sizes=&quot;(max-width: 630px) 100vw, 630px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;这样远程环境就配置好了，下面就开始配置开发环境。&lt;/p&gt;
&lt;h2&gt;开发环境&lt;/h2&gt;
&lt;p&gt;如果这是一个新的&lt;code class=&quot;language-text&quot;&gt;Linue&lt;/code&gt;环境，所以我上面没有&lt;code class=&quot;language-text&quot;&gt;go&lt;/code&gt;环境这些，需要新进行安装&lt;code class=&quot;language-text&quot;&gt;go&lt;/code&gt;环境。&lt;/p&gt;
&lt;h3&gt;Go环境安装&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;Go&lt;/code&gt;源码包下载地址：&lt;a href=&quot;https://go.dev/doc/install&quot;&gt;https://go.dev/doc/install&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;ol&gt;
&lt;li&gt;Go download.&lt;/li&gt;
&lt;/ol&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;shell&quot;&gt;&lt;pre class=&quot;language-shell&quot;&gt;&lt;code class=&quot;language-shell&quot;&gt;$ &lt;span class=&quot;token function&quot;&gt;wget&lt;/span&gt; -c https://dl.google.com/go/go1.19.linux-amd64.tar.gz&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;ol start=&quot;2&quot;&gt;
&lt;li&gt;Go install.&lt;/li&gt;
&lt;/ol&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;shell&quot;&gt;&lt;pre class=&quot;language-shell&quot;&gt;&lt;code class=&quot;language-shell&quot;&gt;$ &lt;span class=&quot;token function&quot;&gt;sudo&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;tar&lt;/span&gt; -C /usr/local -xzf go1.19.linux-amd64.tar.gz
$ &lt;span class=&quot;token function&quot;&gt;vim&lt;/span&gt; /etc/profile
&lt;span class=&quot;token builtin class-name&quot;&gt;export&lt;/span&gt; &lt;span class=&quot;token assign-left variable&quot;&gt;&lt;span class=&quot;token environment constant&quot;&gt;PATH&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token environment constant&quot;&gt;$PATH&lt;/span&gt;:/usr/local/go/bin
$ &lt;span class=&quot;token builtin class-name&quot;&gt;source&lt;/span&gt; /etc/profile&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;ol start=&quot;3&quot;&gt;
&lt;li&gt;设置 go env&lt;/li&gt;
&lt;/ol&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;shell&quot;&gt;&lt;pre class=&quot;language-shell&quot;&gt;&lt;code class=&quot;language-shell&quot;&gt;$ go &lt;span class=&quot;token function&quot;&gt;env&lt;/span&gt; -w &lt;span class=&quot;token assign-left variable&quot;&gt;GO111MODULE&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;on
$ go &lt;span class=&quot;token function&quot;&gt;env&lt;/span&gt; -w &lt;span class=&quot;token assign-left variable&quot;&gt;GOPROXY&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;https://goproxy.cn&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h3&gt;Vscode Go环境配置&lt;/h3&gt;
&lt;ol&gt;
&lt;li&gt;在打开远程连接的&lt;code class=&quot;language-text&quot;&gt;Vscode&lt;/code&gt;中安装&lt;code class=&quot;language-text&quot;&gt;go&lt;/code&gt;插件&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/5adaa763569ed3c16545bb8452a47bcb/9cab2/image-20220507212648391.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 55.69620253164557%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAAsTAAALEwEAmpwYAAAB+0lEQVQoz1WSy2oUQRSG5xVciRCdSd/q0nXp+3RPz2QSY4gLFdyLWbhyI6LgxgcQwfcQ8SE/qWIyYxYf5xQUf/11zr+Q4y223eGaTaTuL469qUdMPWGqEVtPVP0O386xz1WNtAPSdAjToWyPKFsWdTsjy4ZCeUy1pnQ9phrQriMpDKtURc7zEqErpGkotCcVDjNcM87PGTZXNMMFha5YmGoi03W8tEolZ6uMp+f5idWJs2PNWOZldBdQhxodqmpioyv2mWDOBLtcMiX5kU2kODIlBdvzjF0myYNQ2UahQBBd6GbmUlqWbuRJt6esR4RtUb6PhD4v60gRvmsarO+50o78ICLvhYNgcLhVjllZOu0Zfc/sGgblGEtPU2hcUuBTgU8EPpNsTcVN6ckOgtHdvaBrZ5Sq+P7pMx/f3dGKko2t6ZVj0AHPxnfMvot1bWrW2mOko/hPUBxcLkIMUunpt1f4YUtmGkw7oaqeLHzTdly+fMvu5k2s7XyNa9cxCYVuHjiMMwx5y4Tn95+//Pj5C+16Ll+8ohv3qDBL28bYLBMZEWWDsx6pLKIM8zstJG553t/Gw5ev33h/9yG+XLqOXFcUwaGuYgYDzxJJGNH+5jUyBvnk8LjlIBjC/GgpeFx4jO9ohxlp6iiSCkMmLZl0kVz5SCrsA2cBZTv+ARS/VsimTVJBAAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;image-20220507212648391&quot;
        title=&quot;image-20220507212648391&quot;
        src=&quot;/static/5adaa763569ed3c16545bb8452a47bcb/f058b/image-20220507212648391.png&quot;
        srcset=&quot;/static/5adaa763569ed3c16545bb8452a47bcb/c26ae/image-20220507212648391.png 158w,
/static/5adaa763569ed3c16545bb8452a47bcb/6bdcf/image-20220507212648391.png 315w,
/static/5adaa763569ed3c16545bb8452a47bcb/f058b/image-20220507212648391.png 630w,
/static/5adaa763569ed3c16545bb8452a47bcb/9cab2/image-20220507212648391.png 864w&quot;
        sizes=&quot;(max-width: 630px) 100vw, 630px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;ol start=&quot;2&quot;&gt;
&lt;li&gt;安装其他Go插件&lt;/li&gt;
&lt;/ol&gt;
&lt;blockquote&gt;
&lt;p&gt;按快捷键ctrl+shift+p ，选择go install/update tools（安装所有相关包）。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/0f239abd26b7ea7a378abfab6c00f2ad/2c95d/image-20220507212945157.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 29.746835443037973%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAYAAADDl76dAAAACXBIWXMAAAsTAAALEwEAmpwYAAAA+klEQVQY03XQ3U6EMBAFYJ7ExW4p/WFpoUCFBYqLiTfqhe//Lse0yxJi9OLL5DSZk2YS6xZY52F0h/qcw2w0YTAkAyMMTyTH6R/pmR8IJEo7cO3QFTW+7Qs+hwVfg8eHm7BeLEZRIlM1clWDHcQsa2h7he1mVO0IWbZIcmURMGEwDh6Lf4Of12gab+DSIKUKhBV4ztTBPZNcg/AKhJv4lvCiQZDJCm3v4a6v6Kc1Tio00rBM5a+yDZUgsgNRQ7QV2nuhqFDWDqbpo8aNoLzE6Szickrl7pHDLHQDeakgChPz/kMmK3S9xzCvkb+9Q+l2L/xLKA2neAin+QEE/7YpmNkcEgAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;image-20220507212945157&quot;
        title=&quot;image-20220507212945157&quot;
        src=&quot;/static/0f239abd26b7ea7a378abfab6c00f2ad/f058b/image-20220507212945157.png&quot;
        srcset=&quot;/static/0f239abd26b7ea7a378abfab6c00f2ad/c26ae/image-20220507212945157.png 158w,
/static/0f239abd26b7ea7a378abfab6c00f2ad/6bdcf/image-20220507212945157.png 315w,
/static/0f239abd26b7ea7a378abfab6c00f2ad/f058b/image-20220507212945157.png 630w,
/static/0f239abd26b7ea7a378abfab6c00f2ad/40601/image-20220507212945157.png 945w,
/static/0f239abd26b7ea7a378abfab6c00f2ad/2c95d/image-20220507212945157.png 1099w&quot;
        sizes=&quot;(max-width: 630px) 100vw, 630px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;ol start=&quot;3&quot;&gt;
&lt;li&gt;选择全部进行安装&lt;/li&gt;
&lt;/ol&gt;
&lt;blockquote&gt;
&lt;p&gt;最新版的Tools只有7个了，网上有些文章里面看着有10几个，那是很久之前的版本，在新版本中做了很多整合，比如：golint和goimports都整合到staticcheck中了。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/60db8c63ed93ac2ee6ebf068988780ec/cd1d6/image-20220507213258802.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 25.949367088607595%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAFCAYAAABFA8wzAAAACXBIWXMAAAsTAAALEwEAmpwYAAAA30lEQVQY03WPy27DIBBF/SNtmoANAxhsY1AgjpRmk1W7qNT//5TbMm02fSyOZkajezTTmfmEtTwjrSdcQ0XUI4beQAwOygSm9Y1DbxkxWJ73giAoYIsFr3lDIo9OuQTyGWRnuPyCerygpAIfjxinBGUmluyExk7QDzT2vYXSHpk8gg7olFmg3MpBUd4wlyuWXDGtFTYk9BQg1MjBP5EGD9JACQ1HTWgXaBbOkPGGMZ5gfWQZjQseDxpP0nC41V98i1svaboLv16T9R35fEPdLphTZaF2C194l/5H2/efwg9dR5Z+u5xqcwAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;image-20220507213258802&quot;
        title=&quot;image-20220507213258802&quot;
        src=&quot;/static/60db8c63ed93ac2ee6ebf068988780ec/f058b/image-20220507213258802.png&quot;
        srcset=&quot;/static/60db8c63ed93ac2ee6ebf068988780ec/c26ae/image-20220507213258802.png 158w,
/static/60db8c63ed93ac2ee6ebf068988780ec/6bdcf/image-20220507213258802.png 315w,
/static/60db8c63ed93ac2ee6ebf068988780ec/f058b/image-20220507213258802.png 630w,
/static/60db8c63ed93ac2ee6ebf068988780ec/40601/image-20220507213258802.png 945w,
/static/60db8c63ed93ac2ee6ebf068988780ec/cd1d6/image-20220507213258802.png 1141w&quot;
        sizes=&quot;(max-width: 630px) 100vw, 630px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;ol start=&quot;4&quot;&gt;
&lt;li&gt;安装 &lt;code class=&quot;language-text&quot;&gt;Code Run&lt;/code&gt; 插件&lt;/li&gt;
&lt;/ol&gt;
&lt;blockquote&gt;
&lt;p&gt;搜索关键词code，安装Code Runner插件，这样就可以使用快捷键Ctrl+Alt+N运行代码了。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2&gt;其他设置&lt;/h2&gt;
&lt;p&gt;因为使用的笔记本做为远程环境，所以为了避免屏幕一直亮着，可以配置让屏幕关闭显示。&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;shell&quot;&gt;&lt;pre class=&quot;language-shell&quot;&gt;&lt;code class=&quot;language-shell&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;# 在如下文件中加入或者修改如下两个变量值&lt;/span&gt;
$ &lt;span class=&quot;token function&quot;&gt;sudo&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;vim&lt;/span&gt; /etc/systemd/logind.conf
&lt;span class=&quot;token assign-left variable&quot;&gt;HandleLidSwitch&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;ignore
&lt;span class=&quot;token assign-left variable&quot;&gt;HandleLidSwitchExternalPower&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;ignore

&lt;span class=&quot;token comment&quot;&gt;# 之后重启就可以了&lt;/span&gt;
$ &lt;span class=&quot;token function&quot;&gt;sudo&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;service&lt;/span&gt; systemd-logind restart&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2&gt;未来&lt;/h2&gt;
&lt;p&gt;目前暂时使用笔记本，但是笔记本受限于内存大小、磁盘大小、&lt;code class=&quot;language-text&quot;&gt;CPU&lt;/code&gt; 性能，并且没有&lt;code class=&quot;language-text&quot;&gt;GPU&lt;/code&gt;,未来主要朝着家庭低功耗服务器去演进。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https://www.reddit.com/r/homelab/comments/rlouof/trying_to_build_a_small_low_power_server/&quot;&gt;https://www.reddit.com/r/homelab/comments/rlouof/trying_to_build_a_small_low_power_server/&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://kit.co/TechnoTim/efficient-low-power-powerful-virtualization-server&quot;&gt;https://kit.co/TechnoTim/efficient-low-power-powerful-virtualization-server&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://www.proxmox.com/en/&quot;&gt;https://www.proxmox.com/en/&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;</content:encoded></item><item><title><![CDATA[Github Contribute 注意事项]]></title><description><![CDATA[当我们在上贡献代码时要注意些什么？如下是个人贡献时总结的一些小心得，欢迎轻拍。 代码提交流程 如下以以为例，核心操作步骤如下图：
 签署贡献协议 目前大多数开源项目都需要签署贡献协议，比如协议，签署使用的就是当前账号的账号和邮箱，所以在项目提交代码的时候需要先进行配置： 一个PR…]]></description><link>https://lengrongfu.github.io/2022-08-28-github-contribute/</link><guid isPermaLink="false">https://lengrongfu.github.io/2022-08-28-github-contribute/</guid><pubDate>Sun, 28 Aug 2022 23:06:05 GMT</pubDate><content:encoded>&lt;p&gt;当我们在&lt;code class=&quot;language-text&quot;&gt;Github&lt;/code&gt;上贡献代码时要注意些什么？如下是个人贡献时总结的一些小心得，欢迎轻拍。&lt;/p&gt;
&lt;h2&gt;代码提交流程&lt;/h2&gt;
&lt;p&gt;如下以以&lt;code class=&quot;language-text&quot;&gt;kubernetes&lt;/code&gt;为例，核心操作步骤如下图：
&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/fb057a5f3e56e25a9a90e903c8abf16c/21b4d/git_workflow.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 56.32911392405063%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAIAAADwazoUAAAACXBIWXMAAA7DAAAOwwHHb6hkAAACFUlEQVQoz23PSW/TQBiH8Xx9xBUhgVQJcQCJA0WohQZBSBsntbPUSfEyM/bYM+MtHm9jj7O4EQpKhegF6Tm+P/319o7HY9Jw6gwjfBP5SoRHvvtTMz8p3mDsDsfgXEEXCvoyAhdjdGnGKs5Mv7RJZcmu6p2wzMJwzriBuEEEjFs8oP1n+ouX1tksmvwAIzOZ3ODLd+jtjI/TljABSWXLTvS2m23ccEJUw1XnjmYGS1zAQLhJg9cS49ydMyffUZDOJubV2B4uoOIXNhXg73IqM8dXNXA7xwuQAsABLgAVMKihk0GNWEnjGIm68tR7b7rEqhXqdqTXu/KE121GmGoTzQymmK8iCW04Uu76N3p/dH+tMXvdIptPqTAj6UQShQ2kwmo78fhzvWXEi3hGC0mzivKKrDOScLbmMEhnbpoUjRW5XpoyXlFestNNKXf7Ew7zzsQldanr54jWDmtWXqOiZorktSWuVoUf75eEAlo5bINYi1gLSCvkoSeqwotrEG69sGYkIV4YI/xhiJ5fgLMBfHXlvP7u3AJjgTwUyH8B1oj2obeRjeWntyqc6p6i+/duPls41xNz+ovFzLjTfWWGFmZg4OI/+Hg82rR68/nu/dfl+cD6ptEFzIHr5WyQ4Y+R1wd+Yvk1CiVkT9mkEfIR15tDVOzjcs/FA6+6vD6Ipmkrty7wVnhlvcnrQy66vH4qE92u+/0Hqe0/QYW+29YAAAAASUVORK5CYII=&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;git_workflow.png&quot;
        title=&quot;git_workflow.png&quot;
        src=&quot;/static/fb057a5f3e56e25a9a90e903c8abf16c/f058b/git_workflow.png&quot;
        srcset=&quot;/static/fb057a5f3e56e25a9a90e903c8abf16c/c26ae/git_workflow.png 158w,
/static/fb057a5f3e56e25a9a90e903c8abf16c/6bdcf/git_workflow.png 315w,
/static/fb057a5f3e56e25a9a90e903c8abf16c/f058b/git_workflow.png 630w,
/static/fb057a5f3e56e25a9a90e903c8abf16c/40601/git_workflow.png 945w,
/static/fb057a5f3e56e25a9a90e903c8abf16c/78612/git_workflow.png 1260w,
/static/fb057a5f3e56e25a9a90e903c8abf16c/21b4d/git_workflow.png 1280w&quot;
        sizes=&quot;(max-width: 630px) 100vw, 630px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;h2&gt;签署贡献协议&lt;/h2&gt;
&lt;p&gt;目前大多数开源项目都需要签署贡献协议，比如&lt;code class=&quot;language-text&quot;&gt;DCO&lt;/code&gt;协议，签署使用的就是当前&lt;code class=&quot;language-text&quot;&gt;github&lt;/code&gt;账号的账号和邮箱，所以在项目提交代码的时候需要先进行配置：&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;shell&quot;&gt;&lt;pre class=&quot;language-shell&quot;&gt;&lt;code class=&quot;language-shell&quot;&gt;$ &lt;span class=&quot;token function&quot;&gt;git&lt;/span&gt; config --local user.name lengrongfu
$ &lt;span class=&quot;token function&quot;&gt;git&lt;/span&gt; config --local user.email &lt;span class=&quot;token number&quot;&gt;1275177125&lt;/span&gt;@qq.com&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2&gt;一个PR尽量只用一个Commit&lt;/h2&gt;
&lt;p&gt;单发生多次代码修改的时候，在&lt;code class=&quot;language-text&quot;&gt;commit&lt;/code&gt;的时候使用最开始的&lt;code class=&quot;language-text&quot;&gt;commit&lt;/code&gt;，使用命令如下：&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;shell&quot;&gt;&lt;pre class=&quot;language-shell&quot;&gt;&lt;code class=&quot;language-shell&quot;&gt;$ &lt;span class=&quot;token function&quot;&gt;git&lt;/span&gt; commit -s --amend --no-edit
&lt;span class=&quot;token comment&quot;&gt;# -s 后会在PR中加入签名信息：Signed-off-by: lengrongfu 1275177125@qq.com&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;# --amend 追加commit，使用同一个commit ID&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;# --no-edit 不进行任何更改，如果要修改commit 信息就不要使用这个标签&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2&gt;Go项目开发要注意什么&lt;/h2&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;go&lt;/code&gt;开源项目目前大多都是使用的&lt;code class=&quot;language-text&quot;&gt;golangci-lint&lt;/code&gt;、&lt;code class=&quot;language-text&quot;&gt;goimports&lt;/code&gt;来做代码格式等相关静态检查，在提交&lt;code class=&quot;language-text&quot;&gt;PR&lt;/code&gt;的时候都会检查是否符合这些工具的规范。&lt;/p&gt;
&lt;p&gt;在&lt;code class=&quot;language-text&quot;&gt;golangd&lt;/code&gt;中配置上述工具，在文件产生变更的时候自动执行上述命令，进行格式校验，下面以&lt;code class=&quot;language-text&quot;&gt;Mac Goland&lt;/code&gt;为例讲解配置 ：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;通过&lt;code class=&quot;language-text&quot;&gt;command+,&lt;/code&gt;快捷键打开系统配置，或者点击左上角&lt;code class=&quot;language-text&quot;&gt;preferences&lt;/code&gt;菜单。&lt;/li&gt;
&lt;li&gt;搜索&lt;code class=&quot;language-text&quot;&gt;File Watchers&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;点击添加按钮，选择对应工具即可：&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/4213b3f80b9ac267ad85f7cfc5ba3c75/e72de/file-watcher.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 50.632911392405056%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAABYlAAAWJQFJUiTwAAABC0lEQVQoz6WRSU7DQBBFfRvEAVAS2z3b7SGOaTwowwYUEBskDoVgw4YjPhQLWMdh8fVVpdKrr6rI+pK6DZy8CR1tN0y1dDmx1LMVSWMxziGURGo9yWaOrKxQNiMWimQOMDEFZf9As31kPR4Jh2fK7h5bNFhfoDM/S9Fy/UTy8kX5+sni+MHV9o3r/Ts32Y5UpiTakShztqLca3b7gep2ROc1pmiIdc4yVSTqghvmzjL2YXrIJgRCP+CrmlgqYmlmpZsS6rJl0++omg3CZCiXYzL/t/E09OtnAUUdqMcDbbijbNqpuUwlq9N3f2CzgNbnDNuR0I/4eo0wbgJcDEylQBs9gVZCskjEvxJ+A5FoYtJYTlYrAAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;file-watcher.png&quot;
        title=&quot;file-watcher.png&quot;
        src=&quot;/static/4213b3f80b9ac267ad85f7cfc5ba3c75/f058b/file-watcher.png&quot;
        srcset=&quot;/static/4213b3f80b9ac267ad85f7cfc5ba3c75/c26ae/file-watcher.png 158w,
/static/4213b3f80b9ac267ad85f7cfc5ba3c75/6bdcf/file-watcher.png 315w,
/static/4213b3f80b9ac267ad85f7cfc5ba3c75/f058b/file-watcher.png 630w,
/static/4213b3f80b9ac267ad85f7cfc5ba3c75/40601/file-watcher.png 945w,
/static/4213b3f80b9ac267ad85f7cfc5ba3c75/e72de/file-watcher.png 1198w&quot;
        sizes=&quot;(max-width: 630px) 100vw, 630px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;添加后可以选择所有项目生效或者当前项目生效。&lt;/li&gt;
&lt;/ul&gt;
&lt;h2&gt;.gitignore是否可以不修改&lt;/h2&gt;
&lt;p&gt;很多编辑器都有对应的隐藏文件&lt;code class=&quot;language-text&quot;&gt;.vscode&lt;/code&gt;、&lt;code class=&quot;language-text&quot;&gt;.idea&lt;/code&gt;等，我们通过编辑器首次打开项目后都会生成这个文件，如果我们不想让这个文件提交，就只能往&lt;code class=&quot;language-text&quot;&gt;.gitignore&lt;/code&gt;里面加入忽略文件的信息。&lt;/p&gt;
&lt;p&gt;但是从代码仓库管理员的角度看，如果每个人都把特定于个人的配置加入到&lt;code class=&quot;language-text&quot;&gt;.gitignore&lt;/code&gt;中，那整体维护起来将会很难。&lt;/p&gt;
&lt;p&gt;有一个更好的解决办法：为您的所有存储库创建一个个人的全局&lt;code class=&quot;language-text&quot;&gt;.gitignore&lt;/code&gt;文件。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;选择一个地方存储全局&lt;code class=&quot;language-text&quot;&gt;.gitignore&lt;/code&gt;的文件，大多数人选择主目录&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;shell&quot;&gt;&lt;pre class=&quot;language-shell&quot;&gt;&lt;code class=&quot;language-shell&quot;&gt;$ &lt;span class=&quot;token function&quot;&gt;touch&lt;/span&gt; ~/.gitignore&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;ul&gt;
&lt;li&gt;在里面加入自己需要忽略的文件或者文件夹&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;shell&quot;&gt;&lt;pre class=&quot;language-shell&quot;&gt;&lt;code class=&quot;language-shell&quot;&gt;$ &lt;span class=&quot;token function&quot;&gt;vim&lt;/span&gt; ~/.gitignore
.DS_Store
.idea
.vscode&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;ul&gt;
&lt;li&gt;最后，配置git使用我们新创建的~/.gitignore文件&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;shell&quot;&gt;&lt;pre class=&quot;language-shell&quot;&gt;&lt;code class=&quot;language-shell&quot;&gt;$ &lt;span class=&quot;token function&quot;&gt;git&lt;/span&gt; config --global core.excludesfile ~/.gitignore&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;ul&gt;
&lt;li&gt;如果您是 Windows 用户，则需要以不同方式格式化路径&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;shell&quot;&gt;&lt;pre class=&quot;language-shell&quot;&gt;&lt;code class=&quot;language-shell&quot;&gt;$ &lt;span class=&quot;token function&quot;&gt;git&lt;/span&gt; config --global core.excludesfile %USERPROFILE%&lt;span class=&quot;token punctuation&quot;&gt;\&lt;/span&gt;.gitignore&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2&gt;引用&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https://github.com/kubernetes/community/blob/master/contributors/guide/github-workflow.md&quot;&gt;github-workflow.md&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;</content:encoded></item><item><title><![CDATA[Distribution Auth Type]]></title><description><![CDATA[是一个按照  的规范实现的一个制品库管理工具，它提供了三种的认证方式，、、，在  项目中采用的是策略模式。 它的认证流程如下图所示：  htpasswd…]]></description><link>https://lengrongfu.github.io/2022-08-05-distribution-auth/</link><guid isPermaLink="false">https://lengrongfu.github.io/2022-08-05-distribution-auth/</guid><pubDate>Fri, 05 Aug 2022 23:06:05 GMT</pubDate><content:encoded>&lt;p&gt;&lt;a href=&quot;https://github.com/distribution/distribution&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;Distribution&lt;/code&gt;&lt;/a&gt; 是一个按照 &lt;code class=&quot;language-text&quot;&gt;OCI&lt;/code&gt; 的规范实现的一个制品库管理工具，它提供了三种的认证方式，&lt;code class=&quot;language-text&quot;&gt;htpasswd&lt;/code&gt;、&lt;code class=&quot;language-text&quot;&gt;silly&lt;/code&gt;、&lt;code class=&quot;language-text&quot;&gt;token&lt;/code&gt;，在 &lt;code class=&quot;language-text&quot;&gt;Distribution&lt;/code&gt; 项目中采用的是策略模式。&lt;/p&gt;
&lt;p&gt;它的认证流程如下图所示：&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 610px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/f07c3b4ac5a97ea0d8b3507df6a165bf/5aae9/auth.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 127.84810126582278%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAaCAIAAAA44esqAAAACXBIWXMAAAsTAAALEwEAmpwYAAACNUlEQVQ4y5WU227qMBBF+/+fhtQ+tKoEpZAInEJjcvHdHnvwkTKqgUArnfWQq3dmvL2dp/yIEAIA5JzP5/P922EY6OLpoRgm8i/0ff+XOMbY9z3nXEr53+KU0vf3N2NMCPGX+HxHztkYY62lOd9zEYcQ4g+I+PX1tVqt1uv1ZrN5e3trmialFK8AgIs43gEAcgIAYowzMSI+rgwAdV2v1+u6rj8mqqry3l/rqTL1P69sJoQQ4zjSNdUvpJQula/fAUDbtofDYb/f73a7ZuK6NRK3bcsYa5rmie4LXddxzunY933XdbMBiNi27fF45JzfiGOMWmul1Ol04pwrpYQQIYR0y41hAEBPvfeMse12yxjb7/fVhHOuGEaxnSdMa+2c894DACIqpbTWiAgA3nvnnNY6xkixmSfselVDCNQ8NUwF7QTl70bcdV3btqfTCREp2FJKpVRKKeeMiCEEzjkt+Fw8jmPTNJzzIiarihgAOOfW2gdiRKTcFXFZUpok6cuAuWHGGDdhrfXeU7ZDCO4HpdSvWxIRqU75ljGm3FLNsmEv4rI8Xdc9Pz9vt9vNZrNcLt/f3+u6rqpquVwej0eybb7OJTfOuXEchRBSymEY+r4n22iHlCDebEk6CSGoBUqblJLchh9owHzO1M8wDM45MhMAKGFltHPOGCOlpJDdVN7tdovF4vX1lcTOudVEcZgx9vLy8vn5SZ+7/LcRkX53WmsyPMZIeaY6OWdrrVKK4omIjDES/wMzRuQjHW68iQAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;auth&quot;
        title=&quot;auth&quot;
        src=&quot;/static/f07c3b4ac5a97ea0d8b3507df6a165bf/5aae9/auth.png&quot;
        srcset=&quot;/static/f07c3b4ac5a97ea0d8b3507df6a165bf/c26ae/auth.png 158w,
/static/f07c3b4ac5a97ea0d8b3507df6a165bf/6bdcf/auth.png 315w,
/static/f07c3b4ac5a97ea0d8b3507df6a165bf/5aae9/auth.png 610w&quot;
        sizes=&quot;(max-width: 610px) 100vw, 610px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;h2&gt;htpasswd&lt;/h2&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;htpasswd&lt;/code&gt; 是一种在系统中，它包含一个 &lt;code class=&quot;language-text&quot;&gt;htpasswd&lt;/code&gt; 的文件（文件内容是初始的用户名&lt;code class=&quot;language-text&quot;&gt;docker&lt;/code&gt;，以及一个使用特定算法随机生成的密码）以及如何解析这个文件的算法（目前只能使用 &lt;code class=&quot;language-text&quot;&gt;bcrypt&lt;/code&gt; 加密算法）。&lt;/p&gt;
&lt;p&gt;配置格式如下：&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;yaml&quot;&gt;&lt;pre class=&quot;language-yaml&quot;&gt;&lt;code class=&quot;language-yaml&quot;&gt;&lt;span class=&quot;token key atrule&quot;&gt;auth&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;htpasswd&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;token key atrule&quot;&gt;realm&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; harbor&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;registry&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;basic&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;realm
    &lt;span class=&quot;token key atrule&quot;&gt;path&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; /etc/registry/passwd&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;启动过程中会校验 &lt;code class=&quot;language-text&quot;&gt;path&lt;/code&gt; 对应的文件是否存在，如果不存在，就创建并写入内容，内容为用户：&lt;code class=&quot;language-text&quot;&gt;docker&lt;/code&gt;, 密码为随机生成并加密存储。&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;用户在请求过程中，每个请求都会进入配置好的访问控制器中，进行权限验证。&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;会首先判断 &lt;code class=&quot;language-text&quot;&gt;Header&lt;/code&gt; 中是否存在 &lt;code class=&quot;language-text&quot;&gt;Authorization&lt;/code&gt; 字段值，并正确解析；如果不存在，则认为无效认证。&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;如果存在用户密码则会和文件中写入的内容进行对比，确保是一致的（提示：在对比之前系统会先校验这个文件是否被修改过，如果被修改过就会从新生成文件内容）。&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;h2&gt;silly&lt;/h2&gt;
&lt;p&gt;这个主要是用于测试的，是简单功能的实现；它主要是检查 &lt;code class=&quot;language-text&quot;&gt;Header&lt;/code&gt; 中是否存在 &lt;code class=&quot;language-text&quot;&gt;Authorization&lt;/code&gt; 并且值非空，如果是就进行授权通过。&lt;/p&gt;
&lt;h2&gt;token&lt;/h2&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 472px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/d03298b459888a8e45422e5b361ebe5b/3c5de/v2-registry-auth.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 76.58227848101265%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAPCAYAAADkmO9VAAAACXBIWXMAAAsTAAALEwEAmpwYAAADmUlEQVQ4y4VUaWhcVRQ+M28maZNMO5O0Js4UhRIiLVroNJlAFKXQX4pQUEFIKmkSbaG1WCku5I/iAqIwxV+2IG2tVYvJTDpLmsns+77kzb68TDJbYiZ7ahZbe+S+poIY9MDh3HvPd77zzuV+Dy5/f7teZZ84pXXF+8e8qT6dL92ndcVPa5yxMz+POlq1rjjc9SQ5P6otnJsqM9xQGlvUjmi/zp9hsWPeNBs1jmjfNYW+GW6qzNJAfgnDhTX0ZufRk5nD4NQKhqZXUR/Ifl7YQKjcR0rnS1Pj/iyMeVM9fmYRPZkqutNzbPTm5jEwuYRqB90DtzS2DlIcrWyiPV5GUziPkdLvSJfX0Rie/GoeEVYQKX0gxzOF82AIMqcJoYUuoIWeZqOVLmAgv4yj7kQvXP1FK7bQhV/vepIGc2RK40rNKkfdCZ0hxFhGLKFX/cwi+CeXuEpzkDgMGXzHrNGi2hotqvSBnM6RqIw4U7NKK11Q39a5pWCLlWALEQCAAgABAHDx0X4PAPBh21S2CUjM3Yf8GsKDR3mSqyPYx+5OzwHcsUbIhksQrc8cFjzRIt5Pkkeksvq9osZ9pAHJPX2w9e/C/vOX+OIDT4mOyrp2IyLnsfuYRQ68++EncOGjT9nuBExRlJBfUyMk69pdu4U1NbWii4NfwGfyq9A9cI5DyBsEewV19Q3CtsPPsc0Gv7wM314fYnn+YVyKAh6PT0AiANh14uWT5FhIRut84Ti8cWoAtr+4gYwsbGyCBsEeaDv0LPyf1QHAgW3iRg6XKwGAfU37m2sBoAUAntzG/Lcxq0jllhF0vvRF8rY8meqmL7ewYY0W/7DFSg9ssdKmJ1Pd8marmz5mATWOaG9oehUixXvUjoTRygZ3orwOajt93JGoXHEmZ7620AW5IcTI1Q76O0OQkdtiJbkzOfONPV6+ojAFOz3ZKviYRe6OhNLO5+GorAs6ul6seb2nX/Jm71nJW+9cEJ9572PJiVdOtp19f1DcPXCOPX+tu0/S0fUS/4hUxtbsaPk15DErCPpg7gMixXBh7SFRgDM5g77cArpSv7GyjBTvsdIcdSfepssbEJvd2nnk3DLyyB2O+zOXiE4tdOFPa7SItmgRSTRF8qzMzJGph67ULJIfCiGky+v/JuRwufCT1g63tDa4rtA3DRv9ncPGwDGFKdCuNIfaFaZgO1kPG4n724cMPtm14XHhjRET/HDHBKKmZpboL5SJL4lty4BsAAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;auth&quot;
        title=&quot;auth&quot;
        src=&quot;/static/d03298b459888a8e45422e5b361ebe5b/3c5de/v2-registry-auth.png&quot;
        srcset=&quot;/static/d03298b459888a8e45422e5b361ebe5b/c26ae/v2-registry-auth.png 158w,
/static/d03298b459888a8e45422e5b361ebe5b/6bdcf/v2-registry-auth.png 315w,
/static/d03298b459888a8e45422e5b361ebe5b/3c5de/v2-registry-auth.png 472w&quot;
        sizes=&quot;(max-width: 472px) 100vw, 472px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;yaml&quot;&gt;&lt;pre class=&quot;language-yaml&quot;&gt;&lt;code class=&quot;language-yaml&quot;&gt;&lt;span class=&quot;token key atrule&quot;&gt;auth&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;token&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;token key atrule&quot;&gt;realm&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; https&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;//localhost&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;5011/auth
    &lt;span class=&quot;token key atrule&quot;&gt;service&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; Authentication
    &lt;span class=&quot;token key atrule&quot;&gt;issuer&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; Sample Issuer
    &lt;span class=&quot;token key atrule&quot;&gt;rootCertBundle&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; /mnt/local/certs/RootCA.crt&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;token&lt;/code&gt; 认证需要借助外部认证服务，可以实现资源、权限的管理，&lt;code class=&quot;language-text&quot;&gt;distribution&lt;/code&gt; 的响应的时候会返回给用户 &lt;code class=&quot;language-text&quot;&gt;scope&lt;/code&gt; 就是资源权限&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;启动过程会校验 &lt;code class=&quot;language-text&quot;&gt;token&lt;/code&gt; 配置的参数是否正确，并且校验 &lt;code class=&quot;language-text&quot;&gt;tls&lt;/code&gt; 证书。&lt;/li&gt;
&lt;li&gt;用户请求时，会从 &lt;code class=&quot;language-text&quot;&gt;Header&lt;/code&gt; 中获取认证信息，如果没有认证，则会根据是否配置 &lt;code class=&quot;language-text&quot;&gt;autoRedirect&lt;/code&gt; 以及重定向地址 &lt;code class=&quot;language-text&quot;&gt;realm&lt;/code&gt;。&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;distribution&lt;/code&gt; 会返回 &lt;code class=&quot;language-text&quot;&gt;401&lt;/code&gt; 的请求，并携带&lt;code class=&quot;language-text&quot;&gt;WWW-Authenticate&lt;/code&gt; 告诉客户端改如何向认证服务进行认证。&lt;/li&gt;
&lt;/ol&gt;
&lt;blockquote&gt;
&lt;p&gt;如：一个未授权的用户正在 &lt;code class=&quot;language-text&quot;&gt;Push&lt;/code&gt;镜像到 &lt;code class=&quot;language-text&quot;&gt;samalba/my-app&lt;/code&gt; repoName 中，就会返回&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;scope: 授权范围&lt;/li&gt;
&lt;li&gt;service: 授权服务&lt;/li&gt;
&lt;li&gt;realm: 认证服务&lt;/li&gt;
&lt;/ul&gt;
&lt;/blockquote&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;shell&quot;&gt;&lt;pre class=&quot;language-shell&quot;&gt;&lt;code class=&quot;language-shell&quot;&gt;HTTP/1.1 &lt;span class=&quot;token number&quot;&gt;401&lt;/span&gt; Unauthorized
Content-Type: application/json&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;token assign-left variable&quot;&gt;charset&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;utf-8
Docker-Distribution-Api-Version: registry/2.0
Www-Authenticate: Bearer &lt;span class=&quot;token assign-left variable&quot;&gt;realm&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;https://auth.docker.io/token&quot;&lt;/span&gt;,service&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;registry.docker.io&quot;&lt;/span&gt;,scope&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;repository:samalba/my-app:pull,push&quot;&lt;/span&gt;
Date: Thu, &lt;span class=&quot;token number&quot;&gt;10&lt;/span&gt; Sep &lt;span class=&quot;token number&quot;&gt;2015&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;19&lt;/span&gt;:32:31 GMT
Content-Length: &lt;span class=&quot;token number&quot;&gt;235&lt;/span&gt;
Strict-Transport-Security: max-age&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;31536000&lt;/span&gt;

&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;errors&quot;&lt;/span&gt;:&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;code&quot;&lt;/span&gt;&lt;span class=&quot;token builtin class-name&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;UNAUTHORIZED&quot;&lt;/span&gt;,&lt;span class=&quot;token string&quot;&gt;&quot;message&quot;&lt;/span&gt;&lt;span class=&quot;token builtin class-name&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;access to the requested resource is not authorized&quot;&lt;/span&gt;,&lt;span class=&quot;token string&quot;&gt;&quot;detail&quot;&lt;/span&gt;:&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;Type&quot;&lt;/span&gt;&lt;span class=&quot;token builtin class-name&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;repository&quot;&lt;/span&gt;,&lt;span class=&quot;token string&quot;&gt;&quot;Name&quot;&lt;/span&gt;&lt;span class=&quot;token builtin class-name&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;samalba/my-app&quot;&lt;/span&gt;,&lt;span class=&quot;token string&quot;&gt;&quot;Action&quot;&lt;/span&gt;&lt;span class=&quot;token builtin class-name&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;pull&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;,&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;Type&quot;&lt;/span&gt;&lt;span class=&quot;token builtin class-name&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;repository&quot;&lt;/span&gt;,&lt;span class=&quot;token string&quot;&gt;&quot;Name&quot;&lt;/span&gt;&lt;span class=&quot;token builtin class-name&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;samalba/my-app&quot;&lt;/span&gt;,&lt;span class=&quot;token string&quot;&gt;&quot;Action&quot;&lt;/span&gt;&lt;span class=&quot;token builtin class-name&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;push&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;ol start=&quot;4&quot;&gt;
&lt;li&gt;如果开启自动重定向，则请求的就是 &lt;code class=&quot;language-text&quot;&gt;distribution&lt;/code&gt; host 的接口：&lt;code class=&quot;language-text&quot;&gt;https://%s/auth/token&lt;/code&gt;，没有则走用户配置&lt;code class=&quot;language-text&quot;&gt;realm&lt;/code&gt;&lt;/li&gt;
&lt;/ol&gt;</content:encoded></item><item><title><![CDATA[IntelliJ Goland 2022.1.4 最新激活破解教程]]></title><description><![CDATA[激活版本 目前测试结果、、、都是可以激活的，激活方法分为两种，一种是永久激活，一种是30天循环使用激活（这种办法只能在低于2022.1版本以下可以用）。 不论是、、都可以激活，下面以为例。 激活结果 电脑： Goalnd…]]></description><link>https://lengrongfu.github.io/2022-07-25-Goland2022.01激活/</link><guid isPermaLink="false">https://lengrongfu.github.io/2022-07-25-Goland2022.01激活/</guid><pubDate>Mon, 25 Jul 2022 23:06:05 GMT</pubDate><content:encoded>&lt;h2&gt;激活版本&lt;/h2&gt;
&lt;p&gt;目前测试结果&lt;code class=&quot;language-text&quot;&gt;2022.1.4&lt;/code&gt;、&lt;code class=&quot;language-text&quot;&gt;2022.1&lt;/code&gt;、&lt;code class=&quot;language-text&quot;&gt;2021.3.3&lt;/code&gt;、&lt;code class=&quot;language-text&quot;&gt;2021.3.2&lt;/code&gt;都是可以激活的，激活方法分为两种，一种是永久激活，一种是30天循环使用激活（这种办法只能在低于2022.1版本以下可以用）。&lt;/p&gt;
&lt;p&gt;不论是&lt;code class=&quot;language-text&quot;&gt;Mac&lt;/code&gt;、&lt;code class=&quot;language-text&quot;&gt;Linux&lt;/code&gt;、&lt;code class=&quot;language-text&quot;&gt;Window&lt;/code&gt;都可以激活，下面以&lt;code class=&quot;language-text&quot;&gt;Mac&lt;/code&gt;为例。&lt;/p&gt;
&lt;h2&gt;激活结果&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;电脑：&lt;code class=&quot;language-text&quot;&gt;Mac&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;Goalnd版本：&lt;code class=&quot;language-text&quot;&gt;GoLand 2022.1&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/1fc802dde79dece707672f70fba793bd/38712/1658720720629.jpg&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 20.253164556962027%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAEABQDASIAAhEBAxEB/8QAFwABAAMAAAAAAAAAAAAAAAAAAAECBP/EABUBAQEAAAAAAAAAAAAAAAAAAAEA/9oADAMBAAIQAxAAAAHFUSAX/8QAFhABAQEAAAAAAAAAAAAAAAAAEQAQ/9oACAEBAAEFAmc//8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAwEBPwE//8QAFREBAQAAAAAAAAAAAAAAAAAAEBH/2gAIAQIBAT8Bp//EABQQAQAAAAAAAAAAAAAAAAAAABD/2gAIAQEABj8Cf//EABgQAQEAAwAAAAAAAAAAAAAAAAEAETFx/9oACAEBAAE/IVY3cE3/2gAMAwEAAgADAAAAEPA//8QAFxEBAAMAAAAAAAAAAAAAAAAAARARMf/aAAgBAwEBPxAKyP/EABYRAQEBAAAAAAAAAAAAAAAAAAEQMf/aAAgBAgEBPxBTs//EABkQAAMAAwAAAAAAAAAAAAAAAAABESFx0f/aAAgBAQABPxDHVENnwGrsmj//2Q==&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;jihuo&quot;
        title=&quot;jihuo&quot;
        src=&quot;/static/1fc802dde79dece707672f70fba793bd/828fb/1658720720629.jpg&quot;
        srcset=&quot;/static/1fc802dde79dece707672f70fba793bd/ff44c/1658720720629.jpg 158w,
/static/1fc802dde79dece707672f70fba793bd/a6688/1658720720629.jpg 315w,
/static/1fc802dde79dece707672f70fba793bd/828fb/1658720720629.jpg 630w,
/static/1fc802dde79dece707672f70fba793bd/0ede0/1658720720629.jpg 945w,
/static/1fc802dde79dece707672f70fba793bd/3ac88/1658720720629.jpg 1260w,
/static/1fc802dde79dece707672f70fba793bd/38712/1658720720629.jpg 1314w&quot;
        sizes=&quot;(max-width: 630px) 100vw, 630px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;h2&gt;激活工具&lt;/h2&gt;
&lt;p&gt;激活前需要先下载工具，工具上传到了&lt;a href=&quot;https://www.aliyundrive.com/&quot;&gt;阿里云盘&lt;/a&gt;里面（阿里云盘具有上传、下载不限速、容量大等特点，可以进行&lt;a href=&quot;https://pages.aliyundrive.com/mobile-page/web/beinvited.html?code=3cca663&quot;&gt;注册&lt;/a&gt;使用）。&lt;/p&gt;
&lt;p&gt;下载地址：&lt;a href=&quot;/24cc6faf9dccf9dfb738a543b69dd36c/JetBrains2022.zip&quot;&gt;JetBrains2022&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;下载后需要输入解压密码，主要是为了防止压缩包被篡改，解压密码扫码公众号免费获取，关注后输入&lt;code class=&quot;language-text&quot;&gt;ideal解压密码&lt;/code&gt;：&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 344px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/0bbef6adea1ff145fa19d1090089eab0/4fcbd/qrcode_for_gh_d80ffac1dffe_344.jpg&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 100%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAUABQDASIAAhEBAxEB/8QAGQABAQEAAwAAAAAAAAAAAAAAAAIBAwQF/8QAFQEBAQAAAAAAAAAAAAAAAAAAAAH/2gAMAwEAAhADEAAAAezMbHopVWBzg//EABwQAAICAgMAAAAAAAAAAAAAAAECAxIABBQhM//aAAgBAQABBQJ2a95c1ySknUkr2XW8jAhPHTEUIP/EABQRAQAAAAAAAAAAAAAAAAAAACD/2gAIAQMBAT8BH//EABQRAQAAAAAAAAAAAAAAAAAAACD/2gAIAQIBAT8BH//EABwQAAIDAAMBAAAAAAAAAAAAAAABAhEhMkFhgf/aAAgBAQAGPwKVTFrRrvST9OJ9G3enZSP/xAAdEAACAgMAAwAAAAAAAAAAAAABEQBBITFhgZGx/9oACAEBAAE/IQ3oyUMxwLczpQlcQ2gpjY+ahwbmr+Ts4awdnM4+0pPP/9oADAMBAAIAAwAAABDoxwD/xAAUEQEAAAAAAAAAAAAAAAAAAAAg/9oACAEDAQE/EB//xAAWEQADAAAAAAAAAAAAAAAAAAARICH/2gAIAQIBAT8QpT//xAAfEAEBAQEAAgIDAQAAAAAAAAABESEAMUFRkWFxocH/2gAIAQEAAT8QOCgmgJbFzPlzPfKZXTqAC570+v11C2FNuD/vWOoiEUmK5L487zcpRQIdgRW2z770bCu2OKcUyCLhjT+nMMCqvyrUnifj30+pdi3v/9k=&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;qrcode_for_gh_d80ffac1dffe_344&quot;
        title=&quot;qrcode_for_gh_d80ffac1dffe_344&quot;
        src=&quot;/static/0bbef6adea1ff145fa19d1090089eab0/4fcbd/qrcode_for_gh_d80ffac1dffe_344.jpg&quot;
        srcset=&quot;/static/0bbef6adea1ff145fa19d1090089eab0/ff44c/qrcode_for_gh_d80ffac1dffe_344.jpg 158w,
/static/0bbef6adea1ff145fa19d1090089eab0/a6688/qrcode_for_gh_d80ffac1dffe_344.jpg 315w,
/static/0bbef6adea1ff145fa19d1090089eab0/4fcbd/qrcode_for_gh_d80ffac1dffe_344.jpg 344w&quot;
        sizes=&quot;(max-width: 344px) 100vw, 344px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;h2&gt;激活过程&lt;/h2&gt;
&lt;h3&gt;激活前置条件&lt;/h3&gt;
&lt;p&gt;1、 下载最新的 Goland 2022.1.4 版本安装包
我们先从 Goland 官网下载 Goland 2022.1.4 版本的安装包，下载链接如下：&lt;a href=&quot;https://www.jetbrains.com/go/&quot;&gt;https://www.jetbrains.com/go/&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/2e5ba77d0fbb891a140bbb3fe89971a5/f3c07/download.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 52.53164556962025%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAABYlAAAWJQFJUiTwAAAB1ElEQVQoz42SvY7TQBRG/SoUVDwAD8Ab8BRbUFFRsM1SUK1oqGlAaCW0HUIpYAUSNCDRQIF2JRInUZw4scce/41nxj5oxgkQghCWPo3H43vuN/feYJOkiFmIjWZYkWCtQVuN7TraVqNtR6sNZVlSVdWemqahbhRWFXz83nDnHAKA6sMbxOMTyrevUFVBXm5oWkW83rCUiqxuMUajjcEYg9bD2ve9C9+ug4Lh5f+eHeD3/b4gWArL6EyghASs/1EIwXg8ZjoeM5lMmIQhURT9FfILPii49/Qr16/d5OjR6fako6wbkkXE+tsV6Somrxpfr3+53iUITkaX3Lh1m/t3X295HWBASxAxqAxosFpR1TV1XSNlQVEUWGsPoEHRKpZZS1+4ag6F/TSF4xE8fFnx4Dzj+EwQzqQP6vohsPOJD50GLluSJCij2JXkKmp48i7hxfuY5xcLnl1EhOGKspAIkZHnuR8jJ+fUdfynw6rtyZse4xMORK0q2jqhbyWdyujbnELmpGnqk7um7WBSyn2gqGEpYSUddGux68gul6QiZ71J8cMvhAfs5Ab7z/HxVy5UT1r1OKf+wH01mvnnL6zimNl0xnw+Z7FYeFeuKQ6mlDoYH+fwBzTKR/+UPYd6AAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;download&quot;
        title=&quot;download&quot;
        src=&quot;/static/2e5ba77d0fbb891a140bbb3fe89971a5/f058b/download.png&quot;
        srcset=&quot;/static/2e5ba77d0fbb891a140bbb3fe89971a5/c26ae/download.png 158w,
/static/2e5ba77d0fbb891a140bbb3fe89971a5/6bdcf/download.png 315w,
/static/2e5ba77d0fbb891a140bbb3fe89971a5/f058b/download.png 630w,
/static/2e5ba77d0fbb891a140bbb3fe89971a5/40601/download.png 945w,
/static/2e5ba77d0fbb891a140bbb3fe89971a5/78612/download.png 1260w,
/static/2e5ba77d0fbb891a140bbb3fe89971a5/f3c07/download.png 2516w&quot;
        sizes=&quot;(max-width: 630px) 100vw, 630px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;点击下载，静心等待其下载完毕即可。&lt;/p&gt;
&lt;p&gt;2、先卸载老版本的 Goland&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;注意，如果电脑上之前有安装老版本的 Goland, 需要先卸载干净，否则可能安装失败！&lt;/p&gt;
&lt;p&gt;注意，一定要先卸载干净掉老版本的 Goland。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;Mac&lt;/code&gt;可以使用&lt;code class=&quot;language-text&quot;&gt;CleanMyMacX&lt;/code&gt;工具进行卸载，&lt;code class=&quot;language-text&quot;&gt;CleanMyMacX&lt;/code&gt;是一个管理&lt;code class=&quot;language-text&quot;&gt;Mac&lt;/code&gt;的非常好用的工具，需要&lt;a href=&quot;https://cleanmymac.com/&quot;&gt;付费购买&lt;/a&gt;，这是笔者花钱买的第一个软件&lt;code class=&quot;language-text&quot;&gt;199&lt;/code&gt;元，到现在依然觉得很值得。&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/473a1dcd78e8e80184bfe95850da2248/a2510/1658725328160.jpg&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 70.25316455696203%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAOABQDASIAAhEBAxEB/8QAGAAAAwEBAAAAAAAAAAAAAAAAAAEEAgP/xAAWAQEBAQAAAAAAAAAAAAAAAAADAQL/2gAMAwEAAhADEAAAAcKdsXcmLv8A/8QAGBABAQADAAAAAAAAAAAAAAAAABEBEiH/2gAIAQEAAQUC2VVZ4r//xAAXEQEAAwAAAAAAAAAAAAAAAAAAAQIS/9oACAEDAQE/Acoq/8QAFREBAQAAAAAAAAAAAAAAAAAAABH/2gAIAQIBAT8BR//EABQQAQAAAAAAAAAAAAAAAAAAACD/2gAIAQEABj8CX//EABkQAAMAAwAAAAAAAAAAAAAAAAEQEQAxYf/aAAgBAQABPyHbDb6joq//2gAMAwEAAgADAAAAEN/f/8QAFhEBAQEAAAAAAAAAAAAAAAAAAAER/9oACAEDAQE/ECGP/8QAFhEBAQEAAAAAAAAAAAAAAAAAAAER/9oACAECAQE/EGq//8QAGRABAQEAAwAAAAAAAAAAAAAAAREAMYGR/9oACAEBAAE/EGMHlHrAyluYU2HrVv/Z&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;remove&quot;
        title=&quot;remove&quot;
        src=&quot;/static/473a1dcd78e8e80184bfe95850da2248/828fb/1658725328160.jpg&quot;
        srcset=&quot;/static/473a1dcd78e8e80184bfe95850da2248/ff44c/1658725328160.jpg 158w,
/static/473a1dcd78e8e80184bfe95850da2248/a6688/1658725328160.jpg 315w,
/static/473a1dcd78e8e80184bfe95850da2248/828fb/1658725328160.jpg 630w,
/static/473a1dcd78e8e80184bfe95850da2248/0ede0/1658725328160.jpg 945w,
/static/473a1dcd78e8e80184bfe95850da2248/a2510/1658725328160.jpg 1000w&quot;
        sizes=&quot;(max-width: 630px) 100vw, 630px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;3、第三步: 开始安装 Goland 2022.1.4 版本，此处省略安装步骤。&lt;/p&gt;
&lt;h3&gt;一、永久激活方法&lt;/h3&gt;
&lt;p&gt;1、打开上述下载的破解工具，首选执行清除脚本：&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/06b73a24c1cea4dabe2c1bb88bf162a1/7b1dc/c.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 37.34177215189873%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAYAAAAIy204AAAACXBIWXMAABYlAAAWJQFJUiTwAAABPUlEQVQoz32Qy07CQBhGeTL1Hdy41UdQ125c6NMQiSwMK00IJhChAcqdhAqd3riI3ELpzDEthUCM/smZbzKZOfkyCW+xoel+49kWruvhui6GYSCEYLlcIYMAfzTE67ZxOq2IcG82alHK5YJASmRMYjDzyRsjHGHiDcfYtoNeq6HrOl+zOUwnLPUSdl2nr30gKhpeQ0dUNdxaGdWtowBUtJIIYzodY/TamIMeSq05ms2aoNdBWQOk+ERa/W2KPso0UMJARj4VkXBMj5dMiWTqnWQqx1u2SSpd4Cmd5zXbYm57sJpHl5HyF2EhGbeLhJnnPBf3Ba4eq1w+lDm/0zi5LnJ2U+T0VqOSq8OgE7fYCnbsJOHf7YXBZIxvmWwcC9+2ogycOF0b5ZioxWz/gBh10OpIqPh/9m1CyeH5H8IfSt0NmQUbxWAAAAAASUVORK5CYII=&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;clean&quot;
        title=&quot;clean&quot;
        src=&quot;/static/06b73a24c1cea4dabe2c1bb88bf162a1/f058b/c.png&quot;
        srcset=&quot;/static/06b73a24c1cea4dabe2c1bb88bf162a1/c26ae/c.png 158w,
/static/06b73a24c1cea4dabe2c1bb88bf162a1/6bdcf/c.png 315w,
/static/06b73a24c1cea4dabe2c1bb88bf162a1/f058b/c.png 630w,
/static/06b73a24c1cea4dabe2c1bb88bf162a1/40601/c.png 945w,
/static/06b73a24c1cea4dabe2c1bb88bf162a1/7b1dc/c.png 956w&quot;
        sizes=&quot;(max-width: 630px) 100vw, 630px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;在终端上输入: &lt;code class=&quot;language-text&quot;&gt;$ sh reset_script/reset_jetbrains_eval_mac_linux.sh&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;2、执行激活脚本:&lt;/p&gt;
&lt;p&gt;在终端上输入:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;shell&quot;&gt;&lt;pre class=&quot;language-shell&quot;&gt;&lt;code class=&quot;language-shell&quot;&gt;$ &lt;span class=&quot;token function&quot;&gt;sh&lt;/span&gt; scripts/install.sh 
done.&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;输出&lt;code class=&quot;language-text&quot;&gt;done&lt;/code&gt;则认为执行成功了。&lt;/p&gt;
&lt;p&gt;3、打开&lt;code class=&quot;language-text&quot;&gt;Goland&lt;/code&gt;输入激活码&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;D78I41OKAM-eyJsaWNlbnNlSWQiOiJENzhJNDFPS0FNIiwibGljZW5zZWVOYW1lIjoidHJlbmRzIHJhYmJpcyIsImFzc2lnbmVlTmFtZSI6IiIsImFzc2lnbmVlRW1haWwiOiIiLCJsaWNlbnNlUmVzdHJpY3Rpb24iOiIiLCJjaGVja0NvbmN1cnJlbnRVc2UiOmZhbHNlLCJwcm9kdWN0cyI6W3siY29kZSI6IkdPIiwiZmFsbGJhY2tEYXRlIjoiMjAyMy0wMi0wOCIsInBhaWRVcFRvIjoiMjAyMy0wMi0wOCIsImV4dGVuZGVkIjpmYWxzZX0seyJjb2RlIjoiUEdPIiwiZmFsbGJhY2tEYXRlIjoiMjAyMy0wMi0wOCIsInBhaWRVcFRvIjoiMjAyMy0wMi0wOCIsImV4dGVuZGVkIjp0cnVlfSx7ImNvZGUiOiJQV1MiLCJmYWxsYmFja0RhdGUiOiIyMDIzLTAyLTA4IiwicGFpZFVwVG8iOiIyMDIzLTAyLTA4IiwiZXh0ZW5kZWQiOnRydWV9LHsiY29kZSI6IlBTSSIsImZhbGxiYWNrRGF0ZSI6IjIwMjMtMDItMDgiLCJwYWlkVXBUbyI6IjIwMjMtMDItMDgiLCJleHRlbmRlZCI6dHJ1ZX0seyJjb2RlIjoiUENXTVAiLCJmYWxsYmFja0RhdGUiOiIyMDIzLTAyLTA4IiwicGFpZFVwVG8iOiIyMDIzLTAyLTA4IiwiZXh0ZW5kZWQiOnRydWV9XSwibWV0YWRhdGEiOiIwMTIwMjIwMjA4UFNBTjAwMDAwNSIsImhhc2giOiJUUklBTDoxNTE1ODQxMzczIiwiZ3JhY2VQZXJpb2REYXlzIjo3LCJhdXRvUHJvbG9uZ2F0ZWQiOmZhbHNlLCJpc0F1dG9Qcm9sb25nYXRlZCI6ZmFsc2V9-e3JluPUlXHNEJEr6ZvssZ2mkORaSq7d+HMRULh+BQT6fY0753XSbNoQ1B8WP7lZpbhDW43eVNF0KC4Or3KP3JsAbEjRjB4T8Bf/1q4EUDtn5tco62TrPNVsbpPaDQ60LEWV5CvWbrU0KordG1rrod0S9ZuaXcq6HKGcsAh8OskwWoRUlYMrN1fIQstYRTdCATTDWu76O1UXJoFgwVaHscakJtVjsaP5NLikbfD9SKPfMKjwE8PGcI0iA4pP4LI8ybb1/wsa4C/wl1N/dmuZaXQ9rLgmpR8pNf8j8GC61hh+HDIOdq7HyDow/1fjhGVwUhrl/S9SytrBjbq8Bl1BQAQ==-MIIETDCCAjSgAwIBAgIBDTANBgkqhkiG9w0BAQsFADAYMRYwFAYDVQQDDA1KZXRQcm9maWxlIENBMB4XDTIwMTAxOTA5MDU1M1oXDTIyMTAyMTA5MDU1M1owHzEdMBsGA1UEAwwUcHJvZDJ5LWZyb20tMjAyMDEwMTkwggEiMA0GCSqGSIb3DQEBAQUAA4IBDwAwggEKAoIBAQCUlaUFc1wf+CfY9wzFWEL2euKQ5nswqb57V8QZG7d7RoR6rwYUIXseTOAFq210oMEe++LCjzKDuqwDfsyhgDNTgZBPAaC4vUU2oy+XR+Fq8nBixWIsH668HeOnRK6RRhsr0rJzRB95aZ3EAPzBuQ2qPaNGm17pAX0Rd6MPRgjp75IWwI9eA6aMEdPQEVN7uyOtM5zSsjoj79Lbu1fjShOnQZuJcsV8tqnayeFkNzv2LTOlofU/Tbx502Ro073gGjoeRzNvrynAP03pL486P3KCAyiNPhDs2z8/COMrxRlZW5mfzo0xsK0dQGNH3UoG/9RVwHG4eS8LFpMTR9oetHZBAgMBAAGjgZkwgZYwCQYDVR0TBAIwADAdBgNVHQ4EFgQUJNoRIpb1hUHAk0foMSNM9MCEAv8wSAYDVR0jBEEwP4AUo562SGdCEjZBvW3gubSgUouX8bOhHKQaMBgxFjAUBgNVBAMMDUpldFByb2ZpbGUgQ0GCCQDSbLGDsoN54TATBgNVHSUEDDAKBggrBgEFBQcDATALBgNVHQ8EBAMCBaAwDQYJKoZIhvcNAQELBQADggIBAB2J1ysRudbkqmkUFK8xqhiZaYPd30TlmCmSAaGJ0eBpvkVeqA2jGYhAQRqFiAlFC63JKvWvRZO1iRuWCEfUMkdqQ9VQPXziE/BlsOIgrL6RlJfuFcEZ8TK3syIfIGQZNCxYhLLUuet2HE6LJYPQ5c0jH4kDooRpcVZ4rBxNwddpctUO2te9UU5/FjhioZQsPvd92qOTsV+8Cyl2fvNhNKD1Uu9ff5AkVIQn4JU23ozdB/R5oUlebwaTE6WZNBs+TA/qPj+5/we9NH71WRB0hqUoLI2AKKyiPw++FtN4Su1vsdDlrAzDj9ILjpjJKA1ImuVcG329/WTYIKysZ1CWK3zATg9BeCUPAV1pQy8ToXOq+RSYen6winZ2OO93eyHv2Iw5kbn1dqfBw1BuTE29V2FJKicJSu8iEOpfoafwJISXmz1wnnWL3V/0NxTulfWsXugOoLfv0ZIBP1xH9kmf22jjQ2JiHhQZP7ZDsreRrOeIQ/c4yR8IQvMLfC0WKQqrHu5ZzXTH4NO3CwGWSlTY74kE91zXB5mwWAx1jig+UXYc2w4RkVhy0//lOmVya/PEepuuTTI4+UJwC7qbVlh5zfhj8oTNUXgN0AOc+Q0/WFPl1aw5VV/VrO8FCoB15lFVlpKaQ1Yh+DVU8ke+rt9Th0BCHXe0uZOEmH0nOnH/0onD&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/619bce7c18f4842fa1a4647fff0dae3e/1acf3/activate.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 59.49367088607595%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAYAAABiDJ37AAAACXBIWXMAABYlAAAWJQFJUiTwAAAB3klEQVQoz4WTTW4UMRCF+zyILBKhiGn/trvddk/3/GQymr9swgaJMBF7bsNRuAHs4DQfsjsZZSASi6fnV3I9V5XKxWxx5N3mgev+M5fdA5fxE1fdkYmboaxFWkfsZ8RhhjBV1onPYOsRpqJ4s/5G+fgd9fUXF48/eXv8wcWX31wPR7y31LGnDhFTe5o4xTSe0ticPLJF+AEZlsjKU1zd7nDDHfPNPYvtPSYsUe0SXUeatsOHKaZqELpCZrins0MZl7mUZoS2FJPVnna6JnQtbYw432CdQ1YV7e2MuJ5j+5ZqHvGrgeamx/QtbtFlneJlcIhYI5yjEFIzUYb3ymYudUWpLKJ2qG2L3LToTUBvA2ozImmVdZvjehcw+4iaeory7wGbZ8MKvYuYbcwJep9MY46ddDrvAyrrZNhQCG3Jpom1PTNUh3COlHwX/o0fAvouovr/GOaKMsa2TtiG0xiSzhUeInJ4YVi+atigt/40v7HFc5jd+Kg5dOg0Q/FkcjbDZO5q1H6F3C0x645606NuPPKmQWZ+gWWDXHlkW1OIepq3vFRqNMrtGyY2Xf5IOf9AHQem80X+Jan6525eYtwQSyGaARHXiLA6u5BHISWlVONaSf2qUUJ6aL5aE/oZfwDJULK4r//0QgAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;code&quot;
        title=&quot;code&quot;
        src=&quot;/static/619bce7c18f4842fa1a4647fff0dae3e/f058b/activate.png&quot;
        srcset=&quot;/static/619bce7c18f4842fa1a4647fff0dae3e/c26ae/activate.png 158w,
/static/619bce7c18f4842fa1a4647fff0dae3e/6bdcf/activate.png 315w,
/static/619bce7c18f4842fa1a4647fff0dae3e/f058b/activate.png 630w,
/static/619bce7c18f4842fa1a4647fff0dae3e/40601/activate.png 945w,
/static/619bce7c18f4842fa1a4647fff0dae3e/78612/activate.png 1260w,
/static/619bce7c18f4842fa1a4647fff0dae3e/1acf3/activate.png 1596w&quot;
        sizes=&quot;(max-width: 630px) 100vw, 630px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;点击激活&lt;code class=&quot;language-text&quot;&gt;Activate&lt;/code&gt;后，就可以看到激活成功辣，又可以开心的 coding 了~：&lt;/p&gt;
&lt;h2&gt;其它问题&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;最新的 &lt;code class=&quot;language-text&quot;&gt;2022.1.4&lt;/code&gt; 版本应该是做了反制，只能显示到 &lt;code class=&quot;language-text&quot;&gt;2023&lt;/code&gt; 年，但补丁的本质是暴力拦截了剩余使用期限网络请求，还是永久激活。&lt;/li&gt;
&lt;/ul&gt;
&lt;h2&gt;jetbrains其它产品激活码&lt;/h2&gt;
&lt;h3&gt;IDEA 激活码&lt;/h3&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;W438N4X12J-eyJsaWNlbnNlSWQiOiJXNDM4TjRYMTJKIiwibGljZW5zZWVOYW1lIjoidHJlbmRzIHJhYmJpcyIsImFzc2lnbmVlTmFtZSI6IiIsImFzc2lnbmVlRW1haWwiOiIiLCJsaWNlbnNlUmVzdHJpY3Rpb24iOiIiLCJjaGVja0NvbmN1cnJlbnRVc2UiOmZhbHNlLCJwcm9kdWN0cyI6W3siY29kZSI6IklJIiwiZmFsbGJhY2tEYXRlIjoiMjAyMy0wMi0wOCIsInBhaWRVcFRvIjoiMjAyMy0wMi0wOCIsImV4dGVuZGVkIjpmYWxzZX0seyJjb2RlIjoiUERCIiwiZmFsbGJhY2tEYXRlIjoiMjAyMy0wMi0wOCIsInBhaWRVcFRvIjoiMjAyMy0wMi0wOCIsImV4dGVuZGVkIjp0cnVlfSx7ImNvZGUiOiJQV1MiLCJmYWxsYmFja0RhdGUiOiIyMDIzLTAyLTA4IiwicGFpZFVwVG8iOiIyMDIzLTAyLTA4IiwiZXh0ZW5kZWQiOnRydWV9LHsiY29kZSI6IlBHTyIsImZhbGxiYWNrRGF0ZSI6IjIwMjMtMDItMDgiLCJwYWlkVXBUbyI6IjIwMjMtMDItMDgiLCJleHRlbmRlZCI6dHJ1ZX0seyJjb2RlIjoiUFBTIiwiZmFsbGJhY2tEYXRlIjoiMjAyMy0wMi0wOCIsInBhaWRVcFRvIjoiMjAyMy0wMi0wOCIsImV4dGVuZGVkIjp0cnVlfSx7ImNvZGUiOiJQUEMiLCJmYWxsYmFja0RhdGUiOiIyMDIzLTAyLTA4IiwicGFpZFVwVG8iOiIyMDIzLTAyLTA4IiwiZXh0ZW5kZWQiOnRydWV9LHsiY29kZSI6IlBSQiIsImZhbGxiYWNrRGF0ZSI6IjIwMjMtMDItMDgiLCJwYWlkVXBUbyI6IjIwMjMtMDItMDgiLCJleHRlbmRlZCI6dHJ1ZX0seyJjb2RlIjoiUFNXIiwiZmFsbGJhY2tEYXRlIjoiMjAyMy0wMi0wOCIsInBhaWRVcFRvIjoiMjAyMy0wMi0wOCIsImV4dGVuZGVkIjp0cnVlfSx7ImNvZGUiOiJQU0kiLCJmYWxsYmFja0RhdGUiOiIyMDIzLTAyLTA4IiwicGFpZFVwVG8iOiIyMDIzLTAyLTA4IiwiZXh0ZW5kZWQiOnRydWV9LHsiY29kZSI6IlBDV01QIiwiZmFsbGJhY2tEYXRlIjoiMjAyMy0wMi0wOCIsInBhaWRVcFRvIjoiMjAyMy0wMi0wOCIsImV4dGVuZGVkIjp0cnVlfV0sIm1ldGFkYXRhIjoiMDEyMDIyMDIwOFBTQU4wMDAwMDUiLCJoYXNoIjoiVFJJQUw6LTIwMDMxNDk5MzciLCJncmFjZVBlcmlvZERheXMiOjcsImF1dG9Qcm9sb25nYXRlZCI6ZmFsc2UsImlzQXV0b1Byb2xvbmdhdGVkIjpmYWxzZX0=-U0uteIUdI7Pn3l6b42jdvpWmT4iDDXJcC69WIw3EB4sX47Qt98McKvbzUHKsAftFyMRG7HhyG5aFCnQYqVKgOAgYuOZ+vhT4yGHOMHpWtJ/cJnKHmki+pv7jhEc7gfyyk0Gv+5dzdKUGlinX357XGrfe4WJjtRXb6txvgChdlG8wqqi8t9VO7+n5N8XxCStgAmB6eOGVY00ZzXvdP96RRU4YdbD4NM3Hu49ZOC9eR7NxZADSmkhg3F6NPBMKPyQ/QKhFEXaqcexoYcQdwUkLjqUxsvs8zglHp0toM5jcccfqJ2EVbRSsrk5j7qL/h1QvSQJepRzrn8qra9Ne62eaUw==-MIIETDCCAjSgAwIBAgIBDTANBgkqhkiG9w0BAQsFADAYMRYwFAYDVQQDDA1KZXRQcm9maWxlIENBMB4XDTIwMTAxOTA5MDU1M1oXDTIyMTAyMTA5MDU1M1owHzEdMBsGA1UEAwwUcHJvZDJ5LWZyb20tMjAyMDEwMTkwggEiMA0GCSqGSIb3DQEBAQUAA4IBDwAwggEKAoIBAQCUlaUFc1wf+CfY9wzFWEL2euKQ5nswqb57V8QZG7d7RoR6rwYUIXseTOAFq210oMEe++LCjzKDuqwDfsyhgDNTgZBPAaC4vUU2oy+XR+Fq8nBixWIsH668HeOnRK6RRhsr0rJzRB95aZ3EAPzBuQ2qPaNGm17pAX0Rd6MPRgjp75IWwI9eA6aMEdPQEVN7uyOtM5zSsjoj79Lbu1fjShOnQZuJcsV8tqnayeFkNzv2LTOlofU/Tbx502Ro073gGjoeRzNvrynAP03pL486P3KCAyiNPhDs2z8/COMrxRlZW5mfzo0xsK0dQGNH3UoG/9RVwHG4eS8LFpMTR9oetHZBAgMBAAGjgZkwgZYwCQYDVR0TBAIwADAdBgNVHQ4EFgQUJNoRIpb1hUHAk0foMSNM9MCEAv8wSAYDVR0jBEEwP4AUo562SGdCEjZBvW3gubSgUouX8bOhHKQaMBgxFjAUBgNVBAMMDUpldFByb2ZpbGUgQ0GCCQDSbLGDsoN54TATBgNVHSUEDDAKBggrBgEFBQcDATALBgNVHQ8EBAMCBaAwDQYJKoZIhvcNAQELBQADggIBAB2J1ysRudbkqmkUFK8xqhiZaYPd30TlmCmSAaGJ0eBpvkVeqA2jGYhAQRqFiAlFC63JKvWvRZO1iRuWCEfUMkdqQ9VQPXziE/BlsOIgrL6RlJfuFcEZ8TK3syIfIGQZNCxYhLLUuet2HE6LJYPQ5c0jH4kDooRpcVZ4rBxNwddpctUO2te9UU5/FjhioZQsPvd92qOTsV+8Cyl2fvNhNKD1Uu9ff5AkVIQn4JU23ozdB/R5oUlebwaTE6WZNBs+TA/qPj+5/we9NH71WRB0hqUoLI2AKKyiPw++FtN4Su1vsdDlrAzDj9ILjpjJKA1ImuVcG329/WTYIKysZ1CWK3zATg9BeCUPAV1pQy8ToXOq+RSYen6winZ2OO93eyHv2Iw5kbn1dqfBw1BuTE29V2FJKicJSu8iEOpfoafwJISXmz1wnnWL3V/0NxTulfWsXugOoLfv0ZIBP1xH9kmf22jjQ2JiHhQZP7ZDsreRrOeIQ/c4yR8IQvMLfC0WKQqrHu5ZzXTH4NO3CwGWSlTY74kE91zXB5mwWAx1jig+UXYc2w4RkVhy0//lOmVya/PEepuuTTI4+UJwC7qbVlh5zfhj8oTNUXgN0AOc+Q0/WFPl1aw5VV/VrO8FCoB15lFVlpKaQ1Yh+DVU8ke+rt9Th0BCHXe0uZOEmH0nOnH/0onD&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h3&gt;Pycharm 激活码&lt;/h3&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;IHMWLMSEAL-eyJsaWNlbnNlSWQiOiJJSE1XTE1TRUFMIiwibGljZW5zZWVOYW1lIjoidHJlbmRzIHJhYmJpcyIsImFzc2lnbmVlTmFtZSI6IiIsImFzc2lnbmVlRW1haWwiOiIiLCJsaWNlbnNlUmVzdHJpY3Rpb24iOiIiLCJjaGVja0NvbmN1cnJlbnRVc2UiOmZhbHNlLCJwcm9kdWN0cyI6W3siY29kZSI6IlBDIiwiZmFsbGJhY2tEYXRlIjoiMjAyMy0wMi0wOCIsInBhaWRVcFRvIjoiMjAyMy0wMi0wOCIsImV4dGVuZGVkIjpmYWxzZX0seyJjb2RlIjoiUFBDIiwiZmFsbGJhY2tEYXRlIjoiMjAyMy0wMi0wOCIsInBhaWRVcFRvIjoiMjAyMy0wMi0wOCIsImV4dGVuZGVkIjp0cnVlfSx7ImNvZGUiOiJQV1MiLCJmYWxsYmFja0RhdGUiOiIyMDIzLTAyLTA4IiwicGFpZFVwVG8iOiIyMDIzLTAyLTA4IiwiZXh0ZW5kZWQiOnRydWV9LHsiY29kZSI6IlBTSSIsImZhbGxiYWNrRGF0ZSI6IjIwMjMtMDItMDgiLCJwYWlkVXBUbyI6IjIwMjMtMDItMDgiLCJleHRlbmRlZCI6dHJ1ZX0seyJjb2RlIjoiUENXTVAiLCJmYWxsYmFja0RhdGUiOiIyMDIzLTAyLTA4IiwicGFpZFVwVG8iOiIyMDIzLTAyLTA4IiwiZXh0ZW5kZWQiOnRydWV9XSwibWV0YWRhdGEiOiIwMTIwMjIwMjA4UFNBTjAwMDAwNSIsImhhc2giOiJUUklBTDozMzQzMzQ3ODMiLCJncmFjZVBlcmlvZERheXMiOjcsImF1dG9Qcm9sb25nYXRlZCI6ZmFsc2UsImlzQXV0b1Byb2xvbmdhdGVkIjpmYWxzZX0=-TT/mvlYqIE07j8qgnrhSSVpMtD4buKsRuntPuB17Zb8KodU2SUcb8byLpLG1pU+xEIIyG3Scu/ypjXmQ9w4iyvOT+NYGmeeHFMHnknQVEhhUvDZjTMNXPct03KeHcjxJX8jMSsuRkTooePx1beXjHTuxcyiO8qJcNOOl/97pT45kGTqSJohat0Xe7oiwrE6u3JZhfSdmYV9iJxz6XGNeoPMPnXbH17yoP75eXUqQJzUGxqdeHyKVHSUUJTGfO3IHgjN9y2TwYET5oFjRy1qSMRf4vXpPCK7tnfqhCGISQiDCm+ETB133CcmArxlRVlKdbAIM/7W++eOn5AfW/CNvgg==-MIIETDCCAjSgAwIBAgIBDTANBgkqhkiG9w0BAQsFADAYMRYwFAYDVQQDDA1KZXRQcm9maWxlIENBMB4XDTIwMTAxOTA5MDU1M1oXDTIyMTAyMTA5MDU1M1owHzEdMBsGA1UEAwwUcHJvZDJ5LWZyb20tMjAyMDEwMTkwggEiMA0GCSqGSIb3DQEBAQUAA4IBDwAwggEKAoIBAQCUlaUFc1wf+CfY9wzFWEL2euKQ5nswqb57V8QZG7d7RoR6rwYUIXseTOAFq210oMEe++LCjzKDuqwDfsyhgDNTgZBPAaC4vUU2oy+XR+Fq8nBixWIsH668HeOnRK6RRhsr0rJzRB95aZ3EAPzBuQ2qPaNGm17pAX0Rd6MPRgjp75IWwI9eA6aMEdPQEVN7uyOtM5zSsjoj79Lbu1fjShOnQZuJcsV8tqnayeFkNzv2LTOlofU/Tbx502Ro073gGjoeRzNvrynAP03pL486P3KCAyiNPhDs2z8/COMrxRlZW5mfzo0xsK0dQGNH3UoG/9RVwHG4eS8LFpMTR9oetHZBAgMBAAGjgZkwgZYwCQYDVR0TBAIwADAdBgNVHQ4EFgQUJNoRIpb1hUHAk0foMSNM9MCEAv8wSAYDVR0jBEEwP4AUo562SGdCEjZBvW3gubSgUouX8bOhHKQaMBgxFjAUBgNVBAMMDUpldFByb2ZpbGUgQ0GCCQDSbLGDsoN54TATBgNVHSUEDDAKBggrBgEFBQcDATALBgNVHQ8EBAMCBaAwDQYJKoZIhvcNAQELBQADggIBAB2J1ysRudbkqmkUFK8xqhiZaYPd30TlmCmSAaGJ0eBpvkVeqA2jGYhAQRqFiAlFC63JKvWvRZO1iRuWCEfUMkdqQ9VQPXziE/BlsOIgrL6RlJfuFcEZ8TK3syIfIGQZNCxYhLLUuet2HE6LJYPQ5c0jH4kDooRpcVZ4rBxNwddpctUO2te9UU5/FjhioZQsPvd92qOTsV+8Cyl2fvNhNKD1Uu9ff5AkVIQn4JU23ozdB/R5oUlebwaTE6WZNBs+TA/qPj+5/we9NH71WRB0hqUoLI2AKKyiPw++FtN4Su1vsdDlrAzDj9ILjpjJKA1ImuVcG329/WTYIKysZ1CWK3zATg9BeCUPAV1pQy8ToXOq+RSYen6winZ2OO93eyHv2Iw5kbn1dqfBw1BuTE29V2FJKicJSu8iEOpfoafwJISXmz1wnnWL3V/0NxTulfWsXugOoLfv0ZIBP1xH9kmf22jjQ2JiHhQZP7ZDsreRrOeIQ/c4yR8IQvMLfC0WKQqrHu5ZzXTH4NO3CwGWSlTY74kE91zXB5mwWAx1jig+UXYc2w4RkVhy0//lOmVya/PEepuuTTI4+UJwC7qbVlh5zfhj8oTNUXgN0AOc+Q0/WFPl1aw5VV/VrO8FCoB15lFVlpKaQ1Yh+DVU8ke+rt9Th0BCHXe0uZOEmH0nOnH/0onD&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h3&gt;Webstorm 激活码&lt;/h3&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;YJQB4P18ZS-eyJsaWNlbnNlSWQiOiJZSlFCNFAxOFpTIiwibGljZW5zZWVOYW1lIjoidHJlbmRzIHJhYmJpcyIsImFzc2lnbmVlTmFtZSI6IiIsImFzc2lnbmVlRW1haWwiOiIiLCJsaWNlbnNlUmVzdHJpY3Rpb24iOiIiLCJjaGVja0NvbmN1cnJlbnRVc2UiOmZhbHNlLCJwcm9kdWN0cyI6W3siY29kZSI6IldTIiwiZmFsbGJhY2tEYXRlIjoiMjAyMy0wMi0wOCIsInBhaWRVcFRvIjoiMjAyMy0wMi0wOCIsImV4dGVuZGVkIjpmYWxzZX0seyJjb2RlIjoiUFdTIiwiZmFsbGJhY2tEYXRlIjoiMjAyMy0wMi0wOCIsInBhaWRVcFRvIjoiMjAyMy0wMi0wOCIsImV4dGVuZGVkIjp0cnVlfSx7ImNvZGUiOiJQU0kiLCJmYWxsYmFja0RhdGUiOiIyMDIzLTAyLTA4IiwicGFpZFVwVG8iOiIyMDIzLTAyLTA4IiwiZXh0ZW5kZWQiOnRydWV9LHsiY29kZSI6IlBDV01QIiwiZmFsbGJhY2tEYXRlIjoiMjAyMy0wMi0wOCIsInBhaWRVcFRvIjoiMjAyMy0wMi0wOCIsImV4dGVuZGVkIjp0cnVlfV0sIm1ldGFkYXRhIjoiMDEyMDIyMDIwOFBTQU4wMDAwMDUiLCJoYXNoIjoiVFJJQUw6MTA5NjI1MTU0OCIsImdyYWNlUGVyaW9kRGF5cyI6NywiYXV0b1Byb2xvbmdhdGVkIjpmYWxzZSwiaXNBdXRvUHJvbG9uZ2F0ZWQiOmZhbHNlfQ==-aox1Rz0dSIQBtpXHUuEVWlmAa7Nc2tWGZ86EFQsyg2P3dijy3dB0H/Ky4Vu0kjuASRue+4mLsPVrpalNeQ4+K1A8shurIuFOiLKKlGmHYIwHAV9ggDiE5/gtDny7JwvidkPt/KA/o00Q9w/3fIxBhMWlUxcNJTU1IacAyFEGFk2F0hsC6Hi8PKc+yowJfZR+fpZaVtZ3nOpR4hAs2+Csnurx6ud8MW+jFaN1NntIPyku+CZHajBr1s9S1PMh7UJvgaxfXSAV1mH1Y6QT//lJ+Yhp0wjbyXalVd4kWpomMh+eQr/bzE5WgpuTOVOBKInIGTW3O4U2uaHks6nOMEv+Bw==-MIIETDCCAjSgAwIBAgIBDTANBgkqhkiG9w0BAQsFADAYMRYwFAYDVQQDDA1KZXRQcm9maWxlIENBMB4XDTIwMTAxOTA5MDU1M1oXDTIyMTAyMTA5MDU1M1owHzEdMBsGA1UEAwwUcHJvZDJ5LWZyb20tMjAyMDEwMTkwggEiMA0GCSqGSIb3DQEBAQUAA4IBDwAwggEKAoIBAQCUlaUFc1wf+CfY9wzFWEL2euKQ5nswqb57V8QZG7d7RoR6rwYUIXseTOAFq210oMEe++LCjzKDuqwDfsyhgDNTgZBPAaC4vUU2oy+XR+Fq8nBixWIsH668HeOnRK6RRhsr0rJzRB95aZ3EAPzBuQ2qPaNGm17pAX0Rd6MPRgjp75IWwI9eA6aMEdPQEVN7uyOtM5zSsjoj79Lbu1fjShOnQZuJcsV8tqnayeFkNzv2LTOlofU/Tbx502Ro073gGjoeRzNvrynAP03pL486P3KCAyiNPhDs2z8/COMrxRlZW5mfzo0xsK0dQGNH3UoG/9RVwHG4eS8LFpMTR9oetHZBAgMBAAGjgZkwgZYwCQYDVR0TBAIwADAdBgNVHQ4EFgQUJNoRIpb1hUHAk0foMSNM9MCEAv8wSAYDVR0jBEEwP4AUo562SGdCEjZBvW3gubSgUouX8bOhHKQaMBgxFjAUBgNVBAMMDUpldFByb2ZpbGUgQ0GCCQDSbLGDsoN54TATBgNVHSUEDDAKBggrBgEFBQcDATALBgNVHQ8EBAMCBaAwDQYJKoZIhvcNAQELBQADggIBAB2J1ysRudbkqmkUFK8xqhiZaYPd30TlmCmSAaGJ0eBpvkVeqA2jGYhAQRqFiAlFC63JKvWvRZO1iRuWCEfUMkdqQ9VQPXziE/BlsOIgrL6RlJfuFcEZ8TK3syIfIGQZNCxYhLLUuet2HE6LJYPQ5c0jH4kDooRpcVZ4rBxNwddpctUO2te9UU5/FjhioZQsPvd92qOTsV+8Cyl2fvNhNKD1Uu9ff5AkVIQn4JU23ozdB/R5oUlebwaTE6WZNBs+TA/qPj+5/we9NH71WRB0hqUoLI2AKKyiPw++FtN4Su1vsdDlrAzDj9ILjpjJKA1ImuVcG329/WTYIKysZ1CWK3zATg9BeCUPAV1pQy8ToXOq+RSYen6winZ2OO93eyHv2Iw5kbn1dqfBw1BuTE29V2FJKicJSu8iEOpfoafwJISXmz1wnnWL3V/0NxTulfWsXugOoLfv0ZIBP1xH9kmf22jjQ2JiHhQZP7ZDsreRrOeIQ/c4yR8IQvMLfC0WKQqrHu5ZzXTH4NO3CwGWSlTY74kE91zXB5mwWAx1jig+UXYc2w4RkVhy0//lOmVya/PEepuuTTI4+UJwC7qbVlh5zfhj8oTNUXgN0AOc+Q0/WFPl1aw5VV/VrO8FCoB15lFVlpKaQ1Yh+DVU8ke+rt9Th0BCHXe0uZOEmH0nOnH/0onD&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h3&gt;DataGrip 激活码&lt;/h3&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;YVRPO4AYF6-eyJsaWNlbnNlSWQiOiJZVlJQTzRBWUY2IiwibGljZW5zZWVOYW1lIjoidHJlbmRzIHJhYmJpcyIsImFzc2lnbmVlTmFtZSI6IiIsImFzc2lnbmVlRW1haWwiOiIiLCJsaWNlbnNlUmVzdHJpY3Rpb24iOiIiLCJjaGVja0NvbmN1cnJlbnRVc2UiOmZhbHNlLCJwcm9kdWN0cyI6W3siY29kZSI6IkRCIiwiZmFsbGJhY2tEYXRlIjoiMjAyMy0wMi0wOCIsInBhaWRVcFRvIjoiMjAyMy0wMi0wOCIsImV4dGVuZGVkIjpmYWxzZX0seyJjb2RlIjoiUERCIiwiZmFsbGJhY2tEYXRlIjoiMjAyMy0wMi0wOCIsInBhaWRVcFRvIjoiMjAyMy0wMi0wOCIsImV4dGVuZGVkIjp0cnVlfSx7ImNvZGUiOiJQV1MiLCJmYWxsYmFja0RhdGUiOiIyMDIzLTAyLTA4IiwicGFpZFVwVG8iOiIyMDIzLTAyLTA4IiwiZXh0ZW5kZWQiOnRydWV9LHsiY29kZSI6IlBTSSIsImZhbGxiYWNrRGF0ZSI6IjIwMjMtMDItMDgiLCJwYWlkVXBUbyI6IjIwMjMtMDItMDgiLCJleHRlbmRlZCI6dHJ1ZX1dLCJtZXRhZGF0YSI6IjAxMjAyMjAyMDhQU0FOMDAwMDA1IiwiaGFzaCI6IlRSSUFMOjE0MDA0Njg2NTEiLCJncmFjZVBlcmlvZERheXMiOjcsImF1dG9Qcm9sb25nYXRlZCI6ZmFsc2UsImlzQXV0b1Byb2xvbmdhdGVkIjpmYWxzZX0=-ISOBNoUyynrDvQvIIjZ8X95bgfWvktNOudvI9Zs66q6sA6l9RJHRQNnYCqExdIlRvJ6SpbmCKFjt4Gh5c0OPW6WhUEhXGe3TeEnPrWynF31rxG8JXIcpIRtwHfq+iPs1HE7j8ge0lG5jFkfxfGWl+eI6IbnM+zo/pzKyruM2Pz1YyBrOXtwpL+B27iP8ANNK7bNt4ylWbsZvDQEdVWXOn7brup7ZrnIaPbMjouxOGXyW06JgH6wUL52YGFCz03Mmc9o1RCwNQkp7DtQfzi9oVebCztw4Ih2+WVH7+2ML2+4cYE46tiJLzNHLIaM6Yq8H4CepkTjIt8QbrSQZbbB+tA==-MIIETDCCAjSgAwIBAgIBDTANBgkqhkiG9w0BAQsFADAYMRYwFAYDVQQDDA1KZXRQcm9maWxlIENBMB4XDTIwMTAxOTA5MDU1M1oXDTIyMTAyMTA5MDU1M1owHzEdMBsGA1UEAwwUcHJvZDJ5LWZyb20tMjAyMDEwMTkwggEiMA0GCSqGSIb3DQEBAQUAA4IBDwAwggEKAoIBAQCUlaUFc1wf+CfY9wzFWEL2euKQ5nswqb57V8QZG7d7RoR6rwYUIXseTOAFq210oMEe++LCjzKDuqwDfsyhgDNTgZBPAaC4vUU2oy+XR+Fq8nBixWIsH668HeOnRK6RRhsr0rJzRB95aZ3EAPzBuQ2qPaNGm17pAX0Rd6MPRgjp75IWwI9eA6aMEdPQEVN7uyOtM5zSsjoj79Lbu1fjShOnQZuJcsV8tqnayeFkNzv2LTOlofU/Tbx502Ro073gGjoeRzNvrynAP03pL486P3KCAyiNPhDs2z8/COMrxRlZW5mfzo0xsK0dQGNH3UoG/9RVwHG4eS8LFpMTR9oetHZBAgMBAAGjgZkwgZYwCQYDVR0TBAIwADAdBgNVHQ4EFgQUJNoRIpb1hUHAk0foMSNM9MCEAv8wSAYDVR0jBEEwP4AUo562SGdCEjZBvW3gubSgUouX8bOhHKQaMBgxFjAUBgNVBAMMDUpldFByb2ZpbGUgQ0GCCQDSbLGDsoN54TATBgNVHSUEDDAKBggrBgEFBQcDATALBgNVHQ8EBAMCBaAwDQYJKoZIhvcNAQELBQADggIBAB2J1ysRudbkqmkUFK8xqhiZaYPd30TlmCmSAaGJ0eBpvkVeqA2jGYhAQRqFiAlFC63JKvWvRZO1iRuWCEfUMkdqQ9VQPXziE/BlsOIgrL6RlJfuFcEZ8TK3syIfIGQZNCxYhLLUuet2HE6LJYPQ5c0jH4kDooRpcVZ4rBxNwddpctUO2te9UU5/FjhioZQsPvd92qOTsV+8Cyl2fvNhNKD1Uu9ff5AkVIQn4JU23ozdB/R5oUlebwaTE6WZNBs+TA/qPj+5/we9NH71WRB0hqUoLI2AKKyiPw++FtN4Su1vsdDlrAzDj9ILjpjJKA1ImuVcG329/WTYIKysZ1CWK3zATg9BeCUPAV1pQy8ToXOq+RSYen6winZ2OO93eyHv2Iw5kbn1dqfBw1BuTE29V2FJKicJSu8iEOpfoafwJISXmz1wnnWL3V/0NxTulfWsXugOoLfv0ZIBP1xH9kmf22jjQ2JiHhQZP7ZDsreRrOeIQ/c4yR8IQvMLfC0WKQqrHu5ZzXTH4NO3CwGWSlTY74kE91zXB5mwWAx1jig+UXYc2w4RkVhy0//lOmVya/PEepuuTTI4+UJwC7qbVlh5zfhj8oTNUXgN0AOc+Q0/WFPl1aw5VV/VrO8FCoB15lFVlpKaQ1Yh+DVU8ke+rt9Th0BCHXe0uZOEmH0nOnH/0onD&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h3&gt;Phpstorm 激活码&lt;/h3&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;WC8O5PZ8P1-eyJsaWNlbnNlSWQiOiJXQzhPNVBaOFAxIiwibGljZW5zZWVOYW1lIjoidHJlbmRzIHJhYmJpcyIsImFzc2lnbmVlTmFtZSI6IiIsImFzc2lnbmVlRW1haWwiOiIiLCJsaWNlbnNlUmVzdHJpY3Rpb24iOiIiLCJjaGVja0NvbmN1cnJlbnRVc2UiOmZhbHNlLCJwcm9kdWN0cyI6W3siY29kZSI6IlBTIiwiZmFsbGJhY2tEYXRlIjoiMjAyMy0wMi0wOCIsInBhaWRVcFRvIjoiMjAyMy0wMi0wOCIsImV4dGVuZGVkIjpmYWxzZX0seyJjb2RlIjoiUFBTIiwiZmFsbGJhY2tEYXRlIjoiMjAyMy0wMi0wOCIsInBhaWRVcFRvIjoiMjAyMy0wMi0wOCIsImV4dGVuZGVkIjp0cnVlfSx7ImNvZGUiOiJQV1MiLCJmYWxsYmFja0RhdGUiOiIyMDIzLTAyLTA4IiwicGFpZFVwVG8iOiIyMDIzLTAyLTA4IiwiZXh0ZW5kZWQiOnRydWV9LHsiY29kZSI6IlBTSSIsImZhbGxiYWNrRGF0ZSI6IjIwMjMtMDItMDgiLCJwYWlkVXBUbyI6IjIwMjMtMDItMDgiLCJleHRlbmRlZCI6dHJ1ZX0seyJjb2RlIjoiUENXTVAiLCJmYWxsYmFja0RhdGUiOiIyMDIzLTAyLTA4IiwicGFpZFVwVG8iOiIyMDIzLTAyLTA4IiwiZXh0ZW5kZWQiOnRydWV9XSwibWV0YWRhdGEiOiIwMTIwMjIwMjA4UFNBTjAwMDAwNSIsImhhc2giOiJUUklBTDoxMDQ2MTY0OTY5IiwiZ3JhY2VQZXJpb2REYXlzIjo3LCJhdXRvUHJvbG9uZ2F0ZWQiOmZhbHNlLCJpc0F1dG9Qcm9sb25nYXRlZCI6ZmFsc2V9-WW4JPvzhkKSGWoY98a/86WA0TzER4DaNvfj4oSxagfZnX0gwI4Z7hR4b+M5FSiP19NhqSVcatS0YK9t8wpr5iqXVsxWLdO9BnG5spy4SlC9vU8PgRqnSc8lkGv7+++q+FSfX6lh9EIDLxvsMdffjSpCAFfviHGNstBsTpbC0LlewYWZebzLvMA0n8OMKj/BDkh/WKOyF33E7QOBMjXMct8Pp8UrJF03IG/BJ2gCrVIaCGnwsArmVFwaCVZbrXOQFYZaqf+NiuYZztYrnz1c8VFAp0IMfJ7qNsKn+kI3pdwCbCZQAkQPDFCoYbRXUGISPCM/EHjYU+qzeAqSZOcSJzA==-MIIETDCCAjSgAwIBAgIBDTANBgkqhkiG9w0BAQsFADAYMRYwFAYDVQQDDA1KZXRQcm9maWxlIENBMB4XDTIwMTAxOTA5MDU1M1oXDTIyMTAyMTA5MDU1M1owHzEdMBsGA1UEAwwUcHJvZDJ5LWZyb20tMjAyMDEwMTkwggEiMA0GCSqGSIb3DQEBAQUAA4IBDwAwggEKAoIBAQCUlaUFc1wf+CfY9wzFWEL2euKQ5nswqb57V8QZG7d7RoR6rwYUIXseTOAFq210oMEe++LCjzKDuqwDfsyhgDNTgZBPAaC4vUU2oy+XR+Fq8nBixWIsH668HeOnRK6RRhsr0rJzRB95aZ3EAPzBuQ2qPaNGm17pAX0Rd6MPRgjp75IWwI9eA6aMEdPQEVN7uyOtM5zSsjoj79Lbu1fjShOnQZuJcsV8tqnayeFkNzv2LTOlofU/Tbx502Ro073gGjoeRzNvrynAP03pL486P3KCAyiNPhDs2z8/COMrxRlZW5mfzo0xsK0dQGNH3UoG/9RVwHG4eS8LFpMTR9oetHZBAgMBAAGjgZkwgZYwCQYDVR0TBAIwADAdBgNVHQ4EFgQUJNoRIpb1hUHAk0foMSNM9MCEAv8wSAYDVR0jBEEwP4AUo562SGdCEjZBvW3gubSgUouX8bOhHKQaMBgxFjAUBgNVBAMMDUpldFByb2ZpbGUgQ0GCCQDSbLGDsoN54TATBgNVHSUEDDAKBggrBgEFBQcDATALBgNVHQ8EBAMCBaAwDQYJKoZIhvcNAQELBQADggIBAB2J1ysRudbkqmkUFK8xqhiZaYPd30TlmCmSAaGJ0eBpvkVeqA2jGYhAQRqFiAlFC63JKvWvRZO1iRuWCEfUMkdqQ9VQPXziE/BlsOIgrL6RlJfuFcEZ8TK3syIfIGQZNCxYhLLUuet2HE6LJYPQ5c0jH4kDooRpcVZ4rBxNwddpctUO2te9UU5/FjhioZQsPvd92qOTsV+8Cyl2fvNhNKD1Uu9ff5AkVIQn4JU23ozdB/R5oUlebwaTE6WZNBs+TA/qPj+5/we9NH71WRB0hqUoLI2AKKyiPw++FtN4Su1vsdDlrAzDj9ILjpjJKA1ImuVcG329/WTYIKysZ1CWK3zATg9BeCUPAV1pQy8ToXOq+RSYen6winZ2OO93eyHv2Iw5kbn1dqfBw1BuTE29V2FJKicJSu8iEOpfoafwJISXmz1wnnWL3V/0NxTulfWsXugOoLfv0ZIBP1xH9kmf22jjQ2JiHhQZP7ZDsreRrOeIQ/c4yR8IQvMLfC0WKQqrHu5ZzXTH4NO3CwGWSlTY74kE91zXB5mwWAx1jig+UXYc2w4RkVhy0//lOmVya/PEepuuTTI4+UJwC7qbVlh5zfhj8oTNUXgN0AOc+Q0/WFPl1aw5VV/VrO8FCoB15lFVlpKaQ1Yh+DVU8ke+rt9Th0BCHXe0uZOEmH0nOnH/0onD&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h3&gt;AppCode 激活码&lt;/h3&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;31ML3NN173-eyJsaWNlbnNlSWQiOiIzMU1MM05OMTczIiwibGljZW5zZWVOYW1lIjoidHJlbmRzIHJhYmJpcyIsImFzc2lnbmVlTmFtZSI6IiIsImFzc2lnbmVlRW1haWwiOiIiLCJsaWNlbnNlUmVzdHJpY3Rpb24iOiIiLCJjaGVja0NvbmN1cnJlbnRVc2UiOmZhbHNlLCJwcm9kdWN0cyI6W3siY29kZSI6IkFDIiwiZmFsbGJhY2tEYXRlIjoiMjAyMy0wMi0wOCIsInBhaWRVcFRvIjoiMjAyMy0wMi0wOCIsImV4dGVuZGVkIjpmYWxzZX0seyJjb2RlIjoiUFNXIiwiZmFsbGJhY2tEYXRlIjoiMjAyMy0wMi0wOCIsInBhaWRVcFRvIjoiMjAyMy0wMi0wOCIsImV4dGVuZGVkIjp0cnVlfSx7ImNvZGUiOiJQV1MiLCJmYWxsYmFja0RhdGUiOiIyMDIzLTAyLTA4IiwicGFpZFVwVG8iOiIyMDIzLTAyLTA4IiwiZXh0ZW5kZWQiOnRydWV9LHsiY29kZSI6IlBTSSIsImZhbGxiYWNrRGF0ZSI6IjIwMjMtMDItMDgiLCJwYWlkVXBUbyI6IjIwMjMtMDItMDgiLCJleHRlbmRlZCI6dHJ1ZX0seyJjb2RlIjoiUENXTVAiLCJmYWxsYmFja0RhdGUiOiIyMDIzLTAyLTA4IiwicGFpZFVwVG8iOiIyMDIzLTAyLTA4IiwiZXh0ZW5kZWQiOnRydWV9XSwibWV0YWRhdGEiOiIwMTIwMjIwMjA4UFNBTjAwMDAwNSIsImhhc2giOiJUUklBTDotMTAwODM0OTUyMyIsImdyYWNlUGVyaW9kRGF5cyI6NywiYXV0b1Byb2xvbmdhdGVkIjpmYWxzZSwiaXNBdXRvUHJvbG9uZ2F0ZWQiOmZhbHNlfQ==-SmWszZD9WfRRnn0Br9aFbdt9wPFgjp7CIWYzTXa3wvjimGn8BefhvZIgh0MG8VocLMedIEj78Lc7sTI9m9FGBwF/hFqzYdEH54pXyG0TyrlBfkikY1ZnWlhFO4oG1tCXJFLssItpkVPZKwa5s6s94rOQWZGKrP28/NhXFKAVNHwG7xD1y2d/TPdP0W6AuLpTY4z8nJgum1pkNbps8azitK+Pl28I5IK+wDf30X/Hd0m1OaJITbxL9ZFp0P/eWz3EeaknorGWVQeDVJGzZsZDwQUGnpZwujrqR148aXd1Xef/OPUgwc20bG3r3sD0otJIHgEsLBSQzoKylhIDsvZHOg==-MIIETDCCAjSgAwIBAgIBDTANBgkqhkiG9w0BAQsFADAYMRYwFAYDVQQDDA1KZXRQcm9maWxlIENBMB4XDTIwMTAxOTA5MDU1M1oXDTIyMTAyMTA5MDU1M1owHzEdMBsGA1UEAwwUcHJvZDJ5LWZyb20tMjAyMDEwMTkwggEiMA0GCSqGSIb3DQEBAQUAA4IBDwAwggEKAoIBAQCUlaUFc1wf+CfY9wzFWEL2euKQ5nswqb57V8QZG7d7RoR6rwYUIXseTOAFq210oMEe++LCjzKDuqwDfsyhgDNTgZBPAaC4vUU2oy+XR+Fq8nBixWIsH668HeOnRK6RRhsr0rJzRB95aZ3EAPzBuQ2qPaNGm17pAX0Rd6MPRgjp75IWwI9eA6aMEdPQEVN7uyOtM5zSsjoj79Lbu1fjShOnQZuJcsV8tqnayeFkNzv2LTOlofU/Tbx502Ro073gGjoeRzNvrynAP03pL486P3KCAyiNPhDs2z8/COMrxRlZW5mfzo0xsK0dQGNH3UoG/9RVwHG4eS8LFpMTR9oetHZBAgMBAAGjgZkwgZYwCQYDVR0TBAIwADAdBgNVHQ4EFgQUJNoRIpb1hUHAk0foMSNM9MCEAv8wSAYDVR0jBEEwP4AUo562SGdCEjZBvW3gubSgUouX8bOhHKQaMBgxFjAUBgNVBAMMDUpldFByb2ZpbGUgQ0GCCQDSbLGDsoN54TATBgNVHSUEDDAKBggrBgEFBQcDATALBgNVHQ8EBAMCBaAwDQYJKoZIhvcNAQELBQADggIBAB2J1ysRudbkqmkUFK8xqhiZaYPd30TlmCmSAaGJ0eBpvkVeqA2jGYhAQRqFiAlFC63JKvWvRZO1iRuWCEfUMkdqQ9VQPXziE/BlsOIgrL6RlJfuFcEZ8TK3syIfIGQZNCxYhLLUuet2HE6LJYPQ5c0jH4kDooRpcVZ4rBxNwddpctUO2te9UU5/FjhioZQsPvd92qOTsV+8Cyl2fvNhNKD1Uu9ff5AkVIQn4JU23ozdB/R5oUlebwaTE6WZNBs+TA/qPj+5/we9NH71WRB0hqUoLI2AKKyiPw++FtN4Su1vsdDlrAzDj9ILjpjJKA1ImuVcG329/WTYIKysZ1CWK3zATg9BeCUPAV1pQy8ToXOq+RSYen6winZ2OO93eyHv2Iw5kbn1dqfBw1BuTE29V2FJKicJSu8iEOpfoafwJISXmz1wnnWL3V/0NxTulfWsXugOoLfv0ZIBP1xH9kmf22jjQ2JiHhQZP7ZDsreRrOeIQ/c4yR8IQvMLfC0WKQqrHu5ZzXTH4NO3CwGWSlTY74kE91zXB5mwWAx1jig+UXYc2w4RkVhy0//lOmVya/PEepuuTTI4+UJwC7qbVlh5zfhj8oTNUXgN0AOc+Q0/WFPl1aw5VV/VrO8FCoB15lFVlpKaQ1Yh+DVU8ke+rt9Th0BCHXe0uZOEmH0nOnH/0onD&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h3&gt;Goland 激活码&lt;/h3&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;D78I41OKAM-eyJsaWNlbnNlSWQiOiJENzhJNDFPS0FNIiwibGljZW5zZWVOYW1lIjoidHJlbmRzIHJhYmJpcyIsImFzc2lnbmVlTmFtZSI6IiIsImFzc2lnbmVlRW1haWwiOiIiLCJsaWNlbnNlUmVzdHJpY3Rpb24iOiIiLCJjaGVja0NvbmN1cnJlbnRVc2UiOmZhbHNlLCJwcm9kdWN0cyI6W3siY29kZSI6IkdPIiwiZmFsbGJhY2tEYXRlIjoiMjAyMy0wMi0wOCIsInBhaWRVcFRvIjoiMjAyMy0wMi0wOCIsImV4dGVuZGVkIjpmYWxzZX0seyJjb2RlIjoiUEdPIiwiZmFsbGJhY2tEYXRlIjoiMjAyMy0wMi0wOCIsInBhaWRVcFRvIjoiMjAyMy0wMi0wOCIsImV4dGVuZGVkIjp0cnVlfSx7ImNvZGUiOiJQV1MiLCJmYWxsYmFja0RhdGUiOiIyMDIzLTAyLTA4IiwicGFpZFVwVG8iOiIyMDIzLTAyLTA4IiwiZXh0ZW5kZWQiOnRydWV9LHsiY29kZSI6IlBTSSIsImZhbGxiYWNrRGF0ZSI6IjIwMjMtMDItMDgiLCJwYWlkVXBUbyI6IjIwMjMtMDItMDgiLCJleHRlbmRlZCI6dHJ1ZX0seyJjb2RlIjoiUENXTVAiLCJmYWxsYmFja0RhdGUiOiIyMDIzLTAyLTA4IiwicGFpZFVwVG8iOiIyMDIzLTAyLTA4IiwiZXh0ZW5kZWQiOnRydWV9XSwibWV0YWRhdGEiOiIwMTIwMjIwMjA4UFNBTjAwMDAwNSIsImhhc2giOiJUUklBTDoxNTE1ODQxMzczIiwiZ3JhY2VQZXJpb2REYXlzIjo3LCJhdXRvUHJvbG9uZ2F0ZWQiOmZhbHNlLCJpc0F1dG9Qcm9sb25nYXRlZCI6ZmFsc2V9-e3JluPUlXHNEJEr6ZvssZ2mkORaSq7d+HMRULh+BQT6fY0753XSbNoQ1B8WP7lZpbhDW43eVNF0KC4Or3KP3JsAbEjRjB4T8Bf/1q4EUDtn5tco62TrPNVsbpPaDQ60LEWV5CvWbrU0KordG1rrod0S9ZuaXcq6HKGcsAh8OskwWoRUlYMrN1fIQstYRTdCATTDWu76O1UXJoFgwVaHscakJtVjsaP5NLikbfD9SKPfMKjwE8PGcI0iA4pP4LI8ybb1/wsa4C/wl1N/dmuZaXQ9rLgmpR8pNf8j8GC61hh+HDIOdq7HyDow/1fjhGVwUhrl/S9SytrBjbq8Bl1BQAQ==-MIIETDCCAjSgAwIBAgIBDTANBgkqhkiG9w0BAQsFADAYMRYwFAYDVQQDDA1KZXRQcm9maWxlIENBMB4XDTIwMTAxOTA5MDU1M1oXDTIyMTAyMTA5MDU1M1owHzEdMBsGA1UEAwwUcHJvZDJ5LWZyb20tMjAyMDEwMTkwggEiMA0GCSqGSIb3DQEBAQUAA4IBDwAwggEKAoIBAQCUlaUFc1wf+CfY9wzFWEL2euKQ5nswqb57V8QZG7d7RoR6rwYUIXseTOAFq210oMEe++LCjzKDuqwDfsyhgDNTgZBPAaC4vUU2oy+XR+Fq8nBixWIsH668HeOnRK6RRhsr0rJzRB95aZ3EAPzBuQ2qPaNGm17pAX0Rd6MPRgjp75IWwI9eA6aMEdPQEVN7uyOtM5zSsjoj79Lbu1fjShOnQZuJcsV8tqnayeFkNzv2LTOlofU/Tbx502Ro073gGjoeRzNvrynAP03pL486P3KCAyiNPhDs2z8/COMrxRlZW5mfzo0xsK0dQGNH3UoG/9RVwHG4eS8LFpMTR9oetHZBAgMBAAGjgZkwgZYwCQYDVR0TBAIwADAdBgNVHQ4EFgQUJNoRIpb1hUHAk0foMSNM9MCEAv8wSAYDVR0jBEEwP4AUo562SGdCEjZBvW3gubSgUouX8bOhHKQaMBgxFjAUBgNVBAMMDUpldFByb2ZpbGUgQ0GCCQDSbLGDsoN54TATBgNVHSUEDDAKBggrBgEFBQcDATALBgNVHQ8EBAMCBaAwDQYJKoZIhvcNAQELBQADggIBAB2J1ysRudbkqmkUFK8xqhiZaYPd30TlmCmSAaGJ0eBpvkVeqA2jGYhAQRqFiAlFC63JKvWvRZO1iRuWCEfUMkdqQ9VQPXziE/BlsOIgrL6RlJfuFcEZ8TK3syIfIGQZNCxYhLLUuet2HE6LJYPQ5c0jH4kDooRpcVZ4rBxNwddpctUO2te9UU5/FjhioZQsPvd92qOTsV+8Cyl2fvNhNKD1Uu9ff5AkVIQn4JU23ozdB/R5oUlebwaTE6WZNBs+TA/qPj+5/we9NH71WRB0hqUoLI2AKKyiPw++FtN4Su1vsdDlrAzDj9ILjpjJKA1ImuVcG329/WTYIKysZ1CWK3zATg9BeCUPAV1pQy8ToXOq+RSYen6winZ2OO93eyHv2Iw5kbn1dqfBw1BuTE29V2FJKicJSu8iEOpfoafwJISXmz1wnnWL3V/0NxTulfWsXugOoLfv0ZIBP1xH9kmf22jjQ2JiHhQZP7ZDsreRrOeIQ/c4yR8IQvMLfC0WKQqrHu5ZzXTH4NO3CwGWSlTY74kE91zXB5mwWAx1jig+UXYc2w4RkVhy0//lOmVya/PEepuuTTI4+UJwC7qbVlh5zfhj8oTNUXgN0AOc+Q0/WFPl1aw5VV/VrO8FCoB15lFVlpKaQ1Yh+DVU8ke+rt9Th0BCHXe0uZOEmH0nOnH/0onD&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h3&gt;RubyMine 激活码&lt;/h3&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;ISC25C9CVG-eyJsaWNlbnNlSWQiOiJJU0MyNUM5Q1ZHIiwibGljZW5zZWVOYW1lIjoidHJlbmRzIHJhYmJpcyIsImFzc2lnbmVlTmFtZSI6IiIsImFzc2lnbmVlRW1haWwiOiIiLCJsaWNlbnNlUmVzdHJpY3Rpb24iOiIiLCJjaGVja0NvbmN1cnJlbnRVc2UiOmZhbHNlLCJwcm9kdWN0cyI6W3siY29kZSI6IlJNIiwiZmFsbGJhY2tEYXRlIjoiMjAyMy0wMi0wOCIsInBhaWRVcFRvIjoiMjAyMy0wMi0wOCIsImV4dGVuZGVkIjpmYWxzZX0seyJjb2RlIjoiUFJCIiwiZmFsbGJhY2tEYXRlIjoiMjAyMy0wMi0wOCIsInBhaWRVcFRvIjoiMjAyMy0wMi0wOCIsImV4dGVuZGVkIjp0cnVlfSx7ImNvZGUiOiJQV1MiLCJmYWxsYmFja0RhdGUiOiIyMDIzLTAyLTA4IiwicGFpZFVwVG8iOiIyMDIzLTAyLTA4IiwiZXh0ZW5kZWQiOnRydWV9LHsiY29kZSI6IlBTSSIsImZhbGxiYWNrRGF0ZSI6IjIwMjMtMDItMDgiLCJwYWlkVXBUbyI6IjIwMjMtMDItMDgiLCJleHRlbmRlZCI6dHJ1ZX0seyJjb2RlIjoiUENXTVAiLCJmYWxsYmFja0RhdGUiOiIyMDIzLTAyLTA4IiwicGFpZFVwVG8iOiIyMDIzLTAyLTA4IiwiZXh0ZW5kZWQiOnRydWV9XSwibWV0YWRhdGEiOiIwMTIwMjIwMjA4UFNBTjAwMDAwNSIsImhhc2giOiJUUklBTDoyMDkxMDI1MTY3IiwiZ3JhY2VQZXJpb2REYXlzIjo3LCJhdXRvUHJvbG9uZ2F0ZWQiOmZhbHNlLCJpc0F1dG9Qcm9sb25nYXRlZCI6ZmFsc2V9-He5MYi7AvyhwCf7AZpuUdrRGN/Y+mU2UwYFdPRRZozN5NCh6tq/xxyv2AHVNEL/K2SX+kxaz7jysQ9q6ts25E35SmvFAeIDCVcEfARlLeAK9aE/2xG5VjphUWK0PFOLAw59fbULpQAxPt0STpie9epl31+Ve4fuQrLJNZuURH9UwVMHY+1A5Nk4fe0c2qsp3Oqs0koS8LMkjx1YikPLYIcf2C3V3sHLVlhNH5HfQASHI1LsFWu5DRUHuXYuTOKKIltAgHJeMg80/rijwJVl68I96LjFSXbrcjNzS/WJWP2mIM5tXTdej4gPXVsmc1xVTnHWLii7guKhKstWn5CGJdg==-MIIETDCCAjSgAwIBAgIBDTANBgkqhkiG9w0BAQsFADAYMRYwFAYDVQQDDA1KZXRQcm9maWxlIENBMB4XDTIwMTAxOTA5MDU1M1oXDTIyMTAyMTA5MDU1M1owHzEdMBsGA1UEAwwUcHJvZDJ5LWZyb20tMjAyMDEwMTkwggEiMA0GCSqGSIb3DQEBAQUAA4IBDwAwggEKAoIBAQCUlaUFc1wf+CfY9wzFWEL2euKQ5nswqb57V8QZG7d7RoR6rwYUIXseTOAFq210oMEe++LCjzKDuqwDfsyhgDNTgZBPAaC4vUU2oy+XR+Fq8nBixWIsH668HeOnRK6RRhsr0rJzRB95aZ3EAPzBuQ2qPaNGm17pAX0Rd6MPRgjp75IWwI9eA6aMEdPQEVN7uyOtM5zSsjoj79Lbu1fjShOnQZuJcsV8tqnayeFkNzv2LTOlofU/Tbx502Ro073gGjoeRzNvrynAP03pL486P3KCAyiNPhDs2z8/COMrxRlZW5mfzo0xsK0dQGNH3UoG/9RVwHG4eS8LFpMTR9oetHZBAgMBAAGjgZkwgZYwCQYDVR0TBAIwADAdBgNVHQ4EFgQUJNoRIpb1hUHAk0foMSNM9MCEAv8wSAYDVR0jBEEwP4AUo562SGdCEjZBvW3gubSgUouX8bOhHKQaMBgxFjAUBgNVBAMMDUpldFByb2ZpbGUgQ0GCCQDSbLGDsoN54TATBgNVHSUEDDAKBggrBgEFBQcDATALBgNVHQ8EBAMCBaAwDQYJKoZIhvcNAQELBQADggIBAB2J1ysRudbkqmkUFK8xqhiZaYPd30TlmCmSAaGJ0eBpvkVeqA2jGYhAQRqFiAlFC63JKvWvRZO1iRuWCEfUMkdqQ9VQPXziE/BlsOIgrL6RlJfuFcEZ8TK3syIfIGQZNCxYhLLUuet2HE6LJYPQ5c0jH4kDooRpcVZ4rBxNwddpctUO2te9UU5/FjhioZQsPvd92qOTsV+8Cyl2fvNhNKD1Uu9ff5AkVIQn4JU23ozdB/R5oUlebwaTE6WZNBs+TA/qPj+5/we9NH71WRB0hqUoLI2AKKyiPw++FtN4Su1vsdDlrAzDj9ILjpjJKA1ImuVcG329/WTYIKysZ1CWK3zATg9BeCUPAV1pQy8ToXOq+RSYen6winZ2OO93eyHv2Iw5kbn1dqfBw1BuTE29V2FJKicJSu8iEOpfoafwJISXmz1wnnWL3V/0NxTulfWsXugOoLfv0ZIBP1xH9kmf22jjQ2JiHhQZP7ZDsreRrOeIQ/c4yR8IQvMLfC0WKQqrHu5ZzXTH4NO3CwGWSlTY74kE91zXB5mwWAx1jig+UXYc2w4RkVhy0//lOmVya/PEepuuTTI4+UJwC7qbVlh5zfhj8oTNUXgN0AOc+Q0/WFPl1aw5VV/VrO8FCoB15lFVlpKaQ1Yh+DVU8ke+rt9Th0BCHXe0uZOEmH0nOnH/0onD&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h3&gt;Rider 激活码&lt;/h3&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;74OLRHWGEV-eyJsaWNlbnNlSWQiOiI3NE9MUkhXR0VWIiwibGljZW5zZWVOYW1lIjoidHJlbmRzIHJhYmJpcyIsImFzc2lnbmVlTmFtZSI6IiIsImFzc2lnbmVlRW1haWwiOiIiLCJsaWNlbnNlUmVzdHJpY3Rpb24iOiIiLCJjaGVja0NvbmN1cnJlbnRVc2UiOmZhbHNlLCJwcm9kdWN0cyI6W3siY29kZSI6IlJEIiwiZmFsbGJhY2tEYXRlIjoiMjAyMy0wMi0wOCIsInBhaWRVcFRvIjoiMjAyMy0wMi0wOCIsImV4dGVuZGVkIjpmYWxzZX0seyJjb2RlIjoiUERCIiwiZmFsbGJhY2tEYXRlIjoiMjAyMy0wMi0wOCIsInBhaWRVcFRvIjoiMjAyMy0wMi0wOCIsImV4dGVuZGVkIjp0cnVlfSx7ImNvZGUiOiJQV1MiLCJmYWxsYmFja0RhdGUiOiIyMDIzLTAyLTA4IiwicGFpZFVwVG8iOiIyMDIzLTAyLTA4IiwiZXh0ZW5kZWQiOnRydWV9LHsiY29kZSI6IlBTSSIsImZhbGxiYWNrRGF0ZSI6IjIwMjMtMDItMDgiLCJwYWlkVXBUbyI6IjIwMjMtMDItMDgiLCJleHRlbmRlZCI6dHJ1ZX1dLCJtZXRhZGF0YSI6IjAxMjAyMjAyMDhQU0FOMDAwMDA1IiwiaGFzaCI6IlRSSUFMOi0xNTY3NTEzNzgiLCJncmFjZVBlcmlvZERheXMiOjcsImF1dG9Qcm9sb25nYXRlZCI6ZmFsc2UsImlzQXV0b1Byb2xvbmdhdGVkIjpmYWxzZX0=-FQKYUU00tYFGzKjEJknxi5DAwyVFMu8Z3Rm5pvkPP20AJlA/jrSFNqJUhtbw1GwNcC2a6ahikohOmhykkI/Wcjmkxxi/LH6xNLmQc/2R9SdipaBhKiejVpD1mJIug4kUC6dfSwH0tSwOSMkOEDUCvtcXRtokuh3x5GluzMmjjaA7uYMcpNEYruhLUreoflrhg2I4wZHE5IaDQ3ukluFnEGfO1VNiCuz0pKlsZBSQz9z7Gw+SxEUAnjc8fXl4k6xb08IqNbkKcfu4f8HS6nvqmkPwF8k9GPCiDh87UcyDK9lkB/4i+Ep+//tQNcxa0cE9J+QEJ3huQXvsdOQTOxsGpA==-MIIETDCCAjSgAwIBAgIBDTANBgkqhkiG9w0BAQsFADAYMRYwFAYDVQQDDA1KZXRQcm9maWxlIENBMB4XDTIwMTAxOTA5MDU1M1oXDTIyMTAyMTA5MDU1M1owHzEdMBsGA1UEAwwUcHJvZDJ5LWZyb20tMjAyMDEwMTkwggEiMA0GCSqGSIb3DQEBAQUAA4IBDwAwggEKAoIBAQCUlaUFc1wf+CfY9wzFWEL2euKQ5nswqb57V8QZG7d7RoR6rwYUIXseTOAFq210oMEe++LCjzKDuqwDfsyhgDNTgZBPAaC4vUU2oy+XR+Fq8nBixWIsH668HeOnRK6RRhsr0rJzRB95aZ3EAPzBuQ2qPaNGm17pAX0Rd6MPRgjp75IWwI9eA6aMEdPQEVN7uyOtM5zSsjoj79Lbu1fjShOnQZuJcsV8tqnayeFkNzv2LTOlofU/Tbx502Ro073gGjoeRzNvrynAP03pL486P3KCAyiNPhDs2z8/COMrxRlZW5mfzo0xsK0dQGNH3UoG/9RVwHG4eS8LFpMTR9oetHZBAgMBAAGjgZkwgZYwCQYDVR0TBAIwADAdBgNVHQ4EFgQUJNoRIpb1hUHAk0foMSNM9MCEAv8wSAYDVR0jBEEwP4AUo562SGdCEjZBvW3gubSgUouX8bOhHKQaMBgxFjAUBgNVBAMMDUpldFByb2ZpbGUgQ0GCCQDSbLGDsoN54TATBgNVHSUEDDAKBggrBgEFBQcDATALBgNVHQ8EBAMCBaAwDQYJKoZIhvcNAQELBQADggIBAB2J1ysRudbkqmkUFK8xqhiZaYPd30TlmCmSAaGJ0eBpvkVeqA2jGYhAQRqFiAlFC63JKvWvRZO1iRuWCEfUMkdqQ9VQPXziE/BlsOIgrL6RlJfuFcEZ8TK3syIfIGQZNCxYhLLUuet2HE6LJYPQ5c0jH4kDooRpcVZ4rBxNwddpctUO2te9UU5/FjhioZQsPvd92qOTsV+8Cyl2fvNhNKD1Uu9ff5AkVIQn4JU23ozdB/R5oUlebwaTE6WZNBs+TA/qPj+5/we9NH71WRB0hqUoLI2AKKyiPw++FtN4Su1vsdDlrAzDj9ILjpjJKA1ImuVcG329/WTYIKysZ1CWK3zATg9BeCUPAV1pQy8ToXOq+RSYen6winZ2OO93eyHv2Iw5kbn1dqfBw1BuTE29V2FJKicJSu8iEOpfoafwJISXmz1wnnWL3V/0NxTulfWsXugOoLfv0ZIBP1xH9kmf22jjQ2JiHhQZP7ZDsreRrOeIQ/c4yR8IQvMLfC0WKQqrHu5ZzXTH4NO3CwGWSlTY74kE91zXB5mwWAx1jig+UXYc2w4RkVhy0//lOmVya/PEepuuTTI4+UJwC7qbVlh5zfhj8oTNUXgN0AOc+Q0/WFPl1aw5VV/VrO8FCoB15lFVlpKaQ1Yh+DVU8ke+rt9Th0BCHXe0uZOEmH0nOnH/0onD&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h3&gt;CLion 激活码&lt;/h3&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;PW00Y99ZYP-eyJsaWNlbnNlSWQiOiJQVzAwWTk5WllQIiwibGljZW5zZWVOYW1lIjoidHJlbmRzIHJhYmJpcyIsImFzc2lnbmVlTmFtZSI6IiIsImFzc2lnbmVlRW1haWwiOiIiLCJsaWNlbnNlUmVzdHJpY3Rpb24iOiIiLCJjaGVja0NvbmN1cnJlbnRVc2UiOmZhbHNlLCJwcm9kdWN0cyI6W3siY29kZSI6IkNMIiwiZmFsbGJhY2tEYXRlIjoiMjAyMy0wMi0wOCIsInBhaWRVcFRvIjoiMjAyMy0wMi0wOCIsImV4dGVuZGVkIjpmYWxzZX0seyJjb2RlIjoiUFNXIiwiZmFsbGJhY2tEYXRlIjoiMjAyMy0wMi0wOCIsInBhaWRVcFRvIjoiMjAyMy0wMi0wOCIsImV4dGVuZGVkIjp0cnVlfSx7ImNvZGUiOiJQV1MiLCJmYWxsYmFja0RhdGUiOiIyMDIzLTAyLTA4IiwicGFpZFVwVG8iOiIyMDIzLTAyLTA4IiwiZXh0ZW5kZWQiOnRydWV9LHsiY29kZSI6IlBTSSIsImZhbGxiYWNrRGF0ZSI6IjIwMjMtMDItMDgiLCJwYWlkVXBUbyI6IjIwMjMtMDItMDgiLCJleHRlbmRlZCI6dHJ1ZX0seyJjb2RlIjoiUENXTVAiLCJmYWxsYmFja0RhdGUiOiIyMDIzLTAyLTA4IiwicGFpZFVwVG8iOiIyMDIzLTAyLTA4IiwiZXh0ZW5kZWQiOnRydWV9XSwibWV0YWRhdGEiOiIwMTIwMjIwMjA4UFNBTjAwMDAwNSIsImhhc2giOiJUUklBTDoyMDUzNjcyNTI0IiwiZ3JhY2VQZXJpb2REYXlzIjo3LCJhdXRvUHJvbG9uZ2F0ZWQiOmZhbHNlLCJpc0F1dG9Qcm9sb25nYXRlZCI6ZmFsc2V9-MOoKsbGoDXKc3nmFLj/aGiiIhsOe4j5RIQdnLT73nyynpB09yMO8b+j+0+ax6CP1lWqGbW38c5YHctg3v+6cSFXqlisBWOGaHRGTpcHgtuGhS332DiRv+DwILJBj9vD7QOnU7wpuxCApra8WcIGJTSZflY2X9oR3Ql6WiGhXm/iGq3UFEQXRVpcX27EXzW1ad2WKRV4RV9xdMypxZ/EGzZ8cDF3SwKSkAWZs2Zoe4VH9hLmBxFr/9BBaf4yUyLjFDqNpmLnZkEdTjB6Uu7zJlBM/D+5o8Iuaru5jXZRP2TBfG1xO+GOtsW2a+QLMnirdlC0czUp5nJ8Ga2if4pHtvQ==-MIIETDCCAjSgAwIBAgIBDTANBgkqhkiG9w0BAQsFADAYMRYwFAYDVQQDDA1KZXRQcm9maWxlIENBMB4XDTIwMTAxOTA5MDU1M1oXDTIyMTAyMTA5MDU1M1owHzEdMBsGA1UEAwwUcHJvZDJ5LWZyb20tMjAyMDEwMTkwggEiMA0GCSqGSIb3DQEBAQUAA4IBDwAwggEKAoIBAQCUlaUFc1wf+CfY9wzFWEL2euKQ5nswqb57V8QZG7d7RoR6rwYUIXseTOAFq210oMEe++LCjzKDuqwDfsyhgDNTgZBPAaC4vUU2oy+XR+Fq8nBixWIsH668HeOnRK6RRhsr0rJzRB95aZ3EAPzBuQ2qPaNGm17pAX0Rd6MPRgjp75IWwI9eA6aMEdPQEVN7uyOtM5zSsjoj79Lbu1fjShOnQZuJcsV8tqnayeFkNzv2LTOlofU/Tbx502Ro073gGjoeRzNvrynAP03pL486P3KCAyiNPhDs2z8/COMrxRlZW5mfzo0xsK0dQGNH3UoG/9RVwHG4eS8LFpMTR9oetHZBAgMBAAGjgZkwgZYwCQYDVR0TBAIwADAdBgNVHQ4EFgQUJNoRIpb1hUHAk0foMSNM9MCEAv8wSAYDVR0jBEEwP4AUo562SGdCEjZBvW3gubSgUouX8bOhHKQaMBgxFjAUBgNVBAMMDUpldFByb2ZpbGUgQ0GCCQDSbLGDsoN54TATBgNVHSUEDDAKBggrBgEFBQcDATALBgNVHQ8EBAMCBaAwDQYJKoZIhvcNAQELBQADggIBAB2J1ysRudbkqmkUFK8xqhiZaYPd30TlmCmSAaGJ0eBpvkVeqA2jGYhAQRqFiAlFC63JKvWvRZO1iRuWCEfUMkdqQ9VQPXziE/BlsOIgrL6RlJfuFcEZ8TK3syIfIGQZNCxYhLLUuet2HE6LJYPQ5c0jH4kDooRpcVZ4rBxNwddpctUO2te9UU5/FjhioZQsPvd92qOTsV+8Cyl2fvNhNKD1Uu9ff5AkVIQn4JU23ozdB/R5oUlebwaTE6WZNBs+TA/qPj+5/we9NH71WRB0hqUoLI2AKKyiPw++FtN4Su1vsdDlrAzDj9ILjpjJKA1ImuVcG329/WTYIKysZ1CWK3zATg9BeCUPAV1pQy8ToXOq+RSYen6winZ2OO93eyHv2Iw5kbn1dqfBw1BuTE29V2FJKicJSu8iEOpfoafwJISXmz1wnnWL3V/0NxTulfWsXugOoLfv0ZIBP1xH9kmf22jjQ2JiHhQZP7ZDsreRrOeIQ/c4yR8IQvMLfC0WKQqrHu5ZzXTH4NO3CwGWSlTY74kE91zXB5mwWAx1jig+UXYc2w4RkVhy0//lOmVya/PEepuuTTI4+UJwC7qbVlh5zfhj8oTNUXgN0AOc+Q0/WFPl1aw5VV/VrO8FCoB15lFVlpKaQ1Yh+DVU8ke+rt9Th0BCHXe0uZOEmH0nOnH/0onD&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2&gt;本教程只做个人学习使用，请勿用于商业用途！&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;若资金允许，请点击 &lt;a href=&quot;https://www.jetbrains.com/idea/buy/&quot;&gt;https://www.jetbrains.com/idea/buy/&lt;/a&gt; 购买正版，谢谢合作！&lt;/li&gt;
&lt;li&gt;学生凭学生证可免费申请 &lt;a href=&quot;https://sales.jetbrains.com/hc/zh-cn/articles/207154369-%E5%AD%A6%E7%94%9F%E6%8E%88%E6%9D%83%E7%94%B3%E8%AF%B7%E6%96%B9%E5%BC%8F&quot;&gt;https://sales.jetbrains.com/hc/zh-cn/articles/207154369-学生授权申请方式&lt;/a&gt; 正版授权！&lt;/li&gt;
&lt;li&gt;创业公司可5折购买 &lt;a href=&quot;https://www.jetbrains.com/shop/eform/startup&quot;&gt;https://www.jetbrains.com/shop/eform/startup&lt;/a&gt; 正版授权！&lt;/li&gt;
&lt;/ul&gt;</content:encoded></item><item><title><![CDATA[Kubernetes Scheduler]]></title><description><![CDATA[Kubernetes Scheduler Scheduler Workflow  定义了和，在中有串行和两个阶段，是异步并行阶段。 Scheduler FrameWork…]]></description><link>https://lengrongfu.github.io/2022-07-11-Kubernetes-Scheduler/</link><guid isPermaLink="false">https://lengrongfu.github.io/2022-07-11-Kubernetes-Scheduler/</guid><pubDate>Mon, 11 Jul 2022 23:06:05 GMT</pubDate><content:encoded>&lt;h1&gt;Kubernetes Scheduler&lt;/h1&gt;
&lt;h2&gt;Scheduler Workflow&lt;/h2&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/137ee9eb9c987670962a8910825aab00/2f2ab/schedule-workflow.jpg&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 52.53164556962025%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAALABQDASIAAhEBAxEB/8QAFwABAQEBAAAAAAAAAAAAAAAAAAUBBP/EABUBAQEAAAAAAAAAAAAAAAAAAAEC/9oADAMBAAIQAxAAAAG04KVGiX//xAAZEAEAAgMAAAAAAAAAAAAAAAABABEQITH/2gAIAQEAAQUCtmyHGUOP/8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAwEBPwE//8QAFhEBAQEAAAAAAAAAAAAAAAAAARAR/9oACAECAQE/AUyf/8QAGRAAAgMBAAAAAAAAAAAAAAAAEKEAATEy/9oACAEBAAY/AuXMYs//xAAcEAEAAgMAAwAAAAAAAAAAAAABABEhMUFRYeH/2gAIAQEAAT8hVE+ku7nkJQpT4m+T3vuVMkCtT//aAAwDAQACAAMAAAAQY8//xAAWEQEBAQAAAAAAAAAAAAAAAAABEBH/2gAIAQMBAT8QHZ//xAAVEQEBAAAAAAAAAAAAAAAAAAABEP/aAAgBAgEBPxAI/8QAHRAAAgICAwEAAAAAAAAAAAAAAREAMSFRQWFxgf/aAAgBAQABPxDPCWgFwgXuQDIheuo4HWzX2D7nNpCAzY2YAVS7c//Z&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;schedule-workflow&quot;
        title=&quot;schedule-workflow&quot;
        src=&quot;/static/137ee9eb9c987670962a8910825aab00/828fb/schedule-workflow.jpg&quot;
        srcset=&quot;/static/137ee9eb9c987670962a8910825aab00/ff44c/schedule-workflow.jpg 158w,
/static/137ee9eb9c987670962a8910825aab00/a6688/schedule-workflow.jpg 315w,
/static/137ee9eb9c987670962a8910825aab00/828fb/schedule-workflow.jpg 630w,
/static/137ee9eb9c987670962a8910825aab00/0ede0/schedule-workflow.jpg 945w,
/static/137ee9eb9c987670962a8910825aab00/3ac88/schedule-workflow.jpg 1260w,
/static/137ee9eb9c987670962a8910825aab00/2f2ab/schedule-workflow.jpg 1643w&quot;
        sizes=&quot;(max-width: 630px) 100vw, 630px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;Scheduler WorkFlow&lt;/code&gt;定义了&lt;code class=&quot;language-text&quot;&gt;Scheduler Cycle&lt;/code&gt;和&lt;code class=&quot;language-text&quot;&gt;Binding Cycle&lt;/code&gt;，在&lt;code class=&quot;language-text&quot;&gt;Scheduler Cycle&lt;/code&gt;中有串行&lt;code class=&quot;language-text&quot;&gt;Filter &lt;/code&gt;和&lt;code class=&quot;language-text&quot;&gt;Score&lt;/code&gt;两个阶段，&lt;code class=&quot;language-text&quot;&gt;Bind&lt;/code&gt;是异步并行阶段。&lt;/p&gt;
&lt;h2&gt;Scheduler FrameWork&lt;/h2&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;Scheduler FrameWork&lt;/code&gt;是通过在&lt;code class=&quot;language-text&quot;&gt;Scheduler  Cycle&lt;/code&gt;中通过预留扩展点来进行扩展调度流程，&lt;code class=&quot;language-text&quot;&gt;FrameWork&lt;/code&gt;预留了多个扩展点:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;QueueSortFunc() LessFunc&lt;/code&gt;： &lt;code class=&quot;language-text&quot;&gt;Pod&lt;/code&gt; 从队列中获取的优先级&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;PreFilter&lt;/code&gt;： 在过滤之前执行&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;Filter&lt;/code&gt;： 执行过滤函数&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;PostFilter&lt;/code&gt;: 执行抢占&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;PreScore&lt;/code&gt;：执行`Score之前执行&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;Score&lt;/code&gt;: 执行&lt;code class=&quot;language-text&quot;&gt;Node&lt;/code&gt;打分&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;PreBind&lt;/code&gt;: 执行&lt;code class=&quot;language-text&quot;&gt;Binding&lt;/code&gt;之前&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;Bind&lt;/code&gt;： 执行&lt;code class=&quot;language-text&quot;&gt;Binding&lt;/code&gt;动作&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;PostBind&lt;/code&gt;：执行&lt;code class=&quot;language-text&quot;&gt;Binding&lt;/code&gt;之后&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;自定义&lt;code class=&quot;language-text&quot;&gt;Schedlue&lt;/code&gt;可以通过直接实现&lt;code class=&quot;language-text&quot;&gt;Scheduler FrameWork&lt;/code&gt;中暴露的接口，然后在启动过程中进行&lt;code class=&quot;language-text&quot;&gt;Plugin&lt;/code&gt;注册即可。&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;go&quot;&gt;&lt;pre class=&quot;language-go&quot;&gt;&lt;code class=&quot;language-go&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;func&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;main&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
	rand&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Seed&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;time&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Now&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;UTC&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;UnixNano&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
	logs&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;InitLogs&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
	&lt;span class=&quot;token keyword&quot;&gt;defer&lt;/span&gt; logs&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;FlushLogs&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;

	cmd &lt;span class=&quot;token operator&quot;&gt;:=&lt;/span&gt; app&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;NewSchedulerCommand&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;
		app&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;WithPlugin&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;sample&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;Name&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; sample&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;New&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
	&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
	&lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; err &lt;span class=&quot;token operator&quot;&gt;:=&lt;/span&gt; cmd&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Execute&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; err &lt;span class=&quot;token operator&quot;&gt;!=&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;nil&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
		&lt;span class=&quot;token boolean&quot;&gt;_&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;_&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; fmt&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Fprintf&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;os&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;Stderr&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;%v\n&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; err&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
		os&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Exit&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
	&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2&gt;Scheduler Plugin&lt;/h2&gt;
&lt;p&gt;如下的&lt;code class=&quot;language-text&quot;&gt;Scheduler Plugin&lt;/code&gt;是&lt;code class=&quot;language-text&quot;&gt;kube-scheduler&lt;/code&gt;里面内嵌的插件，涵盖了&lt;code class=&quot;language-text&quot;&gt;WorkFlow&lt;/code&gt;里面的所有流程。&lt;/p&gt;
&lt;h3&gt;Sort(排序)&lt;/h3&gt;
&lt;h4&gt;1.PrioritySort&lt;/h4&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;PrioritySort&lt;/code&gt;优先队列是进行&lt;code class=&quot;language-text&quot;&gt;Pod&lt;/code&gt;在入队时的排序函数，按找&lt;code class=&quot;language-text&quot;&gt;Pod&lt;/code&gt;的优先级进行排序，通过读取&lt;code class=&quot;language-text&quot;&gt;pod.Spec.Priority&lt;/code&gt;字段值进行排序，如果未设置&lt;code class=&quot;language-text&quot;&gt;Pod&lt;/code&gt;的优先级则按照添加到队列的时间先后进行排序。&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;go&quot;&gt;&lt;pre class=&quot;language-go&quot;&gt;&lt;code class=&quot;language-go&quot;&gt;p1 &lt;span class=&quot;token operator&quot;&gt;:=&lt;/span&gt; pod1&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;Spec&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;Priority &lt;span class=&quot;token operator&quot;&gt;!=&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;nil&lt;/span&gt; ? &lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt;pod1&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;Spec&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;Priority &lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;
p2 &lt;span class=&quot;token operator&quot;&gt;:=&lt;/span&gt; pod2&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;Spec&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;Priority &lt;span class=&quot;token operator&quot;&gt;!=&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;nil&lt;/span&gt; ? &lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt;pod2&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;Spec&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;Priority &lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;p1 &lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; p2&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;||&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;p1 &lt;span class=&quot;token operator&quot;&gt;==&lt;/span&gt; p2 &lt;span class=&quot;token operator&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; pInfo1&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;Timestamp&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Before&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;pInfo2&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;Timestamp&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h3&gt;Filter(预选)&lt;/h3&gt;
&lt;h4&gt;1. InterPodAffinity&lt;/h4&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;InterPodAffinity&lt;/code&gt; 检查&lt;code class=&quot;language-text&quot;&gt;Pod&lt;/code&gt;的亲和性是否满足，实现了&lt;code class=&quot;language-text&quot;&gt;PreFilterPlugin&lt;/code&gt;和&lt;code class=&quot;language-text&quot;&gt;FilterPlugin&lt;/code&gt;两个插件；&lt;/p&gt;
&lt;h4&gt;2. NodeAffinity&lt;/h4&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;NodeAffinity&lt;/code&gt;是&lt;code class=&quot;language-text&quot;&gt;Node&lt;/code&gt;亲和性的过滤，通过&lt;code class=&quot;language-text&quot;&gt;pod.Spec.Affinity.NodeAffinity &lt;/code&gt;是否配置&lt;code class=&quot;language-text&quot;&gt;Node&lt;/code&gt;亲和性和&lt;code class=&quot;language-text&quot;&gt;Node&lt;/code&gt;进行&lt;code class=&quot;language-text&quot;&gt;Match&lt;/code&gt;动作。&lt;/p&gt;
&lt;h4&gt;3.NodeName&lt;/h4&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;NodeName&lt;/code&gt;用于在对&lt;code class=&quot;language-text&quot;&gt;pod.Spec.NodeName&lt;/code&gt;字段值的判断，判断是否是当前的&lt;code class=&quot;language-text&quot;&gt;Node&lt;/code&gt;，如果指定了&lt;code class=&quot;language-text&quot;&gt;pod.Spec.NodeName&lt;/code&gt;并且不是当前的节点，则返回&lt;code class=&quot;language-text&quot;&gt;UnschedulableAndUnresolvable&lt;/code&gt;状态。&lt;/p&gt;
&lt;h4&gt;4.NodePorts&lt;/h4&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;NodePorts&lt;/code&gt;用于检查要启用的端口是否已经在&lt;code class=&quot;language-text&quot;&gt;Node&lt;/code&gt;上使用过，如果使用过则返回&lt;code class=&quot;language-text&quot;&gt;Unschedulable&lt;/code&gt;状态。&lt;/p&gt;
&lt;h4&gt;5.NodeResourcesFit&lt;/h4&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;NodeResourcesFit&lt;/code&gt; 检查节点是否有足够的资源，如:&lt;code class=&quot;language-text&quot;&gt;cpu&lt;/code&gt;、&lt;code class=&quot;language-text&quot;&gt;memory&lt;/code&gt;、&lt;code class=&quot;language-text&quot;&gt;gpu&lt;/code&gt;等，通过那取&lt;code class=&quot;language-text&quot;&gt;max_resource(sum_pod, any_init_container)&lt;/code&gt;和&lt;code class=&quot;language-text&quot;&gt;node&lt;/code&gt;可分配的资源来判断节点是否资源足够。如果有任一资源不够，此节点则会返回资源不足被过滤。&lt;/p&gt;
&lt;h4&gt;6.NodeUnschedulable&lt;/h4&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;NodeUnschedulable&lt;/code&gt; 插件过滤设置&lt;code class=&quot;language-text&quot;&gt;node.Spec.Unschedulable=true&lt;/code&gt;的节点，但是如果&lt;code class=&quot;language-text&quot;&gt;Pod&lt;/code&gt;设置了容忍&lt;code class=&quot;language-text&quot;&gt;Unschedulable&lt;/code&gt;的污点则不过滤。&lt;/p&gt;
&lt;h4&gt;7.NodeVolumeLimits&lt;/h4&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;NodeVolumeLimits&lt;/code&gt;是一个节点检查&lt;code class=&quot;language-text&quot;&gt;volume&lt;/code&gt;容量的插件； 校验PVC指定的Provision在CSI plugin或非CSI Plugin（后三个）上报的单机最大挂盘数（存储插件提供方一般对每个节点的单机最大挂载磁盘数是有限制的）&lt;/p&gt;
&lt;h4&gt;8.PodTopologySpread&lt;/h4&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;PodTopologySpread&lt;/code&gt; 是用于检查&lt;code class=&quot;language-text&quot;&gt;Pod&lt;/code&gt;的拓扑逻辑是否满足条件，&lt;/p&gt;
&lt;h4&gt;9.TaintToleration&lt;/h4&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;TaintToleration&lt;/code&gt;是一个污点容忍度的插件，用于检查&lt;code class=&quot;language-text&quot;&gt;Pod&lt;/code&gt;是否能容忍次污点。&lt;code class=&quot;language-text&quot;&gt;Taint&lt;/code&gt;污点是&lt;code class=&quot;language-text&quot;&gt;Node&lt;/code&gt;上的标签，&lt;code class=&quot;language-text&quot;&gt;Toleration&lt;/code&gt;容忍度是&lt;code class=&quot;language-text&quot;&gt;Pod&lt;/code&gt;上的功能，一个容忍度和一个污点相“匹配”是指它们有一样的&lt;code class=&quot;language-text&quot;&gt;key&lt;/code&gt;和&lt;code class=&quot;language-text&quot;&gt;value&lt;/code&gt;。&lt;/p&gt;
&lt;h4&gt;10.VolumeBinding&lt;/h4&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;VolumeBinding&lt;/code&gt;检查&lt;code class=&quot;language-text&quot;&gt;Pod&lt;/code&gt;挂载的&lt;code class=&quot;language-text&quot;&gt;PVC&lt;/code&gt;，如果其对应&lt;code class=&quot;language-text&quot;&gt;SC(StorageClass)&lt;/code&gt;的&lt;code class=&quot;language-text&quot;&gt;VolumeBindingMode&lt;/code&gt;是&lt;code class=&quot;language-text&quot;&gt;Immediate&lt;/code&gt;模式，该&lt;code class=&quot;language-text&quot;&gt;PVC&lt;/code&gt;必须已经是&lt;code class=&quot;language-text&quot;&gt;bound&lt;/code&gt;，否则需要返回&lt;code class=&quot;language-text&quot;&gt;UnschedulableAndUnresolvable&lt;/code&gt;。&lt;/p&gt;
&lt;h4&gt;11.VolumeRestrictions&lt;/h4&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;VolumeRestrictions&lt;/code&gt; 检查挂载该Node上的卷是否满足存储提供者的要求&lt;/p&gt;
&lt;h3&gt;Score(优选)&lt;/h3&gt;
&lt;h4&gt;1.ImageLocality&lt;/h4&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;ImageLocality&lt;/code&gt;是一个打分插件，对于调度&lt;code class=&quot;language-text&quot;&gt;Pod&lt;/code&gt;的镜像已经存在&lt;code class=&quot;language-text&quot;&gt;Node&lt;/code&gt;上给评分。已经存在的镜像并且镜像越大的分越高；（逻辑就是越大的镜像如果被重新拉取需要花费更多的时间，但是小的镜像拉起来就快，所以镜像存在并且越大的分越高就是这个逻辑）;如果一个节点上的镜像总大小&lt;code class=&quot;language-text&quot;&gt;&amp;lt; 23Mb&lt;/code&gt;则&lt;code class=&quot;language-text&quot;&gt;node&lt;/code&gt;会被打&lt;code class=&quot;language-text&quot;&gt;0&lt;/code&gt;分；如果一个节点上的镜像总大于&lt;code class=&quot;language-text&quot;&gt;1G * 容器数&lt;/code&gt;则会被打&lt;code class=&quot;language-text&quot;&gt;1&lt;/code&gt;分。&lt;/p&gt;
&lt;h4&gt;2.InterPodAffinity&lt;/h4&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;InterPodAffinity&lt;/code&gt;在&lt;code class=&quot;language-text&quot;&gt;Pod&lt;/code&gt;亲和性之间计算亲和性的的分值。&lt;/p&gt;
&lt;h4&gt;3.NodeAffinity&lt;/h4&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;NodeAffinity&lt;/code&gt;是通过节点的亲和性来进行节点打分的，&lt;code class=&quot;language-text&quot;&gt;PreScore&lt;/code&gt; 主要逻辑是从&lt;code class=&quot;language-text&quot;&gt;pod.Spec.Affinity.NodeAffinity.PreferredDuringSchedulingIgnoredDuringExecution&lt;/code&gt;字段中获取首选节点亲和配置，主要的是配置的&lt;code class=&quot;language-text&quot;&gt;weight&lt;/code&gt;字段值，在通过&lt;code class=&quot;language-text&quot;&gt;Label&lt;/code&gt;匹配过程中，发现&lt;code class=&quot;language-text&quot;&gt;Node.Meta.Label&lt;/code&gt;是匹配&lt;code class=&quot;language-text&quot;&gt;matchExpressions&lt;/code&gt;中的字段则&lt;code class=&quot;language-text&quot;&gt;score += weight&lt;/code&gt;，这样这个节点的优先级就提高了。&lt;/p&gt;
&lt;h4&gt;4.NodeResourcesBalancedAllocation&lt;/h4&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;NodeResourcesBalancedAllocation&lt;/code&gt;节点资源均衡插件，是一个通过&lt;code class=&quot;language-text&quot;&gt;cpu&lt;/code&gt;和&lt;code class=&quot;language-text&quot;&gt;memory&lt;/code&gt;容量分数之间的差异，根据他们的优先级进行排名；对于资源使用率均衡的节点分值更高。&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;# ResourceSpec[{&quot;name&quot;:&quot;cpu&quot;,&quot;Weight&quot;:1},{&quot;name&quot;:&quot;memory&quot;,&quot;Weight&quot;:1}]

std =  Σ((fraction(i)-mean)^2)/len(resources)
# std计算取决于需要均衡几种资源，如果只有cpu和memory
std=Abs( (cpuRequest1/cpuAllocable1 - memoryRequest1/memoryAllocable1) / 2 )
# node打分则由如下计算
score = (1 - std) * MaxNodeScore(100)&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h4&gt;5.NodeResourcesFit&lt;/h4&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;NodeResourcesFit&lt;/code&gt;打分已经配置的策略进行，有如下三种：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;LeastAllocated&lt;/code&gt;: 优先分配资源最少的节点；就是资源堆叠&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;MostAllocated&lt;/code&gt;: 优先分配资源最多的节点；就是资源打散&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;RequestedToCapacityRatio&lt;/code&gt;: 可以自定义函数，对资源容量进行打分。&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;LeastAllocated&lt;/code&gt;计算节点分值逻辑：&lt;code class=&quot;language-text&quot;&gt;(cpu((capacity-requested)*MaxNodeScore*cpuWeight/capacity) + memory((capacity-requested)*MaxNodeScore*memoryWeight/capacity) + ...)/weightSum&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;MostAllocated 计算节点分值逻辑：&lt;code class=&quot;language-text&quot;&gt;(cpu(MaxNodeScore * sum(requested) / capacity) + memory(MaxNodeScore * sum(requested) / capacity) + ...) / weightSum&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;capacity&lt;/code&gt;是&lt;code class=&quot;language-text&quot;&gt;allocable&lt;/code&gt;&lt;/p&gt;
&lt;h4&gt;6.PodTopologySpread&lt;/h4&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;PodTopologySpread&lt;/code&gt;权重为2&lt;/p&gt;
&lt;h4&gt;7.SelectorSpread&lt;/h4&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;SelectorSpread&lt;/code&gt;是一个计算选择器传播优先级的打分插件；&lt;/p&gt;
&lt;h4&gt;8.TaintToleration&lt;/h4&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;TaintToleration计算无法容忍污点的一个插件，用于给&lt;/code&gt;Pod 无法容忍污点打分，每一个无法容忍则&lt;code class=&quot;language-text&quot;&gt;+1&lt;/code&gt;，最后得到的就是&lt;code class=&quot;language-text&quot;&gt;Node&lt;/code&gt;的分。&lt;/p&gt;
&lt;h3&gt;Binding(绑定)&lt;/h3&gt;
&lt;h4&gt;1. DefaultBind&lt;/h4&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;DefaultBind&lt;/code&gt;是通过使用&lt;code class=&quot;language-text&quot;&gt;k8s client&lt;/code&gt;绑定&lt;code class=&quot;language-text&quot;&gt;Pod&lt;/code&gt;到&lt;code class=&quot;language-text&quot;&gt;Node&lt;/code&gt;。绑定流程是先创建一个&lt;code class=&quot;language-text&quot;&gt;Binding&lt;/code&gt;类型对象，通过设置&lt;code class=&quot;language-text&quot;&gt;Target&lt;/code&gt;字段值，来记录绑定对象的目标对象。&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;go&quot;&gt;&lt;pre class=&quot;language-go&quot;&gt;&lt;code class=&quot;language-go&quot;&gt;# Binding是将一个对象与另一个对象联系起来
&lt;span class=&quot;token keyword&quot;&gt;type&lt;/span&gt; Binding &lt;span class=&quot;token keyword&quot;&gt;struct&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
	metav1&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;TypeMeta &lt;span class=&quot;token string&quot;&gt;`json:&quot;,inline&quot;`&lt;/span&gt;
	metav1&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;ObjectMeta &lt;span class=&quot;token string&quot;&gt;`json:&quot;metadata,omitempty&quot; protobuf:&quot;bytes,1,opt,name=metadata&quot;`&lt;/span&gt;
	Target ObjectReference &lt;span class=&quot;token string&quot;&gt;`json:&quot;target&quot; protobuf:&quot;bytes,2,opt,name=target&quot;`&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
binding &lt;span class=&quot;token operator&quot;&gt;:=&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;&amp;amp;&lt;/span&gt;v1&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;Binding&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
		ObjectMeta&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; metav1&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;ObjectMeta&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;Namespace&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; p&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;Namespace&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; Name&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; p&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;Name&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; UID&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; p&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;UID&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
		Target&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;     v1&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;ObjectReference&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;Kind&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;Node&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; Name&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; nodeName&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;创建&lt;code class=&quot;language-text&quot;&gt;Binding&lt;/code&gt;对象之后，通过&lt;code class=&quot;language-text&quot;&gt;Pods&lt;/code&gt;的&lt;code class=&quot;language-text&quot;&gt;Bind&lt;/code&gt;方法就可以进行结果绑定。最终是创建&lt;code class=&quot;language-text&quot;&gt;Pod&lt;/code&gt;的绑定。&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;http&quot;&gt;&lt;pre class=&quot;language-http&quot;&gt;&lt;code class=&quot;language-http&quot;&gt;POST /api/v1/namespaces/{namespace}/pods/{name}/binding
&lt;span class=&quot;token header-name keyword&quot;&gt;namespace:&lt;/span&gt; pod namespace
&lt;span class=&quot;token header-name keyword&quot;&gt;name:&lt;/span&gt; binding 名字
&lt;span class=&quot;token header-name keyword&quot;&gt;body:&lt;/span&gt; Binding对象结构体&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;选中的节点在和待调度Pod进行Bind的时候，有可能会Bind失败，此时需要做回退，把Pod的Assumed状态退回Initial，从Node里面把Pod数据账本擦除掉，会把Pod重新丢回到unschedulableQ队列里面。在unschedulableQ里，如果一个Pod一分钟没调度过，就会重新回到activeQ。它的轮询周期是30s。&lt;/p&gt;
&lt;p&gt;调度失败的&lt;code class=&quot;language-text&quot;&gt;Pod&lt;/code&gt;会放到&lt;code class=&quot;language-text&quot;&gt;backoffQ&lt;/code&gt;，在&lt;code class=&quot;language-text&quot;&gt;backoffQ&lt;/code&gt;里等待的时间会比在&lt;code class=&quot;language-text&quot;&gt;unschedulableQ&lt;/code&gt;里更短，&lt;code class=&quot;language-text&quot;&gt;backoffQ&lt;/code&gt;里的降级策略是&lt;code class=&quot;language-text&quot;&gt;2&lt;/code&gt;的指数次幂降级。假设重试第一次为&lt;code class=&quot;language-text&quot;&gt;1s&lt;/code&gt;，那第二次就是&lt;code class=&quot;language-text&quot;&gt;2s&lt;/code&gt;，第三次就是&lt;code class=&quot;language-text&quot;&gt;4s&lt;/code&gt;，但最大到&lt;code class=&quot;language-text&quot;&gt;10s&lt;/code&gt;。&lt;/p&gt;
&lt;h4&gt;2.VolumeBinding&lt;/h4&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;VolumeBinding&lt;/code&gt;是&lt;code class=&quot;language-text&quot;&gt;PreBinding&lt;/code&gt;作为&lt;code class=&quot;language-text&quot;&gt;Binding&lt;/code&gt;之前检查的&lt;code class=&quot;language-text&quot;&gt;Volume&lt;/code&gt;是否绑定到&lt;code class=&quot;language-text&quot;&gt;Node&lt;/code&gt;上面，&lt;/p&gt;
&lt;h3&gt;Preemption(抢占)&lt;/h3&gt;
&lt;h4&gt;1.DefaultPreemption&lt;/h4&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;DefaultPreemption&lt;/code&gt;是一个&lt;code class=&quot;language-text&quot;&gt;PostFilter&lt;/code&gt;插件，实现了默认抢占逻辑；当高优先级的&lt;code class=&quot;language-text&quot;&gt;Pod&lt;/code&gt;没有找到合适的&lt;code class=&quot;language-text&quot;&gt;Node&lt;/code&gt;时，会执行&lt;code class=&quot;language-text&quot;&gt;Preempt&lt;/code&gt;抢占算法，抢占的流程。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;一个&lt;code class=&quot;language-text&quot;&gt;Pod&lt;/code&gt;进入抢占的时候，首先会判断&lt;code class=&quot;language-text&quot;&gt;Pod&lt;/code&gt;是否拥有抢占的资格，有可能上次已经抢占过一次。&lt;/li&gt;
&lt;li&gt;如果符合抢占资格，会先对所有的节点进行一次过滤，过滤出符合这次抢占要求的节点。然后&lt;/li&gt;
&lt;li&gt;模拟一次调度，把优先级低的&lt;code class=&quot;language-text&quot;&gt;Pod&lt;/code&gt;先移除出去，再尝试能否把待抢占的&lt;code class=&quot;language-text&quot;&gt;Pod&lt;/code&gt;放置到此节点上。然后通过这个过程从过滤剩下的节点中选出一批节点进行抢占。&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;ProcessPreemptionWithExtenders&lt;/code&gt;是一个扩展的钩子，用户可以在这里加一些自己抢占节点的策略。如果没有扩展的钩子，这里面不做任何动作。&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;PickOneNodeForPreemption&lt;/code&gt;，从上面选出的节点里挑选出最合适的一个节点，策略包括：
&lt;ul&gt;
&lt;li&gt;优先选择打破&lt;code class=&quot;language-text&quot;&gt;PDB&lt;/code&gt;最少的节点；&lt;/li&gt;
&lt;li&gt;其次选择待抢占&lt;code class=&quot;language-text&quot;&gt;Pods&lt;/code&gt;中最大优先级最小的节点；&lt;/li&gt;
&lt;li&gt;再次选择待抢占&lt;code class=&quot;language-text&quot;&gt;Pods&lt;/code&gt;优先级加和最小的节点；&lt;/li&gt;
&lt;li&gt;接下来选择待抢占&lt;code class=&quot;language-text&quot;&gt;Pods&lt;/code&gt;数目最小的节点；&lt;/li&gt;
&lt;li&gt;最后选择拥有最晚启动&lt;code class=&quot;language-text&quot;&gt;Pod&lt;/code&gt;的节点；&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;通过过滤之后，会选出一个最合适的节点。对这个节点上待抢占的&lt;code class=&quot;language-text&quot;&gt;Pod&lt;/code&gt;进行&lt;code class=&quot;language-text&quot;&gt;delete&lt;/code&gt;，完成抢占过程。&lt;/p&gt;</content:encoded></item><item><title><![CDATA[CRUSH论文阅读]]></title><description><![CDATA[本篇文章是对论文的翻译和提炼，探究它是什么、解决了什么问题、怎么实现的三个方面。 CRUSH是什么 ，全称是 ，可控的、可扩展的、分布式的副本数据放置算法。 分布式系统中数据分布算法挑战： 数据分布和负载均衡： a. 数据分布均衡，使数据能均匀的分布到各个节点上。 b…]]></description><link>https://lengrongfu.github.io/2022-05-20-CRUSH论文阅读/</link><guid isPermaLink="false">https://lengrongfu.github.io/2022-05-20-CRUSH论文阅读/</guid><pubDate>Fri, 20 May 2022 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;本篇文章是对论文&lt;code class=&quot;language-text&quot;&gt;CRUSH: Controlled, Scalable, Decentralized Placement of Replicated Data&lt;/code&gt;的翻译和提炼，探究它是什么、解决了什么问题、怎么实现的三个方面。&lt;/p&gt;
&lt;h1&gt;CRUSH是什么&lt;/h1&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;CRUSH&lt;/code&gt;，全称是 &lt;a href=&quot;hrome-extension://khpcnaokfebphakjgdgpinmglconplhp/index.html&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;Controlled Scalable Decentralized Placement of Replicated Data&lt;/code&gt;&lt;/a&gt;，可控的、可扩展的、分布式的副本数据放置算法。&lt;/p&gt;
&lt;p&gt;分布式系统中数据分布算法挑战：&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;数据分布和负载均衡：&lt;/li&gt;
&lt;/ol&gt;
&lt;ul&gt;
&lt;li&gt;a. 数据分布均衡，使数据能均匀的分布到各个节点上。&lt;/li&gt;
&lt;li&gt;b. 负载均衡，使数据访问读写操作的负载在各个节点和磁盘的负载均衡。&lt;/li&gt;
&lt;/ul&gt;
&lt;ol start=&quot;2&quot;&gt;
&lt;li&gt;灵活应对集群伸缩&lt;/li&gt;
&lt;/ol&gt;
&lt;ul&gt;
&lt;li&gt;a. 系统可以方便的增加或者删除节点设备，并且对节点失效进行处理。&lt;/li&gt;
&lt;li&gt;b. 增加或者删除节点设备后，能自动实现数据的均衡，并且尽可能少的迁移数据。&lt;/li&gt;
&lt;/ul&gt;
&lt;ol start=&quot;3&quot;&gt;
&lt;li&gt;支持大规模集群&lt;/li&gt;
&lt;/ol&gt;
&lt;ul&gt;
&lt;li&gt;a. 要求数据分布算法维护的元数据相对较小，并且计算量不能太大。随着集群规模的增 加，数据分布算法开销相对比较小。&lt;/li&gt;
&lt;/ul&gt;
&lt;h1&gt;CRUSH解决了什么问题&lt;/h1&gt;
&lt;p&gt;&lt;strong&gt;CRUSH解决了对象数据在分布式系统中的寻址和分布不均衡的问题，通过此算法可以在任意地方能找寻到数据，并且数据会随着节点的增加或者减少重新动态平衡。&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;大部分分布书存储系统简单地将新数据写入到未被充分利用的设备上。这种方法的根本问题是，当数据被写入后，它很少甚至不会被移动。即使是完美的分布也会在存储系统被扩展后变得不均衡，因为新的磁盘或者是空的或者仅含有新的数据。旧的磁盘和新的磁盘可能都是繁忙的，这取决于系统负载，但是这很少能够平等地利用二者并得到所有可用资源的优势。&lt;/p&gt;
&lt;p&gt;一种健壮的解决方案是将所有数据随机分布到系统中可用的存储设备上。这样可以使分布在概率上是均衡的，且新数据和旧数据会均匀地混合在一起。当添加新的存储时，已有数据的中的一份随机采样会被迁移到新的存储设备上以保持平衡。这种方法最重要的优势是平均，所有设备将会有相似的负载，让系统在任何潜在负载下表现良好。&lt;/p&gt;
&lt;p&gt;CRUSH（Controlled Replication Under Scalable Hashing，基于可伸缩哈希的受控多副本策略），它是一个伪随机数据分布算法，它能够高效、健壮地将对象副本在异构、结构化存储集群上分布。CRUSH的实现是一个伪随机、确定性的函数，它将输入值（通常是一个对象或对象组的标识符）映射到一系列存储对象副本的设备上。它与传统方法的不同点在于，它的数据分配不依赖每个文件或每个对象的任何类型的目录——CRUSH仅需要对构成存储集群的设备的紧凑的层次结构的描述和副本分配策略的知识。这种方法有两个关键的好处：第一，它完全是分布式的，大型系统中的任意一方都能单独计算任何对象的位置；第二，所需的元数据很少且几乎是静态的，它仅在有设备加入或移除时变化。&lt;/p&gt;
&lt;p&gt;分布式存储系统如GFS这些都面临着数据分布问题，这些系统使用半随机（semi-random）或基于启发式（heuristic-based）的方法来将数据分配到可用容量的存储设备上，但是很少将数据重新放置以随着时间维护均衡的分布，并且这些系统都通过某种元数据的方式来定位数据（简单说就是有一个Metadata Server来记录了对象数据所在位置，通过hash的形式来定位数据）。&lt;/p&gt;
&lt;p&gt;CRUSH基于RUSH算法族[Honicky and Miller 2004]。RUSH是已有的文献中唯一的一个利用映射函数替代显式元数据，并支持设备添加或移除的算法。尽管RUSH算法有这些特性，但是大量的问题使其无法实际应用。CRUSH完整地包括了RUSHP和RUSHT中好用的元素，同时解决了之前未解决的可靠性和副本问题，并优化了性能和灵活性。&lt;/p&gt;
&lt;h1&gt;CRUSH是如何实现的&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https://mrcroxx.github.io/posts/paper-reading/weil-crush-sc06/&quot;&gt;实现&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;</content:encoded></item><item><title><![CDATA[读《云计算那些事儿》]]></title><description><![CDATA[云计算概览 ** 云计算的根本就是把基础资源虚拟化之后以更小的力度提供出来的能力。** 云计算分类 IaaS: 基础设施即服务，就是将基础设施当作服务队外输出，计算、网络、存储这些原始资源就是基础设施资源，通过互联网队外提供服务。虚拟化是IaaS…]]></description><link>https://lengrongfu.github.io/2022-05-18-读云计算那些事/</link><guid isPermaLink="false">https://lengrongfu.github.io/2022-05-18-读云计算那些事/</guid><pubDate>Wed, 18 May 2022 00:00:00 GMT</pubDate><content:encoded>&lt;h1&gt;云计算概览&lt;/h1&gt;
&lt;p&gt;** 云计算的根本就是把基础资源虚拟化之后以更小的力度提供出来的能力。**&lt;/p&gt;
&lt;h2&gt;云计算分类&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;IaaS: 基础设施即服务，就是将基础设施当作服务队外输出，计算、网络、存储这些原始资源就是基础设施资源，通过互联网队外提供服务。虚拟化是IaaS实现的基础，通过计算虚拟化、网络虚拟化、存储虚拟化将物理资源整合成虚拟的资源池，然后把资源以按需的形式提供给资源申请者，从而完成资源的二次分配。&lt;/li&gt;
&lt;li&gt;PaaS：平台即服务，它直接为用户提供一套平台，包括语言运行环境、编程框架及数据存储中间件等一系列功能。PaaS将管理的对象从资源升级到服务，面向接口编程和运维。&lt;/li&gt;
&lt;li&gt;SaaS: 软件即服务，它是最高层的抽象，对于最终的用户，它不关心任何技术相关内容，以服务的方式交付。如：在线的云编辑器。&lt;/li&gt;
&lt;li&gt;FaaS：函数即服务，通过定义一些CRUD操作函数，在特定事件下触发这些函数， 并执行。&lt;/li&gt;
&lt;/ul&gt;
&lt;h2&gt;关键技术&lt;/h2&gt;
&lt;p&gt;资源调度：资源调度就是当用户申请资源的时候，系统需要通过调度确定资源位置。&lt;/p&gt;
&lt;p&gt;Google在Omega的调度系统论文中将调度分为三类：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;单体：单体调度是指所有任务都是通过一个串行调度器分配的，典型代表是Kubernetes，它的优点是简单，缺点是很难支持多类型任务的执行，如同时支持批处理和长任务。&lt;/li&gt;
&lt;li&gt;二层调度：二层调度是将资源分配和任务调度分离，第一层是从全局的资源池中分配资源给各种类型任务调度器，第二层任务调度器依据任务特点启动任务，典型代表是Mesos和Yarn。二层调度的优点是可以减少调度时间，缺点是：资源调度无法感知全局资源，只了解自己的可用资源，并且每个任务调度器只会最大化自己的利益，造成全局资源的使用平衡。&lt;/li&gt;
&lt;li&gt;共享状态：共享状态调度器，它通过在每个任务调度器中保存一份整个集群状态信息的副本，从而实现全局调度，如Omega的实现。&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;通常的调度流程分为两层：第一层是主机过滤，第二层是主机打分，当服务器达到一定规模后，过滤和打分将会耗费很多时间，优化的方式通常包括：分区调度（将主机划分成多个集群，每次调度只针对集群）、并行调度（将调度算法并行化处理，提高执行效率，并采用乐观锁和重试机制）。在资源混部的情况下，资源调度更加复杂：虚拟机和容器混部、流或批处理任务与常驻进程混部、多任务优先级QOS等。&lt;/p&gt;
&lt;h1&gt;虚拟化与IaaS&lt;/h1&gt;
&lt;h2&gt;计算虚拟化&lt;/h2&gt;
&lt;p&gt;计算虚拟化就是在虚拟系统和底层硬件之间抽象出CPU和内存等，以供虚拟机使用。&lt;/p&gt;
&lt;h2&gt;网络虚拟化&lt;/h2&gt;
&lt;p&gt;网络虚拟化是在物理网络拓扑基础之上建立的虚拟网络，它不依赖底层物理网络，能狗实现网络拓扑的动态变化，并且提供多租户隔离。
在网络虚拟化环境中，一切都可以自定义，首先是网络设备的虚拟化，虚拟交换机，虚拟路由器，虚拟负载均衡和虚拟防火墙。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;网卡虚拟化：通过SR-IOV技术可以实现一个物理网卡虚拟多个网卡，还可以通过tap/veth实现网卡虚拟化。&lt;/li&gt;
&lt;li&gt;链路层虚拟化：主要通过虚拟交换机，实现网络包的VLAN设置、隧道建立等。&lt;/li&gt;
&lt;li&gt;网络层虚拟化：包括VPN、Overlay网络等，创建一套隔离的三层网络。&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;随着云计算和大数据的兴起，东西流量越来越多：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;南北流泪：从防火墙进入到目标服务器经过的流量。&lt;/li&gt;
&lt;li&gt;东西流量：服务器和服务器之间的流量；比如分布式存储系统在服务之间进行数据复制会产生较多的东西流量。&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Linux收发包流程：
&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/e22adf5313961615d8cca0529898776c/3f8ee/netfilter.jpg&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 50.632911392405056%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAKABQDASIAAhEBAxEB/8QAFwAAAwEAAAAAAAAAAAAAAAAAAAECBf/EABQBAQAAAAAAAAAAAAAAAAAAAAD/2gAMAwEAAhADEAAAAdyhkjD/xAAXEAADAQAAAAAAAAAAAAAAAAAAAUEx/9oACAEBAAEFAqLKI//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQMBAT8BP//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQIBAT8BP//EABQQAQAAAAAAAAAAAAAAAAAAACD/2gAIAQEABj8CX//EABoQAAIDAQEAAAAAAAAAAAAAAAERACExEIH/2gAIAQEAAT8hZdHyWshk2feJ/9oADAMBAAIAAwAAABDDD//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQMBAT8QP//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQIBAT8QP//EABwQAQEAAgIDAAAAAAAAAAAAAAERACEQMUFhof/aAAgBAQABPxBg0QoifcuxFmwcsBV8kwdj1j08f//Z&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;netfilter&quot;
        title=&quot;netfilter&quot;
        src=&quot;/static/e22adf5313961615d8cca0529898776c/828fb/netfilter.jpg&quot;
        srcset=&quot;/static/e22adf5313961615d8cca0529898776c/ff44c/netfilter.jpg 158w,
/static/e22adf5313961615d8cca0529898776c/a6688/netfilter.jpg 315w,
/static/e22adf5313961615d8cca0529898776c/828fb/netfilter.jpg 630w,
/static/e22adf5313961615d8cca0529898776c/0ede0/netfilter.jpg 945w,
/static/e22adf5313961615d8cca0529898776c/3ac88/netfilter.jpg 1260w,
/static/e22adf5313961615d8cca0529898776c/3f8ee/netfilter.jpg 1476w&quot;
        sizes=&quot;(max-width: 630px) 100vw, 630px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;网络模块&lt;code class=&quot;language-text&quot;&gt;net_rx_action&lt;/code&gt;会调用驱动将网络包转化为网络模块能够识别的SKB格式，然后经过&lt;code class=&quot;language-text&quot;&gt;netfilter&lt;/code&gt;后发送到用上层协议栈中。&lt;/p&gt;
&lt;h3&gt;VLAN&lt;/h3&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;VLAN&lt;/code&gt;的中文名为虚拟局域网，VLAN的出现是为了解决二层链路中广播域的问题，传统的二层链路层广播访问太广，需要用三层路由来做lan切分隔离广播域，但是路由器的接口较少，因此在交换机上配置VLAN，使之一个交换机可以按需求配置多个LAN，来屏蔽广播域。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https://zhuanlan.zhihu.com/p/35616289&quot;&gt;VLAN基础知识&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://blog.csdn.net/weixin_40748006/article/details/80181493&quot;&gt;VLAN详解&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h2&gt;存储虚拟化&lt;/h2&gt;
&lt;p&gt;存储虚拟化通过软件的方式重塑存储系统，不依赖具体的存储硬件。比如通常云存储所指的公有云提供的文件存储、块存储、对象存储都是通过存储虚拟化实现的。&lt;/p&gt;
&lt;p&gt;存储分类：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;块存储：文件会被分块存储到磁盘，以磁盘方式提供。块存储都遵循SCSI协议，&lt;/li&gt;
&lt;li&gt;文件存储：以文件目录的方式提供。网络文件系统NFS。&lt;/li&gt;
&lt;li&gt;对象存储：以二进制对象的形式提供服务。&lt;/li&gt;
&lt;/ul&gt;
&lt;h3&gt;分布式存储&lt;/h3&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/dc7600bfcaea71056b3f7f7b946009c8/d2cbc/dis-storage.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 51.89873417721519%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAIAAAA7N+mxAAAACXBIWXMAAAsTAAALEwEAmpwYAAAA50lEQVQoz4WRzY6FIAyFff/H0426JYSNJoRgC/3BSejE63VM5mzLR885Hc7/RETMvCxLCEFVmfkaDX9ft9a4i4hyzgBgsHPORh+YmQHAvq+1li7qEpHWmoioaowxpaRdH7jWGkJIKTGzqrauhxFENMOllPtoMMC8vUYAgGsbERlvC34zqyoivu4UkUd/tdZnYSKCiMaoKhGllIjoTprN4zhyzqr61bbxiEhEiGhFXjnNiCXPORPR81TMHGMEgFIKIuacL5PneUJXKQUAEPHlzsy8rqtzzns/TdO9oW3bxnHc932eZ+/9D2jqSlprcBcyAAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;dis&quot;
        title=&quot;dis&quot;
        src=&quot;/static/dc7600bfcaea71056b3f7f7b946009c8/f058b/dis-storage.png&quot;
        srcset=&quot;/static/dc7600bfcaea71056b3f7f7b946009c8/c26ae/dis-storage.png 158w,
/static/dc7600bfcaea71056b3f7f7b946009c8/6bdcf/dis-storage.png 315w,
/static/dc7600bfcaea71056b3f7f7b946009c8/f058b/dis-storage.png 630w,
/static/dc7600bfcaea71056b3f7f7b946009c8/d2cbc/dis-storage.png 705w&quot;
        sizes=&quot;(max-width: 630px) 100vw, 630px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;
上图展示了分布式存储的总体架构，总体有有元数据管理节点和数据管理节点，要实现分布式系统，保证存储元数据模块的高可用。&lt;/p&gt;
&lt;p&gt;分布式系统都不能违背CAP定理：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;C（Consistenncy）：一致性，指在分布式系统中多副本数据的一致性。&lt;/li&gt;
&lt;li&gt;A（Avaliability）：可用性，这里指能够随时读写数据。&lt;/li&gt;
&lt;li&gt;P（Partition tolerance）：即分区容错性，这里指能够容忍网络中断出现分区的情况。&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;在一些要求不高的场景下，保证基本可用和弱一致即可，对应的是BASE理论L：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;B（Basically Avaliable）：基本可用&lt;/li&gt;
&lt;li&gt;S（Soft State）：软状态&lt;/li&gt;
&lt;li&gt;E（Eventual Consistency）最终一致。&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;数据分布寻址问题，如何查找到文件在那个数据节点中，共有两种种方法：；&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;在元数据中标示数据的分布，如HDFS中，NameNode保存了所有块的元数据；它的优点是：避免在添加节点时数据迁移，缺点是：需要额外维护一套元数据，并且元数据服务的可用性是个问题。可用通过采用Raft算法来解决元数据服务的可用性问题。&lt;/li&gt;
&lt;li&gt;通过DHT算法计算得到数据的分布，如采用一致性Hash环算法，或者rados算法；它的优点是：不会存储元数据服务瓶颈和可用性问题，缺点是：在增减节点的时候，整个算法需要重新计算，导致大量数据重新分布，不仅影响集群性能，还可能造成集群暂时不可用。&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;开源Ceph解决数据分布寻址使用的是CRUSH方案。&lt;/p&gt;</content:encoded></item><item><title><![CDATA[Linux网络虚拟化:探索NetWork Namespace]]></title><description><![CDATA[NetWork Namespace简介  是  版本引入的，作用是隔离出一个独立的网络栈（包括设备、IP、路由表、端口、防火墙等），它能创建多个隔离的网络空间。 在系统上，我们可以使用命令来创建和管理。 ip netns…]]></description><link>https://lengrongfu.github.io/2022-05-12-Linux-Network-Namespace/</link><guid isPermaLink="false">https://lengrongfu.github.io/2022-05-12-Linux-Network-Namespace/</guid><pubDate>Thu, 12 May 2022 00:00:00 GMT</pubDate><content:encoded>&lt;h2&gt;NetWork Namespace简介&lt;/h2&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;NetWork Namespace&lt;/code&gt; 是 &lt;code class=&quot;language-text&quot;&gt;Linux 2.6&lt;/code&gt; 版本引入的，作用是隔离出一个独立的网络栈（包括设备、IP、路由表、端口、防火墙等），它能创建多个隔离的网络空间。&lt;/p&gt;
&lt;p&gt;在&lt;code class=&quot;language-text&quot;&gt;Linux&lt;/code&gt;系统上，我们可以使用&lt;code class=&quot;language-text&quot;&gt;ip&lt;/code&gt;命令来创建和管理&lt;code class=&quot;language-text&quot;&gt;Network namespace&lt;/code&gt;。&lt;/p&gt;
&lt;h3&gt;ip netns 命令手册&lt;/h3&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;shell&quot;&gt;&lt;pre class=&quot;language-shell&quot;&gt;&lt;code class=&quot;language-shell&quot;&gt;SYNOPSIS
       &lt;span class=&quot;token function&quot;&gt;ip&lt;/span&gt; netns &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt; list &lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;：列出所有的network namespace

       &lt;span class=&quot;token function&quot;&gt;ip&lt;/span&gt; netns &lt;span class=&quot;token function&quot;&gt;add&lt;/span&gt; NETNSNAME：添加一个新的ns

       &lt;span class=&quot;token function&quot;&gt;ip&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;-all&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; netns del &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt; NETNSNAME &lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;：删除所有或者指定的ns

       &lt;span class=&quot;token function&quot;&gt;ip&lt;/span&gt; netns &lt;span class=&quot;token builtin class-name&quot;&gt;set&lt;/span&gt; NETNSNAME NETNSID：修改netnsname或者netnsid

       &lt;span class=&quot;token function&quot;&gt;ip&lt;/span&gt; netns identify &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt; PID &lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;：把某个进程加入到network namespace中

       &lt;span class=&quot;token function&quot;&gt;ip&lt;/span&gt; netns pids NETNSNAME：列出加入当前ns的pid

       &lt;span class=&quot;token function&quot;&gt;ip&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;-all&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; netns &lt;span class=&quot;token builtin class-name&quot;&gt;exec&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt; NETNSNAME &lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; command&lt;span class=&quot;token punctuation&quot;&gt;..&lt;/span&gt;.：在netns中执行命令，如ping、ifconfig

       &lt;span class=&quot;token function&quot;&gt;ip&lt;/span&gt; netns monitor：监控&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;按照操作手册中的命令就可以创建 &lt;code class=&quot;language-text&quot;&gt;ns&lt;/code&gt;.&lt;/p&gt;
&lt;h3&gt;管理Network Namespace&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;创建NS&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;shell&quot;&gt;&lt;pre class=&quot;language-shell&quot;&gt;&lt;code class=&quot;language-shell&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;root@k8s-master-168 ~&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token comment&quot;&gt;# ip netns add nets1&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;root@k8s-master-168 ~&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token comment&quot;&gt;# ip netns list&lt;/span&gt;
nets1&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;ul&gt;
&lt;li&gt;查看NS中的网络信息&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;shell&quot;&gt;&lt;pre class=&quot;language-shell&quot;&gt;&lt;code class=&quot;language-shell&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;root@k8s-master-168 ~&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token comment&quot;&gt;# ip netns exec nets1 ip link list&lt;/span&gt;
&lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;: lo: &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;LOOPBACK&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; mtu &lt;span class=&quot;token number&quot;&gt;65536&lt;/span&gt; qdisc noop state DOWN mode DEFAULT group default qlen &lt;span class=&quot;token number&quot;&gt;1000&lt;/span&gt;
    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00

&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;root@k8s-master-168 ~&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token comment&quot;&gt;# ip netns exec nets1 route&lt;/span&gt;
Kernel IP routing table
Destination     Gateway         Genmask         Flags Metric Ref    Use Iface

&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;root@k8s-master-168 ~&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token comment&quot;&gt;# ip netns exec nets1 iptables -L&lt;/span&gt;
Chain INPUT &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;policy ACCEPT&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
target     prot opt &lt;span class=&quot;token builtin class-name&quot;&gt;source&lt;/span&gt;               destination         

Chain FORWARD &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;policy ACCEPT&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
target     prot opt &lt;span class=&quot;token builtin class-name&quot;&gt;source&lt;/span&gt;               destination         

Chain OUTPUT &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;policy ACCEPT&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
target     prot opt &lt;span class=&quot;token builtin class-name&quot;&gt;source&lt;/span&gt;               destination&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;从结果来看，创建的&lt;code class=&quot;language-text&quot;&gt;nets1&lt;/code&gt;网络栈中只有&lt;code class=&quot;language-text&quot;&gt;lo&lt;/code&gt;这个未启用的回环设备，并且没有配置路由和防火墙规则等。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;创建一个网络设备并配置IP&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;shell&quot;&gt;&lt;pre class=&quot;language-shell&quot;&gt;&lt;code class=&quot;language-shell&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;# 创建veth pair虚拟网络设备网卡&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;# 创建一个veth0和veth1的veth 对，把veth1插入到nets1的网络栈中，veth0默认在跟network namespace中。&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;root@k8s-master-168 ~&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token comment&quot;&gt;# ip link add  veth0 type veth peer name veth1&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;root@k8s-master-168 ~&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token comment&quot;&gt;# ip link set veth1 netns nets1&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;# 此时查看就发现多了一个网络设备veth1，但是设备没有启动，并且没有配置IP&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;root@k8s-master-168 ~&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token comment&quot;&gt;# ip netns exec nets1 ip link list&lt;/span&gt;
&lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;: lo: &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;LOOPBACK&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; mtu &lt;span class=&quot;token number&quot;&gt;65536&lt;/span&gt; qdisc noop state DOWN mode DEFAULT group default qlen &lt;span class=&quot;token number&quot;&gt;1000&lt;/span&gt;
    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00
&lt;span class=&quot;token number&quot;&gt;9&lt;/span&gt;: veth1@if10: &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;BROADCAST,MULTICAST&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; mtu &lt;span class=&quot;token number&quot;&gt;1500&lt;/span&gt; qdisc noop state DOWN mode DEFAULT group default qlen &lt;span class=&quot;token number&quot;&gt;1000&lt;/span&gt;
    link/ether aa:54:ee:12:3a:34 brd ff:ff:ff:ff:ff:ff link-netnsid &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;# 启用网卡，并设置ip&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;root@k8s-master-168 ~&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token comment&quot;&gt;# ip netns exec nets1 ifconfig veth1 10.1.1.1/24 up&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;root@k8s-master-168 ~&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token comment&quot;&gt;# ip netns exec nets1 ifconfig&lt;/span&gt;
veth1: &lt;span class=&quot;token assign-left variable&quot;&gt;flags&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;409&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&lt;span class=&quot;token file-descriptor important&quot;&gt;9&lt;/span&gt;&amp;lt;&lt;/span&gt;UP,BROADCAST,MULTICAST&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;  mtu &lt;span class=&quot;token number&quot;&gt;1500&lt;/span&gt;
        inet &lt;span class=&quot;token number&quot;&gt;10.1&lt;/span&gt;.1.1  netmask &lt;span class=&quot;token number&quot;&gt;255.255&lt;/span&gt;.255.0  broadcast &lt;span class=&quot;token number&quot;&gt;10.1&lt;/span&gt;.1.255
        ether aa:54:ee:12:3a:34  txqueuelen &lt;span class=&quot;token number&quot;&gt;1000&lt;/span&gt;  &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;Ethernet&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
        RX packets &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;  bytes &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;0.0&lt;/span&gt; B&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
        RX errors &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;  dropped &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;  overruns &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;  frame &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;
        TX packets &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;  bytes &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;0.0&lt;/span&gt; B&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
        TX errors &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;  dropped &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt; overruns &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;  carrier &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;  collisions &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;ul&gt;
&lt;li&gt;删除veth对和ns&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;shell&quot;&gt;&lt;pre class=&quot;language-shell&quot;&gt;&lt;code class=&quot;language-shell&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;# veth对是一个整体，删除veth0，veth1也就不存在。&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;root@k8s-master-168 ~&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token comment&quot;&gt;# ip link del veth0&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;root@k8s-master-168 ~&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token comment&quot;&gt;# ip netns del nets1&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2&gt;单主机两个 NetWork Namespace 之间通信&lt;/h2&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 483px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/4597c3ced57ab15543a4ac1b2514a153/77a9e/veth1.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 41.77215189873418%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAIAAAB2/0i6AAAACXBIWXMAAAsTAAALEwEAmpwYAAABY0lEQVQY02WQS0sbYRSG50f2B9Sla1cmztgWBRHciLoqXhYNhSJBM0kbAt7GTuZ85/JNTTIXhCAKEgwEU0hXk/kkKfGCz+KcFw4PHF5LKUWEWoPWIBIwN/9nIkREpQRAA+ggkGaTAbRSgjMsIuV5ulKJXTfe2a7t711Uq6nrRr7PRHR11UiSShy7termycnXNK22Wr9ohhWGQbl8vbhoHMcUHWM7k2Dbeb3eZsZ+f8uYQp4vG+NMZ2E43EB8KxcK5stytl4crNj/Jv47OXtcGv+1jVl6I4vg+VlrbQN3PpXvP8z5xd2Dw4fv37qXl5qZ0uTo9q500y0NFj72P8+fnq8yH2iteYoFAMwKwMPAuzj8oU4b+o8SDogUIgJwMxAF+qx8/Ptn3fPA9/GlsM6EqNOJozjV7TayJhIiYZbpeyhCIqSE23GUJFEUdaIZ1vg1WTbbmTGm1+uFYTgajUyeP59e8wTLjH138zp0EwAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;veth1&quot;
        title=&quot;veth1&quot;
        src=&quot;/static/4597c3ced57ab15543a4ac1b2514a153/77a9e/veth1.png&quot;
        srcset=&quot;/static/4597c3ced57ab15543a4ac1b2514a153/c26ae/veth1.png 158w,
/static/4597c3ced57ab15543a4ac1b2514a153/6bdcf/veth1.png 315w,
/static/4597c3ced57ab15543a4ac1b2514a153/77a9e/veth1.png 483w&quot;
        sizes=&quot;(max-width: 483px) 100vw, 483px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;主机上创建两个&lt;code class=&quot;language-text&quot;&gt;ns&lt;/code&gt;，它们之间如何通信呢，可以使用&lt;code class=&quot;language-text&quot;&gt;veth pair&lt;/code&gt;进行连接。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;创建两个&lt;code class=&quot;language-text&quot;&gt;ns&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;shell&quot;&gt;&lt;pre class=&quot;language-shell&quot;&gt;&lt;code class=&quot;language-shell&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;#创建两个ns&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;root@k8s-master-168 ~&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token comment&quot;&gt;# ip netns add nets1&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;root@k8s-master-168 ~&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token comment&quot;&gt;# ip netns add nets2&lt;/span&gt;

&lt;span class=&quot;token comment&quot;&gt;# 创建veth，并分别插入ns中&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;root@k8s-master-168 ~&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token comment&quot;&gt;# ip link add veth0 type veth peer name veth1&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;root@k8s-master-168 ~&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token comment&quot;&gt;# ip link set veth0 netns nets1&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;root@k8s-master-168 ~&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token comment&quot;&gt;# ip link set veth1 netns nets2&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;ul&gt;
&lt;li&gt;配置两个veth网络设备&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;shell&quot;&gt;&lt;pre class=&quot;language-shell&quot;&gt;&lt;code class=&quot;language-shell&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;root@k8s-master-168 ~&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token comment&quot;&gt;# ip netns exec nets2 ifconfig veth1 10.1.1.2/24 up&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;root@k8s-master-168 ~&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token comment&quot;&gt;# ip netns exec nets1 ifconfig veth0 10.1.1.1/24 up&lt;/span&gt;

&lt;span class=&quot;token comment&quot;&gt;# 检查是否配置成功&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;root@k8s-master-168 ~&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token comment&quot;&gt;# ip netns exec nets1 ifconfig&lt;/span&gt;
veth0: &lt;span class=&quot;token assign-left variable&quot;&gt;flags&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;416&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&lt;span class=&quot;token file-descriptor important&quot;&gt;3&lt;/span&gt;&amp;lt;&lt;/span&gt;UP,BROADCAST,RUNNING,MULTICAST&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;  mtu &lt;span class=&quot;token number&quot;&gt;1500&lt;/span&gt;
        inet &lt;span class=&quot;token number&quot;&gt;10.1&lt;/span&gt;.1.1  netmask &lt;span class=&quot;token number&quot;&gt;255.255&lt;/span&gt;.255.0  broadcast &lt;span class=&quot;token number&quot;&gt;10.1&lt;/span&gt;.1.255
        inet6 fe80::b4c2:70ff:fe8d:3b0e  prefixlen &lt;span class=&quot;token number&quot;&gt;64&lt;/span&gt;  scopeid 0x2&lt;span class=&quot;token operator&quot;&gt;&lt;span class=&quot;token file-descriptor important&quot;&gt;0&lt;/span&gt;&amp;lt;&lt;/span&gt;link&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;
        ether b6:c2:70:8d:3b:0e  txqueuelen &lt;span class=&quot;token number&quot;&gt;1000&lt;/span&gt;  &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;Ethernet&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
        RX packets &lt;span class=&quot;token number&quot;&gt;8&lt;/span&gt;  bytes &lt;span class=&quot;token number&quot;&gt;656&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;656.0&lt;/span&gt; B&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
        RX errors &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;  dropped &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;  overruns &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;  frame &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;
        TX packets &lt;span class=&quot;token number&quot;&gt;8&lt;/span&gt;  bytes &lt;span class=&quot;token number&quot;&gt;656&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;656.0&lt;/span&gt; B&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
        TX errors &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;  dropped &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt; overruns &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;  carrier &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;  collisions &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;


&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;root@k8s-master-168 ~&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token comment&quot;&gt;# ip netns exec nets2 ifconfig&lt;/span&gt;
veth1: &lt;span class=&quot;token assign-left variable&quot;&gt;flags&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;416&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&lt;span class=&quot;token file-descriptor important&quot;&gt;3&lt;/span&gt;&amp;lt;&lt;/span&gt;UP,BROADCAST,RUNNING,MULTICAST&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;  mtu &lt;span class=&quot;token number&quot;&gt;1500&lt;/span&gt;
        inet &lt;span class=&quot;token number&quot;&gt;10.1&lt;/span&gt;.1.2  netmask &lt;span class=&quot;token number&quot;&gt;255.255&lt;/span&gt;.255.0  broadcast &lt;span class=&quot;token number&quot;&gt;10.1&lt;/span&gt;.1.255
        inet6 fe80::f046:44ff:fe62:1ecc  prefixlen &lt;span class=&quot;token number&quot;&gt;64&lt;/span&gt;  scopeid 0x2&lt;span class=&quot;token operator&quot;&gt;&lt;span class=&quot;token file-descriptor important&quot;&gt;0&lt;/span&gt;&amp;lt;&lt;/span&gt;link&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;
        ether f2:46:44:62:1e:cc  txqueuelen &lt;span class=&quot;token number&quot;&gt;1000&lt;/span&gt;  &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;Ethernet&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
        RX packets &lt;span class=&quot;token number&quot;&gt;9&lt;/span&gt;  bytes &lt;span class=&quot;token number&quot;&gt;726&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;726.0&lt;/span&gt; B&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
        RX errors &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;  dropped &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;  overruns &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;  frame &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;
        TX packets &lt;span class=&quot;token number&quot;&gt;9&lt;/span&gt;  bytes &lt;span class=&quot;token number&quot;&gt;726&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;726.0&lt;/span&gt; B&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
        TX errors &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;  dropped &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt; overruns &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;  carrier &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;  collisions &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;ul&gt;
&lt;li&gt;测试网络&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;shell&quot;&gt;&lt;pre class=&quot;language-shell&quot;&gt;&lt;code class=&quot;language-shell&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;# 从nets1 ping nets2网络是通的&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;root@k8s-master-168 ~&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token comment&quot;&gt;# ip netns exec nets1 ping 10.1.1.2&lt;/span&gt;
PING &lt;span class=&quot;token number&quot;&gt;10.1&lt;/span&gt;.1.2 &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;10.1&lt;/span&gt;.1.2&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;56&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;84&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; bytes of data.
&lt;span class=&quot;token number&quot;&gt;64&lt;/span&gt; bytes from &lt;span class=&quot;token number&quot;&gt;10.1&lt;/span&gt;.1.2: &lt;span class=&quot;token assign-left variable&quot;&gt;icmp_seq&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt; &lt;span class=&quot;token assign-left variable&quot;&gt;ttl&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;64&lt;/span&gt; &lt;span class=&quot;token assign-left variable&quot;&gt;time&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;0.106&lt;/span&gt; ms
&lt;span class=&quot;token number&quot;&gt;64&lt;/span&gt; bytes from &lt;span class=&quot;token number&quot;&gt;10.1&lt;/span&gt;.1.2: &lt;span class=&quot;token assign-left variable&quot;&gt;icmp_seq&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;2&lt;/span&gt; &lt;span class=&quot;token assign-left variable&quot;&gt;ttl&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;64&lt;/span&gt; &lt;span class=&quot;token assign-left variable&quot;&gt;time&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;0.079&lt;/span&gt; ms
&lt;span class=&quot;token number&quot;&gt;64&lt;/span&gt; bytes from &lt;span class=&quot;token number&quot;&gt;10.1&lt;/span&gt;.1.2: &lt;span class=&quot;token assign-left variable&quot;&gt;icmp_seq&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;3&lt;/span&gt; &lt;span class=&quot;token assign-left variable&quot;&gt;ttl&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;64&lt;/span&gt; &lt;span class=&quot;token assign-left variable&quot;&gt;time&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;0.083&lt;/span&gt; ms

&lt;span class=&quot;token comment&quot;&gt;# 从nets2 ping nets1 网络是通的&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;root@k8s-master-168 ~&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token comment&quot;&gt;# ip netns exec nets2 ping 10.1.1.1&lt;/span&gt;
PING &lt;span class=&quot;token number&quot;&gt;10.1&lt;/span&gt;.1.1 &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;10.1&lt;/span&gt;.1.1&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;56&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;84&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; bytes of data.
&lt;span class=&quot;token number&quot;&gt;64&lt;/span&gt; bytes from &lt;span class=&quot;token number&quot;&gt;10.1&lt;/span&gt;.1.1: &lt;span class=&quot;token assign-left variable&quot;&gt;icmp_seq&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt; &lt;span class=&quot;token assign-left variable&quot;&gt;ttl&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;64&lt;/span&gt; &lt;span class=&quot;token assign-left variable&quot;&gt;time&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;0.108&lt;/span&gt; ms
&lt;span class=&quot;token number&quot;&gt;64&lt;/span&gt; bytes from &lt;span class=&quot;token number&quot;&gt;10.1&lt;/span&gt;.1.1: &lt;span class=&quot;token assign-left variable&quot;&gt;icmp_seq&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;2&lt;/span&gt; &lt;span class=&quot;token assign-left variable&quot;&gt;ttl&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;64&lt;/span&gt; &lt;span class=&quot;token assign-left variable&quot;&gt;time&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;0.085&lt;/span&gt; ms
&lt;span class=&quot;token number&quot;&gt;64&lt;/span&gt; bytes from &lt;span class=&quot;token number&quot;&gt;10.1&lt;/span&gt;.1.1: &lt;span class=&quot;token assign-left variable&quot;&gt;icmp_seq&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;3&lt;/span&gt; &lt;span class=&quot;token assign-left variable&quot;&gt;ttl&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;64&lt;/span&gt; &lt;span class=&quot;token assign-left variable&quot;&gt;time&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;0.078&lt;/span&gt; ms&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2&gt;单主机多个 NetWork Namespace 之间通信&lt;/h2&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/00697df5524e023cc18bc052c267f0b7/6af66/bridge.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 39.24050632911392%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAIAAAB2/0i6AAAACXBIWXMAAAsTAAALEwEAmpwYAAABoklEQVQY02XK3W/SUBiA8f7HXhiUaeLNTEiciR8XmM0riWbLDFMU9iV17ekp5z3vOe1pV0AW122sNkDFNRDlY05q9MIY/V0+eTRE7jgAQCyiS8mEAEQEEAAOMRt63WRMAghE5MgBwSDGe0PngpuWqRmGt7o6fPCod7cQFotfSqUIUR0fl0ejJ+fxw6OwcHFRPOpUQTidxofUSk9qpx/fno7oqKW3tL291s18did/tXzrey6XFQpjYP5gsJZl1xZX+cXlUpZdj7ovbHTP6VlWzxb6j8XuPDvIuu+6GrPV4zWndvtpkLtfet4pl5uUYdDc5d6zzsa9ZOXG2cmmCnSLgSKyTcKwVP28tAybFqlRTUqhFHckOBKUy22gtPKaVncMW5g7+9b6SyZ8+qpCajXSsFEiCo4IwkXLtjREgb+aFEJyxvcte7C1lR7o7TiKGvTbxnr/63j8phJub9cJcVBIIaWQruNSSjX1F1epZhB8SpI4SeIoCtptppTvefFwGPV6weHhn9PzPM65dvmf6WQynUxms1m/3/d9P03T6W//bPP5/CcrfoFQCM/bJwAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;bridge&quot;
        title=&quot;bridge&quot;
        src=&quot;/static/00697df5524e023cc18bc052c267f0b7/f058b/bridge.png&quot;
        srcset=&quot;/static/00697df5524e023cc18bc052c267f0b7/c26ae/bridge.png 158w,
/static/00697df5524e023cc18bc052c267f0b7/6bdcf/bridge.png 315w,
/static/00697df5524e023cc18bc052c267f0b7/f058b/bridge.png 630w,
/static/00697df5524e023cc18bc052c267f0b7/6af66/bridge.png 640w&quot;
        sizes=&quot;(max-width: 630px) 100vw, 630px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;上述是两个&lt;code class=&quot;language-text&quot;&gt;ns&lt;/code&gt;可以采用直接&lt;code class=&quot;language-text&quot;&gt;veth&lt;/code&gt;的模式进行通信，就好比采用一根网线，连接两台电脑，如果出现3台电脑需要通信，此时就不能再通过拉取网线的新式了，在物理网络中是采用交换机来处理这种问题。&lt;/p&gt;
&lt;p&gt;在虚拟网络中通常用&lt;code class=&quot;language-text&quot;&gt;Linux bridge&lt;/code&gt;, &lt;code class=&quot;language-text&quot;&gt;Linux Bridge&lt;/code&gt;可以连接任意真实的物理设备（如：eth0网卡）或任意虚拟设备（如：veth pair设备，tap设备）。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;创建一个bridge&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;shell&quot;&gt;&lt;pre class=&quot;language-shell&quot;&gt;&lt;code class=&quot;language-shell&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;root@k8s-master-168 ~&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token comment&quot;&gt;# ip link add name br0 type bridge&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;root@k8s-master-168 ~&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token comment&quot;&gt;# ip link set br0 up&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;ul&gt;
&lt;li&gt;创建三个ns&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;shell&quot;&gt;&lt;pre class=&quot;language-shell&quot;&gt;&lt;code class=&quot;language-shell&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;# 创建3个ns&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;root@k8s-master-168 ~&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token comment&quot;&gt;# ip netns add nets1&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;root@k8s-master-168 ~&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token comment&quot;&gt;# ip netns add nets2&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;root@k8s-master-168 ~&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token comment&quot;&gt;# ip netns add nets3&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;# 创建3对veth pair&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;root@k8s-master-168 ~&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token comment&quot;&gt;# ip link add type veth&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;root@k8s-master-168 ~&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token comment&quot;&gt;# ip link add type veth&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;root@k8s-master-168 ~&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token comment&quot;&gt;# ip link add type veth&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;ul&gt;
&lt;li&gt;把br0和3个ns版定&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;shell&quot;&gt;&lt;pre class=&quot;language-shell&quot;&gt;&lt;code class=&quot;language-shell&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;# 把veth1、veth3、veth5分别插入nets1、nets2、nets3中&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;root@k8s-master-168 ~&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token comment&quot;&gt;# ip link set veth1 netns nets1&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;root@k8s-master-168 ~&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token comment&quot;&gt;# ip link set veth3 netns nets2&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;root@k8s-master-168 ~&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token comment&quot;&gt;# ip link set veth5 netns nets3&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;# 把veth0、veth2、veth4插入br0中&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;root@k8s-master-168 ~&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token comment&quot;&gt;# ip link set dev veth0 master br0 up&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;root@k8s-master-168 ~&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token comment&quot;&gt;# ip link set dev veth2 master br0 up&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;root@k8s-master-168 ~&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token comment&quot;&gt;# ip link set dev veth4 master br0 up&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;# 设置三个ip给veth1、veth3、veth5设备并启用&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;root@k8s-master-168 ~&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token comment&quot;&gt;# ip netns exec nets1 ifconfig veth1 10.1.1.1/24 up&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;root@k8s-master-168 ~&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token comment&quot;&gt;# ip netns exec nets2 ifconfig veth3 10.1.1.2/24 up&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;root@k8s-master-168 ~&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token comment&quot;&gt;# ip netns exec nets3 ifconfig veth5 10.1.1.3/24 up&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;进过上述配置之后呢就把这三个ns通过br0这个桥绑定上了，就可以做到两两任意访问了。&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;shell&quot;&gt;&lt;pre class=&quot;language-shell&quot;&gt;&lt;code class=&quot;language-shell&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;root@k8s-master-168 ~&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token comment&quot;&gt;# ip netns exec nets1 ping 10.1.1.2&lt;/span&gt;
PING &lt;span class=&quot;token number&quot;&gt;10.1&lt;/span&gt;.1.2 &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;10.1&lt;/span&gt;.1.2&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;56&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;84&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; bytes of data.
&lt;span class=&quot;token number&quot;&gt;64&lt;/span&gt; bytes from &lt;span class=&quot;token number&quot;&gt;10.1&lt;/span&gt;.1.2: &lt;span class=&quot;token assign-left variable&quot;&gt;icmp_seq&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt; &lt;span class=&quot;token assign-left variable&quot;&gt;ttl&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;64&lt;/span&gt; &lt;span class=&quot;token assign-left variable&quot;&gt;time&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;0.138&lt;/span&gt; ms
&lt;span class=&quot;token number&quot;&gt;64&lt;/span&gt; bytes from &lt;span class=&quot;token number&quot;&gt;10.1&lt;/span&gt;.1.2: &lt;span class=&quot;token assign-left variable&quot;&gt;icmp_seq&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;2&lt;/span&gt; &lt;span class=&quot;token assign-left variable&quot;&gt;ttl&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;64&lt;/span&gt; &lt;span class=&quot;token assign-left variable&quot;&gt;time&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;0.172&lt;/span&gt; ms
&lt;span class=&quot;token number&quot;&gt;64&lt;/span&gt; bytes from &lt;span class=&quot;token number&quot;&gt;10.1&lt;/span&gt;.1.2: &lt;span class=&quot;token assign-left variable&quot;&gt;icmp_seq&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;3&lt;/span&gt; &lt;span class=&quot;token assign-left variable&quot;&gt;ttl&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;64&lt;/span&gt; &lt;span class=&quot;token assign-left variable&quot;&gt;time&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;0.138&lt;/span&gt; ms

&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;root@k8s-master-168 ~&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token comment&quot;&gt;# ip netns exec nets1 ping 10.1.1.3&lt;/span&gt;
PING &lt;span class=&quot;token number&quot;&gt;10.1&lt;/span&gt;.1.3 &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;10.1&lt;/span&gt;.1.3&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;56&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;84&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; bytes of data.
&lt;span class=&quot;token number&quot;&gt;64&lt;/span&gt; bytes from &lt;span class=&quot;token number&quot;&gt;10.1&lt;/span&gt;.1.3: &lt;span class=&quot;token assign-left variable&quot;&gt;icmp_seq&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt; &lt;span class=&quot;token assign-left variable&quot;&gt;ttl&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;64&lt;/span&gt; &lt;span class=&quot;token assign-left variable&quot;&gt;time&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;0.149&lt;/span&gt; ms
&lt;span class=&quot;token number&quot;&gt;64&lt;/span&gt; bytes from &lt;span class=&quot;token number&quot;&gt;10.1&lt;/span&gt;.1.3: &lt;span class=&quot;token assign-left variable&quot;&gt;icmp_seq&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;2&lt;/span&gt; &lt;span class=&quot;token assign-left variable&quot;&gt;ttl&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;64&lt;/span&gt; &lt;span class=&quot;token assign-left variable&quot;&gt;time&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;0.114&lt;/span&gt; ms
&lt;span class=&quot;token number&quot;&gt;64&lt;/span&gt; bytes from &lt;span class=&quot;token number&quot;&gt;10.1&lt;/span&gt;.1.3: &lt;span class=&quot;token assign-left variable&quot;&gt;icmp_seq&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;3&lt;/span&gt; &lt;span class=&quot;token assign-left variable&quot;&gt;ttl&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;64&lt;/span&gt; &lt;span class=&quot;token assign-left variable&quot;&gt;time&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;0.130&lt;/span&gt; ms
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2&gt;跨主机多个 NetWork Namespace 之间通信&lt;/h2&gt;
&lt;p&gt;跨主机网络通信涉及到需要通过&lt;code class=&quot;language-text&quot;&gt;vxlan&lt;/code&gt;、&lt;code class=&quot;language-text&quot;&gt;macvlan&lt;/code&gt;、&lt;code class=&quot;language-text&quot;&gt;ipvlan&lt;/code&gt;等技术进行跨主机组网，&lt;/p&gt;</content:encoded></item><item><title><![CDATA[Kubernetes网络之CNI规范解读]]></title><description><![CDATA[CNI 简介 容器网络接口（Container Network Interface），简称 CNI，是 CNCF 旗下的一个项目，由一组用于配置 Linux 容器的网络接口的规范和库组成，同时还包含了一些插件。CNI…]]></description><link>https://lengrongfu.github.io/2022-05-11-k8s之CNI规范解读/</link><guid isPermaLink="false">https://lengrongfu.github.io/2022-05-11-k8s之CNI规范解读/</guid><pubDate>Wed, 11 May 2022 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/337b43fbb65a6a700d1b27fe59098fa7/7e111/cni-horizontal-color.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 38.60759493670886%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAAC4jAAAuIwF4pT92AAAB1ElEQVQoz12SXUuTYRjH/8+cvUgKpYhQKwkCBwbSQeh9aVMpvK+hlbnpIivC917AYSAVxDqwEA8M+gJiR7L7Yc+tbNXWcltuTYI66tAP0LeI5wVTDy7+Nxf39bteAUsBlroAbcahzUFYqtbzGZidB7rDBgQDxICQrpL8/3b0gEGbV6HNKCzVC0uFoM1JWOqSA32V8KE7bAfWgTgAIU+6QDZcmK3SdwDotyt5ilSyDR/XYGizA5YagTYjSCnCmyWg/1YrBM+AeAyCezzQYxBf9+ARkGxwgfwaNWk94d9KXYO5EUQqOXo8rYeR0QNYX2vEyH370wOnOrdVv9fqOIgXIPgMSEZAtjqJ3uNsLhO6mMtEA5nN6dbPW1Mt2XQs+PVTaFEl606HR+3ghxCyeX92blVREJ+H4DEQPwHJeieR4FXEy4Vzj8oF3C7kemKlfKB3O4vxUn5oOP+lv+PdCvx9N4MgngbJARCTB4xBSHuuLRC8DOJjzuIEv0W8UryR2N3pfFYp4u/eH9+L6veh+XKx/e63LNoWXvq8Fhsh5GUQN3gbPwHiGg9eu78k4lNYrJaw9LPc/uF39d7qrx93Ers7Tc8rRcyV8sCVPqBLGodORhw5myP2D/59qIrWophFAAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;image&quot;
        title=&quot;image&quot;
        src=&quot;/static/337b43fbb65a6a700d1b27fe59098fa7/f058b/cni-horizontal-color.png&quot;
        srcset=&quot;/static/337b43fbb65a6a700d1b27fe59098fa7/c26ae/cni-horizontal-color.png 158w,
/static/337b43fbb65a6a700d1b27fe59098fa7/6bdcf/cni-horizontal-color.png 315w,
/static/337b43fbb65a6a700d1b27fe59098fa7/f058b/cni-horizontal-color.png 630w,
/static/337b43fbb65a6a700d1b27fe59098fa7/40601/cni-horizontal-color.png 945w,
/static/337b43fbb65a6a700d1b27fe59098fa7/78612/cni-horizontal-color.png 1260w,
/static/337b43fbb65a6a700d1b27fe59098fa7/7e111/cni-horizontal-color.png 1627w&quot;
        sizes=&quot;(max-width: 630px) 100vw, 630px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;h2&gt;CNI 简介&lt;/h2&gt;
&lt;p&gt;容器网络接口（Container Network Interface），简称 CNI，是 CNCF 旗下的一个项目，由一组用于配置 Linux 容器的网络接口的规范和库组成，同时还包含了一些插件。CNI 仅关心容器创建时的网络分配，和当容器被删除时释放网络资源。&lt;/p&gt;
&lt;p&gt;使用CNI的容器运行时有：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Kubernetes&lt;/li&gt;
&lt;li&gt;ContainerD&lt;/li&gt;
&lt;li&gt;Mesos&lt;/li&gt;
&lt;li&gt;Cloud Foundry&lt;/li&gt;
&lt;li&gt;OpenShift&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;实现了CNI规范的网络插件有：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Flannel&lt;/li&gt;
&lt;li&gt;Calico&lt;/li&gt;
&lt;li&gt;Weave&lt;/li&gt;
&lt;li&gt;Cilium&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://www.cni.dev/docs/#3rd-party-plugins&quot;&gt;等等&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h2&gt;CNI插件&lt;/h2&gt;
&lt;p&gt;CNI 插件必须实现一个可执行文件，这个文件可以被容器管理系统（例如 rkt 或 Kubernetes）调用。&lt;/p&gt;
&lt;p&gt;CNI 插件负责将网络接口插入容器网络命名空间（例如，veth 对的一端），并在主机上进行任何必要的改变（例如将 veth 的另一端连接到网桥）。然后将 IP 分配给接口，并通过调用适当的 IPAM 插件来设置与 “IP 地址管理” 部分一致的路由。&lt;/p&gt;
&lt;h2&gt;CNI规范&lt;/h2&gt;
&lt;h5&gt;1. CNI定义规范版本，用来控制版本兼容性问题，但是版本不是一尘不变的。&lt;/h5&gt;
&lt;h4&gt;2. 概念：&lt;/h4&gt;
&lt;ul&gt;
&lt;li&gt;容器是一个网络隔离域。&lt;/li&gt;
&lt;li&gt;网络是指一组可以唯一寻址的端点，它们可以相互通信。&lt;/li&gt;
&lt;li&gt;Container Runtime是负责执行CNI插件的地方。&lt;/li&gt;
&lt;li&gt;Plugin是指网络配置的程序。&lt;/li&gt;
&lt;/ul&gt;
&lt;h4&gt;3. 规范&lt;/h4&gt;
&lt;p&gt;CNI规范定义了5点：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;ol&gt;
&lt;li&gt;系统管理员去定义网络配置的格式。&lt;/li&gt;
&lt;/ol&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;ol start=&quot;2&quot;&gt;
&lt;li&gt;Container Runtime向网络插件发起请求的协议。&lt;/li&gt;
&lt;/ol&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;ol start=&quot;3&quot;&gt;
&lt;li&gt;基于系统管理员提供的配置执行插件，由第2步发起调用。&lt;/li&gt;
&lt;/ol&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;ol start=&quot;4&quot;&gt;
&lt;li&gt;CNI插件会将功能委托给其他插件。&lt;/li&gt;
&lt;/ol&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;ol start=&quot;5&quot;&gt;
&lt;li&gt;插件返回result到container runtime的数据类型。&lt;/li&gt;
&lt;/ol&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/897ecc9258c093d3c1289dd26099d60f/a6d36/cni.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 46.835443037974684%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAIAAAC9o5sfAAAACXBIWXMAAAsTAAALEwEAmpwYAAABG0lEQVQoz22Ra26DMBCEuX7v0Vv0AA0SUV6FSKgQJOwaRbbBBLqw+FHJVqMk4vu10u7seNZR0zT7/T5Jku12u9lsmqZZtHbOZUy+x99UqB9KCSHDMFhrjUdrPc+zcy5CxOmBYRgm3/gsr28fX9f+l1Fa16Tve2ut1toY45zT3iByz4QJrTWMt45fWynneQ6jAJDneZqmx+PxcDjUdb0iDgUhJDufa0KqqtrtdnmeM8amabp5lFIAEL3IiqKI41gpxTkvimJZFiFEVVVlWXLOrbVt255OJ0rpyrPvAMDlcsmyLE3TsCVENcZYz3pmRDTGAICUsus6IYT0yRExnAMRw65XcfiJxyDjODLGHs9hrV0XB+fFg/8sz9yd/wAh+wLhskj1NwAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;CNI Arch&quot;
        title=&quot;CNI Arch&quot;
        src=&quot;/static/897ecc9258c093d3c1289dd26099d60f/f058b/cni.png&quot;
        srcset=&quot;/static/897ecc9258c093d3c1289dd26099d60f/c26ae/cni.png 158w,
/static/897ecc9258c093d3c1289dd26099d60f/6bdcf/cni.png 315w,
/static/897ecc9258c093d3c1289dd26099d60f/f058b/cni.png 630w,
/static/897ecc9258c093d3c1289dd26099d60f/a6d36/cni.png 650w&quot;
        sizes=&quot;(max-width: 630px) 100vw, 630px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;h5&gt;3.1 网络配置&lt;/h5&gt;
&lt;p&gt;网络配置是具有如下字段的json格式：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;cniVersion&lt;/code&gt;: 指定CNI规范的版本。&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;Name&lt;/code&gt;: 网络名字，这在主机的网络配置中应该唯一。&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;disableCheck&lt;/code&gt;: 是否禁用检查网络，如果为true,则 &lt;code class=&quot;language-text&quot;&gt;container runtime&lt;/code&gt; 不会调用 Check 方法进行网络检查。&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;plugin&lt;/code&gt;: cni插件及其配置列表，可以配置多个插件。&lt;/li&gt;
&lt;/ul&gt;
&lt;h5&gt;3.2 执行协议&lt;/h5&gt;
&lt;p&gt;CNI协议基于容器运行时调用插件二进制程序。CNI程序逻辑本身被封装在了&lt;code class=&quot;language-text&quot;&gt;libcni&lt;/code&gt;中，会被其他容器运行时调用。在&lt;code class=&quot;language-text&quot;&gt;libcni&lt;/code&gt;中总共暴露了 4 个核心方法：&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;go&quot;&gt;&lt;pre class=&quot;language-go&quot;&gt;&lt;code class=&quot;language-go&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;type&lt;/span&gt; CNI &lt;span class=&quot;token keyword&quot;&gt;interface&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token comment&quot;&gt;// 添加网络&lt;/span&gt;
    &lt;span class=&quot;token function&quot;&gt;AddNetwork&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;ctx context&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;Context&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; net &lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt;NetworkConfig&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; rt &lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt;RuntimeConf&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;types&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;Result&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token builtin&quot;&gt;error&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;token comment&quot;&gt;// 检查网络&lt;/span&gt;
	&lt;span class=&quot;token function&quot;&gt;CheckNetwork&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;ctx context&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;Context&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; net &lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt;NetworkConfig&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; rt &lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt;RuntimeConf&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token builtin&quot;&gt;error&lt;/span&gt;
    &lt;span class=&quot;token comment&quot;&gt;// 删除网络&lt;/span&gt;
	&lt;span class=&quot;token function&quot;&gt;DelNetwork&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;ctx context&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;Context&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; net &lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt;NetworkConfig&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; rt &lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt;RuntimeConf&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token builtin&quot;&gt;error&lt;/span&gt;
    &lt;span class=&quot;token comment&quot;&gt;// 获取网络缓存结果&lt;/span&gt;
	&lt;span class=&quot;token function&quot;&gt;GetNetworkCachedResult&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;net &lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt;NetworkConfig&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; rt &lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt;RuntimeConf&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;types&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;Result&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token builtin&quot;&gt;error&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;token comment&quot;&gt;// 获取网络缓存配置&lt;/span&gt;
	&lt;span class=&quot;token function&quot;&gt;GetNetworkCachedConfig&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;net &lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt;NetworkConfig&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; rt &lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt;RuntimeConf&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token builtin&quot;&gt;byte&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt;RuntimeConf&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token builtin&quot;&gt;error&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;token comment&quot;&gt;// 校验网络&lt;/span&gt;
	&lt;span class=&quot;token function&quot;&gt;ValidateNetwork&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;ctx context&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;Context&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; net &lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt;NetworkConfig&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token builtin&quot;&gt;string&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token builtin&quot;&gt;error&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;CNI&lt;/code&gt;插件负责以某种方式配置容器的网络接口，通过标准输入提供配置，标准输出上返回结果，标准错误上返回error。&lt;/p&gt;
&lt;h5&gt;3.3 CNI操作&lt;/h5&gt;
&lt;p&gt;CNI插件定义了4个操作：ADD、DEL、CHECK、Version。&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;ADD：添加容器到网络中，插件收到ADD命令执行如下步骤；不支持多次调用。&lt;/li&gt;
&lt;/ol&gt;
&lt;ul&gt;
&lt;li&gt;在CNI_NETNS的容器中创建CNI_IFNAME的接口。&lt;/li&gt;
&lt;li&gt;调整CNI_NETNS容器内CNI_IFNAME的配置。&lt;/li&gt;
&lt;/ul&gt;
&lt;ol start=&quot;2&quot;&gt;
&lt;li&gt;DEL：从容器中删除网络，插件收到DEL命令执行如下步骤；支持多次调用。&lt;/li&gt;
&lt;/ol&gt;
&lt;ul&gt;
&lt;li&gt;删除CNI_NETNS容器内的CNI_IFNAME定义的接口。&lt;/li&gt;
&lt;li&gt;撤销插件ADD功能中应用的修改。&lt;/li&gt;
&lt;/ul&gt;
&lt;ol start=&quot;3&quot;&gt;
&lt;li&gt;
&lt;p&gt;Check：检查容器的网络是否符合预期。&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Version：探测CNI插件版本是否支持。&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;h2&gt;CNI Plugin 项目&lt;/h2&gt;
&lt;p&gt;Plugin中提供了3个维度的插件，一个是main，用户创建网络接口的插件，一个ipam，用于管理ip地址的插件，可以被main插件调用，一个meta插件，就是其它插件。&lt;/p&gt;</content:encoded></item><item><title><![CDATA[Kubernetes网络之Flannel原理介绍]]></title><description><![CDATA[Flannel 简介 Flannel CNI实现]]></description><link>https://lengrongfu.github.io/2022-05-10-k8s网络之Flannel原理/</link><guid isPermaLink="false">https://lengrongfu.github.io/2022-05-10-k8s网络之Flannel原理/</guid><pubDate>Tue, 10 May 2022 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 328px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/b31d6e1a829455a4ecf786c3ab45b7c0/d5c60/flannel-horizontal-color.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 30.37974683544304%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAYAAADDl76dAAAACXBIWXMAAAsTAAALEwEAmpwYAAABbElEQVQY0z2RQUtVURSFj5BKYIISVPLYa7nXQwIhA0FokFhIoxD0HgwaBKIDzbIciINCaOIkwqGDRu9dEf+ANG/oRB357tWRf+TGuV0cHPZZ+5y92Ht/IeZFyPJiM+sWp/HoZnzx93loe/u1wBduGJEhCAwO1jFptxT/a6/f6z+DMjwLMS/aMS/Psk7vz8Z19bg11D8l+k+BHwS+FCgZxxy8J/C5DE/ceF/gtMAHAvoFTrrhkcDdEPPyV9YtyqzT+7teVK3W0MCM6N8FLrghGS4I3JdhQ8YtgdsCvwr8JHBTxvdu2BHwWcBqMlyJeXmRdXqHNjqcWp8UxpcFvmqKltzwTYZ9Aa0mtyfDQwE/BB44MC9wUcB2yLrFcMzLy6xztf5m7zg8nZqZcMNcGs+BLwK3ZFwR+E7GZPhWYHTDWLo7OO+GjzJMCFxLQFKXazEvZ5dPbkNVVfWiHc2yjX01AMMdiAbC3XHDoDfg/gE5PG+3ISSUAwAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;image&quot;
        title=&quot;image&quot;
        src=&quot;/static/b31d6e1a829455a4ecf786c3ab45b7c0/d5c60/flannel-horizontal-color.png&quot;
        srcset=&quot;/static/b31d6e1a829455a4ecf786c3ab45b7c0/c26ae/flannel-horizontal-color.png 158w,
/static/b31d6e1a829455a4ecf786c3ab45b7c0/6bdcf/flannel-horizontal-color.png 315w,
/static/b31d6e1a829455a4ecf786c3ab45b7c0/d5c60/flannel-horizontal-color.png 328w&quot;
        sizes=&quot;(max-width: 328px) 100vw, 328px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;h2&gt;Flannel 简介&lt;/h2&gt;
&lt;h2&gt;Flannel CNI实现&lt;/h2&gt;</content:encoded></item><item><title><![CDATA[计算机体系结构基础]]></title><description><![CDATA[计算机体系结构基础 Github 地址 这是龙芯团队胡伟武老师等人编写的《计算机体系结构基础》（第三版）的开源版本。本书纸质版本由机械工业出版社发行，前两版可以通过各种常规渠道购买，第三版纸质版本也即将发行。 计算机体系结构基础]]></description><link>https://lengrongfu.github.io/test/</link><guid isPermaLink="false">https://lengrongfu.github.io/test/</guid><pubDate>Wed, 02 Mar 2022 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;&lt;a href=&quot;https://github.com/foxsen/archbase&quot;&gt;计算机体系结构基础 Github 地址&lt;/a&gt; 这是龙芯团队胡伟武老师等人编写的《计算机体系结构基础》（第三版）的开源版本。本书纸质版本由机械工业出版社发行，前两版可以通过各种常规渠道购买，第三版纸质版本也即将发行。&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;/51c48c1673ebd002ec0838c0c9ba6274/bookdown.pdf&quot;&gt;计算机体系结构基础&lt;/a&gt;&lt;/p&gt;</content:encoded></item><item><title><![CDATA[Serverless 入门知识]]></title><description><![CDATA[Serverless 是什么，它有什么优势，有什么限制，应该什么时候使用它. Serverless…]]></description><link>https://lengrongfu.github.io/2022-03-01-serverless基础知识/</link><guid isPermaLink="false">https://lengrongfu.github.io/2022-03-01-serverless基础知识/</guid><pubDate>Tue, 01 Mar 2022 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/3de73df04293288a54989057b50889df/07a9c/Serverless-architecture-preview-image.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 34.810126582278485%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAIAAACHqfpvAAAACXBIWXMAAAsTAAALEwEAmpwYAAAA4klEQVQY04WQzU7CUBCFeVEewB0JC1/BPRsTN+7YsuyGDdJEFAJGAiQ1WBRivPW2tJfe1ts7c0ghMeHH8K1mc2a+ORWcQMREDGATq8XMt7v5LBX8C3/4n5N+VyfztYqstRfCxOWR7njZeV1SURSWgd8wFI+DdhB8vXirQMblVuYz4b3hTdNttJ4Xs96w/5DlJGWUb2SWRrd396Ph09+N47AxRspQ/nwDqNeurmtVkNJZTsTrWL15YyWngOUj7b2J67qO4wBIUz1/90PhAQURa62NMRd+TpJECFH6n9TDO4CD5re2t5A+3VtDpgAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;image&quot;
        title=&quot;image&quot;
        src=&quot;/static/3de73df04293288a54989057b50889df/f058b/Serverless-architecture-preview-image.png&quot;
        srcset=&quot;/static/3de73df04293288a54989057b50889df/c26ae/Serverless-architecture-preview-image.png 158w,
/static/3de73df04293288a54989057b50889df/6bdcf/Serverless-architecture-preview-image.png 315w,
/static/3de73df04293288a54989057b50889df/f058b/Serverless-architecture-preview-image.png 630w,
/static/3de73df04293288a54989057b50889df/40601/Serverless-architecture-preview-image.png 945w,
/static/3de73df04293288a54989057b50889df/78612/Serverless-architecture-preview-image.png 1260w,
/static/3de73df04293288a54989057b50889df/07a9c/Serverless-architecture-preview-image.png 1440w&quot;
        sizes=&quot;(max-width: 630px) 100vw, 630px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;Serverless 是什么，它有什么优势，有什么限制，应该什么时候使用它.&lt;/p&gt;
&lt;h2&gt;Serverless 是什么&lt;/h2&gt;
&lt;p&gt;无服务器架构是一种基于事件的软件设计模式，无需处理、供应和扩展服务器和数据库。这样，企业就可以通过第三方服务运行他们的应用程序，而无需投资物理或虚拟服务器。许多处理云服务的提供商处理计算、服务器管理、编码和动态分配资源的复杂性。&lt;/p&gt;
&lt;p&gt;在无服务的发展过程中主要有两种模式：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;后端即服务（BaaS）&lt;/li&gt;
&lt;li&gt;功能即服务（FaaS）&lt;/li&gt;
&lt;/ul&gt;
&lt;h3&gt;什么是 BaaS&lt;/h3&gt;
&lt;p&gt;后端即服务使开发人员能够专注于管理应用程序的前端，并让他们摆脱托管、云存储和数据库管理等后端开发任务。这样，他们就不必为服务器端活动（例如数据库管理、用户身份验证和加密）管理或编写代码。&lt;/p&gt;
&lt;h3&gt;什么是 FaaS&lt;/h3&gt;
&lt;p&gt;功能即服务是一种事件驱动的执行模型，可以执行小代码模块。当应用程序模块中发生某些事件的执行时，它会触发函数。这带来了卓越的成本效率、资源的动态扩展和简化的流程。&lt;/p&gt;
&lt;h2&gt;Serverless 有什么优势&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;您的开发人员现在可以专注于编写代码和优化应用程序设计。&lt;/li&gt;
&lt;li&gt;您可以变得更加敏捷，获得创业创新，并拥有企业竞争优势。&lt;/li&gt;
&lt;li&gt;由于无服务器架构将业务逻辑/代码作为函数执行，因此您不再需要手动管理基础架构。&lt;/li&gt;
&lt;li&gt;具有成本效益的定价模式——按价值付费——消除了在管理内部架构方面进行大量投资的需要。&lt;/li&gt;
&lt;li&gt;故障不会影响整个应用程序开发，因为基于事件的架构使应用程序模块彼此独立。&lt;/li&gt;
&lt;li&gt;您可以更快地部署应用程序并在发布中变得更加灵活。除此之外，命令行界面还有助于在几分钟内部署代码。&lt;/li&gt;
&lt;li&gt;它使您能够构建优雅、无缝的用户体验并满足客户的需求。&lt;/li&gt;
&lt;li&gt;您可以按需和按使用情况扩展或缩小应用程序。&lt;/li&gt;
&lt;li&gt;功能即服务架构使开发人员能够创建独立的、有目的的功能，例如 API 调用。&lt;/li&gt;
&lt;li&gt;由于基于模块化、快速和较小的版本，它显着缩短了产品上市时间。&lt;/li&gt;
&lt;li&gt;您无需担心基础架构的安全性，因为云提供商会维护它。&lt;/li&gt;
&lt;li&gt;您的团队可以使用 AWS Lambda边缘等现代无服务器功能来改善延迟期。&lt;/li&gt;
&lt;/ul&gt;
&lt;h2&gt;Serverless 有什么限制&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;长时间运行的工作负载在无服务器上可能比专用服务器成本更高。&lt;/li&gt;
&lt;li&gt;在执行函数时处理冷启动请求时，您可能会遇到延迟。但是，您可以通过发送定期请求以保持活动状态来解决此问题。&lt;/li&gt;
&lt;li&gt;您将依赖于您的提供商来提供调试和监控工具，并且对平台架构和可用性的控制有限。&lt;/li&gt;
&lt;li&gt;由于更多的功能，开发人员面临着越来越多的复杂性。忽略几个函数的粒度和它们之间的平衡会造成混乱。&lt;/li&gt;
&lt;li&gt;由于无服务器架构中的小型模块，您可能会面临部署、版本控制和其他实施问题。这在对一组部署的功能进行集成测试时提出了挑战。&lt;/li&gt;
&lt;li&gt;由于云提供商可以控制组件之间的交互，因此可能会影响系统的灵活性和定制化。&lt;/li&gt;
&lt;/ul&gt;
&lt;h2&gt;Serverless 什么场景可以使用它&lt;/h2&gt;
&lt;p&gt;无服务器架构为敏捷工作环境、资源分配自动化、可扩展性、改进响应时间等未来业务目标奠定了基础。此外，您会看到物理基础设施的运营开销和配置减少，从而为您的投资带来价值。&lt;/p&gt;
&lt;p&gt;以下是无服务器应用程序列表，展示了您可以在哪些地方将无服务器架构集成到您的业务中：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;构建高延迟的实时应用程序，例如多媒体应用程序，以执行内存的自动分配和复杂的数据处理&lt;/li&gt;
&lt;li&gt;为了满足快速变化的开发需求、客户需求功能添加和其他复杂的可扩展性需求，为不可预测的工作负载提供服务。&lt;/li&gt;
&lt;li&gt;动态调整图像大小或转码视频并简化不同设备的多媒体处理。&lt;/li&gt;
&lt;li&gt;支持多语言服务集成，满足现代软件需求。&lt;/li&gt;
&lt;li&gt;使用物联网获取精确的设备状态并处理智能设备应用程序。&lt;/li&gt;
&lt;li&gt;建立安全的客户交付调度系统并帮助动态调整大小。&lt;/li&gt;
&lt;/ul&gt;</content:encoded></item><item><title><![CDATA[gRPC 学习之-高级知识]]></title><description><![CDATA[高级知识 之前的文章中记录了对 gRPC 的使用，但是都没有涉及底层的通信基础知识。这篇文章主要介绍 gRPC 的高级知识，涉及到 gRPC 的底层原理、 gRPC 底层原理 gRPC 超越基础知识 这部分主要讲述在构建真正的gRPC…]]></description><link>https://lengrongfu.github.io/2022-01-01 gRPC 学习之高级知识/</link><guid isPermaLink="false">https://lengrongfu.github.io/2022-01-01 gRPC 学习之高级知识/</guid><pubDate>Sun, 26 Dec 2021 16:22:00 GMT</pubDate><content:encoded>&lt;h2&gt;高级知识&lt;/h2&gt;
&lt;p&gt;之前的文章中记录了对 gRPC 的使用，但是都没有涉及底层的通信基础知识。这篇文章主要介绍 gRPC 的高级知识，涉及到 gRPC 的底层原理、&lt;/p&gt;
&lt;h3&gt;gRPC 底层原理&lt;/h3&gt;
&lt;h3&gt;gRPC 超越基础知识&lt;/h3&gt;
&lt;p&gt;这部分主要讲述在构建真正的gRPC应用时，对于需要增强它们的各种能力，比如：拦截gRPC的输入和输出、弹性处理网络延迟、处理错误、在服务和消费者之间共享元数据。&lt;/p&gt;
&lt;h4&gt;拦截器&lt;/h4&gt;
&lt;p&gt;在 &lt;code class=&quot;language-text&quot;&gt;gRPC&lt;/code&gt; 中，可以拦截 &lt;code class=&quot;language-text&quot;&gt;gRPC&lt;/code&gt; 的执行.来满足特定的需求，如日志、认证、性能度盐指标等，这会使用一种名为拦截器的扩展机制。它是 &lt;code class=&quot;language-text&quot;&gt;gRPC&lt;/code&gt; 核心扩展机制之一 ，在一些使用场呆中非常有用，比如日志、身份验证、授权、性能度盘指标、跟踪以及其他一些自定义错求.&lt;/p&gt;
&lt;p&gt;根据所拦截的 &lt;code class=&quot;language-text&quot;&gt;RPC&lt;/code&gt; 调用类型，&lt;code class=&quot;language-text&quot;&gt;gRPC&lt;/code&gt; 拦截可以分为两类，对于一元&lt;code class=&quot;language-text&quot;&gt;RPC&lt;/code&gt;，使用一元拦截器，对于流&lt;code class=&quot;language-text&quot;&gt;RPC&lt;/code&gt;，使用流拦截器；这些拦截器既可以用在服务端也可以用在客户端。&lt;/p&gt;
&lt;h5&gt;服务端拦截器&lt;/h5&gt;
&lt;p&gt;当客户端调用 gRPC服务的远程方法肘，通过使用服务器端拦截器，可以在执行远程方法 之前，执行一个通用的逻辑。&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/49e9add621361ce0afb361338b098d87/b7756/grpc-server-intercepter.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 60.75949367088608%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAIAAADtbgqsAAAACXBIWXMAAAsTAAALEwEAmpwYAAACJElEQVQoz42R62+aUBiH+f8/NnZ2ly5LlrRpdrGdiiIVxbWK1dr1opaLiKJ4AUQEDj1wDmexLm2yfdnv03vy5nnPk/yoKIqSJMEYJ0lC/glCSJ/O3I1HCPlrjxCiEEK7RxAAmmbzNEsXzulCOZst0YUyw/IMyxdZvlDkCgzHcRdc5bJauWTZ6k3nlkIo3sHz+TKXK82MuTYcTyazr1/OWLayXFgT3dB14+Qks7f3VhKVle1Y1mo8mtT4OuVuNuu1q8jqaKhf/GwmhJjWCj6hElO9uuogTGxn7YdhNl96kz60LHv3EwBhU2hTT+FTHMcQQsNY8HwdIex5fgiiAl0WGm2EEj8AGx9kfhRT6Q/LpbmDfT+oN1pUFL9oLxpCixCyO19iuJvOHXkWiRE+yzH76UPTtDHGURQBEApCi4pf4WWjsYXXjksIYYqVzvUtIcR1N3GMT3PMVtu0kySJYwQAqAstKggAhNBZOdPpjK/Vt7OzDvyAKXJNoQ2jyHHdtetlssX9g4+LxR9tz/O32p7nBwHQtPFkYgiNq+fOQkJIuVz7dbPVDsIQRihHnx+8+2Tbq5dem8L1a8/m0jrN5Ps9+f6+3+1Kx0ff8zTblwd3XfG2K34++pZKve9c36nqSB1oDw/9SuWCghCi50AYybLa6z72+1KvK8myKsuDR1EWRUWUBpo21sdTdaApsqooQ0VR5/MFpeuGadq9nihJqqbpGGPy3/kNVAV+i61jIzYAAAAASUVORK5CYII=&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;grpc-server-intercepter&quot;
        title=&quot;grpc-server-intercepter&quot;
        src=&quot;/static/49e9add621361ce0afb361338b098d87/f058b/grpc-server-intercepter.png&quot;
        srcset=&quot;/static/49e9add621361ce0afb361338b098d87/c26ae/grpc-server-intercepter.png 158w,
/static/49e9add621361ce0afb361338b098d87/6bdcf/grpc-server-intercepter.png 315w,
/static/49e9add621361ce0afb361338b098d87/f058b/grpc-server-intercepter.png 630w,
/static/49e9add621361ce0afb361338b098d87/40601/grpc-server-intercepter.png 945w,
/static/49e9add621361ce0afb361338b098d87/78612/grpc-server-intercepter.png 1260w,
/static/49e9add621361ce0afb361338b098d87/b7756/grpc-server-intercepter.png 2294w&quot;
        sizes=&quot;(max-width: 630px) 100vw, 630px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;在服务器销， 一元拦截器拦截一元 RPC，梳拦iliV:ìI售出1拦截流 RPC. 下回来右一下服务器揣
一元拦敲器.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;一元拦截&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;要实现这一点 ，需要先实现 &lt;code class=&quot;language-text&quot;&gt;UnaryServerlnterceptor&lt;/code&gt; 类型的函数， 并在创 &lt;code class=&quot;language-text&quot;&gt;gRPC&lt;/code&gt; 服务器端时将函数注册进来。 &lt;code class=&quot;language-text&quot;&gt;UnaryServerlnterceptor&lt;/code&gt; 是用于服务器端一元拦截的类型。函数定义类型如下。&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;go&quot;&gt;&lt;pre class=&quot;language-go&quot;&gt;&lt;code class=&quot;language-go&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;func&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;ctx context&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;Context&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; req &lt;span class=&quot;token keyword&quot;&gt;interface&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; info 叫JnaryServerlnfo，
hand1er UnaryHand1er&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;re5p &lt;span class=&quot;token keyword&quot;&gt;interface&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; err &lt;span class=&quot;token builtin&quot;&gt;error&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;例如：进行一元拦截，打印日志。&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;go&quot;&gt;&lt;pre class=&quot;language-go&quot;&gt;&lt;code class=&quot;language-go&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;func&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;orderUnaryServerlnterceptor&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;ctx context&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;Context&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; req &lt;span class=&quot;token keyword&quot;&gt;interface&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
	info &lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt;grpc&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;UnaryServerInfo&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; handler grpc&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;UnaryHandler&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;interface&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token builtin&quot;&gt;error&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
	log&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Println&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;======= [Server Interceptor1 &quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; info&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;FullMethod&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
	m&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; err &lt;span class=&quot;token operator&quot;&gt;:=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;handler&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;ctx&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; req&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
	log&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Printf&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;post proc mess: %s&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; m&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;token comment&quot;&gt;// 可以拦截修改返回内容&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; order&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; ok &lt;span class=&quot;token operator&quot;&gt;:=&lt;/span&gt; m&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt;pb&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;Order&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; ok &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
		order&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;Price &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;100&lt;/span&gt;
		&lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; order&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; err
	&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
	&lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; m&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; err
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;func&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;main&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token operator&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;省略
	s &lt;span class=&quot;token operator&quot;&gt;:=&lt;/span&gt; grpc&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;NewServer&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;grpc&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;UnaryInterceptor&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;orderUnaryServerlnterceptor&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
	pb&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;RegisterOrderManagementServer&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;s&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;&amp;amp;&lt;/span&gt;server&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
	&lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; err &lt;span class=&quot;token operator&quot;&gt;:=&lt;/span&gt; s&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Serve&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;listen&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; err &lt;span class=&quot;token operator&quot;&gt;!=&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;nil&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
		&lt;span class=&quot;token function&quot;&gt;panic&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;err&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
	&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;ul&gt;
&lt;li&gt;流拦截&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;服务器端流拦截器会拦截 &lt;code class=&quot;language-text&quot;&gt;gRPC&lt;/code&gt; 服务器所处理的所有流&lt;code class=&quot;language-text&quot;&gt;RPC&lt;/code&gt;。 流拦截器包括前置处理阶段和流操作拦截阶段。&lt;/p&gt;
&lt;p&gt;要实现流拦截，需要实现&lt;code class=&quot;language-text&quot;&gt;Streal&apos;1Serverlnterceptor&lt;/code&gt; 函数：&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;go&quot;&gt;&lt;pre class=&quot;language-go&quot;&gt;&lt;code class=&quot;language-go&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;func&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;srv &lt;span class=&quot;token keyword&quot;&gt;interface&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; ss grpc&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;ServerStream&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;info &lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt;grpc&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;StreamServerInfo&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;handler grpc&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;StreamHandler&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token builtin&quot;&gt;error&lt;/span&gt;  &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;

&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;grpc.ServerStream&lt;/code&gt; 的包装器可以拦截 &lt;code class=&quot;language-text&quot;&gt;gRPC&lt;/code&gt; 服务发送或接收到的数据，它实现了 &lt;code class=&quot;language-text&quot;&gt;SendMsg&lt;/code&gt; 函数和 &lt;code class=&quot;language-text&quot;&gt;RecvMsg&lt;/code&gt; 函数，这两个函数分别会在服务发送和接收 &lt;code class=&quot;language-text&quot;&gt;RPC&lt;/code&gt; 流消息的时候调用。&lt;/p&gt;
&lt;p&gt;在流 &lt;code class=&quot;language-text&quot;&gt;RPC&lt;/code&gt; 进入服务前，可以通过 &lt;code class=&quot;language-text&quot;&gt;grpc.ServeStream&lt;/code&gt; 进行流的处理，再通过 &lt;code class=&quot;language-text&quot;&gt;grpc.StreamHandler&lt;/code&gt; 来进行调用。&lt;/p&gt;
&lt;p&gt;例如：在 &lt;code class=&quot;language-text&quot;&gt;OrderManager&lt;/code&gt; 的流接口中先进行输入流的处理，再调用 &lt;code class=&quot;language-text&quot;&gt;RPC&lt;/code&gt;.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;go&quot;&gt;&lt;pre class=&quot;language-go&quot;&gt;&lt;code class=&quot;language-go&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;type&lt;/span&gt; wrappedSteam &lt;span class=&quot;token keyword&quot;&gt;struct&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
	grpc&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;ServerStream
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;var&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;_&lt;/span&gt; grpc&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;ServerStream &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;&amp;amp;&lt;/span&gt;wrappedSteam&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;func&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;w &lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt;wrappedSteam&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;RecvMsg&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;m &lt;span class=&quot;token keyword&quot;&gt;interface&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token builtin&quot;&gt;error&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
	log&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Printf&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;=====RecvMSg==== %T&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; m&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
	&lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; w&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;ServerStream&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;RecvMsg&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;m&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;func&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;w &lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt;wrappedSteam&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;SendMsg&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;m &lt;span class=&quot;token keyword&quot;&gt;interface&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token builtin&quot;&gt;error&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
	log&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Println&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;====SendMsg====&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; m&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
	&lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; w&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;ServerStream&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;SendMsg&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;m&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;func&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;newWrappedStream&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;s grpc&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;ServerStream&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; grpc&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;ServerStream &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
	&lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;&amp;amp;&lt;/span&gt;wrappedSteam&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;s&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;func&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;orderServerStreamInterceptor&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;srv &lt;span class=&quot;token keyword&quot;&gt;interface&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; ss grpc&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;ServerStream&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; info &lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt;grpc&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;StreamServerInfo&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; handler grpc&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;StreamHandler&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token builtin&quot;&gt;error&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
	log&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Println&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;===== [Server Steam Interceptor ]&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; info&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;FullMethod&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; 
	err &lt;span class=&quot;token operator&quot;&gt;:=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;handler&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;srv&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;newWrappedStream&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;ss&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
	&lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; err &lt;span class=&quot;token operator&quot;&gt;!=&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;nil&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
		log&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Fatalf&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;RPC failed with error %v&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; err&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
	&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
	&lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; err
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;func&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;main&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
	&lt;span class=&quot;token operator&quot;&gt;...&lt;/span&gt;
	s &lt;span class=&quot;token operator&quot;&gt;:=&lt;/span&gt; grpc&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;NewServer&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;grpc&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;StreamInterceptor&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;orderServerStreamInterceptor&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
	pb&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;RegisterOrderManagementServer&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;s&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;&amp;amp;&lt;/span&gt;server&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
	&lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; err &lt;span class=&quot;token operator&quot;&gt;:=&lt;/span&gt; s&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Serve&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;listen&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; err &lt;span class=&quot;token operator&quot;&gt;!=&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;nil&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
		&lt;span class=&quot;token function&quot;&gt;panic&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;err&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
	&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;在流开始时会进入 &lt;code class=&quot;language-text&quot;&gt;orderServerStreamInterceptor&lt;/code&gt; 方法，流结束后才会推出，在流每次 &lt;code class=&quot;language-text&quot;&gt;RecvMsg&lt;/code&gt; 时会进入到流拦截的 &lt;code class=&quot;language-text&quot;&gt;(w *wrappedSteam) RecvMsg&lt;/code&gt; 方法中，&lt;code class=&quot;language-text&quot;&gt;SendMsg&lt;/code&gt; 同理。&lt;/p&gt;
&lt;h5&gt;客户端拦截器&lt;/h5&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/dc07d75222f341085a962a66a82ecc2c/bf668/grpc-client-interceptor.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 60.12658227848101%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAIAAADtbgqsAAAACXBIWXMAAAsTAAALEwEAmpwYAAAB/0lEQVQoz3WSa2/TMBSG8/9/BkhcMjRRkGg3MSZglxa2wZo4dhK7TtqNrmnX3Bw7vsRD3aBDmni+HR09Oq9eHUdrffcEa+3iJhOifbrSf5FSOlm29LwgAMj3oO9BABAIQt+HFxfeeBx4IByDcOyjsQ89gCCMtfpzzBjjAB9d/gRpOkvoNADh82fu7pv3ISKEJGlydXQ0+tA/wCTBmCbp1Zevw7KsHuUwxEVRPsxNw3fc3v7eoRAtY41SKorI6bcfWquyqrUxAYyybBljUpYVF8KBML5drR/kumLu696g/4nVDRdcaw1hdHz6vZUt59wY43lwvS4YY0pppdRGzparVkou2qpmrtvbHxwqpfK8MMZgQk+GZ53pbte5tR0KcZ6Xj7E3crZqGs4Yr+rGdXt7G1kXRdkZExN6MjqztsvzwlqLEM6LraydIIhW29g127mP3TAupeyMgSg+Hp5JKdu27TpzuYmdN5wrpbTWDkJxvi62hbmv3g76B03Dy7IWQsAwPhmet63M80JJCYJwschiTIqiFEI4IAg9gK7n2a/5IsLJyxe773qDCZkmdDa7mh+PzgcfP0/S2SSdzq7np6OLqqq33+LMbxY+CD0feT6EMCKEEpzgmGJMMaF4kmBCY0IjQskkSdKplFIbbcx928vlijG2zJaUpg9lWGvv/o/9h9+C2YzsH6YUUgAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;grpc-client-interceptor&quot;
        title=&quot;grpc-client-interceptor&quot;
        src=&quot;/static/dc07d75222f341085a962a66a82ecc2c/f058b/grpc-client-interceptor.png&quot;
        srcset=&quot;/static/dc07d75222f341085a962a66a82ecc2c/c26ae/grpc-client-interceptor.png 158w,
/static/dc07d75222f341085a962a66a82ecc2c/6bdcf/grpc-client-interceptor.png 315w,
/static/dc07d75222f341085a962a66a82ecc2c/f058b/grpc-client-interceptor.png 630w,
/static/dc07d75222f341085a962a66a82ecc2c/40601/grpc-client-interceptor.png 945w,
/static/dc07d75222f341085a962a66a82ecc2c/78612/grpc-client-interceptor.png 1260w,
/static/dc07d75222f341085a962a66a82ecc2c/bf668/grpc-client-interceptor.png 2328w&quot;
        sizes=&quot;(max-width: 630px) 100vw, 630px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;一元拦截&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;一元拦截的函数签名：&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;go&quot;&gt;&lt;pre class=&quot;language-go&quot;&gt;&lt;code class=&quot;language-go&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;type&lt;/span&gt; UnaryClientInterceptor &lt;span class=&quot;token keyword&quot;&gt;func&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;ctx context&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;Context&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; method &lt;span class=&quot;token builtin&quot;&gt;string&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; req&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; reply &lt;span class=&quot;token keyword&quot;&gt;interface&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; cc &lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt;ClientConn&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; invoker UnaryInvoker&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; opts &lt;span class=&quot;token operator&quot;&gt;...&lt;/span&gt;CallOption&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token builtin&quot;&gt;error&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;与服务端拦截一元拦截器一样，客户端一元拦截器也有不同的阶段。&lt;/p&gt;
&lt;p&gt;例子：&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;go&quot;&gt;&lt;pre class=&quot;language-go&quot;&gt;&lt;code class=&quot;language-go&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;func&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;orderClientInterceptor&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;ctx context&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;Context&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; method &lt;span class=&quot;token builtin&quot;&gt;string&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; req&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; apply &lt;span class=&quot;token keyword&quot;&gt;interface&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; cc &lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt;grpc&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;ClientConn&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; invoker grpc&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;UnaryInvoker&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; opts &lt;span class=&quot;token operator&quot;&gt;...&lt;/span&gt;grpc&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;CallOption&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token builtin&quot;&gt;error&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
	log&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Println&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;Method :&quot;&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;+&lt;/span&gt; method&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
	start &lt;span class=&quot;token operator&quot;&gt;:=&lt;/span&gt; time&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Now&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
	err &lt;span class=&quot;token operator&quot;&gt;:=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;invoker&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;ctx&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; method&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; req&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; apply&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; cc&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; opts&lt;span class=&quot;token operator&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
	log&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Printf&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;cost is [%d]ms&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;time&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Now&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Sub&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;start&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Milliseconds&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
	&lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; err
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;func&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;main&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
	conn&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; err &lt;span class=&quot;token operator&quot;&gt;:=&lt;/span&gt; grpc&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Dial&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;address&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; grpc&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;WithInsecure&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;grpc&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;WithUnaryInterceptor&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;orderClientInterceptor&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;ul&gt;
&lt;li&gt;流拦截&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;go&quot;&gt;&lt;pre class=&quot;language-go&quot;&gt;&lt;code class=&quot;language-go&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;type&lt;/span&gt; StreamClientInterceptor &lt;span class=&quot;token keyword&quot;&gt;func&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;ctx context&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;Context&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; desc &lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt;StreamDesc&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; cc &lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt;ClientConn&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; method &lt;span class=&quot;token builtin&quot;&gt;string&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; streamer Streamer&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; opts &lt;span class=&quot;token operator&quot;&gt;...&lt;/span&gt;CallOption&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;ClientStream&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token builtin&quot;&gt;error&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;例子：&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;go&quot;&gt;&lt;pre class=&quot;language-go&quot;&gt;&lt;code class=&quot;language-go&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;type&lt;/span&gt; wrappedSteam &lt;span class=&quot;token keyword&quot;&gt;struct&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
	grpc&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;ClientStream
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;func&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;w &lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt;wrappedSteam&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;RecvMsg&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;m &lt;span class=&quot;token keyword&quot;&gt;interface&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token builtin&quot;&gt;error&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
	log&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Printf&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;===== [ Client Stream Interceptor ] Receive a message (Type :%T) at %v&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; m&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; time&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Now&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Format&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;time&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;RFC3339&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
	&lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; w&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;ClientStream&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;RecvMsg&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;m&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;func&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;w &lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt;wrappedSteam&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;SendMsg&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;m &lt;span class=&quot;token keyword&quot;&gt;interface&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token builtin&quot;&gt;error&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
	log&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Printf&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;===== [Client Stream Interceptor ] Send a message (Type :%T) at %v&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;m&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; time&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Now&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Format&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;time&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;RFC3339&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
	&lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; w&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;ClientStream&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;SendMsg&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;m&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;func&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;newWrappedStream&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;cs grpc&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;ClientStream&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; grpc&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;ClientStream &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
	&lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;&amp;amp;&lt;/span&gt;wrappedSteam&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;cs&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;func&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;orderClientStreamInterceptor&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;ctx context&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;Context&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; desc &lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt;grpc&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;StreamDesc&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; cc &lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt;grpc&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;ClientConn&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; method &lt;span class=&quot;token builtin&quot;&gt;string&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; streamer grpc&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;Streamer&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; opts &lt;span class=&quot;token operator&quot;&gt;...&lt;/span&gt;grpc&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;CallOption&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;grpc&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;ClientStream&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token builtin&quot;&gt;error&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
	log&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Println&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;===== [Client Interceptor] &quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;method&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
	s&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; err &lt;span class=&quot;token operator&quot;&gt;:=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;streamer&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;ctx&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; desc&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; cc&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; method&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; opts&lt;span class=&quot;token operator&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
	&lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;newWrappedStream&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;s&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; err
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;func&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;main&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
	conn&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; err &lt;span class=&quot;token operator&quot;&gt;:=&lt;/span&gt; grpc&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Dial&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;address&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; grpc&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;WithInsecure&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;grpc&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;WithStreamInterceptor&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;orderClientStreamInterceptor&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h4&gt;截止时间&lt;/h4&gt;</content:encoded></item><item><title><![CDATA[gRPC 学习之-初级知识]]></title><description><![CDATA[初级知识 1、进程间通信 同步请求的响应风格 异步请求的事件驱动风格 请求响应的风格最常见和传统的方式就是构建为RESTful 服务，但是，使用RESTful 服务来实现进程间通信显得过于笨重、低效并且容易出错。 2、进程间通信技术的演进 传统的RPC： 早期有一些流行的RPC…]]></description><link>https://lengrongfu.github.io/2021-12-25 gRPC 学习之初级知识/</link><guid isPermaLink="false">https://lengrongfu.github.io/2021-12-25 gRPC 学习之初级知识/</guid><pubDate>Sat, 25 Dec 2021 22:22:00 GMT</pubDate><content:encoded>&lt;h2&gt;初级知识&lt;/h2&gt;
&lt;h3&gt;1、进程间通信&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;同步请求的响应风格&lt;/li&gt;
&lt;li&gt;异步请求的事件驱动风格&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;请求响应的风格最常见和传统的方式就是构建为RESTful 服务，但是，使用RESTful 服务来实现进程间通信显得过于笨重、低效并且容易出错。&lt;/p&gt;
&lt;h3&gt;2、进程间通信技术的演进&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;传统的RPC：&lt;/li&gt;
&lt;/ul&gt;
&lt;blockquote&gt;
&lt;p&gt;早期有一些流行的RPC实现，比如通用对象请求代理体系结构CORBA和 Java 的远程调用(remot method invocation, RMI)；但是，他们的实现极其复杂，因为他们是构建在TCP这样的通信协议之上。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;ul&gt;
&lt;li&gt;SOAP&lt;/li&gt;
&lt;/ul&gt;
&lt;blockquote&gt;
&lt;p&gt;鉴于CORBA等传统RPC实现的局限性，简单对象访问协议（SOAP）就产生了，SOAP是面向服务的架构（SOA）中的标准通信技术，能够基于任意的底层通信协议进行通信，其中最常用的就是HTTP。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;ul&gt;
&lt;li&gt;RESTFul&lt;/li&gt;
&lt;/ul&gt;
&lt;blockquote&gt;
&lt;p&gt;描述性状态迁移 (REST) 是面向资源的架构的基础，在这种架构中，需要将分布式应用程序建模为资源集合，访问这些资源的客户端可以变更这些资源的状态（创建、修改、删除）。RUST 的通用实现是 HTTP。&lt;/p&gt;
&lt;p&gt;随着微服务的数量及其网络交互的激增，RESTFul 服务已经无法慢煮现代化的需求了，下面介绍 3 个主要的局限性：&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;基于文本的低效消息协议：RESTFul 服务建立在基于文本的传输协议之上，并且会使用人类可读的文本格式，如 JSON。&lt;/li&gt;
&lt;li&gt;应用程序之间缺乏强类型接口：越来越多的服务要通过网络进行交互，而且这些服务使用完全不同的语言来构建，缺乏明确定义和强类型的服务接口成了使用RESTFul 服务的主要障碍。&lt;/li&gt;
&lt;li&gt;REST 架构风格难以强制实施：REST 架构风格有很多好的实践，只有遵循这些实践，才能构建出真正的 RESTFul 服务；但是，由于没有作为实现协议（如：HTTP）的一部分强制要求，因此，在实践阶段，这些实践难以实施。&lt;/li&gt;
&lt;/ol&gt;
&lt;/blockquote&gt;
&lt;h3&gt;3、gRPC 的起源&lt;/h3&gt;
&lt;p&gt;来源于 Google 的 Stubby 的通用 RPC 框架。2015 年 Google 发布了 Stubby 的社区版本 gRPC 框架，并捐献给了 CNCF 社区。&lt;/p&gt;
&lt;h3&gt;4、gRPC 的优势&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;提供高效的进程间通信。&lt;/li&gt;
&lt;/ul&gt;
&lt;blockquote&gt;
&lt;ol&gt;
&lt;li&gt;gRPC 没有使用类似 JSON 、 XML 之类的文本传输协议，而是采用自定义的  &lt;code class=&quot;language-text&quot;&gt;protocol buffers &lt;/code&gt; 的二进制协议。&lt;/li&gt;
&lt;li&gt;gRPC 在 HTTP/2 上实现了 protocol buffers 的协议。&lt;/li&gt;
&lt;/ol&gt;
&lt;/blockquote&gt;
&lt;ul&gt;
&lt;li&gt;具有简单且定义良好的服务接口和模式&lt;/li&gt;
&lt;/ul&gt;
&lt;blockquote&gt;
&lt;p&gt;gRPC 为应用提供了必须先定义接口，才能去处理细节的要求，gRPC 为应用提供了简单但一致，可靠且可扩展的应用程序。&lt;/p&gt;
&lt;p&gt;解决了类似 REST 模式需要遵循好的架构风格实践，才能构建出真正的 RESTFul 服务，但是 gRPC 自带类似的好的架构风格。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;ul&gt;
&lt;li&gt;属于强类型&lt;/li&gt;
&lt;/ul&gt;
&lt;blockquote&gt;
&lt;p&gt;通过定义应用服务之间通信所使用的类型，对于其所产生的大多数运行时错误和互操作错误，可以通过静态类型来克服。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;ul&gt;
&lt;li&gt;支持多语言&lt;/li&gt;
&lt;/ul&gt;
&lt;blockquote&gt;
&lt;p&gt;gRPC 支持多语言，基于 protocol buffers 定义的服务时语言中立的。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;ul&gt;
&lt;li&gt;支持双工流&lt;/li&gt;
&lt;/ul&gt;
&lt;blockquote&gt;
&lt;p&gt;gRPC 客户端和服务端都提供了对流的原生支持。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;ul&gt;
&lt;li&gt;具备内置的商业化特性&lt;/li&gt;
&lt;/ul&gt;
&lt;blockquote&gt;
&lt;p&gt;gRPC 提供了商业化特性的内置支持，如&lt;strong&gt;认证、加密、弹性、元数据交换、压缩、负载均衡、服务发现&lt;/strong&gt;等。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;ul&gt;
&lt;li&gt;与云原生系统进行了集成&lt;/li&gt;
&lt;/ul&gt;
&lt;blockquote&gt;
&lt;p&gt;gRPC 是 CNCF 的一部分，大多数框架和技术都对 gRPC 提供了原生的支持。&lt;/p&gt;
&lt;p&gt;同时提供了丰富的应用性能监控工具。如 metrics、tracing、logging。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h3&gt;5、gRPC 的劣势&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;gRPC 不太适合面向外部的服务&lt;/li&gt;
&lt;/ul&gt;
&lt;blockquote&gt;
&lt;p&gt;gRPC 服务具有契约精神、强类型等特点，会限制暴露外部服务的灵活性，同时消费者的控制权会削弱很多。gRPC 网关是克服该问题的解决方案。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;ul&gt;
&lt;li&gt;大的服务变更是复杂的开发流程&lt;/li&gt;
&lt;/ul&gt;
&lt;blockquote&gt;
&lt;p&gt;gRPC 服务出现变更，需要重新生成客户端和服务端代码。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;ul&gt;
&lt;li&gt;gRPC 系统相对较小&lt;/li&gt;
&lt;/ul&gt;
&lt;blockquote&gt;
&lt;p&gt;与 REST 和 HTTP 等协议相比，gRPC 的生态系统相对较小。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h3&gt;6、gRPC 基本使用&lt;/h3&gt;</content:encoded></item><item><title><![CDATA[gRPC 学习之-中级知识]]></title><description><![CDATA[中级知识 借助 gRPC 可以实现不同的进程间通信模式（也称RPC风格）；本章将讨论 gRPC 应用的四种通信模式，一元RPC、服务端流RPC、客户端流RPC、以及双向RPC。 一元RPC 一元RPC：一元RPC模式也被称为简单RPC…]]></description><link>https://lengrongfu.github.io/2021-12-30 gRPC 学习之中级知识/</link><guid isPermaLink="false">https://lengrongfu.github.io/2021-12-30 gRPC 学习之中级知识/</guid><pubDate>Sat, 25 Dec 2021 22:22:00 GMT</pubDate><content:encoded>&lt;h2&gt;中级知识&lt;/h2&gt;
&lt;p&gt;借助 gRPC 可以实现不同的进程间通信模式（也称RPC风格）；本章将讨论 gRPC 应用的四种通信模式，一元RPC、服务端流RPC、客户端流RPC、以及双向RPC。&lt;/p&gt;
&lt;h3&gt;一元RPC&lt;/h3&gt;
&lt;p&gt;一元RPC：一元RPC模式也被称为简单RPC模式，当客户端调用服务端的远程方法时，客户端发送请求到服务端并获得一个响应，与响应一起发送还有元数据。&lt;/p&gt;
&lt;h3&gt;服务器端流 RPPC 模式&lt;/h3&gt;
&lt;p&gt;一元RPC模式：gRPC 服务器端和 gRPC 客户端在通信时始终只有一个请求和一个响应。
服务器端流 RPC 模式：gRPC 服务器端在接收到客户端的请求消息后，会发回一个响应序列（简单说就是会发回多个响应）。这种多个响应所组成的序列也被称为流。&lt;/p&gt;
&lt;p&gt;例如：&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;在 OrderManagement 服务中，假设需要实现一个订单搜索功能；利用服务器端流 gRPC 模式时 OrderManagement 服务不会将所有匹配的订单一次性的发送给客户端，而是在找到匹配的订单时，逐步将其发送出去。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/27fc9ff7fae6a0d78cdd6f4e0e20ba80/ca3c3/grpc-server-stream.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 37.9746835443038%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAIAAAB2/0i6AAAACXBIWXMAAAsTAAALEwEAmpwYAAABeklEQVQY0z2QWU/CQBRG+e2S8KBxi+iLgahR44txBRFXTEwMoC0grWxlKbTQYaYUlC6zmbbKeZq5mTO53xdBaFIqy2JJEsVqq9XFPgRjsmBxrjWUwnu5+F4uFIQxgJ7nRZpKL5E4im/txncSN5knxjjnnDFOKWUB/J/Ti3QsthpdWo5GVySpyTmPtNvqXvL4YP8kmTi8zTyHjykhU2s2Ma3pdEYwCeWLy8zaanxjfXtlebP2Fciqqt1ln58eXx7uc/m3DxrAGLUdt90Z2nOXMX8FD+Nc7jV1lU1dZ8/P0orS9WVdHwEDAgAta1at1tpKFyETADAyQL+vQ2giZELTVAeaJDcQmui6oWnDnjrw5fEYiWJFECrCR0Wq1j0PBzmZ7XjN5qBeV7URcl1/KMuNYrFULIj5vDAygC+HeWzHwUE2xhghlBB/eULIxPru9Y2fuROWhzG25zaljFLqum5kDKAs18ufNVXVW60OhKZf2F/VNPw6NBf9/9/oL5wUroIOo73RAAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;grpc-server-stream&quot;
        title=&quot;grpc-server-stream&quot;
        src=&quot;/static/27fc9ff7fae6a0d78cdd6f4e0e20ba80/f058b/grpc-server-stream.png&quot;
        srcset=&quot;/static/27fc9ff7fae6a0d78cdd6f4e0e20ba80/c26ae/grpc-server-stream.png 158w,
/static/27fc9ff7fae6a0d78cdd6f4e0e20ba80/6bdcf/grpc-server-stream.png 315w,
/static/27fc9ff7fae6a0d78cdd6f4e0e20ba80/f058b/grpc-server-stream.png 630w,
/static/27fc9ff7fae6a0d78cdd6f4e0e20ba80/40601/grpc-server-stream.png 945w,
/static/27fc9ff7fae6a0d78cdd6f4e0e20ba80/78612/grpc-server-stream.png 1260w,
/static/27fc9ff7fae6a0d78cdd6f4e0e20ba80/ca3c3/grpc-server-stream.png 1850w&quot;
        sizes=&quot;(max-width: 630px) 100vw, 630px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;grpc server&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;go&quot;&gt;&lt;pre class=&quot;language-go&quot;&gt;&lt;code class=&quot;language-go&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;func&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;s &lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt;server&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;SearchOrders&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;searchQuery &lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt;wrappers&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;StringValue&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;stream pb&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;OrderManagement_SearchOrdersServer&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token builtin&quot;&gt;error&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
	&lt;span class=&quot;token keyword&quot;&gt;for&lt;/span&gt; key&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; order &lt;span class=&quot;token operator&quot;&gt;:=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;range&lt;/span&gt; orderMap &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
		log&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Print&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;key&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; order&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
		&lt;span class=&quot;token keyword&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;_&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; itemStr &lt;span class=&quot;token operator&quot;&gt;:=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;range&lt;/span&gt; order&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;Items &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
			log&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Print&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;itemStr&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
			&lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; strings&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Contains&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;itemStr&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; searchQuery&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;Value&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
				&lt;span class=&quot;token comment&quot;&gt;// Send the matching orders in a stream&lt;/span&gt;
				err &lt;span class=&quot;token operator&quot;&gt;:=&lt;/span&gt; stream&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Send&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&amp;amp;&lt;/span&gt;order&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
				&lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; err &lt;span class=&quot;token operator&quot;&gt;!=&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;nil&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
					&lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; fmt&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Errorf&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;error sending message to stream : %v&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; err&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
				&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
				log&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Print&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;Matching Order Found : &quot;&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;+&lt;/span&gt; key&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
				&lt;span class=&quot;token keyword&quot;&gt;break&lt;/span&gt;
			&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
		&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
	&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
	&lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;nil&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;ul&gt;
&lt;li&gt;grpc clinet&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;go&quot;&gt;&lt;pre class=&quot;language-go&quot;&gt;&lt;code class=&quot;language-go&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;func&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;main&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token operator&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;
    searchStream&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; 	&lt;span class=&quot;token boolean&quot;&gt;_&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;:=&lt;/span&gt; client&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;SearchOrders&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;ctx&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;&amp;amp;&lt;/span&gt;wrappers&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;StringValue&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;Value&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;Google&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
	&lt;span class=&quot;token keyword&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
		searchOrder&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; err &lt;span class=&quot;token operator&quot;&gt;:=&lt;/span&gt; searchStream&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Recv&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
		&lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; err &lt;span class=&quot;token operator&quot;&gt;==&lt;/span&gt; io&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;EOF &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
			log&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Print&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;EOF&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
			&lt;span class=&quot;token keyword&quot;&gt;break&lt;/span&gt;
		&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

		&lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; err &lt;span class=&quot;token operator&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;nil&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
			log&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Print&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;Search Result : &quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; searchOrder&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
		&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
	&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;token operator&quot;&gt;...&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;上述就是 &lt;code class=&quot;language-text&quot;&gt;gRPC&lt;/code&gt; 服务器端流模式，服务在检索到订单时，通过以流的形式发送给客户端 &lt;code class=&quot;language-text&quot;&gt;err := stream.Send(&amp;amp;order)&lt;/code&gt; ; 客户端在调用时，返回一个客户端流，它有一个 &lt;code class=&quot;language-text&quot;&gt;Recv&lt;/code&gt; 方法，调用客户端的 &lt;code class=&quot;language-text&quot;&gt;Recv&lt;/code&gt; 方法，可以逐个读取服务端写入的数据。当发现流结束时， &lt;code class=&quot;language-text&quot;&gt;Recv&lt;/code&gt; 会返回 &lt;code class=&quot;language-text&quot;&gt;io.EOF&lt;/code&gt;。&lt;/p&gt;
&lt;h3&gt;客户端流 RPC 模式&lt;/h3&gt;
&lt;p&gt;客户端流RPC模式：客户端会发起多个请求给服务端，而不再是单个请求，服务器端则会发送一个响应给客户端。但是，服务端不一定要等到从客户端接受到所有消息后才发送响应。&lt;/p&gt;
&lt;p&gt;例如：&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;在 OrderManagement 服务中希望添加 updateOrders 方法，从而更新一个订单集合。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/e1d7a8a2ac0462cbea1e2e9aa4c9cd52/81ebd/grpc-client-stream.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 38.60759493670886%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAIAAAB2/0i6AAAACXBIWXMAAAsTAAALEwEAmpwYAAABdUlEQVQY002R20vCUBzH93fXQ0FQFHSlB30JLLpg9RBJIZEvdjedTh3Z1Lm1uZ2dbV4qtJ3LL84U6wsHzvfwu36O5Ae9WlVTqlpFadg24pwRQimljDEai8R++PlVKteLZaUkK2/vrZ8oIiSSmi0jtXeWTBwnE+mnxzIAcM7ZVKIE5xwAXNdbW91ZXFiZn1vaT51wzimlUls3jw4uTtO3+6nrwksVYoW9AfKCfr8/Ho8YYwCAEN7eSmys764sbx4dnk+TTct5uC8+PVfzd7KqNpnoSrE/7JjYsPy2icc/EQDobSNzmb26uslksrlcnoi9qGS7HnI9hDyEA1V9dxHy/SAMQ+Rh0+raXdfD2MdYlpVWU7dtx3FQ400bjUacMyno9dWaJpjVNNN0AGAyZzj4ttzezA6Hn6Vi5bVQei3Iar0xISIxEDwIoywGQ2lMSRzGOROWTuGLMEIml0jQJpIfhm3daOlGx7LND1uwjjXB/c/NvuDv/Re38LExsOZTMAAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;grpc client stream&quot;
        title=&quot;grpc client stream&quot;
        src=&quot;/static/e1d7a8a2ac0462cbea1e2e9aa4c9cd52/f058b/grpc-client-stream.png&quot;
        srcset=&quot;/static/e1d7a8a2ac0462cbea1e2e9aa4c9cd52/c26ae/grpc-client-stream.png 158w,
/static/e1d7a8a2ac0462cbea1e2e9aa4c9cd52/6bdcf/grpc-client-stream.png 315w,
/static/e1d7a8a2ac0462cbea1e2e9aa4c9cd52/f058b/grpc-client-stream.png 630w,
/static/e1d7a8a2ac0462cbea1e2e9aa4c9cd52/40601/grpc-client-stream.png 945w,
/static/e1d7a8a2ac0462cbea1e2e9aa4c9cd52/78612/grpc-client-stream.png 1260w,
/static/e1d7a8a2ac0462cbea1e2e9aa4c9cd52/81ebd/grpc-client-stream.png 1868w&quot;
        sizes=&quot;(max-width: 630px) 100vw, 630px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;grpc server : 如下方法定义了一个服务端接收客户端流的方法&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;go&quot;&gt;&lt;pre class=&quot;language-go&quot;&gt;&lt;code class=&quot;language-go&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;func&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;s &lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt;server&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;UpdateOrders&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;stream pb&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;OrderManagement_UpdateOrdersServer&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token builtin&quot;&gt;error&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
	ordersStr &lt;span class=&quot;token operator&quot;&gt;:=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;Updated Order IDs : &quot;&lt;/span&gt;
	&lt;span class=&quot;token keyword&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
		order&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; err &lt;span class=&quot;token operator&quot;&gt;:=&lt;/span&gt; stream&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Recv&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
		&lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; err &lt;span class=&quot;token operator&quot;&gt;==&lt;/span&gt; io&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;EOF &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
			&lt;span class=&quot;token comment&quot;&gt;// 客户端发送完流数据&lt;/span&gt;
			&lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; stream&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;SendAndClose&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&amp;amp;&lt;/span&gt;wrappers&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;StringValue&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;Value&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;Orders processed &quot;&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;+&lt;/span&gt; ordersStr&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
		&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

		&lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; err &lt;span class=&quot;token operator&quot;&gt;!=&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;nil&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
			&lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; err
		&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
		&lt;span class=&quot;token comment&quot;&gt;// Update order&lt;/span&gt;
		orderMap&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;order&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;Id&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt;order

		log&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Printf&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;Order ID : %s - %s&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; order&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;Id&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;Updated&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
		ordersStr &lt;span class=&quot;token operator&quot;&gt;+=&lt;/span&gt; order&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;Id &lt;span class=&quot;token operator&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;, &quot;&lt;/span&gt;
	&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;ul&gt;
&lt;li&gt;grpc client&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;go&quot;&gt;&lt;pre class=&quot;language-go&quot;&gt;&lt;code class=&quot;language-go&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;func&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;main&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token operator&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;省略
    &lt;span class=&quot;token comment&quot;&gt;// =========================================&lt;/span&gt;
	&lt;span class=&quot;token comment&quot;&gt;// Update Orders : Client streaming scenario&lt;/span&gt;
	updOrder1 &lt;span class=&quot;token operator&quot;&gt;:=&lt;/span&gt; pb&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;Order&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;Id&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;102&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; Items&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token builtin&quot;&gt;string&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;Google Pixel 3A&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;Google Pixel Book&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; Destination&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;Mountain View, CA&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; Price&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1100.00&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
	updOrder2 &lt;span class=&quot;token operator&quot;&gt;:=&lt;/span&gt; pb&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;Order&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;Id&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;103&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; Items&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token builtin&quot;&gt;string&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;Apple Watch S4&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;Mac Book Pro&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;iPad Pro&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; Destination&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;San Jose, CA&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; Price&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;2800.00&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
	updOrder3 &lt;span class=&quot;token operator&quot;&gt;:=&lt;/span&gt; pb&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;Order&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;Id&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;104&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; Items&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token builtin&quot;&gt;string&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;Google Home Mini&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;Google Nest Hub&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;iPad Mini&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; Destination&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;Mountain View, CA&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; Price&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;2200.00&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

	updateStream&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; err &lt;span class=&quot;token operator&quot;&gt;:=&lt;/span&gt; client&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;UpdateOrders&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;ctx&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;

	&lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; err &lt;span class=&quot;token operator&quot;&gt;!=&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;nil&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
		log&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Fatalf&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;%v.UpdateOrders(_) = _, %v&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; client&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; err&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
	&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

	&lt;span class=&quot;token comment&quot;&gt;// Updating order 1&lt;/span&gt;
	&lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; err &lt;span class=&quot;token operator&quot;&gt;:=&lt;/span&gt; updateStream&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Send&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&amp;amp;&lt;/span&gt;updOrder1&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; err &lt;span class=&quot;token operator&quot;&gt;!=&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;nil&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
		log&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Fatalf&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;%v.Send(%v) = %v&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; updateStream&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; updOrder1&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; err&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
	&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

	&lt;span class=&quot;token comment&quot;&gt;// Updating order 2&lt;/span&gt;
	&lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; err &lt;span class=&quot;token operator&quot;&gt;:=&lt;/span&gt; updateStream&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Send&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&amp;amp;&lt;/span&gt;updOrder2&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; err &lt;span class=&quot;token operator&quot;&gt;!=&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;nil&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
		log&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Fatalf&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;%v.Send(%v) = %v&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; updateStream&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; updOrder2&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; err&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
	&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

	&lt;span class=&quot;token comment&quot;&gt;// Updating order 3&lt;/span&gt;
	&lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; err &lt;span class=&quot;token operator&quot;&gt;:=&lt;/span&gt; updateStream&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Send&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&amp;amp;&lt;/span&gt;updOrder3&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; err &lt;span class=&quot;token operator&quot;&gt;!=&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;nil&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
		log&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Fatalf&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;%v.Send(%v) = %v&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; updateStream&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; updOrder3&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; err&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
	&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

	updateRes&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; err &lt;span class=&quot;token operator&quot;&gt;:=&lt;/span&gt; updateStream&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;CloseAndRecv&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
	&lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; err &lt;span class=&quot;token operator&quot;&gt;!=&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;nil&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
		log&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Fatalf&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;%v.CloseAndRecv() got error %v, want %v&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; updateStream&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; err&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;nil&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
	&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
	log&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Printf&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;Update Orders Res : %s&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; updateRes&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;

&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;客户端以流的形式发送&lt;code class=&quot;language-text&quot;&gt;updateStream.Send(&amp;amp;updOrder2)&lt;/code&gt;给服务端，一旦所有消息都以流的形式发送出去，客户端就可以将流标记为已完成，并通过 &lt;code class=&quot;language-text&quot;&gt;CloseAndRecv&lt;/code&gt; 方法来读取服务端的响应。&lt;/p&gt;
&lt;h3&gt;双向流 RPC 模式&lt;/h3&gt;
&lt;p&gt;双向流RPC模式：客户端以消息流的形式发送请求到服务器端，服务器端也以消息流的形式进行响应。调用必须由客户端发起，但在此之后，通信完全基于 gRPC 客户端和服务器端的应用程序逻辑。&lt;/p&gt;
&lt;p&gt;例如：&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;在 OrderManagement 服务中，假设需要一个订单处理功能，通过该功能，用户可以发送连续的订单集合，并根据投递地址对它们进行组合发货。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/eda84444fa6e8513ced7d10c96265f38/1f6b7/grpc-double-stream.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 40.50632911392405%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAIAAAB2/0i6AAAACXBIWXMAAAsTAAALEwEAmpwYAAABlklEQVQY02WRSW/TUACE/f8JcAgItQlpBQgQSFxQE7VKihBqKTRr2zjx7mc7Trwlfvazjd+KmnDj02hGmsscRsIYZ3luAU+3PdVygx0sa1pVGFOKCa0J+UNIVdcVxuZqszSAZjm241dVTSmRhBA28E46H46PTlutt6PZgglBMM1QCVGBirImlHJOhfj45exJo9loNDud9wWqOOcS50LXneOj03brzauX7V/DuwLzJMqCMA2TNIzTGOZbiCosPn3++qzRfP70xev2O4RKxpjEmADA73YH5+ffet3L0VR2/NhbRZsw9YKtH6VukLjreBXsLi6vznqDbm9w0f+eo4IzJnHOV36oWZ5lry2wuboZzxVTUe2FZhvOemm4sg5MN5A18HMyN92NAXxFs7MMCS4kRtl2ByfT+e3w7nZ077gB8IJ+/8dwfB/v8uub2fXvWbLNwwSquj2ePExn8lIxMCbssCz2HJIIgQkPI4jKmgmRQgQzJP6Dc04plVzPD8LoQVZV01koJkQFppSQf2J7KH2syN4O0McH+F8l8avRBBmqyQAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;grpc-double-stream&quot;
        title=&quot;grpc-double-stream&quot;
        src=&quot;/static/eda84444fa6e8513ced7d10c96265f38/f058b/grpc-double-stream.png&quot;
        srcset=&quot;/static/eda84444fa6e8513ced7d10c96265f38/c26ae/grpc-double-stream.png 158w,
/static/eda84444fa6e8513ced7d10c96265f38/6bdcf/grpc-double-stream.png 315w,
/static/eda84444fa6e8513ced7d10c96265f38/f058b/grpc-double-stream.png 630w,
/static/eda84444fa6e8513ced7d10c96265f38/40601/grpc-double-stream.png 945w,
/static/eda84444fa6e8513ced7d10c96265f38/78612/grpc-double-stream.png 1260w,
/static/eda84444fa6e8513ced7d10c96265f38/1f6b7/grpc-double-stream.png 1909w&quot;
        sizes=&quot;(max-width: 630px) 100vw, 630px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;这个业务用例的关键步骤如下所示：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;每个订单以独立的 gRPC 消息的形式发送至服务器端。&lt;/li&gt;
&lt;li&gt;每个发货组合可能会包含多个订单，它们应该被投递到相同的目的地。&lt;/li&gt;
&lt;li&gt;订单是成批处理的，当达到指定的批次大小时，当前创建的所有发货组合都会被发送至客户端。&lt;/li&gt;
&lt;li&gt;假设：流中有4个订单，其中有两个订单要发送至X，两个要发送至Y，则可以将其表示为：X、Y、X、Y。如果批次大小为3，那么所创建的订单发货组合会是[X，X],[Y],[Y]。&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;gRpc Server：主要逻辑就是通过客户端发送过来的订单ID按照指定批次大小以及发货地址进行分组，再把分组后的信息返回给客户端。&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;go&quot;&gt;&lt;pre class=&quot;language-go&quot;&gt;&lt;code class=&quot;language-go&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; orderBatchSize &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;3&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;func&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;s &lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt;server&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;ProcessOrders&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;stream pb&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;OrderManagement_ProcessOrdersServer&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token builtin&quot;&gt;error&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
	batchMarker &lt;span class=&quot;token operator&quot;&gt;:=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;
	&lt;span class=&quot;token keyword&quot;&gt;var&lt;/span&gt; combinedShipmentMap &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;make&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;map&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token builtin&quot;&gt;string&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;pb&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;CombinedShipment&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
	&lt;span class=&quot;token keyword&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
		orderId&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; err &lt;span class=&quot;token operator&quot;&gt;:=&lt;/span&gt; stream&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Recv&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
		log&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Printf&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;Reading Proc order : %s&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; orderId&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
		&lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; err &lt;span class=&quot;token operator&quot;&gt;==&lt;/span&gt; io&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;EOF &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
			&lt;span class=&quot;token comment&quot;&gt;// 客户端发送关闭时，需要把服务端已经接收到的进行发送&lt;/span&gt;
			log&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Printf&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;EOF : %s&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; orderId&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
			&lt;span class=&quot;token keyword&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;_&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; shipment &lt;span class=&quot;token operator&quot;&gt;:=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;range&lt;/span&gt; combinedShipmentMap &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
				&lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; err &lt;span class=&quot;token operator&quot;&gt;:=&lt;/span&gt; stream&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Send&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&amp;amp;&lt;/span&gt;shipment&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; err &lt;span class=&quot;token operator&quot;&gt;!=&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;nil&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
					&lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; err
				&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
			&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
			&lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;nil&lt;/span&gt;
		&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
		&lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; err &lt;span class=&quot;token operator&quot;&gt;!=&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;nil&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
			log&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Println&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;err&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
			&lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; err
		&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

		destination &lt;span class=&quot;token operator&quot;&gt;:=&lt;/span&gt; orderMap&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;orderId&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;GetValue&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;Destination
		shipment&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; found &lt;span class=&quot;token operator&quot;&gt;:=&lt;/span&gt; combinedShipmentMap&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;destination&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;

		&lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; found &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
			ord &lt;span class=&quot;token operator&quot;&gt;:=&lt;/span&gt; orderMap&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;orderId&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;GetValue&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;
			shipment&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;OrdersList &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;append&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;shipment&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;OrdersList&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;&amp;amp;&lt;/span&gt;ord&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
			combinedShipmentMap&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;destination&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; shipment
		&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
			comShip &lt;span class=&quot;token operator&quot;&gt;:=&lt;/span&gt; pb&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;CombinedShipment&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;Id&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;cmb - &quot;&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;orderMap&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;orderId&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;GetValue&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;Destination&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; Status&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;Processed!&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
			ord &lt;span class=&quot;token operator&quot;&gt;:=&lt;/span&gt; orderMap&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;orderId&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;GetValue&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;
			comShip&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;OrdersList &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;append&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;shipment&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;OrdersList&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;&amp;amp;&lt;/span&gt;ord&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
			combinedShipmentMap&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;destination&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; comShip
			log&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Print&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;len&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;comShip&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;OrdersList&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; comShip&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;GetId&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
		&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

		&lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; batchMarker &lt;span class=&quot;token operator&quot;&gt;==&lt;/span&gt; orderBatchSize &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
			&lt;span class=&quot;token keyword&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;_&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; comb &lt;span class=&quot;token operator&quot;&gt;:=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;range&lt;/span&gt; combinedShipmentMap &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
				log&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Printf&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;Shipping : %v -&gt; %v&quot;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; comb&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;Id&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;len&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;comb&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;OrdersList&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
				&lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; err &lt;span class=&quot;token operator&quot;&gt;:=&lt;/span&gt; stream&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Send&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&amp;amp;&lt;/span&gt;comb&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; err &lt;span class=&quot;token operator&quot;&gt;!=&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;nil&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
					&lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; err
				&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
			&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
			batchMarker &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;
			combinedShipmentMap &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;make&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;map&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token builtin&quot;&gt;string&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;pb&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;CombinedShipment&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
		&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
			batchMarker&lt;span class=&quot;token operator&quot;&gt;++&lt;/span&gt;
		&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
	&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;gRpc Client：主要逻辑就是发送订单ID给服务端，之后开启 Go协程来读取服务端返回的消息。&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;go&quot;&gt;&lt;pre class=&quot;language-go&quot;&gt;&lt;code class=&quot;language-go&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;func&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;main&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token operator&quot;&gt;...&lt;/span&gt;
    &lt;span class=&quot;token comment&quot;&gt;// =========================================&lt;/span&gt;
	&lt;span class=&quot;token comment&quot;&gt;// Process Order : Bi-di streaming scenario&lt;/span&gt;
	streamProcOrder&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; err &lt;span class=&quot;token operator&quot;&gt;:=&lt;/span&gt; client&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;ProcessOrders&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;ctx&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
	&lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; err &lt;span class=&quot;token operator&quot;&gt;!=&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;nil&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
		log&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Fatalf&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;%v.ProcessOrders(_) = _, %v&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; client&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; err&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
	&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

	&lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; err &lt;span class=&quot;token operator&quot;&gt;:=&lt;/span&gt; streamProcOrder&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Send&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&amp;amp;&lt;/span&gt;wrappers&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;StringValue&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;Value&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;102&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; err &lt;span class=&quot;token operator&quot;&gt;!=&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;nil&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
		log&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Fatalf&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;%v.Send(%v) = %v&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; client&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;102&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; err&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
	&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

	&lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; err &lt;span class=&quot;token operator&quot;&gt;:=&lt;/span&gt; streamProcOrder&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Send&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&amp;amp;&lt;/span&gt;wrappers&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;StringValue&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;Value&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;103&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; err &lt;span class=&quot;token operator&quot;&gt;!=&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;nil&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
		log&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Fatalf&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;%v.Send(%v) = %v&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; client&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;103&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; err&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
	&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

	&lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; err &lt;span class=&quot;token operator&quot;&gt;:=&lt;/span&gt; streamProcOrder&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Send&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&amp;amp;&lt;/span&gt;wrappers&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;StringValue&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;Value&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;104&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; err &lt;span class=&quot;token operator&quot;&gt;!=&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;nil&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
		log&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Fatalf&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;%v.Send(%v) = %v&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; client&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;104&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; err&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
	&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

	&lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; err &lt;span class=&quot;token operator&quot;&gt;:=&lt;/span&gt; streamProcOrder&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Send&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&amp;amp;&lt;/span&gt;wrappers&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;StringValue&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;Value&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;101&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; err &lt;span class=&quot;token operator&quot;&gt;!=&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;nil&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
		log&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Fatalf&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;%v.Send(%v) = %v&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; client&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;101&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; err&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
	&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

    channel &lt;span class=&quot;token operator&quot;&gt;:=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;make&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;chan&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;struct&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
	&lt;span class=&quot;token keyword&quot;&gt;go&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;asncClientBidirectionalRPC&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;streamProcOrder&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; channel&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
	
	&lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; err &lt;span class=&quot;token operator&quot;&gt;:=&lt;/span&gt; streamProcOrder&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;CloseSend&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; err &lt;span class=&quot;token operator&quot;&gt;!=&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;nil&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
		log&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Fatal&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;err&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
	&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
	channel &lt;span class=&quot;token operator&quot;&gt;&amp;lt;-&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;struct&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;func&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;asncClientBidirectionalRPC&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;streamProcOrder pb&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;OrderManagement_ProcessOrdersClient&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; c &lt;span class=&quot;token keyword&quot;&gt;chan&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;struct&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
	&lt;span class=&quot;token keyword&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
		combinedShipment&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; errProcOrder &lt;span class=&quot;token operator&quot;&gt;:=&lt;/span&gt; streamProcOrder&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Recv&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
		&lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; errProcOrder &lt;span class=&quot;token operator&quot;&gt;==&lt;/span&gt; io&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;EOF &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;token comment&quot;&gt;// 判断服务端流是否结束；服务端方法只要有return就意味着流结束流了，可能是因为正常结束，也可能是错误导致结束，总之只要return之后双向流就断开了。&lt;/span&gt;
			&lt;span class=&quot;token keyword&quot;&gt;break&lt;/span&gt;
		&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
		log&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Printf&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;Combined shipment : &quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; combinedShipment&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;OrdersList&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
	&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
	&lt;span class=&quot;token operator&quot;&gt;&amp;lt;-&lt;/span&gt;c
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;在双向流中可以通过定义客户端流和服务端流的方式来实现，客户端和服务端都定义了 &lt;code class=&quot;language-text&quot;&gt;Send&lt;/code&gt; 和 &lt;code class=&quot;language-text&quot;&gt;Recv&lt;/code&gt; 方法。可以实现双向传输。&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;go&quot;&gt;&lt;pre class=&quot;language-go&quot;&gt;&lt;code class=&quot;language-go&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;// 客户端流&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;type&lt;/span&gt; OrderManagement_ProcessOrdersClient &lt;span class=&quot;token keyword&quot;&gt;interface&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
	&lt;span class=&quot;token function&quot;&gt;Send&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt;wrappers&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;StringValue&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token builtin&quot;&gt;error&lt;/span&gt;
	&lt;span class=&quot;token function&quot;&gt;Recv&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt;CombinedShipment&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token builtin&quot;&gt;error&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
	grpc&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;ClientStream
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;token comment&quot;&gt;// 服务端流&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;type&lt;/span&gt; OrderManagement_ProcessOrdersServer &lt;span class=&quot;token keyword&quot;&gt;interface&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
	&lt;span class=&quot;token function&quot;&gt;Send&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt;CombinedShipment&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token builtin&quot;&gt;error&lt;/span&gt;
	&lt;span class=&quot;token function&quot;&gt;Recv&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt;wrappers&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;StringValue&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token builtin&quot;&gt;error&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
	grpc&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;ServerStream
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;客户端可以并发读取和写入同一个流，输入流和输出流可以独立进行操作。&lt;/p&gt;</content:encoded></item><item><title><![CDATA[启航]]></title><description><![CDATA[启航 从业务骨干到管理者 新任管理者问题： 时间不够用。 应该授权给谁 目标打不成 下属没动力 据调查一个管理者在成为个月内就失败了，根本原因是没有经过系统的管理者培训，下面分五个单元来讲述管理者的入门。 单元一 管理者的角色与职责 从三个方面来讲述管理者的角色与职责。 1.…]]></description><link>https://lengrongfu.github.io/2021-05-26-启航/</link><guid isPermaLink="false">https://lengrongfu.github.io/2021-05-26-启航/</guid><pubDate>Wed, 26 May 2021 22:22:00 GMT</pubDate><content:encoded>&lt;h1&gt;启航&lt;/h1&gt;
&lt;h2&gt;从业务骨干到管理者&lt;/h2&gt;
&lt;p&gt;新任管理者问题：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;时间不够用。&lt;/li&gt;
&lt;li&gt;应该授权给谁&lt;/li&gt;
&lt;li&gt;目标打不成&lt;/li&gt;
&lt;li&gt;下属没动力&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;据调查一个管理者在成为&lt;code class=&quot;language-text&quot;&gt;24&lt;/code&gt;个月内就失败了，根本原因是没有经过系统的管理者培训，下面分五个单元来讲述管理者的入门。&lt;/p&gt;
&lt;h2&gt;单元一 管理者的角色与职责&lt;/h2&gt;
&lt;p&gt;从三个方面来讲述管理者的角色与职责。&lt;/p&gt;
&lt;h3&gt;1.1 管理四大功能&lt;/h3&gt;
&lt;img src=&quot;https://gitee.com/lengrongfu/blog-static-file/raw/master/img20210524154834.png&quot; style=&quot;zoom:30%;&quot;&gt;
&lt;h4&gt;1.1.1 管理是什么？&lt;/h4&gt;
&lt;p&gt;​		管理是运用有限的资源创造最高合理利润以及透过他人把事情做好。&lt;/p&gt;
&lt;p&gt;管理者的工作包含利用有限的资源来&lt;strong&gt;规划&lt;/strong&gt;、&lt;strong&gt;组织&lt;/strong&gt;、&lt;strong&gt;领导&lt;/strong&gt;、&lt;strong&gt;控制&lt;/strong&gt;四大工作。&lt;/p&gt;
&lt;h4&gt;1.1.2 规划&lt;/h4&gt;
&lt;p&gt;​		规划指的是管理者要制定目标，针对每项目标要达成的任务内容以及资源情况来展开工作的计划。&lt;/p&gt;
&lt;h4&gt;1.1.3 组织&lt;/h4&gt;
&lt;p&gt;​		组织是按照规划的结果来安排成员工作，授权给成员。并且要为了团队来招募成员，使团队成员有效分工，执行各项工作。&lt;/p&gt;
&lt;h4&gt;1.1.4 领导&lt;/h4&gt;
&lt;p&gt;​		领导是指对成员工作的指导，沟通他们的想法，并且利用影响力来带领成员、引导他们、激励他们促进达成组织的目标。&lt;/p&gt;
&lt;h4&gt;1.1.5 控制&lt;/h4&gt;
&lt;p&gt;​		控制是指团队成员在执行任务的时候，持续观察，监督进度，还需要适当提出反馈建议；还需要在公司指定的时间进行绩效的面谈考核。&lt;/p&gt;
&lt;h3&gt;1.2 关键工作分析&lt;/h3&gt;
&lt;p&gt;​		管理者有那么多工作，我们肯定是做不完的，所以要找到关键工作，利用有限的资源来创造最高的利润。&lt;/p&gt;
&lt;p&gt;​		管理者需要掌握自我的关键工作，了解下属的关键工作。透过与下属的共同合作，达成团队的整体成果。&lt;/p&gt;
&lt;p&gt;​		关键工作是指：在组织内个人必须负责承担的事情，并且可以处理的责任范围。&lt;/p&gt;
&lt;p&gt;​		关键工作分为做人和做事两方面。&lt;/p&gt;
&lt;h5&gt;1.2.1 做人&lt;/h5&gt;
&lt;p&gt;​		做人是指职位赋予管理者运用人力，以发挥人力功能的工作。这里面又可以分为两类：&lt;strong&gt;人力资源&lt;/strong&gt;、 &lt;strong&gt;自我启发&lt;/strong&gt;。&lt;/p&gt;
&lt;h6&gt;1.2.1.1 人力资源&lt;/h6&gt;
&lt;p&gt;​		人力资源工作是指管理者发展团队人才的重要任务，主要在团队筛选、任用、培训、领导、发展与激励。&lt;/p&gt;
&lt;p&gt;​       这些工作做的越多，越能提升下属的能力，开发下属潜能。&lt;/p&gt;
&lt;h6&gt;1.2.1.2 自我启发&lt;/h6&gt;
&lt;p&gt;​		自我启发工作就是管理者的自我成长工作，每个管理者都应该持续的追求成长、追求创新、多多阅读，并且要做好自身的自我管理、情绪管理、健康管理，才能面对挑战，更上一层楼。&lt;/p&gt;
&lt;p&gt;​		这个工作做的越多，越能提升自我的能力。&lt;/p&gt;
&lt;h5&gt;1.2.2 做事&lt;/h5&gt;
&lt;p&gt;​		做事是指职位所赋予管理者的任务，完成公司所交互的工作目标。这里面又可以分为两类：&lt;strong&gt;例行工作&lt;/strong&gt;、&lt;strong&gt;发展工作&lt;/strong&gt;。&lt;/p&gt;
&lt;h6&gt;1.2.2.1 例行工作&lt;/h6&gt;
&lt;p&gt;​		例行工作是指经常重复的工作，有周期性或循环性质的工作。&lt;/p&gt;
&lt;p&gt;​        这些事情呢做的越多越熟练，但是会导致个人的折旧，又不能不做。&lt;/p&gt;
&lt;p&gt;​        这些工作不能不做，但是可以做好标准化，授权出去，让下属执行。&lt;/p&gt;
&lt;h6&gt;1.2.2.2 发展工作&lt;/h6&gt;
&lt;p&gt;​		发展工作是指运用新方式，以创新的工作手法改进工作流程。&lt;/p&gt;
&lt;p&gt;​		目的在于提升效率，创造绩效。&lt;/p&gt;
&lt;p&gt;​		这些工作是能够创新、改善工作、做的好的话能增加绩效、提高工作质量。&lt;/p&gt;
&lt;p&gt;身为管理者需要多做可以创造价值的发展工作，少做容易折旧的例行工作。&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;总结一下管理者的价值：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;多做发展工作&lt;/li&gt;
&lt;li&gt;控制例行工作&lt;/li&gt;
&lt;li&gt;培养人力资源&lt;/li&gt;
&lt;li&gt;持续自我启发&lt;/li&gt;
&lt;/ul&gt;
&lt;/blockquote&gt;
&lt;blockquote&gt;
&lt;p&gt;做一个关键工作分析表：&lt;img src=&quot;https://gitee.com/lengrongfu/blog-static-file/raw/master/img20210524171352.png&quot; style=&quot;zoom:50%;&quot;&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h3&gt;1.3 管理必备技能&lt;/h3&gt;
&lt;p&gt;​		管理者进行不同的管理工作，需要具备不同的技能。&lt;/p&gt;
&lt;h4&gt;1.3.1 专业技能&lt;/h4&gt;
&lt;p&gt;​		对个人工作产业或专业领域所具备的专业知识与能力。&lt;/p&gt;
&lt;h4&gt;1.3.2 人才技能&lt;/h4&gt;
&lt;p&gt;​		与他人可以进行良好的互动，顺利交流、顺利沟通、顺利协调。&lt;/p&gt;
&lt;h4&gt;1.3.3 概念化技能&lt;/h4&gt;
&lt;p&gt;​		是指快速搜集、处理信息及迅速做出结论的逻辑化能力。&lt;/p&gt;
&lt;p&gt;管理者在组织层级职位上的变化会导致使用技能比例将会变化。&lt;/p&gt;
&lt;img src=&quot;https://gitee.com/lengrongfu/blog-static-file/raw/master/20210524172515.png&quot; style=&quot;zoom:50%;&quot;&gt;
&lt;p&gt;管理者和下属的五大差异点：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;1、管理别人的时间而不是自己的时间。&lt;/li&gt;
&lt;li&gt;2、创造良好的工作环境和氛围，协助下属完成工作。&lt;/li&gt;
&lt;li&gt;3、绩效衡量标准发生改变。&lt;/li&gt;
&lt;li&gt;4、必须面对长期无解的问题和压力。&lt;/li&gt;
&lt;li&gt;5、关键资源是下属，发展下属能力共同创造绩效。&lt;/li&gt;
&lt;/ul&gt;
&lt;h2&gt;单元二 管理者的规划工作&lt;/h2&gt;
&lt;p&gt;​		没有明确目标就像在迷雾中开车。&lt;/p&gt;
&lt;h3&gt;2.1 设定工作目标&lt;/h3&gt;
&lt;p&gt;为什么要设定工作目标：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;有目标使工作有方向感。&lt;/li&gt;
&lt;li&gt;有了目标，知道如何改进绩效超目标改进。&lt;/li&gt;
&lt;li&gt;目标如果达成，将获得满足感。&lt;/li&gt;
&lt;li&gt;达成目标，建立信心，挑战更高的目标。&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;设定目标要满足&lt;strong&gt;SMART原则&lt;/strong&gt;。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;Specific&lt;/code&gt;具体明确的。&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;Measurable&lt;/code&gt;可以衡量。&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;Attainable&lt;/code&gt;能够达成的。&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;Relevant&lt;/code&gt;与关键工作相关的。&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;Time&lt;/code&gt;有时间限制的可以追踪的。&lt;/li&gt;
&lt;/ul&gt;
&lt;h3&gt;2.2 工作计划展开&lt;/h3&gt;
&lt;p&gt;​		工作计划展开是在协助管理者构建阶段目标，展开各项工作的技巧。&lt;/p&gt;
&lt;p&gt;​		可以运用任务分解的三个步骤来分解任务，步骤一：运用思维导图进行任务分解。步骤二：运用工具方法做排序规划。步骤三：运用甘特图规划项目活动进度。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;思维导图分解任务：以关键任务为中心，拆分任务，之后再进行梳理、总结提炼。&lt;/li&gt;
&lt;li&gt;项目排序规划：运用重要、紧急四相现来进行任务的排序。这也是时间规划的一个方法，多做重要不紧急的事情，他们是大石头。&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;运用&lt;code class=&quot;language-text&quot;&gt;5w2h&lt;/code&gt;工作法来进行工作任务的排序，用来理清工作细节、自我问询、自我思考、整理出工作内容、做出工作排序。&lt;code class=&quot;language-text&quot;&gt;5w2h&lt;/code&gt;分别是&lt;code class=&quot;language-text&quot;&gt;why 何因&lt;/code&gt;、&lt;code class=&quot;language-text&quot;&gt;what 何事&lt;/code&gt; 、&lt;code class=&quot;language-text&quot;&gt;who 何人&lt;/code&gt;、&lt;code class=&quot;language-text&quot;&gt;when 何时&lt;/code&gt;、&lt;code class=&quot;language-text&quot;&gt;where 何地&lt;/code&gt;、&lt;code class=&quot;language-text&quot;&gt;how 如何做&lt;/code&gt;、&lt;code class=&quot;language-text&quot;&gt;how match 多少成本&lt;/code&gt;。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;规划项目进度：以时间为横轴，事件为纵轴。&lt;/li&gt;
&lt;/ul&gt;
&lt;h2&gt;单元三 管理者的组织工作&lt;/h2&gt;
&lt;p&gt;​		这里面主要学习工作授权和招聘选才。&lt;/p&gt;
&lt;h3&gt;3.1 授权&lt;/h3&gt;
&lt;p&gt;新任管理者必须学会的3件事：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;不再事必躬亲，而是授权给下属。&lt;/li&gt;
&lt;li&gt;告诉下属需要完成什么事，而不是如何完成。&lt;/li&gt;
&lt;li&gt;接受授权下属的任务成果，而不是总想如果我来做，一定会做的更好。&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;授权的5大步骤：&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;要详细说明授权的原因、任务的重要性、任务的SMART目标、任务权责。&lt;/li&gt;
&lt;li&gt;要了解下属对任务的理解以及执行能力；最好让下属复述一遍执行内容，管理者需要确认下属的执行能力；并在关键时候对下属进行指导、协助和培训。&lt;/li&gt;
&lt;li&gt;共同拟定执行计划和执行方式，管理者要倾听下属的执行步骤，管理者进行补充，并及时提供资源以及支持协助完成任务。&lt;/li&gt;
&lt;li&gt;与下属约定追踪核检时间，表达管理者对下属的信息。&lt;/li&gt;
&lt;li&gt;任务完成时，管理者要肯定下属的贡献。&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;那些情况不适合授权：&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;对下属的赏与罚不能授权给他人。&lt;/li&gt;
&lt;li&gt;涉及公司机密或者个人机密的事件也不能授权给他人去做。&lt;/li&gt;
&lt;li&gt;对下属绩效考评、绩效面谈不能授予他人完成。&lt;/li&gt;
&lt;li&gt;下属能力缺口很大的时候，并不适合授权他去完成任务。&lt;/li&gt;
&lt;/ol&gt;
&lt;h3&gt;3.2 招聘人才&lt;/h3&gt;
&lt;p&gt;​			招聘人才观：招最好的人、给最大的空间、看最后的结果。&lt;/p&gt;
&lt;h4&gt;3.2.1 招最好的人&lt;/h4&gt;
&lt;p&gt;​		主要有三点，是否认同公司的文化价值观、胜任岗位要求、具备优秀的学习能力。&lt;/p&gt;
&lt;h5&gt;3.2.1.1 胜任岗位&lt;/h5&gt;
&lt;p&gt;​		管理者在面试中要把握重点考试内容，&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;岗位匹配度、职业承诺、职业动机。&lt;/li&gt;
&lt;li&gt;专业技能、项目经验、通用素质。&lt;/li&gt;
&lt;li&gt;个人特质、职业动机、与团队氛围的匹配度、与其他成员的匹配度。&lt;/li&gt;
&lt;/ol&gt;
&lt;h2&gt;单元四 管理者的领导工作&lt;/h2&gt;
&lt;p&gt;​		领导这个单元里主要学习如何进行工作指导、如何沟通、如何激励下属。&lt;/p&gt;
&lt;h3&gt;4.1 工作指导&lt;/h3&gt;
&lt;p&gt;​		交代工作任务后，管理者必须对下属进行工作指导。目的是培养下属的能力以及确保工作的完成。&lt;/p&gt;
&lt;p&gt;​		工作指导的四大步骤是&lt;strong&gt;期望&lt;/strong&gt;、&lt;strong&gt;能力&lt;/strong&gt;、&lt;strong&gt;投入&lt;/strong&gt;、&lt;strong&gt;绩效&lt;/strong&gt;。&lt;/p&gt;
&lt;h4&gt;4.1.1 期望&lt;/h4&gt;
&lt;p&gt;​		期望是指明确告知公司对他的目标期待/任务。&lt;/p&gt;
&lt;h4&gt;4.1.2 能力&lt;/h4&gt;
&lt;p&gt;​		能力是指观察下属的工作表现，看下属是否具备足够的能力和技巧。&lt;/p&gt;
&lt;h4&gt;4.1.3 投入&lt;/h4&gt;
&lt;p&gt;​		投入是指工作一段时间之后，观察下属是否具备动力和信心，并且坚持在任务上。&lt;/p&gt;
&lt;h4&gt;4.1.4 绩效&lt;/h4&gt;
&lt;p&gt;​		绩效是指工作到一个段落时，总结下属的工作表现，给予下属支持或改善指导。&lt;/p&gt;
&lt;p&gt;​&lt;/p&gt;
&lt;p&gt;​		管理者在工作指导中如果发现下属&lt;strong&gt;技能不足&lt;/strong&gt;，就用&lt;strong&gt;培养技能教育的5要点&lt;/strong&gt;；发现&lt;strong&gt;有优异表现&lt;/strong&gt;，就用&lt;strong&gt;一分钟赞美法&lt;/strong&gt;；发现有&lt;strong&gt;表现不理想、失误&lt;/strong&gt;，就用&lt;strong&gt;一分钟指正&lt;/strong&gt;法。&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;培养技能5要点&lt;/strong&gt;：要告诉下属，并演示给他看怎么解决，并让他独立尝试，这个过程中进行观察，然后提供反馈。&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;赞美下属&lt;/strong&gt;：管理者必须说出那些具体的行为值得赞美，以及赞美的原因。告诉下属他的行动，给管理者本人那些正面的感受，对管理者或整个团队组织的影响。当然还要当面正式的向下属表达信任和鼓励，促使下属维持良好的表现。&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;指正下属&lt;/strong&gt;：&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;不带职责的呈现错误具体影响。如：在…这几个方面你犯了很多错误…。&lt;/li&gt;
&lt;li&gt;指出错误产生的影响。如：你的错误是什么…;你的影响是什么…&lt;/li&gt;
&lt;li&gt;承认是自己的指示不明而影响下属行动。如：这件事情在…方面你要承担责任。&lt;/li&gt;
&lt;li&gt;共同检视工作细节，进行正确的改善。如：细节是…;原因在于…;可以…改善&lt;/li&gt;
&lt;li&gt;并且要表达任然对下属信赖和信心。如：希望你记住这次教训，以后为公司做出更多的贡献。&lt;/li&gt;
&lt;/ol&gt;
&lt;h3&gt;4.2 沟通&lt;/h3&gt;
&lt;ol&gt;
&lt;li&gt;倾听的三要点&lt;code class=&quot;language-text&quot;&gt;ASC&lt;/code&gt;提问：&lt;code class=&quot;language-text&quot;&gt;ASK&lt;/code&gt;提问，清楚明确的提问；&lt;code class=&quot;language-text&quot;&gt;Silence&lt;/code&gt;沉默，沉默三秒钟让对方更深入的说明；&lt;code class=&quot;language-text&quot;&gt;Confirm&lt;/code&gt;确认，确认自己理解的意思是否正确。&lt;/li&gt;
&lt;li&gt;下属发生错误的时候如何提问呢？&lt;code class=&quot;language-text&quot;&gt;ICE&lt;/code&gt;三部曲，以我为开场白、比较以为的表现、让下属做出解释。&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;不定期与下属进行一对一面谈技巧：&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;要求下属主动的说明目前的具体情况，理清下属现在的那些行为是值得称赞的，有哪些是必须指正的。&lt;/li&gt;
&lt;li&gt;一起深入探讨面临的问题。&lt;/li&gt;
&lt;li&gt;还可以鼓励下属多多思考，针对问题提出不同的方案、分析和讨论。&lt;/li&gt;
&lt;li&gt;达成共识，决定改善的计划。&lt;/li&gt;
&lt;/ol&gt;
&lt;h2&gt;单元五 管理者的控制工作&lt;/h2&gt;
&lt;p&gt;绩效评估面谈的6大步骤。&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;绩效面谈时下属是紧张的，所以要营造放松的气氛，让双方能放松的会谈，然后在聚焦到锁定的焦点。&lt;/li&gt;
&lt;li&gt;使用绩效计划或者评分表来评估；&lt;/li&gt;
&lt;li&gt;展开绩效分析；向下属提问找出目标与实际行动大幅落差的原因，再研究如何解决。&lt;/li&gt;
&lt;li&gt;列出行动计划。&lt;/li&gt;
&lt;li&gt;将谈话记录建档。&lt;/li&gt;
&lt;li&gt;安排后续的会议。&lt;/li&gt;
&lt;/ol&gt;</content:encoded></item><item><title><![CDATA[技术写作 第二课]]></title><description><![CDATA[…]]></description><link>https://lengrongfu.github.io/2021-05-25-技术写作/</link><guid isPermaLink="false">https://lengrongfu.github.io/2021-05-25-技术写作/</guid><pubDate>Tue, 25 May 2021 00:01:46 GMT</pubDate><content:encoded>&lt;h1&gt;技术写作 第二课&lt;/h1&gt;
&lt;h3&gt;目标读者&lt;/h3&gt;
&lt;p&gt;​		本课程的目标读者为已完成&lt;a href=&quot;https://lengrongfu.github.io/2021/05/21/%E6%8A%80%E6%9C%AF%E5%86%99%E4%BD%9C-%E7%AC%AC%E4%B8%80%E8%8A%82/&quot;&gt;技术写作 第一课&lt;/a&gt;，但是仍然渴望进行更多写作培训的人员。如果你没有接受过任何技术写作的培训，最好先看一下第一课能容。&lt;/p&gt;
&lt;h3&gt;学习目标&lt;/h3&gt;
&lt;p&gt;​		这节课侧重于技术写作中的几个中间主题，学习完本课程之后，将收获如下的知识：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;从几种不同的策略中选择一种编写第一稿的策略，以及第二稿、第三稿的其他策略。&lt;/li&gt;
&lt;li&gt;使用多种技术来检测写作中的错误。&lt;/li&gt;
&lt;li&gt;学会组织大型的文档。&lt;/li&gt;
&lt;li&gt;介绍文档的范围和所有先决条件。&lt;/li&gt;
&lt;li&gt;写下清晰的图形标题。&lt;/li&gt;
&lt;li&gt;在技术插图中选择适当的信息密度。&lt;/li&gt;
&lt;li&gt;将读者的注意力集中在插图上。&lt;/li&gt;
&lt;li&gt;通过图片建立上下文。&lt;/li&gt;
&lt;li&gt;有效的修改技术插图。&lt;/li&gt;
&lt;li&gt;创建有用、准确、简洁，清晰，可重用和注释良好的代码，用来演示一系列的复杂性。&lt;/li&gt;
&lt;li&gt;标示不同的文档类型。&lt;/li&gt;
&lt;li&gt;描述所有的内容。&lt;/li&gt;
&lt;li&gt;体谅初学者，并为他们编写教程。&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;​		成为一名优秀的工程师或者优秀的技术作家都需要花费多年的专注实践，这门课程能提高你的写作水平，但不会立即使你成为一个出色的作家。&lt;/p&gt;
&lt;h3&gt;自我编辑&lt;/h3&gt;
&lt;p&gt;参考《&lt;a href=&quot;https://developers.google.com/style/highlights&quot;&gt;Google开发分档风格指南&lt;/a&gt;》&lt;/p&gt;
&lt;p&gt;换位思考：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;尝试从读者的角度阅读文档，确保文档目的是明确的；并考虑好不同的角色所拥有的知识储备。&lt;/li&gt;
&lt;li&gt;然后从作者的角度阅读文档，确保你做的假设有用，还可以提供资源的链接。&lt;/li&gt;
&lt;li&gt;最后请注意，过分依赖角色，会导致文档过于狭隘，而无法对大多数读者有用。&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;大声读出来：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;自己大声的朗读或者使用屏幕阅读器朗读，来听取尴尬的措辞，冗长的句子或其他不自然的内容。&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;编写每一搞的策略：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;编写完每一个版本之后，先放边上一个小时，然后再回来阅读一遍，总会发现有可以改进的地方，推荐做三遍。&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;检查写作中的错误：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;邀请某人查看你的文档，并给你具体的，建设性意见。&lt;/li&gt;
&lt;li&gt;阅读的人不一定是同行，但是最好熟悉你遵循的文档风格。&lt;/li&gt;
&lt;/ul&gt;
&lt;h3&gt;写一个大型文档&lt;/h3&gt;
&lt;p&gt;使用以下策略可以帮助你们撰写大型文档：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;选择编写单个大型文档或一组简短文档。&lt;/li&gt;
&lt;li&gt;把简短文档整理为一个大型文档。&lt;/li&gt;
&lt;li&gt;给大型文档添加导航。&lt;/li&gt;
&lt;li&gt;逐步暴露信息。&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;什么时候写大文档：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;当你的阅读对象是刚入门的读者时，写操作指南、入门概述和概念性指南通常能以短文的形式提供更好的作用。&lt;/li&gt;
&lt;li&gt;当已经对工具和主题有一定经验的读者，写深入教程，最佳实践指南和命令行参考页可以作为更长的文档使用。&lt;/li&gt;
&lt;li&gt;好的教程能可以依靠叙述来引导读者完成较长文档中的一系列相关任务。&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;写较长文档的方法：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;创建大纲和起草宣言。&lt;/li&gt;
&lt;li&gt;完成初稿之后，可以更具概述和简介对其进行复审。&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;编写大纲的实用技巧：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;在要求读者执行任务前，先解释为什么要执行此任务。&lt;/li&gt;
&lt;li&gt;将大纲的每个步骤限制为描述概念或完成特定任务。&lt;/li&gt;
&lt;li&gt;构造轮廓，以便文档在与读者最相关时引入信息。&lt;/li&gt;
&lt;li&gt;在起草前，先与贡献者共享大纲内容。&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;可以提供一个基本信息来介绍文档：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;说明文档涵盖的内容。&lt;/li&gt;
&lt;li&gt;希望读者具备哪些知识储备。&lt;/li&gt;
&lt;li&gt;说明文档没有涵盖那些内容。&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;为文档添加目录，可确保读者能快速的找到所需要的内容，清晰的目录包括：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;简介和摘要&lt;/li&gt;
&lt;li&gt;主题清晰&lt;/li&gt;
&lt;li&gt;有助于用户理解的标题和子标题&lt;/li&gt;
&lt;li&gt;提示用户在目录中的位置&lt;/li&gt;
&lt;li&gt;可以通过目录能跳转到相关位置&lt;/li&gt;
&lt;li&gt;有下一步学习的链接&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;在每个标题下都进行简短的介绍，避免在标题后面马上放入下一级标题。&lt;/p&gt;
&lt;h3&gt;图片&lt;/h3&gt;
&lt;p&gt;在插入图之前写标题会很有帮助，然后，插入能说明标题的图片&lt;/p&gt;
&lt;p&gt;图片中好的标题应该具有下面的特征：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;他们很简短，通常只是几句话。&lt;/li&gt;
&lt;li&gt;说明了重点。&lt;/li&gt;
&lt;li&gt;能吸引读者的注意力。&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;考虑以下三个图形，每个图形使用相同的标题。&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://gitee.com/lengrongfu/blog-static-file/raw/master/20210521214527.png&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;标题A。单链接列表包含内容和指向下一个节点的指针。&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://gitee.com/lengrongfu/blog-static-file/raw/master/20210521214546.png&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;标题B。单链接列表包含内容和指向下一个节点的指针。&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://gitee.com/lengrongfu/blog-static-file/raw/master/20210521214602.png&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;标题C。单链接列表包含内容和指向下一个节点的指针。&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;上述三个标题中&lt;strong&gt;标题C&lt;/strong&gt;是最具启发性的，标题清晰的描述了图片的功能。&lt;/p&gt;
&lt;p&gt;如下图片中的信息量不要过大。&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://gitee.com/lengrongfu/blog-static-file/raw/master/20210521214727.png&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;p&gt;如上图的复杂性就会让很多读者望而却步，就像避免过长的句子一样，请尽量避免较复杂的图片。&lt;/p&gt;
&lt;p&gt;将复杂的图片变为连贯且有用的诀窍是将复杂的系统组织成子系统。&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://raw.githubusercontent.com/lengrongfu/images/master/img20210521215106.png&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;图4.分为三个子系统的复杂系统。&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;显示大图之后再分别提供每个子系统的图片。&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://raw.githubusercontent.com/lengrongfu/images/master/img20210521215224.png&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;图5.复杂系统的一个子系统的扩展细节。&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;画图工具&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https://drawings.google.com/&quot;&gt;Google绘图&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://diagrams.net/&quot;&gt;diagrams.net&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://www.lucidchart.com/pages/&quot;&gt;lucidchart&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h3&gt;创建示例代码&lt;/h3&gt;
&lt;p&gt;代码仍然是技术人最喜欢读的，好的代码通常是最好的文档。&lt;/p&gt;
&lt;p&gt;好的代码样本是正确、简洁，你的读者可以快速理解它们，并能以最小的代价重复使用它们。&lt;/p&gt;
&lt;h4&gt;正确&lt;/h4&gt;
&lt;p&gt;示例代码应该满足下面条件：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;代码构建没有错误。&lt;/li&gt;
&lt;li&gt;能按要求进行执行。&lt;/li&gt;
&lt;li&gt;要做好生产使用的准备，比如，代码不能有安全漏洞。&lt;/li&gt;
&lt;li&gt;遵循语言的约定。&lt;/li&gt;
&lt;/ul&gt;
&lt;h4&gt;简洁&lt;/h4&gt;
&lt;p&gt;​	    示例代码应该简短，仅包括基本组件，不相关的代码可能会使你的读者分散注意力。但是，也不要用错误的做法来缩短你的代码，在正确和简短之间，我们更看重正确性。&lt;/p&gt;</content:encoded></item><item><title><![CDATA[代码质量好坏如何评判]]></title><description><![CDATA[…]]></description><link>https://lengrongfu.github.io/2021-05-24-代码质量好坏如何评判/</link><guid isPermaLink="false">https://lengrongfu.github.io/2021-05-24-代码质量好坏如何评判/</guid><pubDate>Mon, 24 May 2021 23:49:59 GMT</pubDate><content:encoded>&lt;h1&gt;代码质量好坏如何评判？&lt;/h1&gt;
&lt;h2&gt;代码质量”好”和”坏”指什么？&lt;/h2&gt;
&lt;p&gt;“好”可以表示代码的质量高，“坏”表示代码的质量低。&lt;/p&gt;
&lt;h2&gt;代码质量”高”又是指什么？&lt;/h2&gt;
&lt;p&gt;代码质量高指代码：可维护性、可读性、可扩展性、灵活性、简洁性、可复用、可测试性。其中&lt;strong&gt;可维护性、可读性、可扩展性&lt;/strong&gt;是最重要的三个指标。&lt;/p&gt;
&lt;h3&gt;可维护性&lt;/h3&gt;
&lt;p&gt;可维护性是一个主观性很强的评判标准，因为熟悉系统的资深工程师可能会任务易维护，但是资历浅的工程师就会认为难维护。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;所谓可维护性就是指，在不破坏原有代码设计、不引入新的&lt;code class=&quot;language-text&quot;&gt;BUG&lt;/code&gt;的情况下，能够快速地修改或者添加代码。&lt;/li&gt;
&lt;li&gt;所谓代码不易维护就是值，修改或者添加代码需要冒着极大的引入新&lt;code class=&quot;language-text&quot;&gt;bug&lt;/code&gt;的风险，并且需要花费很长的时间才能完成。&lt;/li&gt;
&lt;/ul&gt;
&lt;h3&gt;可读性&lt;/h3&gt;
&lt;p&gt;代码的可读性从如下几个方面来进行评价。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;是否符合编码规范、命名是否达意、注释是否详尽、函数是否长短合适、模块划分是否清晰、是否符合高内聚低耦合等。&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;但是最简单的评价标准就是让同事来做&lt;code class=&quot;language-text&quot;&gt;Code Receive&lt;/code&gt;,如果同事能够轻松的读懂你的代码，那就是可读性很好，反之就是需要改善代码了。&lt;/p&gt;
&lt;h3&gt;可扩展性&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;可扩展性表示，我们在不修改或少量修改原有代码的情况下，通过扩展的方式添加新的功能代码。&lt;/li&gt;
&lt;/ul&gt;
&lt;h3&gt;灵活性&lt;/h3&gt;
&lt;p&gt;代码灵活性主要提现在易扩展方面。&lt;/p&gt;
&lt;h3&gt;简洁性&lt;/h3&gt;
&lt;p&gt;我们要遵从&lt;code class=&quot;language-text&quot;&gt;KISS&lt;/code&gt;原则，代码要尽可能的简单；但是&lt;strong&gt;思从深而行从简，真正的高手能云淡风轻地用最简单的方法解决最复杂的问题。这也是一个编程老手跟编程新手的本质区别之一。&lt;/strong&gt;&lt;/p&gt;
&lt;h3&gt;可复用性&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;可复用性是很多设计模式、思想、原则所要达到的最终效果。&lt;/li&gt;
&lt;/ul&gt;
&lt;h3&gt;可测试性&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;可测试就能从侧面上非常准确地反应代码质量的好坏。&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;要写出满足上述评价标准的高质量代码，我们需要掌握一些更加细化、更加能落地的编程方法论，包括面向对象设计思想、设计原则、设计模式、编码规范、重构技巧等。&lt;/p&gt;
&lt;p&gt;如：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;面向对象中的继承、多态能让我们写出可复用的代码；&lt;/li&gt;
&lt;li&gt;编码规范能让我们写出可读性好的代码。&lt;/li&gt;
&lt;li&gt;设计原则中的单一职责、DRY、基于接口而非实现、里氏替换原则等可以写出易复用、灵活、可读性好、易扩展、易维护的代码；&lt;/li&gt;
&lt;li&gt;设计模式可以写出易扩展的代码。&lt;/li&gt;
&lt;li&gt;持续重构可以时刻保持代码的可维护性。&lt;/li&gt;
&lt;/ul&gt;</content:encoded></item><item><title><![CDATA[技术写作 第一课]]></title><description><![CDATA[…]]></description><link>https://lengrongfu.github.io/2021-05-21-技术写作-第一节/</link><guid isPermaLink="false">https://lengrongfu.github.io/2021-05-21-技术写作-第一节/</guid><pubDate>Fri, 21 May 2021 01:53:00 GMT</pubDate><content:encoded>&lt;blockquote&gt;
&lt;p&gt;本文是学习&lt;a href=&quot;https://developers.google.com/tech-writing&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;Google&lt;/code&gt;技术写作课程&lt;/a&gt;的学习笔记，它这个课程主要用于指导我们如何做好技术写作，了解如何计划和编写技术文档；&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;本课程是技术写作中的第一课，主要学习技术写作的关键基础，在学校任何其他课程之前，请先学习本课程。&lt;/p&gt;
&lt;h3&gt;学习目标&lt;/h3&gt;
&lt;p&gt;​		首先我们确定学习的目标，知道学习完本课程之后可以得到什么；本课程教我们技术协作的基础，完成本课程后，我们就知道如何执行如下的操作了。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;始终使用专业术语（包括缩写词和首字母缩写词）；比如&lt;code class=&quot;language-text&quot;&gt;K8s&lt;/code&gt;中的最小调度单元&lt;code class=&quot;language-text&quot;&gt;Pod&lt;/code&gt;。&lt;/li&gt;
&lt;li&gt;识别并尽量减少使用代词的句子。&lt;/li&gt;
&lt;li&gt;区分主动语句和被动语句。&lt;/li&gt;
&lt;li&gt;确定主动语句优于被动语句的三种方式。&lt;/li&gt;
&lt;li&gt;制定至少三种形式，使句子更清晰，更加引人入胜。&lt;/li&gt;
&lt;li&gt;制定至少四种缩短句子的策略。&lt;/li&gt;
&lt;li&gt;了解项目符号列表和编号列表之间的区别。&lt;/li&gt;
&lt;li&gt;创建有用的列表。&lt;/li&gt;
&lt;li&gt;为段落创建有效的主要句子。&lt;/li&gt;
&lt;li&gt;将每个段落集中在一个主题上。&lt;/li&gt;
&lt;li&gt;在每个文档的开头说明要点。&lt;/li&gt;
&lt;li&gt;确定你的目标受众。&lt;/li&gt;
&lt;li&gt;确定你的目标受众已知什么以及需要学习什么。&lt;/li&gt;
&lt;li&gt;了解知识的灾难。&lt;/li&gt;
&lt;li&gt;识别和修订成语。&lt;/li&gt;
&lt;li&gt;说明文档的范围目标和受众。&lt;/li&gt;
&lt;li&gt;将较长的主题分为适当的部分。&lt;/li&gt;
&lt;li&gt;真确使用标点符号，包括括号、冒号、破折号和分号。&lt;/li&gt;
&lt;li&gt;在&lt;code class=&quot;language-text&quot;&gt;Markdown&lt;/code&gt;中发展初学者的能力。&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;​		成为一名优秀的工程师和一名出色的技术作家，需要花费多年的专注实践，本课程将提高我们的技术写作水平，但不会使我们变成一名出色的技术作家。&lt;/p&gt;
&lt;h3&gt;足够的语法&lt;/h3&gt;
&lt;p&gt;这里主要是介绍与本课程相关的词性。&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th align=&quot;center&quot;&gt;词性&lt;/th&gt;
&lt;th&gt;定义&lt;/th&gt;
&lt;th align=&quot;left&quot;&gt;例子&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td align=&quot;center&quot;&gt;名词&lt;/td&gt;
&lt;td&gt;人，地方，概念或事物&lt;/td&gt;
&lt;td align=&quot;left&quot;&gt;&lt;strong&gt;山姆&lt;/strong&gt;跑&lt;strong&gt;比赛&lt;/strong&gt;。&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&quot;center&quot;&gt;代词&lt;/td&gt;
&lt;td&gt;替换另一个名词（或更大结构）的名词&lt;/td&gt;
&lt;td align=&quot;left&quot;&gt;山姆参加比赛。&lt;strong&gt;他&lt;/strong&gt;喜欢竞争。&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&quot;center&quot;&gt;形容词&lt;/td&gt;
&lt;td&gt;修饰名词的单词或短语&lt;/td&gt;
&lt;td align=&quot;left&quot;&gt;山姆穿&lt;strong&gt;蓝色的&lt;/strong&gt;鞋子。&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&quot;center&quot;&gt;动词&lt;/td&gt;
&lt;td&gt;一个动作词或短语&lt;/td&gt;
&lt;td align=&quot;left&quot;&gt;山姆&lt;strong&gt;跑&lt;/strong&gt;比赛。&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&quot;center&quot;&gt;副词&lt;/td&gt;
&lt;td&gt;修饰动词，形容词或其他副词的单词或短语&lt;/td&gt;
&lt;td align=&quot;left&quot;&gt;山姆运行&lt;strong&gt;缓慢&lt;/strong&gt;。&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&quot;center&quot;&gt;介词&lt;/td&gt;
&lt;td&gt;指定两个名词的位置关系的单词或短语&lt;/td&gt;
&lt;td align=&quot;left&quot;&gt;山姆的运动鞋很少&lt;strong&gt;在&lt;/strong&gt;他的架子上。&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&quot;center&quot;&gt;连词&lt;/td&gt;
&lt;td&gt;连接两个名词或短语的单词&lt;/td&gt;
&lt;td align=&quot;left&quot;&gt;山姆的奖杯&lt;strong&gt;和&lt;/strong&gt;缎带只存在于他的想象中。&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&quot;center&quot;&gt;过渡&lt;/td&gt;
&lt;td&gt;连接两个句子的单词或短语&lt;/td&gt;
&lt;td align=&quot;left&quot;&gt;山姆每周参加比赛。&lt;strong&gt;但是&lt;/strong&gt;，他弱势地完成了比赛。&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h4&gt;名词&lt;/h4&gt;
&lt;p&gt;名次代表人、地方或事务。朱迪、南极洲和锤子都是名词，无形的概念（例如&lt;strong&gt;健壮性&lt;/strong&gt; 和&lt;strong&gt;完美性&lt;/strong&gt;）也是名词。&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;在&lt;strong&gt;框架中&lt;/strong&gt;，&lt;strong&gt;对象&lt;/strong&gt;必须复制该&lt;strong&gt;对象&lt;/strong&gt;要更改的所有基础&lt;strong&gt;值&lt;/strong&gt;。该&lt;strong&gt;PROTOS&lt;/strong&gt;的&lt;strong&gt;代码库&lt;/strong&gt;是巨大的，所以复制的&lt;strong&gt;PROTOS&lt;/strong&gt;是不可接受的昂贵。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;在编程中，我们会把类和变量视为名词。&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;练习&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;找出下面段落中识别六个名词&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;C使程序员能够控制指针和内存。强大的功能带来巨大的责任。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;&lt;strong&gt;答案&lt;/strong&gt;&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;C、指针、内存、程序员、功能、责任。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h4&gt;代词&lt;/h4&gt;
&lt;p&gt;代词是一个间接层，它指向或替代了其他名词或句子。例如，考虑以下两个句子：&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;珍妮特（Janet）编写了出色的代码。&lt;strong&gt;她&lt;/strong&gt;是高级工程师。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;在前面的示例中，第一句话将&lt;strong&gt;Janet&lt;/strong&gt;建立为名词。第二句话用代词&lt;strong&gt;她&lt;/strong&gt;代替名词&lt;strong&gt;珍妮特&lt;/strong&gt;。&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;练习&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;在以下段落中确定三个代词：&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;自助餐厅的特色是在吐司上撒上腰果、黄油和果酱。员工们发现它很棒，希望他们每天都能吃它。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;&lt;strong&gt;答案&lt;/strong&gt;&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;它很棒: 它代指前面描述的在吐司上撒上腰果、黄油和果酱的食物。&lt;/p&gt;
&lt;p&gt;他们每天吃：他们指代前面的员工。&lt;/p&gt;
&lt;p&gt;吃它：它代指前面描述的食物&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h4&gt;动词&lt;/h4&gt;
&lt;p&gt;动词是一个动作词或短语。当您要表示两个名词（一个演员和一个目标）之间的关系时，该动词会起作用。动词标识演员对目标的作用。&lt;/p&gt;
&lt;p&gt;每个句子必须至少包含一个动词。例如，以下每个句子包含一个动词：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;酒井&lt;strong&gt;更喜欢&lt;/strong&gt;意大利面。&lt;/li&gt;
&lt;li&gt;里克&lt;strong&gt;喜欢&lt;/strong&gt;大海。&lt;/li&gt;
&lt;li&gt;蓝精灵&lt;strong&gt;是&lt;/strong&gt;蓝色的。&lt;/li&gt;
&lt;li&gt;杰西&lt;strong&gt;患有&lt;/strong&gt;过敏症。&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;练习&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;在下面句子中找到动词：&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;萨曼莎（Samantha）正在用C ++编写“斗牛行动”。该项目目前消耗超过80,000行代码。她以前使用过Python，但最近开始使用C ++。萨曼莎（Samantha）领导着一个由四名软件工程师组成的团队，该团队将在下个季度增长到六名软件工程师&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;&lt;strong&gt;答案&lt;/strong&gt;&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;编写、消耗、领导、增长&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h4&gt;形容词和副词&lt;/h4&gt;
&lt;p&gt;形容词修饰名词。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;汤姆喜欢&lt;strong&gt;红&lt;/strong&gt;气球。他准备&lt;strong&gt;美味的&lt;/strong&gt;食物。他修复了 &lt;strong&gt;八个&lt;/strong&gt;错误。&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;副词修饰动词。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Jane可以&lt;strong&gt;有效地&lt;/strong&gt;修复错误。&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;练习&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;在以下段落中确定四个形容词。&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;对于有才华的人来说，工程是一个伟大的事业。我认识一位聪明的工程师，可以在任何知识性的工作中脱颖而出。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;&lt;strong&gt;答案&lt;/strong&gt;&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;才华、聪明、知识性、伟大&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h4&gt;连词和过渡&lt;/h4&gt;
&lt;p&gt;连词连接短语或名词中的句子，过渡将句子本身连起来。&lt;/p&gt;
&lt;p&gt;最重要的连接词如下：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;和&lt;/li&gt;
&lt;li&gt;但&lt;/li&gt;
&lt;li&gt;或者&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;技术写作中最重要的过渡词如下：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;然而&lt;/li&gt;
&lt;li&gt;所以&lt;/li&gt;
&lt;li&gt;例如&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;练习&lt;/strong&gt;&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;通常，Barbara在编写第一行代码之前会研究问题很长时间。_____________，前几天她突然受到启发时，自发地编码了一种方法。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;&lt;strong&gt;答案&lt;/strong&gt;&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;然而&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h3&gt;单词&lt;/h3&gt;
&lt;h4&gt;定义新术语&lt;/h4&gt;
&lt;p&gt;在编写时，识别目标受众可能不熟悉的术语，当识别出来之后，需要采取下面两种措施：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;如果该术语已经存在，请链接到现有的良好说明。（不要重新发明轮子。）&lt;/li&gt;
&lt;li&gt;如果是新引入的术语，需要定义它，如果引入多个术语，请定义收集到词汇表中。&lt;/li&gt;
&lt;/ul&gt;
&lt;h4&gt;始终使用术语&lt;/h4&gt;
&lt;p&gt;在同一个文档中使用相同的术语，否则会让看的人疑惑。&lt;/p&gt;
&lt;h4&gt;正确使用首字母缩写&lt;/h4&gt;
&lt;p&gt;在正文中首次使用首字母缩写时，请拼写完整的术语，然后将首字母缩写词放在括号中，首字母缩写词用黑体字体标出。然后就可以在后续使用同名的首字母缩写词了。&lt;/p&gt;
&lt;h3&gt;歧义代词&lt;/h3&gt;
&lt;p&gt;​		许多代词都是指代前文中的名词，这种代词像编程中的指针，往往容易引入错误；在文中，尽量避免使用代词，只需要重用名词即可。可以在如下的几种情况中使用代词。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;引入名词后使用代词；在介绍名词之前，请勿使用代词。&lt;/li&gt;
&lt;li&gt;代词应尽可能靠近指代名词，通常，如果名词和代词的距离超过五个单词，就请考虑重用名词。&lt;/li&gt;
&lt;li&gt;如果在名词和代词之间引入第二名词，请重用名词，而不要使用代词。&lt;/li&gt;
&lt;/ul&gt;
&lt;h4&gt;它和他们&lt;/h4&gt;
&lt;p&gt;这两个代词在技术文档中引起最大的混乱：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;它&lt;code class=&quot;language-text&quot;&gt;It&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;他们&lt;code class=&quot;language-text&quot;&gt;they、them、their&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;下面句子中的&lt;strong&gt;它&lt;/strong&gt;就是一个不确定的代词。&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;Python是解释形语言，而C ++是编译形语言，。&lt;strong&gt;它&lt;/strong&gt;具有很多追随者。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h4&gt;这个和那个&lt;/h4&gt;
&lt;ul&gt;
&lt;li&gt;这&lt;code class=&quot;language-text&quot;&gt;This&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;那&lt;code class=&quot;language-text&quot;&gt;That&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;下面句子中的&lt;strong&gt;这&lt;/strong&gt;就不清楚代之&lt;code class=&quot;language-text&quot;&gt;Frambus&lt;/code&gt;还是&lt;code class=&quot;language-text&quot;&gt;Foo&lt;/code&gt;。&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;您可以使用&lt;code class=&quot;language-text&quot;&gt;Frambus&lt;/code&gt;或&lt;code class=&quot;language-text&quot;&gt;Foo&lt;/code&gt;来计算导数。&lt;strong&gt;这&lt;/strong&gt;不是最佳的。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h3&gt;主动语态&lt;/h3&gt;
&lt;p&gt;优先使用主动语态而不是被动语态：&lt;/p&gt;
&lt;h3&gt;清晰的句子&lt;/h3&gt;
&lt;p&gt;在技术写作中，文章写的清晰明了要优于其它规则；下面提供了几种可以使文章清晰明了的方法。&lt;/p&gt;
&lt;h4&gt;选择有效的动词&lt;/h4&gt;
&lt;p&gt;​		大多数技术作家都认为动词是句子中最重要的部分，选择正确的使用动词更会产生令人满意的结果。&lt;/p&gt;
&lt;p&gt;要吸引和让读者学习，请选择精确、有力，特定的动词。减少使用不精确、通用的动词，如：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;be&lt;/code&gt;动词：is，are，am，was，are等。&lt;/li&gt;
&lt;li&gt;发生&lt;/li&gt;
&lt;/ul&gt;
&lt;h3&gt;简短的句子&lt;/h3&gt;
&lt;p&gt;出于一大原因，我们会在写技术文档时把句子写的足够间断：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;简短的句子阅读起来更快。&lt;/li&gt;
&lt;li&gt;简短的句子通常更容易维护。&lt;/li&gt;
&lt;li&gt;较长的句子会让自己更难理解。&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;我们可以通过如下几点来把长句子变为短句：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;每个句子都只表达一个想法。&lt;/li&gt;
&lt;li&gt;将一些长句子转换为列表。&lt;/li&gt;
&lt;/ul&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;strong&gt;原句&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;如：要更改循环的常规流程，可以使用&lt;strong&gt;break&lt;/strong&gt;语句（使您跳出当前循环）或&lt;strong&gt;continue&lt;/strong&gt;语句（跳过当前循环的当前迭代的其余部分）。&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;修改如下&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;要更改循环的通常流程，请调用以下语句之一：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;break&lt;/code&gt;，使您跳出当前循环。&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;continue&lt;/code&gt;，跳过当前循环的当前迭代的其余部分。&lt;/li&gt;
&lt;/ul&gt;
&lt;/blockquote&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;减少使用重复的单词&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;减少从属子句。&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h3&gt;列表和表格&lt;/h3&gt;
&lt;p&gt;好的列表可以把混乱的技术内容转变为有序的事物，技术读者通常喜欢列表。&lt;/p&gt;
&lt;h4&gt;选择正确的列表类型&lt;/h4&gt;
&lt;p&gt;下面的列表在技术写作中经常被使用：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;项目列表。&lt;/li&gt;
&lt;/ul&gt;
&lt;blockquote&gt;
&lt;p&gt;如：Bash提供以下字符串操作机制：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;从字符串开头删除子字符串&lt;/li&gt;
&lt;li&gt;将整个文件读入一个字符串变量&lt;/li&gt;
&lt;/ul&gt;
&lt;/blockquote&gt;
&lt;ul&gt;
&lt;li&gt;数字编号列表。&lt;/li&gt;
&lt;/ul&gt;
&lt;blockquote&gt;
&lt;p&gt;如：请执行以下步骤来重新配置服务器：&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;停止服务器。&lt;/li&gt;
&lt;li&gt;编辑配置文件。&lt;/li&gt;
&lt;li&gt;重新启动服务器。&lt;/li&gt;
&lt;/ol&gt;
&lt;/blockquote&gt;
&lt;ul&gt;
&lt;li&gt;潜入编号清单。&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;​		项目列表和编号列表的区别，使用项目列表的时候，重新排列项目列表中的内容，则列表的含义&lt;strong&gt;不会改变&lt;/strong&gt;；使用编号列表是，重新排列编号列表中的内容，则列表的含义会&lt;strong&gt;改变&lt;/strong&gt;。&lt;/p&gt;
&lt;h4&gt;保持列表项一致&lt;/h4&gt;
&lt;p&gt;列表项一致是指列表中描述每一项都使用一样的词性、标点、句子结构（如都是主动句）。&lt;/p&gt;
&lt;p&gt;如下面句子就是列表项一致的：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;萝卜&lt;/li&gt;
&lt;li&gt;土豆&lt;/li&gt;
&lt;li&gt;卷心菜&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;下面的句子就是列表项不一致的：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;萝卜&lt;/li&gt;
&lt;li&gt;土豆&lt;/li&gt;
&lt;li&gt;夏日的阳光遮掩了冬天的所有回忆。&lt;/li&gt;
&lt;/ul&gt;
&lt;h4&gt;创建有用的表&lt;/h4&gt;
&lt;p&gt;大家对于表的展示信息会更加的关注。&lt;/p&gt;
&lt;p&gt;使用表时，请注意以下几点：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;每一列的标题都要取的有意义，不要让读者去猜测。&lt;/li&gt;
&lt;li&gt;每个单元格中不要放入过多的内容，如果超过两行，就需要仔细想一是否需要。&lt;/li&gt;
&lt;li&gt;争取每个列之间是相关性的。&lt;/li&gt;
&lt;/ul&gt;
&lt;h4&gt;使用表和列表前&lt;/h4&gt;
&lt;p&gt;​	在使用表和列表前加上一句话，告诉读者表格或者列表是要说明什么，然后用&lt;strong&gt;冒号&lt;/strong&gt;来终止介绍语句。&lt;/p&gt;
&lt;h3&gt;段落&lt;/h3&gt;
&lt;blockquote&gt;
&lt;p&gt;写作的工作：弄清主题各部分之间的依赖关系，并按逻辑的顺序呈现出来，使读者能够理解。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h4&gt;写一个好的开头&lt;/h4&gt;
&lt;p&gt;​		开头句子是段落中最重要的部分，好的开头确定了段落的中心思想。&lt;/p&gt;
&lt;h4&gt;每一段都只写一个主题&lt;/h4&gt;
&lt;p&gt;​		一段应只写一个主题，将每个段落都只写一个主题，不要描述之前的话题或者是之后的话题。&lt;/p&gt;
&lt;h4&gt;段落不要太长也不要太短&lt;/h4&gt;
&lt;p&gt;​		段落太长让看的人第一映像是恐惧，读者更喜欢包含三到五个句子的段落，但会避免包含超过七个句子的段落。&lt;/p&gt;
&lt;h4&gt;一个段落要提供什么&lt;/h4&gt;
&lt;p&gt;​		好的段落可以回答三个问题：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;你想告诉读者什么东西？&lt;/li&gt;
&lt;li&gt;读者为什么知道这点很重要？&lt;/li&gt;
&lt;li&gt;读者应该如何使用这些知识。&lt;/li&gt;
&lt;/ul&gt;
&lt;h3&gt;受众&lt;/h3&gt;
&lt;h4&gt;如何定义受众&lt;/h4&gt;
&lt;p&gt;我们通过简单的方式来确定受众；首先确定受众的角色，示例角色包括：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;软件工程师&lt;/li&gt;
&lt;li&gt;技术非工程师角色&lt;/li&gt;
&lt;li&gt;科学家们&lt;/li&gt;
&lt;li&gt;科学领域的专业人才&lt;/li&gt;
&lt;li&gt;本科生&lt;/li&gt;
&lt;li&gt;研究生&lt;/li&gt;
&lt;li&gt;非技术职位&lt;/li&gt;
&lt;/ul&gt;
&lt;h4&gt;确定受众需要学习内容&lt;/h4&gt;
&lt;p&gt;​		在写文章之前最好能确定受众需要掌握什么知识才能更好的读懂本文，可以把受众需要掌握的以列表的形式列出来。&lt;/p&gt;
&lt;h3&gt;文档&lt;/h3&gt;
&lt;p&gt;​		需要把所有的段落组织成一个连贯的文档。&lt;/p&gt;
&lt;h4&gt;声明文档范围&lt;/h4&gt;
&lt;p&gt;​		一个好的文档应该要说明它要说明的主题，以及不会说明什么；如下：&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;本文档描述了Project Frambus的总体设计；本文档未介绍相关技术Froobus项目的设计。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;​		说明文档的范围不仅能使读者受益，也能让作者受益。在编写时，可以时刻参考自己定义的文档范围并修正。&lt;/p&gt;
&lt;h3&gt;Markdown&lt;/h3&gt;
&lt;p&gt;​		&lt;code class=&quot;language-text&quot;&gt;Markdown&lt;/code&gt;是一种轻量级的标记语言，许多技术专业人员都是用它来创建和编辑技术文档，使用&lt;code class=&quot;language-text&quot;&gt;Markdown&lt;/code&gt;，通过插入特殊符号用来标示标题、粗体、列表等。&lt;/p&gt;</content:encoded></item><item><title><![CDATA[2020年十大战略技术趋势：分布式云]]></title><description><![CDATA[…]]></description><link>https://lengrongfu.github.io/2021-05-19-分布式云/</link><guid isPermaLink="false">https://lengrongfu.github.io/2021-05-19-分布式云/</guid><pubDate>Wed, 19 May 2021 23:50:31 GMT</pubDate><content:encoded>&lt;h3&gt;概述&lt;/h3&gt;
&lt;h3&gt;关键发现&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;分布式云是第一个将云提供的服务的物理位置作为其定义的一部分的云模型。&lt;/li&gt;
&lt;li&gt;分布式云修复了混合云模型中通常存在的云价值链中的不连续性。云提供商正在采用不同的方法和模型来解决此类问题。&lt;/li&gt;
&lt;li&gt;分布式云将分阶段出现。在第一阶段，企业将其作为打包的，受位置限制的分布式云产品进行部署和使用。在第二阶段中，电信公司和市政府等第三方将参与其中。&lt;/li&gt;
&lt;li&gt;新的高级用例和对云计算的更复杂的使用正在增加可供IT专业人员使用的云服务的范围。这些分布式云体系结构中的每一个都通常基于邻近性，控制，可伸缩性和可用服务的广度提供一组不同的权衡。&lt;/li&gt;
&lt;/ul&gt;
&lt;h3&gt;推荐建议&lt;/h3&gt;
&lt;p&gt;评估战略技术趋势的影响和竞争优势潜力的企业体系结构和技术创新领导者必须：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;通过定位与位置相关的用例，使用分布式云模型作为为下一代云计算做准备的机会。&lt;/li&gt;
&lt;li&gt;通过使用分布式云的按需混合特性，克服私有云和混合云实现中的不足。&lt;/li&gt;
&lt;li&gt;确定分布式云的未来阶段的用例（例如低延迟，受限的规模和数据驻留），这些用例可通过使用分布式云“变电站”得到增强。&lt;/li&gt;
&lt;li&gt;调查使云提供商负责甚至内部部署的云操作，以克服当今的私有云和混合云计算的失败和不足。&lt;/li&gt;
&lt;/ul&gt;
&lt;h3&gt;战略规划假设&lt;/h3&gt;
&lt;p&gt;到&lt;code class=&quot;language-text&quot;&gt;2024&lt;/code&gt;年，大多数云服务平台将至少提供一些在需要时执行的分布式云服务。&lt;/p&gt;
&lt;h3&gt;分析&lt;/h3&gt;
&lt;h4&gt;为什么分布式云是十大趋势&lt;/h4&gt;
&lt;p&gt;​		随着越来越多的人使用云计算，他们将使用更高级的功能。而且供应商正在以更加细致和智能的方式提供云功能，从而在新的业务案例中认识到新的客户价值。“云计算的未来是什么？“这一问题的答案就是&lt;strong&gt;分布式云&lt;/strong&gt;。它是指将公共云服务分发到不同的物理位置，而服务的运营，治理和演进仍然是公共云提供商的责任。与描述未来的任何事物一样，分布式云基于今天可见的起源。分布式云将全球公共云区域，混合云和边缘计算的各个方面带入了云计算的原始世界（见图1）。图1.分布式云&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://gitee.com/lengrongfu/blog-static-file/raw/master/20210519113745.png&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;p&gt;​		由于云计算本身的重要性，我们已将分布式云确定为&lt;code class=&quot;language-text&quot;&gt;2020&lt;/code&gt;年十大战略技术趋势。云计算实际上是下一件大事的基础，包括其他十大战略技术趋势。&lt;/p&gt;
&lt;h4&gt;分布式云最适合的地方前十名&lt;/h4&gt;
&lt;p&gt;​		这种趋势是智能空间类别的一部分（参见图2），同时还包括授权的边缘，自治的事物，实用的区块链和&lt;code class=&quot;language-text&quot;&gt;AI&lt;/code&gt;安全性。图2.分布式云在战略技术趋势的前十大列表中的位置。&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://gitee.com/lengrongfu/blog-static-file/raw/master/20210519114008.png&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;p&gt;分布式云与其他十大战略技术趋势中的三个具有很大的协同作用。这以下的三个趋势的实现基础是分布式云：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;赋权的边缘。&lt;/strong&gt; 边缘设备将利用从邻近到端点（例如，在网关和本地微数据中心上）到远程云区域无处不在的分布式云系统。&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;实用的区块链&lt;/strong&gt; 随着区块链的成熟，更多的处理将在边缘和其他地方进行。但是，这些环境中的许多环境都限制了计算能力，缓慢的联网和有限的数据存储功能。他们将越来越依赖由分布式云提供支持的功能。&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;AI安全。&lt;/strong&gt; 手动监视和管理大量的未来边缘设备将是不可能的。基于AI的安全系统对于通过分布式功能识别异常行为至关重要。&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;这三大十大技术成功部署和使用的关键因素是&lt;strong&gt;位置&lt;/strong&gt;。分布式云将成为在所需位置交付云功能以支持其他十大技术的基础。&lt;/p&gt;
&lt;h3&gt;分布式云介绍&lt;/h3&gt;
&lt;p&gt;​		分布式云将公共云服务分布到不同的物理位置，代表着与大多数公共云服务的虚拟化集中式模型以及与通用云概念相关的模型的重大转变。这将引领云计算的新纪元。 &lt;code class=&quot;language-text&quot;&gt;Gartner&lt;/code&gt;将云计算定义为一种计算样式，其中使用&lt;code class=&quot;language-text&quot;&gt;Internet&lt;/code&gt;技术将作为服务的弹性可伸缩&lt;code class=&quot;language-text&quot;&gt;IT&lt;/code&gt;功能交付为服务。此定义没有提及位置。长期以来，云计算一直被视为提供商数据中心中运行的“集中式”服务的代名词。但是，最好将其视为逻辑上集中或统一的服务。私有云和混合云选项补充了此公共云模型。 &lt;em&gt;私有云&lt;/em&gt; 指的是专门针对通常在自己的数据中心中运行的各个公司创建云服务。 &lt;em&gt;混合云&lt;/em&gt; 指私有云和公共云服务的集成以支持并行，集成或互补的任务。位置是分布式云概念的关键部分。分布式云将功能分布到不同的位置。以分布式方式部署云服务为从中央公共云到边缘设备和场景的连续云服务提供了更强大的支持。访问在边缘设备上运行的云服务的能力可以将云资源分配给不同的用例。它使单个设备可以满足不同的连接要求；附近的景点；以及社区，城市，国家或整个地区。分布式云还可以满足不同的物理安全性和耐用性要求。这个统一体统一了云。&lt;/p&gt;
&lt;h3&gt;分布式云具有三个起源：公共云区域，混合云和边缘计算&lt;/h3&gt;
&lt;h4&gt;公共云&lt;/h4&gt;
&lt;p&gt;​		在超大规模公共云实施中，公共云是“宇宙的中心”。但是，几乎自云计算服务诞生以来，它就已经在全球范围内分布在公共云中。提供商在世界各地具有不同的区域，所有区域均由一个公共云提供商进行集中控制，管理和提供。云服务的位置是分布式云计算模型的关键组成部分。从历史上看，位置与云定义无关，但是在许多情况下，与之相关的问题很重要。出于多种原因（包括数据主权）以及对延迟敏感的用例，位置可能很重要。在这些情况下，分布式云服务为组织提供了在满足其要求的位置提供的公共云服务的功能。&lt;/p&gt;
&lt;h4&gt;混合云&lt;/h4&gt;
&lt;p&gt;​		混合云概念的目标是以优化，高效和经济高效的方式将提供商的外部服务与内部运行的内部服务混合在一起。但是，实施私有云非常困难。混合云计算需要公共云和私有云。大多数私有云项目无法提供组织所寻求的云成果和收益。此外，Gartner与客户进行的有关混合云的大多数对话都不是真正的混合云方案。相反，它们是关于混合IT场景的，在该场景中，非云技术与一系列类似云的模型一起用于公共云服务。这就是所谓的云启发式（请参阅 “四种类型的云计算描述了云计算的价值范围”））。混合IT和真正的混合云选项是有效的方法，我们建议在某些用例中使用它们。但是大多数混合云样式破坏了许多云计算的价值主张，并且未能：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;将运行硬件和软件基础架构的责任和工作转移到云提供商&lt;/li&gt;
&lt;li&gt;从大量共享资源中利用云弹性的经济性（上下扩展）&lt;/li&gt;
&lt;li&gt;与公共云提供商同步从创新的步伐中受益&lt;/li&gt;
&lt;li&gt;使用全球超大规模服务的成本经济学&lt;/li&gt;
&lt;li&gt;利用大型云提供商的技能来保护和运营世界一流的服务&lt;/li&gt;
&lt;/ul&gt;
&lt;h5&gt;包装的混合云&lt;/h5&gt;
&lt;p&gt;​		下一代混合（和私有）云被打包在一起解决了混合云的许多问题。打包的混合云是指由供应商提供的私有云产品，该产品以捆绑方式打包并连接到公共云。打包的混合云有两种主要方法：“按需比较”混合和“分层技术”混合（跨越不同的技术基础）。&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;Microsoft Azure&lt;/code&gt;和&lt;code class=&quot;language-text&quot;&gt;Azure Stack&lt;/code&gt;代表了“按需&lt;strong&gt;混合”方法&lt;/strong&gt;。&lt;code class=&quot;language-text&quot;&gt;Azure Stack&lt;/code&gt;与公共云中的&lt;code class=&quot;language-text&quot;&gt;Azure&lt;/code&gt;不同。它是一个子集，但提供了一组功能，这些功能可反映&lt;code class=&quot;language-text&quot;&gt;Azure&lt;/code&gt;公共云中的服务。另一个示例是，&lt;code class=&quot;language-text&quot;&gt;AWS Outposts&lt;/code&gt;可以在托管的私有云模式下使用（没有其他公司可以访问此模式）。它代表了“按需使用”方法的示例。但是，以&lt;code class=&quot;language-text&quot;&gt;AWS Outposts&lt;/code&gt;代表的更广泛的策略将鼓励采用更加分散的模型，其中每个&lt;code class=&quot;language-text&quot;&gt;Outposts&lt;/code&gt;部署都向附近的邻居开放。同类解决方案提供了“完整堆栈”，但不一定提供硬件，所有解决方案均由单个供应商管理。&lt;/li&gt;
&lt;/ol&gt;
&lt;ul&gt;
&lt;li&gt;在&lt;code class=&quot;language-text&quot;&gt;Azure Stack&lt;/code&gt;方法中， 客户购买并拥有一个硬件平台。云软件层随提供商的公共云服务的子集一起交付。在这种情况下，云提供商通常不对底层硬件平台的正在进行的操作，维护或更新承担全部责任。云提供商可能仅对该软件承担部分责任。用户自行负责或使用托管服务提供商负责。&lt;/li&gt;
&lt;li&gt;在&lt;code class=&quot;language-text&quot;&gt;AWS Outposts&lt;/code&gt;模型中， 将既包含硬件又包含软件的完整设备交付给客户。云提供商负责支持和维护硬件和软件。客户提供了托管系统的物理设施，但否则云提供商将设备作为其中央云服务的扩展有效运行。&lt;/li&gt;
&lt;li&gt;尽管软件方法在公共服务和本地实施之间提供了类似的模型，但是混合云的其他挑战仍然存在。一些客户认为控制服务更新是一种优势。&lt;/li&gt;
&lt;/ul&gt;
&lt;ol start=&quot;2&quot;&gt;
&lt;li&gt;&lt;strong&gt;分层技术混合方法&lt;/strong&gt; 基于不同基础技术，平台和功能的集成-创建各种可移植性层。这就是&lt;code class=&quot;language-text&quot;&gt;Google&lt;/code&gt;和&lt;code class=&quot;language-text&quot;&gt;IBM&lt;/code&gt;（及其他公司）关注的重点-带有&lt;code class=&quot;language-text&quot;&gt;Anthos&lt;/code&gt;（以前称为其云服务平台）的&lt;code class=&quot;language-text&quot;&gt;Google&lt;/code&gt;和带有&lt;code class=&quot;language-text&quot;&gt;Red Hat&lt;/code&gt;和&lt;code class=&quot;language-text&quot;&gt;OpenShift&lt;/code&gt;的&lt;code class=&quot;language-text&quot;&gt;IBM&lt;/code&gt;。&lt;/li&gt;
&lt;/ol&gt;
&lt;ul&gt;
&lt;li&gt;通过这种方法，提供商可以提供通常基于&lt;code class=&quot;language-text&quot;&gt;Kubernetes&lt;/code&gt;构建的可移植层，作为跨分布式环境的服务的基础。在某些情况下，可移植性层仅使用容器来支持容器化应用程序的执行。在其他情况下，提供商将其某些云服务作为可在分布式环境中运行的容器化服务来提供。可移植性方法忽略了底层硬件平台的所有权和管理，这仍然是客户的责任。&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;​		存在组合方法和其他方法。在这些服务中，提供商以硬件/软件组合的形式提供其某些云服务的同类版本，并且提供商致力于管理和更新服务。这减轻了服务使用者的负担，他们可以将服务视为“黑匣子”。但是，有些客户会不满意放弃对底层硬件和软件更新周期的所有控制权。&lt;/p&gt;
&lt;h5&gt;混合云Promise上的分布式云交付&lt;/h5&gt;
&lt;p&gt;​		分布式云超出了云提供商拥有的数据中心的范围（例如，云提供商具有不同区域的模型）。在分布式云中，原始公共云提供商负责云服务体系结构，交付，运营，治理和更新的所有方面。这将恢复在客户负责交付的一部分时被打破的云价值主张，这在混合云场景中通常是这种情况。云提供商不需要拥有安装分布式云服务的硬件。但是，在完全实施分布式云模型时，云提供商必须对如何管理和维护该硬件承担全部责任。&lt;/p&gt;
&lt;h4&gt;边缘云&lt;/h4&gt;
&lt;p&gt;​		分布式云的基本概念是，公有云提供商负责设计，架构，交付，操作，维护，更新和所有权，通常包括底层硬件。但是，随着解决方案越来越靠近边缘，云提供商通常不希望拥有整个技术栈，这是不希望的或不可行的。由于这些服务被分发到操作系统（例如，发电厂或风电场）上，因此消费组织可能不希望将物理工厂的所有权和管理权交给外部供应商。但是，消费组织可能会对提供商在此类设备上交付，管理和更新的服务感兴趣。移动设备，智能手机和其他客户端设备也是如此。因此，我们预计，随着提供商接受不同级别的所有权和责任，将会出现一系列交付模型。另一个会影响公共云服务分布的边缘因素将是边缘，近边缘和远边缘平台的功能。可能不需要或无法运行在集中式云中进行镜像的同类服务。低目标物联网&lt;code class=&quot;language-text&quot;&gt;（IoT）&lt;/code&gt;或存储设备等针对目标环境量身定制的补充服务将成为分布式云频谱的一部分（例如，&lt;code class=&quot;language-text&quot;&gt;AWS IoT Greengrass&lt;/code&gt;，&lt;code class=&quot;language-text&quot;&gt;AWS Snowball&lt;/code&gt;和&lt;code class=&quot;language-text&quot;&gt;Azure Stack Edge&lt;/code&gt;）。但是，如果要将这些服务视为分布式云频谱的一部分，则云提供商至少必须设计，架构，分发，管理和更新这些服务。分布式云支持从分布到特定和不同位置的公共云中的云服务的连续连接和断续连接操作。这实现了低延迟服务执行，其中云服务更接近远程数据中心的需求点，或者一直传递到边缘设备本身。这可以大大提高性能，降低与全球网络相关的中断的风险，并支持偶尔连接的场景。到&lt;code class=&quot;language-text&quot;&gt;2024&lt;/code&gt;年，大多数云服务平台将至少提供一些在需要时执行的服务。这实现了低延迟服务执行，其中云服务更接近远程数据中心的需求点，或者一直传递到边缘设备本身。这可以大大提高性能，降低与全球网络相关的中断的风险，并支持偶尔连接的场景。到&lt;code class=&quot;language-text&quot;&gt;2024&lt;/code&gt;年，大多数云服务平台将至少提供一些在需要时执行的服务。这实现了低延迟服务执行，其中云服务更接近远程数据中心的需求点，或者一直传递到边缘设备本身。这可以大大提高性能，降低与全球网络相关的中断的风险，并支持偶尔连接的场景。到&lt;code class=&quot;language-text&quot;&gt;2024&lt;/code&gt;年，大多数云服务平台将至少提供一些在需要时执行的服务。&lt;/p&gt;
&lt;h3&gt;分布式云的演变&lt;/h3&gt;
&lt;h4&gt;分布式云有那几个阶段&lt;/h4&gt;
&lt;p&gt;我们预计分布式云计算将分四个阶段进行：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;阶段1.&lt;/strong&gt; 相似的混合模式，其中云提供商以分布式方式交付服务，该服务镜像其集中式云中的服务子集以在企业中交付。&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;阶段2。&lt;/strong&gt; 按需模型的扩展，其中云提供商与第三方合作，以通过第三方提供商向目标社区交付其集中式云服务的子集。一个例子是通过电信提供商或托管提供商提供服务，以支持提供商没有数据中心的较小国家/地区对数据主权的要求。&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;阶段3。&lt;/strong&gt; 组织社区共享分布式云变电站。我们使用“变电站”一词来唤起人们聚集使用服务的子站（例如分支邮局）的形象。如果云客户开放给社区或公共使用，则云客户可以出于常见或多种原因聚集在分布式云变电站中，以使用云服务。这提高了与支付分布式云变电站的安装和运营相关的经济性。当其他公司使用变电站时，他们可以分担安装成本。我们预计，诸如电信服务提供商之类的第三方将考虑在公共云提供商缺少位置的位置创建变电站。如果变电站在为其安装付费的组织外部不开放使用，&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;阶段4.&lt;/strong&gt; 使用嵌入式和个人资源。示例包括在个人设备上使用本地处理，在智能建筑中嵌入功能以及在软件包或应用程序中嵌入的组件。&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;​		具有讽刺意味的是，分布式云采用了与位置无关的东西（云计算），引入了位置重要性，并最终消除了对位置的担忧。以最完整的形式，分布式云方法将使组织能够向云提供商指定其要求（例如，合规性和安全性，预算和容量）。云提供商将越来越以自动化的方式生成最佳配置，而无需详细的位置知识。除了解决区域，混合和边缘问题之外，分布式云方法还将支持其他方案。这些包括针对政府和特定行业社区云的专用连接实施，以及可能满足地缘政治需求的解决方案。此类地缘政治问题导致越来越多的国家关注与主要互联网的连接。其中包括审查制度，安全性，隐私权和数据主权。互联网和云方案的这种“碎片化”无视简单的解决方案-分布式云功能可以提供帮助。&lt;/p&gt;
&lt;h4&gt;分布式云的路径&lt;/h4&gt;
&lt;p&gt;​		分布式云处于开发的早期阶段。许多提供商的目标是长期提供分布式的大多数公共服务。但是，它们目前仅以分布式方式提供有限的消费模型（形状因数），仅提供其服务的一个子集（通常是一小部分）。一些提供商不支持完整分布式云的完整交付，操作和更新元素。提供商正在将服务扩展到本地数据中心，第三方数据中心和边缘。他们通过&lt;code class=&quot;language-text&quot;&gt;Microsoft Azure Stack&lt;/code&gt;，客户的&lt;code class=&quot;language-text&quot;&gt;Oracle Cloud&lt;/code&gt;，&lt;code class=&quot;language-text&quot;&gt;Google Anthos&lt;/code&gt;，&lt;code class=&quot;language-text&quot;&gt;IBM Red Hat&lt;/code&gt;和&lt;code class=&quot;language-text&quot;&gt;AWS Outposts&lt;/code&gt;（以及&lt;code class=&quot;language-text&quot;&gt;AWS Local Zones&lt;/code&gt;和&lt;code class=&quot;language-text&quot;&gt;AWS Wavelength&lt;/code&gt;）等产品来做到这一点。分层技术包装方法。在实现分布式云的愿景方面，每种方法都涉及挑战。类似的方法往往会导致围墙花园。分层方法可能会面临交付便携式开放软件的挑战。这两种方法都可以带来一个开放的，完全托管的多云解决方案，但要通过不同的途径并面临截然不同的挑战。&lt;/p&gt;
&lt;h3&gt;行动&lt;/h3&gt;
&lt;p&gt;企业架构和技术创新领导者必须：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;通过定位与位置相关的用例，使用分布式云模型为下一代云计算做准备的机会。&lt;/li&gt;
&lt;li&gt;通过使用分布式云的按需混合特性，克服私有云和混合云实现中的不足。&lt;/li&gt;
&lt;li&gt;确定分布式云的未来阶段（例如，低延迟，限制规模和数据驻留）的使用案例，这些使用案例可以通过使用分布式云变电站来增强。&lt;/li&gt;
&lt;li&gt;确定场景，在这些场景中，分布式云模型将消除对“传统”混合云模型的需求，并且将持续需要多年的混合云模型。&lt;/li&gt;
&lt;li&gt;调查使云提供商负责甚至内部部署的云操作，以克服当今的私有云和混合云计算的失败和不足。&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;利用增加的云计算部署选项提供的灵活性。&lt;/p&gt;</content:encoded></item><item><title><![CDATA[断更的这段时间我去哪了？]]></title><description><![CDATA[​	    前几天一个朋友问，你写文章为什么断更了，然后就有了这篇文章，我来说下断更的这段时间都去做什么了？最后一次发文是在月，以及为什么现在又开始更新了。
< !—more…]]></description><link>https://lengrongfu.github.io/2021-05-15-断更的这段时间我去哪了/</link><guid isPermaLink="false">https://lengrongfu.github.io/2021-05-15-断更的这段时间我去哪了/</guid><pubDate>Sat, 15 May 2021 00:35:50 GMT</pubDate><content:encoded>&lt;p&gt;​	    前几天一个朋友问，你写文章为什么断更了，然后就有了这篇文章，我来说下断更的这段时间都去做什么了？最后一次发文是在&lt;code class=&quot;language-text&quot;&gt;2019-10&lt;/code&gt;月，以及为什么现在又开始更新了。
&amp;#x3C; !—more—&gt;
​        我先简短说一下，这一年半我换了两次工作、离开了之前生活以及工作了多年的城市&lt;strong&gt;成都&lt;/strong&gt;，来到了&lt;strong&gt;北京&lt;/strong&gt;，成为了北漂一族，来到北京之后工作任务繁重就没有再继续写&lt;code class=&quot;language-text&quot;&gt;blog&lt;/code&gt;了。&lt;/p&gt;
&lt;p&gt;​	   下面我会从为什么开始写&lt;code class=&quot;language-text&quot;&gt;blog&lt;/code&gt;、写作过程中的变化、为什么来北京、北漂的生活、入职、未来、找工作几个方面来描述今天的主题。&lt;/p&gt;
&lt;h3&gt;为什么想写blog&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;第一：在写&lt;code class=&quot;language-text&quot;&gt;blog&lt;/code&gt;之前，我看了不少优秀的的软件工程师写的&lt;code class=&quot;language-text&quot;&gt;blog&lt;/code&gt;，他们会写他们自己学习的东西、自己的读书见解、自己的思考（包括对过去的总结，对未来的规划）等一系列的知识，有时候我常常会把一个人的博客通读一遍，所以这些优秀的博客对我的影响最大。&lt;/li&gt;
&lt;li&gt;第二：在看别人&lt;code class=&quot;language-text&quot;&gt;blog&lt;/code&gt;中提到写&lt;code class=&quot;language-text&quot;&gt;blog&lt;/code&gt;最大的好处就是，这个过程可以总结自己学习到的知识，算是一种输出；因为我刚毕业时也是什么都不懂，所以想着也把学习的东西总结下来。&lt;/li&gt;
&lt;li&gt;第三：写&lt;code class=&quot;language-text&quot;&gt;blog&lt;/code&gt;可以锻炼一个人的写作能力，这是很重要的一个技能；我自认为我的写作技能需要提升。&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;基于以上三点呢，我就使用&lt;code class=&quot;language-text&quot;&gt;Github pages&lt;/code&gt;开通了我的第一个&lt;code class=&quot;language-text&quot;&gt;blog&lt;/code&gt;，开启了写&lt;code class=&quot;language-text&quot;&gt;blog&lt;/code&gt;之旅。&lt;/p&gt;
&lt;h3&gt;写作过程中的变化&lt;/h3&gt;
&lt;p&gt;​		从写作到现在我发现了几点问题，也在持续的学习并改进中；&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;第一：我刚开始写作更多是以记录为主，更多的是描述怎么解决这个问题。但是并没有深入的去探究它背后的原理；比如&lt;code class=&quot;language-text&quot;&gt;blog&lt;/code&gt;最开始的几篇就是我毕业不久写的文章；我意识到这样对自己是没有提高的，我不能只做一个永远只会解决问题的人，也需要拥有找到问题的本质的能力。这个是我持续在改进的。&lt;/li&gt;
&lt;li&gt;第二：我们国家写&lt;code class=&quot;language-text&quot;&gt;blog&lt;/code&gt;的质量这些年持续在进步，这是好事，也会倒逼我去改进自己写的&lt;code class=&quot;language-text&quot;&gt;blog&lt;/code&gt;。&lt;/li&gt;
&lt;li&gt;第三：写作能力的提高需要有持续的输入，也就是持续的看书，才能写出更好的内容；这也会倒逼我去学习更多、更深层次的东西。&lt;/li&gt;
&lt;/ul&gt;
&lt;h3&gt;为什么来北京&lt;/h3&gt;
&lt;p&gt;​		一句话概括就是天时、地理、人和刚好都满足，也就是时机成熟了。&lt;/p&gt;
&lt;p&gt;​		天时：在&lt;code class=&quot;language-text&quot;&gt;2019&lt;/code&gt;年底第一家公司经营不善，就把我裁了。也就是这段时间新冠爆发了。&lt;/p&gt;
&lt;p&gt;​		地理：在新冠爆发之后都采用了视频面试，我可以异地面试并走完流程，然后直接入职就可以了；我后面再说这个的问题。&lt;/p&gt;
&lt;p&gt;​       人和：认识了一些从外省大厂回去的朋友；刚好一个朋友建议我可以出去看看。当时我&lt;code class=&quot;language-text&quot;&gt;25&lt;/code&gt;岁，工作三年左右经验，并且能力不差，所以建议我出来闯一闯。&lt;/p&gt;
&lt;p&gt;​		我之前从来没有想过离开&lt;strong&gt;成都&lt;/strong&gt;，第一次听到这想法的时候我就在想有什么不可以呢，所以立即就和家里的领导商量了一通，领导通情达理很支持我，我们就规划着我先来北京，后面再接领导过来，就这样计划着。&lt;/p&gt;
&lt;p&gt;​		然后我就开始了选择离开&lt;strong&gt;成都&lt;/strong&gt;的去处，当时选择了&lt;strong&gt;北京&lt;/strong&gt;、&lt;strong&gt;杭州&lt;/strong&gt;；便开始了投递这两个地方的岗位，后面再来说下这个找工作的经历，那真是一波三折，最后也就只拿到一个&lt;strong&gt;百度&lt;/strong&gt;的&lt;code class=&quot;language-text&quot;&gt;offer&lt;/code&gt;。&lt;/p&gt;
&lt;p&gt;​		然后我选择地方的依据就两点：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;第一：互联网大公司多不多，能不能成长。&lt;/li&gt;
&lt;li&gt;第二：工资不能太低，之前拿的是二线城市的工资。&lt;/li&gt;
&lt;/ul&gt;
&lt;h3&gt;北漂的生活&lt;/h3&gt;
&lt;p&gt;​		经过一段时间的找工作之后拿到了&lt;strong&gt;百度&lt;/strong&gt;&lt;code class=&quot;language-text&quot;&gt;offer&lt;/code&gt;，当时工资被压了不少，于是又和家里领导一顿商量要不要来，最后结果还是来了，领导建议看长远一些。&lt;/p&gt;
&lt;p&gt;​		离开&lt;strong&gt;成都&lt;/strong&gt;前和一些好朋友一起吃了顿饯行饭，大家也还是支持我出来看看的；在离家前也是把家里都打点好了，什么电表没电要怎么弄，钥匙备份一把到物业，把近期能遇到的问题都解决好了；然后就装了两箱东西就来了，一箱被子，一箱衣服，再背上我的电脑就开始了我的北漂之旅。&lt;/p&gt;
&lt;p&gt;​		在来之前已经租好房了，所以可以直接入住；但是来就发现找了一个不靠谱的房子，找的房间租金是&lt;code class=&quot;language-text&quot;&gt;1900&lt;/code&gt;，使用面积只有&lt;code class=&quot;language-text&quot;&gt;10&lt;/code&gt;平方不到，并且房子还没装修好，我来早了就只能先入住了，然后后面就是我住在里面然后还在装修；这样过了几天之后，最后因为合租的舍友和中介签订合同没达成一致，就不了了之；这个时候我从公司内部平台也找到了房子，于是搬去了程序员的合租区&lt;strong&gt;回龙观&lt;/strong&gt;。&lt;/p&gt;
&lt;p&gt;​		突然来到了一个陌生的环境，而且还是带着使命来的，就导致刚来的时候内心很煎熬，压力很大，经常睡不着；但是过了一段时间工作实在太忙了，忙得我都没有压力，可以睡着了。&lt;/p&gt;
&lt;p&gt;​		过了这一年，我也早已经适应了北京的生活，有了一些朋友，并且剩下大把的时间可以让我来干自己的事情，每个周末最开心的事情就是来公司学习着自己喜欢的东西。感觉租的房子只是睡觉的地方，只有睡觉的时候才会回去一下，公司才是生活的地方。&lt;/p&gt;
&lt;p&gt;​		为什么来北京的都叫北漂呢？因为这些人都是居无定所，没有家，所以叫北漂。&lt;/p&gt;
&lt;p&gt;​		为什么北京的节奏很快呢？我认为是大家都想在短时间内用付出&lt;code class=&quot;language-text&quot;&gt;200%&lt;/code&gt;以上的努力得到可观的回报，这是通过燃烧自己的生命做代价的一种投入，但是依然有很多人前赴后继的加入，那就说明这里面的诱惑足够给力。&lt;/p&gt;
&lt;h3&gt;入职&lt;/h3&gt;
&lt;p&gt;​		穿到桥头自然直，一切的选择都是最好的安排。&lt;/p&gt;
&lt;p&gt;​		我应聘的这个岗位是&lt;code class=&quot;language-text&quot;&gt;Java后端开发&lt;/code&gt;，然后部门业务是负责公司的&lt;code class=&quot;language-text&quot;&gt;CRM&lt;/code&gt;系统，我之前一直都是做基础架构的，更多的做服务，本来做业务我也不排斥，但是我希望能做一些有挑战的项目，却没有收到合适的&lt;code class=&quot;language-text&quot;&gt;Offer&lt;/code&gt;。但并不是&lt;code class=&quot;language-text&quot;&gt;CRM&lt;/code&gt;没有挑战，据我所知全球最大的&lt;code class=&quot;language-text&quot;&gt;PASS&lt;/code&gt;应用厂家&lt;code class=&quot;language-text&quot;&gt;Salesforse&lt;/code&gt;就是做&lt;code class=&quot;language-text&quot;&gt;CRM&lt;/code&gt;出生的，但是他们的项目挑战很大。&lt;/p&gt;
&lt;p&gt;​		我来的时候内心已经妥协了，想着做就做吧，我只要保持持续学习，自己能力不掉就行了，业务这个我也控制不了，所以就来了；然后来了才发现，部门项目要大重构，要成立一个基础技术小组，我被安排到这个组了，我心想真是天意啊，那我就可以继续做基础技术服务了。&lt;/p&gt;
&lt;p&gt;​		再之后工作中一次偶然想到要用&lt;code class=&quot;language-text&quot;&gt;Kubernetes&lt;/code&gt;，于是就点燃了我的热情，之前我一直就想做这个方向，都是苦于之前只会用，根本做不了开发，于是称着这个机会，我又系统的深入的学习了一遍，以及怎么开发等相关知识都是学习了一遍，在这个过程中，我就想到干脆我以后就做这个方向吧，反正这个方向前景很好，并且我对这个领域很感兴趣。&lt;/p&gt;
&lt;p&gt;​		能让我再次有机会接触到&lt;code class=&quot;language-text&quot;&gt;Kubernetes&lt;/code&gt;并且开发，我得感谢组长，并且我喜欢这样的领导，做事看结果，并且使用的技术方案他会予以支持。&lt;/p&gt;
&lt;p&gt;​		所以一切的选择都是最好的安排，我以为我从此要在&lt;code class=&quot;language-text&quot;&gt;Java&lt;/code&gt;后端的大潮中沉沦了，但是上天眷顾了我，也或许是我之前的技术积累拯救了我。&lt;/p&gt;
&lt;h3&gt;未来&lt;/h3&gt;
&lt;p&gt;​		未来我会去做云原生相关产业中的项目，会作为一个深挖的领域，并持续的输出有质量的文章。&lt;/p&gt;
&lt;h3&gt;找工作&lt;/h3&gt;
&lt;p&gt;​		在视频面试下，面试官对候选人的要求更高了，而且如果没有大厂经验，可能要进入一个新的大厂更难；在我面试百度这段时间，同时面试了杭州菜鸟、北京字节、北京美团、北京小米等公司，但是均没有通过，杭州菜鸟以两次五面失之交臂，北京字节以加面第四面没写出一面面试官出的题的算法最优解而失之交臂，美团、小米均是二面挂；最终就只拿到了百度的&lt;code class=&quot;language-text&quot;&gt;Offer&lt;/code&gt;。&lt;/p&gt;
&lt;p&gt;​		所以在视频面试的模式下，让候选人的流动更加方便，但是对于候选人的面试要求更高了，但是如果要是有大厂经验，那面试会简单不少。&lt;/p&gt;
&lt;p&gt;​		当我拥有百度这个头衔之后，再次出去面试我相信会好很多，所以这也是看长远一些的收益吧。&lt;/p&gt;
&lt;h3&gt;结束语&lt;/h3&gt;
&lt;p&gt;​		随着工作的渐渐稳定下来，未来我会定期更新&lt;code class=&quot;language-text&quot;&gt;blog&lt;/code&gt;，持续往感兴趣的方向发力。&lt;/p&gt;
&lt;p&gt;​		大厂提供给我们的是平台，只有提升自己的能力才能轻松应对这个变化的环境。&lt;/p&gt;
&lt;p&gt;​		不论能力怎么样都不要随意糟蹋自己的履历，否则跳槽太频繁会失去很多机会。&lt;/p&gt;</content:encoded></item><item><title><![CDATA[Kubernetes Network]]></title><description><![CDATA[Kubernetes Network…]]></description><link>https://lengrongfu.github.io/2021-05-13-Kubernetes-Network/</link><guid isPermaLink="false">https://lengrongfu.github.io/2021-05-13-Kubernetes-Network/</guid><pubDate>Thu, 13 May 2021 23:06:05 GMT</pubDate><content:encoded>&lt;h1&gt;Kubernetes Network&lt;/h1&gt;
&lt;h2&gt;一、单机容器网络&lt;/h2&gt;
&lt;h3&gt;名词&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;网络栈：网络栈包括了网卡(&lt;code class=&quot;language-text&quot;&gt;Network Interface&lt;/code&gt;)、回环设备(&lt;code class=&quot;language-text&quot;&gt;Loopback Device&lt;/code&gt;)、路由表(&lt;code class=&quot;language-text&quot;&gt;Routing Table&lt;/code&gt;)和&lt;code class=&quot;language-text&quot;&gt;Iptables&lt;/code&gt;规则，对于一个进程来说，这些要素，就构成了它发起请求和响应网络请求的基本环境。&lt;/li&gt;
&lt;li&gt;网桥(&lt;code class=&quot;language-text&quot;&gt;Bridge&lt;/code&gt;)：&lt;code class=&quot;language-text&quot;&gt;bridge&lt;/code&gt;是一个虚拟网络设备，所以具有网络设备的特征，可以配置&lt;code class=&quot;language-text&quot;&gt;IP&lt;/code&gt;、&lt;code class=&quot;language-text&quot;&gt;MAC&lt;/code&gt;地址；&lt;code class=&quot;language-text&quot;&gt;Bridger&lt;/code&gt;是一个虚拟交换机，具有和物理交换机类似的功能。它是工作在数据链路层的设备。&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;Veth Pair&lt;/code&gt;: 虚拟网线，用来连接容器到网桥上的；它被创建出来以后，总是以两张虚拟网卡(&lt;code class=&quot;language-text&quot;&gt;Veth Peer&lt;/code&gt;)的形式成对出现，并且，从其中一个网卡发出的数据包会自动出现在与之对应的网卡上，哪怕是这两张_*网卡_在不同的&lt;code class=&quot;language-text&quot;&gt;Network Namespace&lt;/code&gt;中。&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;ARP&lt;/code&gt;: 是一个通过三层的&lt;code class=&quot;language-text&quot;&gt;IP&lt;/code&gt;地址找到对应二层&lt;code class=&quot;language-text&quot;&gt;MAC&lt;/code&gt;地址的协议。&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;CAM表&lt;/code&gt;：虚拟交换机(这里是网桥)通过&lt;code class=&quot;language-text&quot;&gt;MAC&lt;/code&gt;地址学习维护的端口和&lt;code class=&quot;language-text&quot;&gt;MAC&lt;/code&gt;地址的对应表。&lt;/li&gt;
&lt;/ul&gt;
&lt;h3&gt;Host网络&lt;/h3&gt;
&lt;p&gt;作为一个容器，在启动时可以通过指定&lt;code class=&quot;language-text&quot;&gt;-net=host&lt;/code&gt;，使用宿主机的&lt;code class=&quot;language-text&quot;&gt;Network Namespace&lt;/code&gt;。&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;$ docker run -d -net=host --name nginx-1 nginx&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;使用&lt;code class=&quot;language-text&quot;&gt;Host&lt;/code&gt;网络的优点是网络性能较好，直接使用宿主机的网络栈，缺点是会引入共享网络资源的问题，比如端口冲突。&lt;strong&gt;所以，在多数情况下，我们都希望能使用自己Network Namespace里的网络栈，拥有属于自己的IP和端口。&lt;/strong&gt;&lt;/p&gt;
&lt;h3&gt;如何通信&lt;/h3&gt;
&lt;p&gt;&lt;img src=&quot;https://gitee.com/lengrongfu/blog-static-file/raw/master/single_node_container_network.png&quot; alt=&quot;单节点容器网络通信&quot;&gt;&lt;/p&gt;
&lt;p&gt;如上图，描述了单节点容器网络的通信流程，下面主要按&lt;code class=&quot;language-text&quot;&gt;C1-&gt;C2&lt;/code&gt;的访问流程来详细描述交互流程:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;# 先创建两个容器，用于模拟发起请求,启动两个centos容器，并在里面安装net-tools工具，才可以使用ifconfig命令
# 创建C1，并安装net-tools
$ docker run -d -it --name c1 centos /bin/bash
$ docker exec -it c1 bash
$ [root@60671509044e /]# yum install -y net-tools
# 创建C2，并安装net-tools
$ docker run -d -it --name c2 centos /bin/bash
$ docker exec -it c2 bash
$ [root@94a6c877b01a /]# yum install -y net-tools&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;ul&gt;
&lt;li&gt;容器&lt;code class=&quot;language-text&quot;&gt;C1&lt;/code&gt;和&lt;code class=&quot;language-text&quot;&gt;C2&lt;/code&gt;启动之后，在容器中都有一条默认的路由规则，当前容器网段的所有请求都会走&lt;code class=&quot;language-text&quot;&gt;eth0&lt;/code&gt;网卡设备。
&lt;ul&gt;
&lt;li&gt;C1&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;# 进入c1容器，查看ip以及路由表
$ docker exec -it c1 bash
# 查看IP
$ ifconfig
eth0: flags=4163&amp;lt;UP,BROADCAST,RUNNING,MULTICAST&gt;  mtu 1500
        inet 172.17.0.7  netmask 255.255.0.0  broadcast 172.17.255.255
        ether 02:42:ac:11:00:07  txqueuelen 0  (Ethernet)
        RX packets 6698  bytes 9678058 (9.2 MiB)
        RX errors 0  dropped 0  overruns 0  frame 0
        TX packets 3518  bytes 195061 (190.4 KiB)
        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0

lo: flags=73&amp;lt;UP,LOOPBACK,RUNNING&gt;  mtu 65536
        inet 127.0.0.1  netmask 255.0.0.0
        loop  txqueuelen 1000  (Local Loopback)
        RX packets 0  bytes 0 (0.0 B)
        RX errors 0  dropped 0  overruns 0  frame 0
        TX packets 0  bytes 0 (0.0 B)
        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0
# 查看路由       
$ route
Kernel IP routing table
Destination     Gateway         Genmask         Flags Metric Ref    Use Iface
default         _gateway        0.0.0.0         UG    0      0        0 eth0
172.17.0.0      0.0.0.0         255.255.0.0     U     0      0        0 eth0&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;C2&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;# 进入C2容器查看IP和路由表
$ docker exec -it c2 bash
$ ifconfig
eth0: flags=4163&amp;lt;UP,BROADCAST,RUNNING,MULTICAST&gt;  mtu 1500
        inet 172.17.0.8  netmask 255.255.0.0  broadcast 172.17.255.255
        ether 02:42:ac:11:00:08  txqueuelen 0  (Ethernet)
        RX packets 6771  bytes 9681937 (9.2 MiB)
        RX errors 0  dropped 0  overruns 0  frame 0
        TX packets 3227  bytes 179347 (175.1 KiB)
        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0

lo: flags=73&amp;lt;UP,LOOPBACK,RUNNING&gt;  mtu 65536
        inet 127.0.0.1  netmask 255.0.0.0
        loop  txqueuelen 1000  (Local Loopback)
        RX packets 0  bytes 0 (0.0 B)
        RX errors 0  dropped 0  overruns 0  frame 0
        TX packets 0  bytes 0 (0.0 B)
        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0
# 查看路由
$ route
Kernel IP routing table
Destination     Gateway         Genmask         Flags Metric Ref    Use Iface
default         _gateway        0.0.0.0         UG    0      0        0 eth0
172.17.0.0      0.0.0.0         255.255.0.0     U     0      0        0 eth0&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;上述容器现实有自己的&lt;code class=&quot;language-text&quot;&gt;IP&lt;/code&gt;以及&lt;code class=&quot;language-text&quot;&gt;MAC&lt;/code&gt;地址，并且每个容器中都有默认路由&lt;code class=&quot;language-text&quot;&gt;_gateway&lt;/code&gt;指向&lt;code class=&quot;language-text&quot;&gt;eth0&lt;/code&gt;网卡；并且&lt;code class=&quot;language-text&quot;&gt;_gateway&lt;/code&gt;有对应的&lt;code class=&quot;language-text&quot;&gt;MAC&lt;/code&gt;地址已经存在于本地&lt;code class=&quot;language-text&quot;&gt;ARP&lt;/code&gt;缓存中。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;主机之间网络通信需要用到&lt;code class=&quot;language-text&quot;&gt;MAC&lt;/code&gt;地址，这是数据链路层识别主机的方式，&lt;code class=&quot;language-text&quot;&gt;C1&lt;/code&gt;访问&lt;code class=&quot;language-text&quot;&gt;C2&lt;/code&gt;的时候会先从本地&lt;code class=&quot;language-text&quot;&gt;ARP&lt;/code&gt;缓存中查找是否有&lt;code class=&quot;language-text&quot;&gt;C2&lt;/code&gt;容器对应的&lt;code class=&quot;language-text&quot;&gt;IP:172.17.0.3&lt;/code&gt;的&lt;code class=&quot;language-text&quot;&gt;MAC&lt;/code&gt;地址。如果没有就会发起&lt;code class=&quot;language-text&quot;&gt;ARP&lt;/code&gt;协议查找&lt;code class=&quot;language-text&quot;&gt;MAC&lt;/code&gt;地址。&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;# c1 -&gt; c2 ,先发起ARP请求查找MAC地址，可以在容器中查看ARP缓存对应IP的MAC
$ docker exec -it c1 bash
# 先查看本地的ARP缓存
$ [root@94a6c877b01a /]# arp
Address                  HWtype  HWaddress           Flags Mask            Iface
_gateway                 ether   02:42:2e:8d:21:d6   C                     eth0
# 执行ping命令就会发起ARP寻址请求
$ ping 172.17.0.8
# 再查询本地arp缓存，发现已经有MAC地址存在了
$ [root@60671509044e /]# arp
Address                  HWtype  HWaddress           Flags Mask            Iface
172.17.0.8               ether   02:42:ac:11:00:08   C                     eth0
_gateway                 ether   02:42:2e:8d:21:d6   C                     eth0&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;ARP&lt;/code&gt;寻址流程：&lt;code class=&quot;language-text&quot;&gt;C1&lt;/code&gt;容器发起&lt;code class=&quot;language-text&quot;&gt;ARP&lt;/code&gt;请求，进过本地路由协议之后会把请求路由到网桥上，此时网桥(&lt;code class=&quot;language-text&quot;&gt;Bridge&lt;/code&gt;)充当一个虚拟交换机，虚拟交换机会把&lt;code class=&quot;language-text&quot;&gt;ARP&lt;/code&gt;广播到其它插入到网桥的所有容器，&lt;code class=&quot;language-text&quot;&gt;C2&lt;/code&gt;收到&lt;code class=&quot;language-text&quot;&gt;ARP&lt;/code&gt;协议之后会回复&lt;code class=&quot;language-text&quot;&gt;MAC&lt;/code&gt;地址。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;查找到&lt;code class=&quot;language-text&quot;&gt;C2&lt;/code&gt;的&lt;code class=&quot;language-text&quot;&gt;MAC&lt;/code&gt;地址之后就可以发起通信。&lt;/li&gt;
&lt;/ul&gt;
&lt;h2&gt;二、跨主机容器通信&lt;/h2&gt;
&lt;blockquote&gt;
&lt;p&gt;跨主机之间容器通信按是否依赖底层网络环境来划分主要分为&lt;code class=&quot;language-text&quot;&gt;Overlay&lt;/code&gt;和&lt;code class=&quot;language-text&quot;&gt;Underlay&lt;/code&gt;两种网络结构，&lt;code class=&quot;language-text&quot;&gt;Overlay&lt;/code&gt;网络要求只是主机之间网络可达即可，不要求主机之间同处二层域；&lt;code class=&quot;language-text&quot;&gt;Underlay&lt;/code&gt;对底层的基础设施有要求，按照实现的方式对底层的网络基础设施有不同的要求，比如&lt;code class=&quot;language-text&quot;&gt;Flanan host-gw&lt;/code&gt;组件要求主机之间同处二层域，也就是主机之间要连接到一个交换机上。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h4&gt;名词&lt;/h4&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;Overlay Network&lt;/code&gt;(覆盖网络): 在已有的宿主机网络之上，通过软件构建一个覆盖在宿主机网络之上的、可以把所有容器连通在一起的虚拟网络。&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;Tun设备(Tunnel设备)&lt;/code&gt;：在&lt;code class=&quot;language-text&quot;&gt;Linux&lt;/code&gt;中，&lt;code class=&quot;language-text&quot;&gt;TUN&lt;/code&gt;设备是一种工作在三层（&lt;code class=&quot;language-text&quot;&gt;Network Layer&lt;/code&gt;）的虚拟网络设备;&lt;code class=&quot;language-text&quot;&gt;Tun&lt;/code&gt;设备的功能就是在操作系统内核和用户应用程序之间传递&lt;code class=&quot;language-text&quot;&gt;IP&lt;/code&gt;包，&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;VXLAN&lt;/code&gt;: 虚拟可扩展局域网(&lt;code class=&quot;language-text&quot;&gt;Virtual Extensible LAN&lt;/code&gt;),是&lt;code class=&quot;language-text&quot;&gt;LINUX&lt;/code&gt;内核支持的一种网络虚拟化技术，&lt;code class=&quot;language-text&quot;&gt;VXLAN&lt;/code&gt;完全在内核态实现网络数据包的封装和解封装。&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;VTEP&lt;/code&gt;：虚拟隧道端点设备，它既有&lt;code class=&quot;language-text&quot;&gt;IP&lt;/code&gt;，也有&lt;code class=&quot;language-text&quot;&gt;MAC&lt;/code&gt;地址。&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;BGP&lt;/code&gt;: 边界网关协议（&lt;code class=&quot;language-text&quot;&gt;Border Gateway Protocol&lt;/code&gt;）,它是一个&lt;code class=&quot;language-text&quot;&gt;Linux&lt;/code&gt;内核原生就支持的、专门用在大规模数据中心里维护不同的自治系统之间路由信息的、无中心的路由协议。&lt;/li&gt;
&lt;/ul&gt;
&lt;h3&gt;跨主机通信&lt;/h3&gt;
&lt;p&gt;跨主机之间的容器通信，通过采用&lt;code class=&quot;language-text&quot;&gt;Overlay Network&lt;/code&gt;来实现跨主机之间的容器通信，&lt;code class=&quot;language-text&quot;&gt;Overlay Network&lt;/code&gt;的实现有多种方式。&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://gitee.com/lengrongfu/blog-static-file/raw/master/overlay_network.png&quot; alt=&quot;Overlay Network&quot;&gt;&lt;/p&gt;
&lt;h3&gt;Overlay 模式&lt;/h3&gt;
&lt;h5&gt;1、三层Flannel UDP&lt;/h5&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;Flannel UDP&lt;/code&gt;模式是&lt;code class=&quot;language-text&quot;&gt;Flannel&lt;/code&gt;最开始提供的一种最简单且最易实现的容器跨主网络方案，但是因为性能最差，所以后来被弃用。但是对于理解&lt;code class=&quot;language-text&quot;&gt;Overlay&lt;/code&gt;的实现方式还是很有参考意义的。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;我们以一个例子来讲述这个网络访问的流程，在这个流程中，有两台宿主机，四个容器，我们需要通过&lt;code class=&quot;language-text&quot;&gt;Container-1&lt;/code&gt;容器请求&lt;code class=&quot;language-text&quot;&gt;Container-4&lt;/code&gt;。&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://gitee.com/lengrongfu/blog-static-file/raw/master/flannel_udp_network.png&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;Container-1&lt;/code&gt;容器向&lt;code class=&quot;language-text&quot;&gt;Container-4&lt;/code&gt;容器发起请求，&lt;code class=&quot;language-text&quot;&gt;Docker0&lt;/code&gt;是位于&lt;code class=&quot;language-text&quot;&gt;Root Network Namespace&lt;/code&gt;的，通过&lt;code class=&quot;language-text&quot;&gt;veth peer&lt;/code&gt;一头连着容器的&lt;code class=&quot;language-text&quot;&gt;Network Namespace&lt;/code&gt;一头连着位于&lt;code class=&quot;language-text&quot;&gt;Root Netwrok Namespace&lt;/code&gt;的&lt;code class=&quot;language-text&quot;&gt;Docker0&lt;/code&gt;虚拟网络设备。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;容器&lt;code class=&quot;language-text&quot;&gt;100.96.1.2&lt;/code&gt;访问&lt;code class=&quot;language-text&quot;&gt;100.96.2.2&lt;/code&gt;，由于目的地址不在&lt;code class=&quot;language-text&quot;&gt;Docker0&lt;/code&gt;网桥的网段内(通过&lt;code class=&quot;language-text&quot;&gt;ARP&lt;/code&gt;请求一次就知道目标容器不在此网桥上)，所以这个&lt;code class=&quot;language-text&quot;&gt;IP&lt;/code&gt;会执行&lt;code class=&quot;language-text&quot;&gt;Container-1&lt;/code&gt;的默认路由规则中，容器中的默认路由规则就是如下的&lt;code class=&quot;language-text&quot;&gt;default via 172.17.0.1 dev eth0 &lt;/code&gt;。对应到上图的步骤1。&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;shell&quot;&gt;&lt;pre class=&quot;language-shell&quot;&gt;&lt;code class=&quot;language-shell&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;# 容器中默认设置的的路由规则，&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;root@94a6c877b01a /&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token comment&quot;&gt;# ip route&lt;/span&gt;
default via &lt;span class=&quot;token number&quot;&gt;172.17&lt;/span&gt;.0.1 dev eth0 
&lt;span class=&quot;token number&quot;&gt;172.17&lt;/span&gt;.0.0/16 dev eth0 proto kernel scope &lt;span class=&quot;token function&quot;&gt;link&lt;/span&gt; src &lt;span class=&quot;token number&quot;&gt;172.17&lt;/span&gt;.0.2 
&lt;span class=&quot;token comment&quot;&gt;# 下一跳是172.17.0.1且从eth0设备上出去，通过查看docker的网络，172.17.0.1就是bridge设备的网关IP&lt;/span&gt;
lengrongfu@MacintoshdeMacBook-Pro ~ % docker network &lt;span class=&quot;token function&quot;&gt;ls&lt;/span&gt;        
NETWORK ID     NAME                               DRIVER    SCOPE
e522990979b3   bridge                             bridge    &lt;span class=&quot;token builtin class-name&quot;&gt;local&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;# 查看网络&lt;/span&gt;
lengrongfu@MacintoshdeMacBook-Pro ~ % docker inspect network e522990979b3
&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;token string&quot;&gt;&quot;Name&quot;&lt;/span&gt;&lt;span class=&quot;token builtin class-name&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;bridge&quot;&lt;/span&gt;,
        &lt;span class=&quot;token string&quot;&gt;&quot;Id&quot;&lt;/span&gt;&lt;span class=&quot;token builtin class-name&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;e522990979b365e9df4d967c3600483e598e530361deb28513b6e75b8b66bedf&quot;&lt;/span&gt;,
        &lt;span class=&quot;token string&quot;&gt;&quot;Created&quot;&lt;/span&gt;&lt;span class=&quot;token builtin class-name&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;2021-04-12T12:11:57.321486866Z&quot;&lt;/span&gt;,
        &lt;span class=&quot;token string&quot;&gt;&quot;Scope&quot;&lt;/span&gt;&lt;span class=&quot;token builtin class-name&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;local&quot;&lt;/span&gt;,
        &lt;span class=&quot;token string&quot;&gt;&quot;Driver&quot;&lt;/span&gt;&lt;span class=&quot;token builtin class-name&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;bridge&quot;&lt;/span&gt;,
        &lt;span class=&quot;token string&quot;&gt;&quot;EnableIPv6&quot;&lt;/span&gt;&lt;span class=&quot;token builtin class-name&quot;&gt;:&lt;/span&gt; false,
        &lt;span class=&quot;token string&quot;&gt;&quot;IPAM&quot;&lt;/span&gt;&lt;span class=&quot;token builtin class-name&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;token string&quot;&gt;&quot;Driver&quot;&lt;/span&gt;&lt;span class=&quot;token builtin class-name&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;default&quot;&lt;/span&gt;,
            &lt;span class=&quot;token string&quot;&gt;&quot;Options&quot;&lt;/span&gt;&lt;span class=&quot;token builtin class-name&quot;&gt;:&lt;/span&gt; null,
            &lt;span class=&quot;token string&quot;&gt;&quot;Config&quot;&lt;/span&gt;&lt;span class=&quot;token builtin class-name&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;
                &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
                    &lt;span class=&quot;token string&quot;&gt;&quot;Subnet&quot;&lt;/span&gt;&lt;span class=&quot;token builtin class-name&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;172.17.0.0/16&quot;&lt;/span&gt;,
                    &lt;span class=&quot;token string&quot;&gt;&quot;Gateway&quot;&lt;/span&gt;&lt;span class=&quot;token builtin class-name&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;172.17.0.1&quot;&lt;/span&gt;
                &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
            &lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;,
        &lt;span class=&quot;token string&quot;&gt;&quot;Internal&quot;&lt;/span&gt;&lt;span class=&quot;token builtin class-name&quot;&gt;:&lt;/span&gt; false,
        &lt;span class=&quot;token string&quot;&gt;&quot;Attachable&quot;&lt;/span&gt;&lt;span class=&quot;token builtin class-name&quot;&gt;:&lt;/span&gt; false,
        &lt;span class=&quot;token string&quot;&gt;&quot;Ingress&quot;&lt;/span&gt;&lt;span class=&quot;token builtin class-name&quot;&gt;:&lt;/span&gt; false,
        &lt;span class=&quot;token string&quot;&gt;&quot;ConfigFrom&quot;&lt;/span&gt;&lt;span class=&quot;token builtin class-name&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;token string&quot;&gt;&quot;Network&quot;&lt;/span&gt;&lt;span class=&quot;token builtin class-name&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;&quot;&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;,
        &lt;span class=&quot;token string&quot;&gt;&quot;ConfigOnly&quot;&lt;/span&gt;&lt;span class=&quot;token builtin class-name&quot;&gt;:&lt;/span&gt; false,
        &lt;span class=&quot;token string&quot;&gt;&quot;Containers&quot;&lt;/span&gt;&lt;span class=&quot;token builtin class-name&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;token string&quot;&gt;&quot;94a6c877b01ac3a1638f1c5cde87e7c58be9ce0aafd4a78efcb96528ab00ed94&quot;&lt;/span&gt;&lt;span class=&quot;token builtin class-name&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
                &lt;span class=&quot;token string&quot;&gt;&quot;Name&quot;&lt;/span&gt;&lt;span class=&quot;token builtin class-name&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;c2&quot;&lt;/span&gt;,
                &lt;span class=&quot;token string&quot;&gt;&quot;EndpointID&quot;&lt;/span&gt;&lt;span class=&quot;token builtin class-name&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;a5c12fb3800991228f8dc3a2a8de1d6f4865439701a83558e4430c2aebf783a8&quot;&lt;/span&gt;,
                &lt;span class=&quot;token string&quot;&gt;&quot;MacAddress&quot;&lt;/span&gt;&lt;span class=&quot;token builtin class-name&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;02:42:ac:11:00:02&quot;&lt;/span&gt;,
                &lt;span class=&quot;token string&quot;&gt;&quot;IPv4Address&quot;&lt;/span&gt;&lt;span class=&quot;token builtin class-name&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;172.17.0.2/16&quot;&lt;/span&gt;,
                &lt;span class=&quot;token string&quot;&gt;&quot;IPv6Address&quot;&lt;/span&gt;&lt;span class=&quot;token builtin class-name&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;&quot;&lt;/span&gt;
            &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;,
        &lt;span class=&quot;token string&quot;&gt;&quot;Options&quot;&lt;/span&gt;&lt;span class=&quot;token builtin class-name&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;token string&quot;&gt;&quot;com.docker.network.bridge.default_bridge&quot;&lt;/span&gt;&lt;span class=&quot;token builtin class-name&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;true&quot;&lt;/span&gt;,
            &lt;span class=&quot;token string&quot;&gt;&quot;com.docker.network.bridge.enable_icc&quot;&lt;/span&gt;&lt;span class=&quot;token builtin class-name&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;true&quot;&lt;/span&gt;,
            &lt;span class=&quot;token string&quot;&gt;&quot;com.docker.network.bridge.enable_ip_masquerade&quot;&lt;/span&gt;&lt;span class=&quot;token builtin class-name&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;true&quot;&lt;/span&gt;,
            &lt;span class=&quot;token string&quot;&gt;&quot;com.docker.network.bridge.host_binding_ipv4&quot;&lt;/span&gt;&lt;span class=&quot;token builtin class-name&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;0.0.0.0&quot;&lt;/span&gt;,
            &lt;span class=&quot;token string&quot;&gt;&quot;com.docker.network.bridge.name&quot;&lt;/span&gt;&lt;span class=&quot;token builtin class-name&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;docker0&quot;&lt;/span&gt;,
            &lt;span class=&quot;token string&quot;&gt;&quot;com.docker.network.driver.mtu&quot;&lt;/span&gt;&lt;span class=&quot;token builtin class-name&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;1500&quot;&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;,
        &lt;span class=&quot;token string&quot;&gt;&quot;Labels&quot;&lt;/span&gt;&lt;span class=&quot;token builtin class-name&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;ul&gt;
&lt;li&gt;进入到&lt;code class=&quot;language-text&quot;&gt;Docker0&lt;/code&gt;网桥之后就按照主机上的路由取决于后续如何走。如下就是主机的路由表，访问目标&lt;code class=&quot;language-text&quot;&gt;IP&lt;/code&gt;为&lt;code class=&quot;language-text&quot;&gt;100.96.2.2&lt;/code&gt;的设备会命中第二条匹配规则，意思是访问&lt;code class=&quot;language-text&quot;&gt;100.96.0.0/16&lt;/code&gt;网段的数据去&lt;code class=&quot;language-text&quot;&gt;flannel0&lt;/code&gt;设备，并且愿&lt;code class=&quot;language-text&quot;&gt;IP&lt;/code&gt;为&lt;code class=&quot;language-text&quot;&gt;100.96.1.0&lt;/code&gt;。对应到上图的步骤2。&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;shell&quot;&gt;&lt;pre class=&quot;language-shell&quot;&gt;&lt;code class=&quot;language-shell&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;# Node1路由表&lt;/span&gt;
$ &lt;span class=&quot;token function&quot;&gt;ip&lt;/span&gt; route
&lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt; Default via &lt;span class=&quot;token number&quot;&gt;10.168&lt;/span&gt;.0.1 dev eth0
&lt;span class=&quot;token number&quot;&gt;2&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;100.96&lt;/span&gt;.0.0/16 dev flannel0 proto kernel scope &lt;span class=&quot;token function&quot;&gt;link&lt;/span&gt; src &lt;span class=&quot;token number&quot;&gt;100.96&lt;/span&gt;.1.0
&lt;span class=&quot;token number&quot;&gt;3&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;100.96&lt;/span&gt;.1.0/24 dev docker0 proto kernel scope &lt;span class=&quot;token function&quot;&gt;link&lt;/span&gt; src &lt;span class=&quot;token number&quot;&gt;100.96&lt;/span&gt;.1.1
&lt;span class=&quot;token number&quot;&gt;4&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;10.168&lt;/span&gt;.0.0/24 dev eth0 proto kernel scope &lt;span class=&quot;token function&quot;&gt;link&lt;/span&gt; src &lt;span class=&quot;token number&quot;&gt;10.168&lt;/span&gt;.0.2&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h6&gt;Flannel0设备&lt;/h6&gt;
&lt;ul&gt;
&lt;li&gt;上述说了&lt;code class=&quot;language-text&quot;&gt;Flannel0&lt;/code&gt;是一个&lt;code class=&quot;language-text&quot;&gt;TUN&lt;/code&gt;虚拟三层网络设备，主要是在内核态和用户态之间传递&lt;code class=&quot;language-text&quot;&gt;IP&lt;/code&gt;包；继续按上述的流程分析，数据报文从内核态到达&lt;code class=&quot;language-text&quot;&gt;Flannel0&lt;/code&gt;设备之后，会被传递给创建&lt;code class=&quot;language-text&quot;&gt;Flannel0&lt;/code&gt;设备的进程也就是&lt;code class=&quot;language-text&quot;&gt;FlannelD&lt;/code&gt;进程，然后&lt;code class=&quot;language-text&quot;&gt;flanneld&lt;/code&gt;进程看到目的地址是&lt;code class=&quot;language-text&quot;&gt;100.96.2.2&lt;/code&gt;,就把数据报文发送到&lt;code class=&quot;language-text&quot;&gt;Node2&lt;/code&gt;节点上的&lt;code class=&quot;language-text&quot;&gt;flanneld&lt;/code&gt;进程监听的&lt;code class=&quot;language-text&quot;&gt;UDP&lt;/code&gt;端口上。&lt;code class=&quot;language-text&quot;&gt;flanneld&lt;/code&gt;会把要发送的数据封装为一个&lt;code class=&quot;language-text&quot;&gt;UDP&lt;/code&gt;数据包发出去。对应到上图的步骤3、4、5、6。
&lt;ul&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;flanneld&lt;/code&gt;进程是怎么知道&lt;code class=&quot;language-text&quot;&gt;100.96.2.2&lt;/code&gt;这个&lt;code class=&quot;language-text&quot;&gt;ip&lt;/code&gt;在&lt;code class=&quot;language-text&quot;&gt;Node2&lt;/code&gt;上呢，这是因为它利用了子网，在每个节点启动的时候都会被指定一个字网段，通过字网就能确定这个&lt;code class=&quot;language-text&quot;&gt;ip&lt;/code&gt;是属于那个节点的，子网被存在&lt;code class=&quot;language-text&quot;&gt;etcd&lt;/code&gt;里面。&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;Node2&lt;/code&gt;上的&lt;code class=&quot;language-text&quot;&gt;flanneld&lt;/code&gt;进程收到数据包之后，会发送到&lt;code class=&quot;language-text&quot;&gt;flannel0&lt;/code&gt;设备上，这是一个从用户态到内核态的过程，所以&lt;code class=&quot;language-text&quot;&gt;Linux&lt;/code&gt;内核网络协议栈就会负责处理这个&lt;code class=&quot;language-text&quot;&gt;IP&lt;/code&gt;包，具体的处理方法，就是通过本机的路由表来寻找这个&lt;code class=&quot;language-text&quot;&gt;IP&lt;/code&gt;包的下一步流向。对应到上图的步骤7、8。&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;shell&quot;&gt;&lt;pre class=&quot;language-shell&quot;&gt;&lt;code class=&quot;language-shell&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;# node2上的路由表&lt;/span&gt;
$ &lt;span class=&quot;token function&quot;&gt;ip&lt;/span&gt; route
&lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt; default via &lt;span class=&quot;token number&quot;&gt;10.168&lt;/span&gt;.0.1 dev eth0
&lt;span class=&quot;token number&quot;&gt;2&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;100.96&lt;/span&gt;.0.0/16 dev flannel0 proto kernel scope &lt;span class=&quot;token function&quot;&gt;link&lt;/span&gt; src &lt;span class=&quot;token number&quot;&gt;100.96&lt;/span&gt;.2.0
&lt;span class=&quot;token number&quot;&gt;3&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;100.96&lt;/span&gt;.2.0/24 dev docker0 proto kernel scope &lt;span class=&quot;token function&quot;&gt;link&lt;/span&gt; src &lt;span class=&quot;token number&quot;&gt;100.96&lt;/span&gt;.2.1
&lt;span class=&quot;token number&quot;&gt;4&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;10.168&lt;/span&gt;.0.0/24 dev eth0 proto kernel scope &lt;span class=&quot;token function&quot;&gt;link&lt;/span&gt; src &lt;span class=&quot;token number&quot;&gt;10.168&lt;/span&gt;.0.3&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;ul&gt;
&lt;li&gt;通过解析出目标&lt;code class=&quot;language-text&quot;&gt;ip&lt;/code&gt;为&lt;code class=&quot;language-text&quot;&gt;100.96.2.2&lt;/code&gt;，他和第三条的路由规则匹配更加精确，这条路由规则的意思是把发往&lt;code class=&quot;language-text&quot;&gt;100.96.2.0/24&lt;/code&gt;网段的的数据包发送到&lt;code class=&quot;language-text&quot;&gt;docker0&lt;/code&gt;设备上去，并且设置源&lt;code class=&quot;language-text&quot;&gt;IP&lt;/code&gt;为&lt;code class=&quot;language-text&quot;&gt;100.96.2.1&lt;/code&gt;。对应到上图的步骤9。&lt;/li&gt;
&lt;li&gt;数据包进入到&lt;code class=&quot;language-text&quot;&gt;docker0&lt;/code&gt;设备之后，&lt;code class=&quot;language-text&quot;&gt;docker0&lt;/code&gt;网桥会扮演二层交换机的角色，将数据包发送给正确的&lt;code class=&quot;language-text&quot;&gt;veth pair&lt;/code&gt;对，进过此设备之后就进入到&lt;code class=&quot;language-text&quot;&gt;Contaniner-2&lt;/code&gt;的网络协议栈中。对应到上图的步骤10。&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;Flannel UDP&lt;/code&gt;模式提供的是一个三层的&lt;code class=&quot;language-text&quot;&gt;Overlay&lt;/code&gt;网络，它首选对发出端的&lt;code class=&quot;language-text&quot;&gt;IP&lt;/code&gt;包进行&lt;code class=&quot;language-text&quot;&gt;UDP&lt;/code&gt;封装，然后在接收端进行解封装拿到原始&lt;code class=&quot;language-text&quot;&gt;IP&lt;/code&gt;包，进而把这个&lt;code class=&quot;language-text&quot;&gt;IP&lt;/code&gt;包转发给目标容器。&lt;/p&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;Flannel UDP&lt;/code&gt;模式有严重的性能问题，主要问题是，由于使用了&lt;code class=&quot;language-text&quot;&gt;TUN&lt;/code&gt;设备，仅在发出&lt;code class=&quot;language-text&quot;&gt;IP&lt;/code&gt;包的过程中，就需要经过三次用户态和内核态之间的数据拷贝。&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://gitee.com/lengrongfu/blog-static-file/raw/master/flannel_tun.png&quot; alt=&quot;tun&quot;&gt;&lt;/p&gt;
&lt;h5&gt;2、三层Calico ipip&lt;/h5&gt;
&lt;h5&gt;3、二层+三层VXLAN&lt;/h5&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;VXLAN&lt;/code&gt;网络的设计思想是，在现有的三层网络之上，覆盖一层虚拟的、由内核&lt;code class=&quot;language-text&quot;&gt;VXLAN&lt;/code&gt;模块负责维护的二层网络，使得连接在这个&lt;code class=&quot;language-text&quot;&gt;VXLAN&lt;/code&gt;二层网络上的主机之间，可以像在同一个局域网那样自由通信。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;blockquote&gt;
&lt;p&gt;为了能在二层网络上打通隧道，&lt;code class=&quot;language-text&quot;&gt;VXLAN&lt;/code&gt;会在宿主机上设置一个特殊的网络设备作为隧道的两端，这个设备就叫作&lt;code class=&quot;language-text&quot;&gt;VTEP&lt;/code&gt;，全称是：(&lt;code class=&quot;language-text&quot;&gt;VXLAN Tun End Poin&lt;/code&gt;)虚拟隧道端点。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;VTEP&lt;/code&gt;设备的作用和&lt;code class=&quot;language-text&quot;&gt;flanneld&lt;/code&gt;进程的作用是一样的，就是做数据包的封装和解封装，只不过，它进行封装和解封装的是二层数据帧，而且这个工作流程，全都是在内核里完成的。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h3&gt;Underlay 模式&lt;/h3&gt;
&lt;h5&gt;1、三层模式BGP&lt;/h5&gt;
&lt;p&gt;&lt;img src=&quot;https://gitee.com/lengrongfu/blog-static-file/raw/master/bgp.png&quot; alt=&quot;BGP&quot;&gt;&lt;/p&gt;
&lt;p&gt;如上图是一个典型的&lt;code class=&quot;language-text&quot;&gt;BGP&lt;/code&gt;网络拓扑图，通过&lt;code class=&quot;language-text&quot;&gt;Route1&lt;/code&gt;和&lt;code class=&quot;language-text&quot;&gt;Route2&lt;/code&gt;作为边界路由网关，把其它&lt;code class=&quot;language-text&quot;&gt;LAN&lt;/code&gt;的路由信息写入到当前的路由中，就实现了不同&lt;code class=&quot;language-text&quot;&gt;LAN&lt;/code&gt;下的路由信息同步，达到三层网络全通。&lt;/p&gt;
&lt;h6&gt;Calico BGP 使用&lt;/h6&gt;
&lt;p&gt;​		在了解了&lt;code class=&quot;language-text&quot;&gt;BGP&lt;/code&gt;之后，&lt;code class=&quot;language-text&quot;&gt;Calico&lt;/code&gt;项目的架构就非常容易理解了，它把每个主机节点当做一个边界路由来看待，所以在每个节点上都保存了所有其他节点的路由信息，我们来分析一下它的实现，它由三个部分组成：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;Calico&lt;/code&gt;的&lt;code class=&quot;language-text&quot;&gt;CNI&lt;/code&gt;插件，这是&lt;code class=&quot;language-text&quot;&gt;Caclico&lt;/code&gt;和&lt;code class=&quot;language-text&quot;&gt;Kubernetes&lt;/code&gt;对接的部分。&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;BIRD&lt;/code&gt;是&lt;code class=&quot;language-text&quot;&gt;BGP&lt;/code&gt;的客户端，专门负责在集群里面分发路由信息。&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;Felix&lt;/code&gt;,它是一个&lt;code class=&quot;language-text&quot;&gt;Demoset&lt;/code&gt;，负责在宿主机上插入路由规则（写入&lt;code class=&quot;language-text&quot;&gt;Linux&lt;/code&gt;内核的&lt;code class=&quot;language-text&quot;&gt;FIB&lt;/code&gt;转发信息表），以及维护&lt;code class=&quot;language-text&quot;&gt;Calico&lt;/code&gt;所需的网络设备等工作。&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;​	&lt;code class=&quot;language-text&quot;&gt;Calico BGP&lt;/code&gt;模式和&lt;code class=&quot;language-text&quot;&gt;Flannel host-gw&lt;/code&gt;模式不同，&lt;code class=&quot;language-text&quot;&gt;Calico&lt;/code&gt;没有创建任何的虚拟网桥设备，&lt;code class=&quot;language-text&quot;&gt;Calico&lt;/code&gt;的工作方式采用如下图来说明。&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://gitee.com/lengrongfu/blog-static-file/raw/master/calico_bgp.png&quot; alt=&quot;calico_bgp&quot;&gt;&lt;/p&gt;
&lt;p&gt;​		&lt;code class=&quot;language-text&quot;&gt;Calico BGP&lt;/code&gt;模式的网络交互图如上所示，如&lt;code class=&quot;language-text&quot;&gt;container1&lt;/code&gt;需要访问&lt;code class=&quot;language-text&quot;&gt;Container3&lt;/code&gt;，我们来分析下网络如何到达。因为没有采用&lt;code class=&quot;language-text&quot;&gt;cni0&lt;/code&gt;虚拟网桥设备，因此&lt;code class=&quot;language-text&quot;&gt;veth&lt;/code&gt;设备对的一端是在容器的&lt;code class=&quot;language-text&quot;&gt;Network Namespace&lt;/code&gt;中的，一端是在宿主机的容器网络空间的，&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;首先&lt;code class=&quot;language-text&quot;&gt;Calico CNI&lt;/code&gt;插件还需要在每个宿主机上为每个容器的&lt;code class=&quot;language-text&quot;&gt;Veth Pair&lt;/code&gt;设备配置一条路由规则，由于接受传入的&lt;code class=&quot;language-text&quot;&gt;IP&lt;/code&gt;包，比如：&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;shell&quot;&gt;&lt;pre class=&quot;language-shell&quot;&gt;&lt;code class=&quot;language-shell&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;# 192.168.0.2节点上的路由信息有&lt;/span&gt;
$ &lt;span class=&quot;token function&quot;&gt;ip&lt;/span&gt; route
&lt;span class=&quot;token number&quot;&gt;10.20&lt;/span&gt;.0.2 dev cali1 scope &lt;span class=&quot;token function&quot;&gt;link&lt;/span&gt;
&lt;span class=&quot;token number&quot;&gt;10.20&lt;/span&gt;.0.3 dev cali2 scope &lt;span class=&quot;token function&quot;&gt;link&lt;/span&gt;

&lt;span class=&quot;token comment&quot;&gt;# 192.168.0.3节点上的路由信息有&lt;/span&gt;
$ &lt;span class=&quot;token function&quot;&gt;ip&lt;/span&gt; route
&lt;span class=&quot;token number&quot;&gt;10.20&lt;/span&gt;.1.2 dev cali3 scope &lt;span class=&quot;token function&quot;&gt;link&lt;/span&gt;
&lt;span class=&quot;token number&quot;&gt;10.20&lt;/span&gt;.1.3 dev cali4 scope &lt;span class=&quot;token function&quot;&gt;link&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;ul&gt;
&lt;li&gt;每个节点上还有&lt;code class=&quot;language-text&quot;&gt;BGP&lt;/code&gt;广播的其它节点路由协议，比如：&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;shell&quot;&gt;&lt;pre class=&quot;language-shell&quot;&gt;&lt;code class=&quot;language-shell&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;# 192.168.0.2上有一条指向192.169.0.3的路由&lt;/span&gt;
$ &lt;span class=&quot;token function&quot;&gt;ip&lt;/span&gt; route
&lt;span class=&quot;token number&quot;&gt;10.20&lt;/span&gt;.1.0/24 via &lt;span class=&quot;token number&quot;&gt;192.168&lt;/span&gt;.0.3 dev eth0
&lt;span class=&quot;token comment&quot;&gt;# 192.168.0.3上有一条指向192.168.0.2的路由&lt;/span&gt;
$ &lt;span class=&quot;token function&quot;&gt;ip&lt;/span&gt; route
&lt;span class=&quot;token number&quot;&gt;10.20&lt;/span&gt;.0.0/24 via &lt;span class=&quot;token number&quot;&gt;192.168&lt;/span&gt;.0.2 dev eth0&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;ul&gt;
&lt;li&gt;默认的&lt;code class=&quot;language-text&quot;&gt;Calico BGP&lt;/code&gt;使用的是&lt;code class=&quot;language-text&quot;&gt;Node to Node&lt;/code&gt;的模式，会导致每个节点上的连接以&lt;code class=&quot;language-text&quot;&gt;N^2&lt;/code&gt;的数独增长，一般推荐少于使用&lt;code class=&quot;language-text&quot;&gt;100&lt;/code&gt;个节点的集群中。在大规模集群中，需要用到一个叫&lt;code class=&quot;language-text&quot;&gt;Route Reflector&lt;/code&gt;的模式，所有的路由会统一上报到一个中心节点，其它节点都从中心节点进行同步。&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;Calico BGP&lt;/code&gt;模式和&lt;code class=&quot;language-text&quot;&gt;Flannel host-gw&lt;/code&gt;模式一样，都有一个对基础网络设施的依赖，要求集群宿主机之间是二层可达的。假如宿主机之间处在不同的&lt;code class=&quot;language-text&quot;&gt;LAN&lt;/code&gt;下，就需要使用&lt;code class=&quot;language-text&quot;&gt;Calico ipip&lt;/code&gt;的&lt;code class=&quot;language-text&quot;&gt;Overlay&lt;/code&gt;模式了。&lt;/p&gt;
&lt;h5&gt;2、二层VLAN&lt;/h5&gt;
&lt;h5&gt;3、Flannel host-gw&lt;/h5&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;Flannel host-gw&lt;/code&gt;模式一张图就可以讲清楚他们之间的实现原理。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;&lt;img src=&quot;https://gitee.com/lengrongfu/blog-static-file/raw/master/flannel_hostgw.png&quot; alt=&quot;host-gw&quot;&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;CNI0&lt;/code&gt;设备是一个三层交换机，具有二层交换机的功能，同时具有独立&lt;code class=&quot;language-text&quot;&gt;IP&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;flannel&lt;/code&gt;以&lt;code class=&quot;language-text&quot;&gt;Daemonset&lt;/code&gt;的方式在每个节点上启动一个&lt;code class=&quot;language-text&quot;&gt;Flanneld&lt;/code&gt;进程，用于维护每个节点上的路由信息，实现方式是，本地&lt;/p&gt;
&lt;p&gt;如：&lt;code class=&quot;language-text&quot;&gt;192.168.1.0/24 via 10.20.0.3 dev eth0&lt;/code&gt;路由定义了访问&lt;code class=&quot;language-text&quot;&gt;192.168.1.0/24&lt;/code&gt;网段的下一跳为&lt;code class=&quot;language-text&quot;&gt;10.20.0.3&lt;/code&gt;并从&lt;code class=&quot;language-text&quot;&gt;eth0&lt;/code&gt;设备出。&lt;/p&gt;
&lt;p&gt;然后&lt;code class=&quot;language-text&quot;&gt;IP&lt;/code&gt;包被封装成帧发送出去的时候，会使用路由表里的下一跳来设置目的&lt;code class=&quot;language-text&quot;&gt;MAC&lt;/code&gt;地址；这样，就能通过二层网络达到目的宿主机。&lt;/p&gt;
&lt;p&gt;因为他会使用下一跳的目的&lt;code class=&quot;language-text&quot;&gt;MAC&lt;/code&gt;地址，所以它要求宿主机之间是二层联通的，不如就没法通过使用&lt;code class=&quot;language-text&quot;&gt;ARP&lt;/code&gt;协议用&lt;code class=&quot;language-text&quot;&gt;IP&lt;/code&gt;去获取&lt;code class=&quot;language-text&quot;&gt;MAC&lt;/code&gt;地址了。&lt;/p&gt;</content:encoded></item><item><title><![CDATA[文章全平台发布]]></title><description><![CDATA[…]]></description><link>https://lengrongfu.github.io/2021-05-12-文章全平台发布/</link><guid isPermaLink="false">https://lengrongfu.github.io/2021-05-12-文章全平台发布/</guid><pubDate>Wed, 12 May 2021 11:30:06 GMT</pubDate><content:encoded>&lt;p&gt;这篇文章主要是记录如何构建一个可以把文章发布到各平台的环境。&lt;/p&gt;
&lt;h3&gt;平台&lt;/h3&gt;
&lt;p&gt;之所以把文章发布到多平台有如下几点原因：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;扩大阅读的受众，让各个平台的用户都能共同学习，变得更好。&lt;/li&gt;
&lt;li&gt;防止文章被其它平台的用户复制、盗版。&lt;/li&gt;
&lt;li&gt;扩大个人的影响力。&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;文章发布的平台我选择了如下几个：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;自己的博客主页: &lt;a href=&quot;https://lengrongfu.github.io/&quot;&gt;LRF成长记&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;知乎：&lt;a href=&quot;https://www.zhihu.com/people/leng-77-26&quot;&gt;leng&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;简书: &lt;a href=&quot;https://www.jianshu.com/u/1ef6ada5fbb4&quot;&gt;LRF成长记&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;掘金: &lt;a href=&quot;https://juejin.cn/user/289926802576647/posts&quot;&gt;LRF成长记&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;SegmentFault：&lt;a href=&quot;https://segmentfault.com/u/lengrongfu/articles&quot;&gt;LRF成长记&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;微信公众号：&lt;strong&gt;菜鸟随笔&lt;/strong&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h3&gt;写文章&lt;/h3&gt;
&lt;p&gt;上述平台几乎都支持发布&lt;code class=&quot;language-text&quot;&gt;Markdown&lt;/code&gt;文件，除了微信公众号除外，后面我会讲到怎么用工具把&lt;code class=&quot;language-text&quot;&gt;Markdown&lt;/code&gt;直接转换为微信公众号可接受的内容。&lt;/p&gt;
&lt;h4&gt;1、图片&lt;/h4&gt;
&lt;p&gt;在写文档的过程中总会有需要用到图片，因此我们需要一个可以方便上传图片的工具，这里我们选用&lt;code class=&quot;language-text&quot;&gt;PicGo&lt;/code&gt;。&lt;/p&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;PicGo&lt;/code&gt;能快速上传图片并获取上传后的&lt;code class=&quot;language-text&quot;&gt;url&lt;/code&gt;，且兼容多平台。而且图片可以选择上传到多个平台：七牛、腾讯云、又拍云、&lt;code class=&quot;language-text&quot;&gt;github&lt;/code&gt;、阿里云、&lt;code class=&quot;language-text&quot;&gt;gitee&lt;/code&gt;等等，并且可以和&lt;code class=&quot;language-text&quot;&gt;typora&lt;/code&gt;无缝集成，&lt;code class=&quot;language-text&quot;&gt;typora&lt;/code&gt;是用来写&lt;code class=&quot;language-text&quot;&gt;Markdown&lt;/code&gt;的工具，稍后再来讲解。&lt;/p&gt;
&lt;p&gt;此处我选用&lt;code class=&quot;language-text&quot;&gt;Github&lt;/code&gt;作为我的图片存储，之所以没有选择&lt;code class=&quot;language-text&quot;&gt;gitee&lt;/code&gt;，是因为&lt;code class=&quot;language-text&quot;&gt;gitee&lt;/code&gt;有文件&lt;code class=&quot;language-text&quot;&gt;1M&lt;/code&gt;的限制，如果文件大于&lt;code class=&quot;language-text&quot;&gt;1M&lt;/code&gt;就不能创建外链了。&lt;/p&gt;
&lt;h5&gt;(1)下载PicGo&lt;/h5&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;PicGo&lt;/code&gt;的&lt;code class=&quot;language-text&quot;&gt;Github&lt;/code&gt;地址：&lt;a href=&quot;https://github.com/Molunerfinn/&quot;&gt;https://github.com/Molunerfinn/&lt;/a&gt;&lt;/p&gt;
&lt;h5&gt;(2) 配置&lt;/h5&gt;
&lt;p&gt;点击&lt;code class=&quot;language-text&quot;&gt;PicGo&lt;/code&gt;的&lt;strong&gt;打开详细窗口&lt;/strong&gt;，进行图床配置，此处配置为&lt;code class=&quot;language-text&quot;&gt;Github&lt;/code&gt;，需要设置仓库名：&lt;code class=&quot;language-text&quot;&gt;lengrongfu/images&lt;/code&gt;,分支：&lt;code class=&quot;language-text&quot;&gt;master&lt;/code&gt;，以及&lt;code class=&quot;language-text&quot;&gt;Token&lt;/code&gt;三个必要参数。&lt;/p&gt;
&lt;h5&gt;(3)验证&lt;/h5&gt;
&lt;p&gt;配置好之后可以上传一张图片进行测试。&lt;/p&gt;
&lt;h4&gt;2、写文档&lt;/h4&gt;
&lt;p&gt;写文章我们采用&lt;code class=&quot;language-text&quot;&gt;Typora&lt;/code&gt;工具，&lt;code class=&quot;language-text&quot;&gt;Typora&lt;/code&gt; 是一款&lt;strong&gt;支持实时预览的 Markdown 文本编辑器&lt;/strong&gt;。它有&lt;code class=&quot;language-text&quot;&gt; OS X&lt;/code&gt;、&lt;code class=&quot;language-text&quot;&gt;Windows&lt;/code&gt;、&lt;code class=&quot;language-text&quot;&gt;Linux &lt;/code&gt;三个平台的版本，并且由于仍在测试中，是&lt;strong&gt;完全免费&lt;/strong&gt;的，好用就对了。&lt;/p&gt;
&lt;h5&gt;(1)Typora下载安装&lt;/h5&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;Typora&lt;/code&gt;的官方地址：&lt;a href=&quot;https://www.typora.io/&quot;&gt;Typora&lt;/a&gt;&lt;/p&gt;
&lt;h5&gt;(2)配置PicGo&lt;/h5&gt;
&lt;p&gt;配置&lt;code class=&quot;language-text&quot;&gt;PicGo&lt;/code&gt;，这样就可以直接从&lt;code class=&quot;language-text&quot;&gt;Typora&lt;/code&gt;中触发图片的上传了。设置方式(&lt;code class=&quot;language-text&quot;&gt;Typora&lt;/code&gt;-&gt;偏好设置-&gt;图像)&lt;/p&gt;
&lt;h4&gt;3、任务排期&lt;/h4&gt;
&lt;p&gt;写文章和做项目一样，要把重要的时间拿来写复杂、重要的内容，因此最好对要写的东西做一个任务排期，什么时候做什么，这样会好很多。&lt;/p&gt;
&lt;p&gt;此处推荐使用&lt;strong&gt;trello&lt;/strong&gt;,&lt;a href=&quot;https://trello.com/&quot;&gt;https://trello.com/&lt;/a&gt;&lt;/p&gt;
&lt;h4&gt;4、代码图片&lt;/h4&gt;
&lt;p&gt;有些网站不支持代码格式，所以可以把代码转换为图片，可以使用现有的网站实现这个功能：&lt;a href=&quot;https://carbon.now.sh/&quot;&gt;https://carbon.now.sh/&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;如果代码是在&lt;code class=&quot;language-text&quot;&gt;IDEA&lt;/code&gt;或者&lt;code class=&quot;language-text&quot;&gt;VSCode&lt;/code&gt;中也可以直接使用，通过安装&lt;code class=&quot;language-text&quot;&gt;carbon&lt;/code&gt;的插件即可。&lt;/p&gt;
&lt;h3&gt;发布&lt;/h3&gt;
&lt;p&gt;这里主要记录把文章发布到各个平台的方式，此处推荐两种方式:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;openwrite&lt;/code&gt;，一个收费产品，可以做到发布到上诉的所有平台，以及微信公众号。免费每个月可以发布&lt;code class=&quot;language-text&quot;&gt;10&lt;/code&gt;次，收费是&lt;code class=&quot;language-text&quot;&gt;199&lt;/code&gt;一年。&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;bloghelper&lt;/code&gt;，一个&lt;a href=&quot;https://github.com/onblog/BlogHelper&quot;&gt;开源产品&lt;/a&gt;，好处就是免费，并且可以自己添加公共，目前它只支持发布到上述的博客平台，不能发送到微信公众号。此处我主要是用这个工具来发布，后面我会扩展它使其可以发布到微信公众号。&lt;/li&gt;
&lt;/ul&gt;
&lt;h5&gt;发布到公众号&lt;/h5&gt;
&lt;p&gt;由于文章采用 &lt;strong&gt;markdown&lt;/strong&gt; 写作，而微信公众号编辑器不支持渲染 &lt;strong&gt;markdown&lt;/strong&gt;，这就导致我们需要自己排版。可以使用自动排版 &lt;strong&gt;markdown&lt;/strong&gt; 的网站，里面支持样式也是比较简洁好看。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;http://md.aclickall.com/&quot;&gt;http://md.aclickall.com/&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://mdnice.com/&quot;&gt;https://mdnice.com/&lt;/a&gt; (这个项目目前要开始收费)&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;上面这些工具更多的是只能从页面把&lt;code class=&quot;language-text&quot;&gt;Markdown&lt;/code&gt;转换为微信公众号文章，我们可以通过代码的方式，使其转换、发布做到自动化，并最后集成到&lt;code class=&quot;language-text&quot;&gt;bloghelper&lt;/code&gt;中去。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;转换&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;此处借用一个开源项目&lt;a href=&quot;https://github.com/LinusLing/wechat-format-cli&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;wechat-format-cli&lt;/code&gt;&lt;/a&gt;，可以做到使用命令行来转换&lt;code class=&quot;language-text&quot;&gt;Markdown&lt;/code&gt;到公众号的文章去。&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;shell&quot;&gt;&lt;pre class=&quot;language-shell&quot;&gt;&lt;code class=&quot;language-shell&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;# 安装工具&lt;/span&gt;
$ &lt;span class=&quot;token function&quot;&gt;npm&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;install&lt;/span&gt; wechat-format-cli -g
&lt;span class=&quot;token comment&quot;&gt;# 执行转换命令&lt;/span&gt;
$ wechat-format-cli &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;your_md_path.md&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;ul&gt;
&lt;li&gt;发布&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;上述的工具把文档转换好之后，我们再使用一款自动预览/发布文章的命令行工具，也是一个开源项目&lt;a href=&quot;https://github.com/LinusLing/WeChatMediaPlatformAutomation&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;wechat-mp-automation&lt;/code&gt;&lt;/a&gt;。&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;shell&quot;&gt;&lt;pre class=&quot;language-shell&quot;&gt;&lt;code class=&quot;language-shell&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;# 安装&lt;/span&gt;
$ &lt;span class=&quot;token function&quot;&gt;npm&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;install&lt;/span&gt; wechat-mp-automation -g
$ wechat-mp-automation -h
Usage: wechat-mp-automation &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;options&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;

Options:
  -V, --version                 output the version number
  -C, --configPath &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;xxx&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;        配置文件的本地路径（支持所有自定义参数）
  -t, --title &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;xxx&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;             文章标题
  -a, --author &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;xxx&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;            文章作者
  -c, --content &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;xxx&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;           文章内容&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;可选&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;，默认从粘贴板复制
  -u, --username &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;xxx&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;          公众号账号
  -p, --password &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;xxx&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;          公众号密码
  -o, --original                声明原创&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;可选&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;
  --preview                     预览而不发布&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;可选&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;
  --preview_username &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;xxx~yyy&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;  预览名单&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;可选&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;，以~间隔多个微信号（自行保证微信号已关注公众号）
  --skip_typing                 跳过文章标题、作者、文章的填写和封面图片选择（声明原创除外）&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;可选&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;
  --last_edit                   选中最近编辑的文章&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;可选&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;，请自行确保当前有“最近编辑”的文章
  -h, --help                    output usage information
  
&lt;span class=&quot;token comment&quot;&gt;# 只预览&lt;/span&gt;
$ wechat-mp-automation -C YOUR_CONFIG_JSON_FILE_PATH --preview_username XXXXX --preview
&lt;span class=&quot;token comment&quot;&gt;# 发布&lt;/span&gt;
$ wechat-mp-automation -t &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;标题&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; -a &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;作者&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; -u &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;账号&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; -p &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;密码&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; -o
&lt;span class=&quot;token comment&quot;&gt;# 配合wechat-format-cli工具可做到自动转换和发布&lt;/span&gt;
$ wechat-format-cli test.md &lt;span class=&quot;token operator&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; wechat-mp-automation -t &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;标题&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; -a &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;作者&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; -u &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;账号&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; -p &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;密码&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; -o&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h3&gt;全平台发布流程&lt;/h3&gt;
&lt;p&gt;下图我定义了全平台发布流程，把图床、发布工具设置好之后，用户只需要在&lt;code class=&quot;language-text&quot;&gt;Typora&lt;/code&gt;上进行编写&lt;code class=&quot;language-text&quot;&gt;Markdown&lt;/code&gt;格式的内容即可，编写完之后就可以全平台的发布了。&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://raw.githubusercontent.com/lengrongfu/images/master/imgblog-flow.png&quot; alt=&quot;blog-flow&quot;&gt;&lt;/p&gt;
&lt;h3&gt;我的流程&lt;/h3&gt;
&lt;p&gt;在使用过程中发现一个好的&lt;code class=&quot;language-text&quot;&gt;Chrome&lt;/code&gt;插件&lt;a href=&quot;https://github.com/lengrongfu/Wechatsync&quot;&gt;Wechatsync&lt;/a&gt; ，可以在发微信文章的时候自动把内容容不到其它平台上去。&lt;/p&gt;</content:encoded></item><item><title><![CDATA[intellij-idea激活]]></title><description><![CDATA[IntelliJ IDEA 2019.2.1最新激活码 激活时间到2089年，足够任何人使用了。 201…]]></description><link>https://lengrongfu.github.io/2019-10-20-intellij-idea激活/</link><guid isPermaLink="false">https://lengrongfu.github.io/2019-10-20-intellij-idea激活/</guid><pubDate>Sun, 20 Oct 2019 15:59:13 GMT</pubDate><content:encoded>&lt;h1&gt;IntelliJ IDEA 2019.2.1最新激活码&lt;/h1&gt;
&lt;p&gt;激活时间到&lt;strong&gt;2089年&lt;/strong&gt;，足够任何人使用了。&lt;/p&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;IDEA&lt;/code&gt;2019以前的版本都可以使用&lt;code class=&quot;language-text&quot;&gt;http://idea.lanyus.com/&lt;/code&gt;这个注册码去破解，我相信大多数人都是使用的这个激活码，可是&lt;code class=&quot;language-text&quot;&gt;2019&lt;/code&gt;版的都不能在使用这个注册码了。&lt;/p&gt;
&lt;p&gt;新版注册码方法主要有如下几个步骤。
此处的&lt;code class=&quot;language-text&quot;&gt;IDEA&lt;/code&gt;包括所有软件，不止&lt;code class=&quot;language-text&quot;&gt;intellij&lt;/code&gt;还包括&lt;code class=&quot;language-text&quot;&gt;goland&lt;/code&gt;、&lt;code class=&quot;language-text&quot;&gt;pychart&lt;/code&gt;这些软件都是本人亲测激活并且有效的。&lt;/p&gt;
&lt;h2&gt;破解步骤&lt;/h2&gt;
&lt;p&gt;首先去官网下载最新版的&lt;code class=&quot;language-text&quot;&gt;IDEA&lt;/code&gt;，下载好之后安装并启动；
打开之后选择&lt;strong&gt;选择30天免费试用&lt;/strong&gt;。&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://note.youdao.com/yws/api/personal/file/WEBd316f43d8ad3dc706fcaa6b9e110a19e?method=download&amp;#x26;shareKey=a55b461fcf4d04c652066aab8e17d042&quot; alt=&quot;image&quot;&gt;&lt;/p&gt;
&lt;p&gt;进入之后点击&lt;code class=&quot;language-text&quot;&gt;Configure&lt;/code&gt;-&gt;&lt;code class=&quot;language-text&quot;&gt;Edit Custom VM Options&lt;/code&gt; 进入编辑框中。
&lt;img src=&quot;https://note.youdao.com/yws/api/personal/file/WEBc74c7dcf05dc009df79d42983abd4c70?method=download&amp;#x26;shareKey=48344ed4c5cb22f28376497a1cb99533&quot; alt=&quot;image&quot;&gt;&lt;/p&gt;
&lt;p&gt;在&lt;code class=&quot;language-text&quot;&gt;VM Options&lt;/code&gt;中添加&lt;code class=&quot;language-text&quot;&gt;-javaagent:绝对路径&lt;/code&gt;的参数。添加完之后保存，并关闭软件再次重启。
&lt;img src=&quot;https://note.youdao.com/yws/api/personal/file/WEB291a77318ea22fedcc84ce9a90c15b59?method=download&amp;#x26;shareKey=45ea668d89c153e2b1bb78cd9576a1c7&quot; alt=&quot;image&quot;&gt;&lt;/p&gt;
&lt;p&gt;重启后点击&lt;code class=&quot;language-text&quot;&gt;Configure&lt;/code&gt;-&gt;&lt;code class=&quot;language-text&quot;&gt;Manage License&lt;/code&gt;进入如下的页面，首先如果有&lt;code class=&quot;language-text&quot;&gt;Remove License&lt;/code&gt;，那就点击删除这个&lt;code class=&quot;language-text&quot;&gt;License&lt;/code&gt;，其次再把&lt;code class=&quot;language-text&quot;&gt;License&lt;/code&gt;放入即可激活。
&lt;img src=&quot;https://note.youdao.com/yws/api/personal/file/WEB4118c5e452fe931f50648bc609cf0101?method=download&amp;#x26;shareKey=5b00317cdae7a5fbc2585997f32205a0&quot; alt=&quot;image&quot;&gt;&lt;/p&gt;
&lt;h2&gt;注意事项&lt;/h2&gt;
&lt;p&gt;1、上面添加&lt;code class=&quot;language-text&quot;&gt;-javaagent&lt;/code&gt;这一步一定要做，不然就会出现&lt;code class=&quot;language-text&quot;&gt;key is invalid&lt;/code&gt;的提示。&lt;/p&gt;
&lt;p&gt;2、上面的破解包和&lt;code class=&quot;language-text&quot;&gt;License&lt;/code&gt;要对应。&lt;/p&gt;
&lt;h2&gt;破解包和License&lt;/h2&gt;
&lt;h3&gt;agent jar 包&lt;/h3&gt;
&lt;p&gt;下载地址：&lt;a href=&quot;http://note.youdao.com/noteshare?id=027477dc925c299fa427f761301a3e2a&quot;&gt;http://note.youdao.com/noteshare?id=027477dc925c299fa427f761301a3e2a&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://note.youdao.com/yws/api/personal/file/WEBa838e2c0131a7781033f2d5b7bcb226e?method=download&amp;#x26;shareKey=01a48f4594b587f3f736576b4663a6a2&quot; alt=&quot;image&quot;&gt;&lt;/p&gt;
&lt;h3&gt;License&lt;/h3&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;520E5894E2-eyJsaWNlbnNlSWQiOiI1MjBFNTg5NEUyIiwibGljZW5zZWVOYW1lIjoicGlnNiIsImFzc2lnbmVlTmFtZSI6IiIsImFzc2lnbmVlRW1haWwiOiIiLCJsaWNlbnNlUmVzdHJpY3Rpb24iOiJVbmxpbWl0ZWQgbGljZW5zZSB0aWxsIGVuZCBvZiB0aGUgY2VudHVyeS4iLCJjaGVja0NvbmN1cnJlbnRVc2UiOmZhbHNlLCJwcm9kdWN0cyI6W3siY29kZSI6IklJIiwicGFpZFVwVG8iOiIyMDg5LTA3LTA3In0seyJjb2RlIjoiUlMwIiwicGFpZFVwVG8iOiIyMDg5LTA3LTA3In0seyJjb2RlIjoiV1MiLCJwYWlkVXBUbyI6IjIwODktMDctMDcifSx7ImNvZGUiOiJSRCIsInBhaWRVcFRvIjoiMjA4OS0wNy0wNyJ9LHsiY29kZSI6IlJDIiwicGFpZFVwVG8iOiIyMDg5LTA3LTA3In0seyJjb2RlIjoiREMiLCJwYWlkVXBUbyI6IjIwODktMDctMDcifSx7ImNvZGUiOiJEQiIsInBhaWRVcFRvIjoiMjA4OS0wNy0wNyJ9LHsiY29kZSI6IlJNIiwicGFpZFVwVG8iOiIyMDg5LTA3LTA3In0seyJjb2RlIjoiRE0iLCJwYWlkVXBUbyI6IjIwODktMDctMDcifSx7ImNvZGUiOiJBQyIsInBhaWRVcFRvIjoiMjA4OS0wNy0wNyJ9LHsiY29kZSI6IkRQTiIsInBhaWRVcFRvIjoiMjA4OS0wNy0wNyJ9LHsiY29kZSI6IkdPIiwicGFpZFVwVG8iOiIyMDg5LTA3LTA3In0seyJjb2RlIjoiUFMiLCJwYWlkVXBUbyI6IjIwODktMDctMDcifSx7ImNvZGUiOiJDTCIsInBhaWRVcFRvIjoiMjA4OS0wNy0wNyJ9LHsiY29kZSI6IlBDIiwicGFpZFVwVG8iOiIyMDg5LTA3LTA3In0seyJjb2RlIjoiUlNVIiwicGFpZFVwVG8iOiIyMDg5LTA3LTA3In1dLCJoYXNoIjoiODkwNzA3MC8wIiwiZ3JhY2VQZXJpb2REYXlzIjowLCJhdXRvUHJvbG9uZ2F0ZWQiOmZhbHNlLCJpc0F1dG9Qcm9sb25nYXRlZCI6ZmFsc2V9-DZ/oNHBfyho0XrrCJJvAOKg5Q1tLBgOdbCmzCKwkuM+Yryce0RoOi3OOmH6Ba/uTcCh/L37meyD0FJdJIprv59y4+n+k2kIeF/XKrKqg0dEsDUQRw0lUqqMt99ohqa+zmbJ44Yufdwwx/F1CtoRGvEQ2Mn0QjuqRoZJZ3wiT5Am22JiJW8MaNUl3wg9YPj+OPGARKKJUdUJ0NGUDQBcBAv5ds8LhbSbJSbPkbkwH/a1QMz4nEdn6lRDKI1aFIn43QhBSCFqvUq6TPJlbIJ0ZjE+PyZjHFBKCgkry0DHPXU2BbtIZPsksQnN3fx240a9K6sN7peZnLpEoMoq23FEz4g==-MIIElTCCAn2gAwIBAgIBCTANBgkqhkiG9w0BAQsFADAYMRYwFAYDVQQDDA1KZXRQcm9maWxlIENBMB4XDTE4MTEwMTEyMjk0NloXDTIwMTEwMjEyMjk0NlowaDELMAkGA1UEBhMCQ1oxDjAMBgNVBAgMBU51c2xlMQ8wDQYDVQQHDAZQcmFndWUxGTAXBgNVBAoMEEpldEJyYWlucyBzLnIuby4xHTAbBgNVBAMMFHByb2QzeS1mcm9tLTIwMTgxMTAxMIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEA5ndaik1GD0nyTdqkZgURQZGW+RGxCdBITPXIwpjhhaD0SXGa4XSZBEBoiPdY6XV6pOfUJeyfi9dXsY4MmT0D+sKoST3rSw96xaf9FXPvOjn4prMTdj3Ji3CyQrGWeQU2nzYqFrp1QYNLAbaViHRKuJrYHI6GCvqCbJe0LQ8qqUiVMA9wG/PQwScpNmTF9Kp2Iej+Z5OUxF33zzm+vg/nYV31HLF7fJUAplI/1nM+ZG8K+AXWgYKChtknl3sW9PCQa3a3imPL9GVToUNxc0wcuTil8mqveWcSQCHYxsIaUajWLpFzoO2AhK4mfYBSStAqEjoXRTuj17mo8Q6M2SHOcwIDAQABo4GZMIGWMAkGA1UdEwQCMAAwHQYDVR0OBBYEFGEpG9oZGcfLMGNBkY7SgHiMGgTcMEgGA1UdIwRBMD+AFKOetkhnQhI2Qb1t4Lm0oFKLl/GzoRykGjAYMRYwFAYDVQQDDA1KZXRQcm9maWxlIENBggkA0myxg7KDeeEwEwYDVR0lBAwwCgYIKwYBBQUHAwEwCwYDVR0PBAQDAgWgMA0GCSqGSIb3DQEBCwUAA4ICAQBonMu8oa3vmNAa4RQP8gPGlX3SQaA3WCRUAj6Zrlk8AesKV1YSkh5D2l+yUk6njysgzfr1bIR5xF8eup5xXc4/G7NtVYRSMvrd6rfQcHOyK5UFJLm+8utmyMIDrZOzLQuTsT8NxFpbCVCfV5wNRu4rChrCuArYVGaKbmp9ymkw1PU6+HoO5i2wU3ikTmRv8IRjrlSStyNzXpnPTwt7bja19ousk56r40SmlmC04GdDHErr0ei2UbjUua5kw71Qn9g02tL9fERI2sSRjQrvPbn9INwRWl5+k05mlKekbtbu2ev2woJFZK4WEXAd/GaAdeZZdumv8T2idDFL7cAirJwcrbfpawPeXr52oKTPnXfi0l5+g9Gnt/wfiXCrPElX6ycTR6iL3GC2VR4jTz6YatT4Ntz59/THOT7NJQhr6AyLkhhJCdkzE2cob/KouVp4ivV7Q3Fc6HX7eepHAAF/DpxwgOrg9smX6coXLgfp0b1RU2u/tUNID04rpNxTMueTtrT8WSskqvaJd3RH8r7cnRj6Y2hltkja82HlpDURDxDTRvv+krbwMr26SB/40BjpMUrDRCeKuiBahC0DCoU/4+ze1l94wVUhdkCfL0GpJrMSCDEK+XEurU18Hb7WT+ThXbkdl6VpFdHsRvqAnhR2g4b+Qzgidmuky5NUZVfEaZqV/g==&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;</content:encoded></item><item><title><![CDATA[go channel 实现]]></title><description><![CDATA[什么是Channel…]]></description><link>https://lengrongfu.github.io/2019-09-18-go-channel源码/</link><guid isPermaLink="false">https://lengrongfu.github.io/2019-09-18-go-channel源码/</guid><pubDate>Wed, 18 Sep 2019 15:02:51 GMT</pubDate><content:encoded>&lt;h1&gt;什么是Channel&lt;/h1&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;Channel&lt;/code&gt;是&lt;code class=&quot;language-text&quot;&gt;go&lt;/code&gt;之间通信的一种方式，从实现上说，&lt;code class=&quot;language-text&quot;&gt;channel&lt;/code&gt;是一个链表的数据结构，可以将数据放入和读取。&lt;/p&gt;
&lt;h1&gt;基本使用&lt;/h1&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;channel&lt;/code&gt;分为有缓冲区的和无缓冲区的通道。&lt;/p&gt;
&lt;h1&gt;原理&lt;/h1&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;channel&lt;/code&gt;就是通过一个共享队列来做协程之间的数据传递的，是一种数据结构，低层还是通过锁来控制数据之间的安全；和我们自己实现的差别,加入了协程挂起和通知的功能，使得协程更加的快速。&lt;/p&gt;
&lt;h2&gt;发送消息时：&lt;/h2&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;channel已经关闭，那就不能发。panic掉。
看一下有没有阻塞在读操作上的goroutine，有的话取出上一次接收的位置，然后把发送的元素插入到缓冲槽尾部。所以写入有序，输出也是有序的。
没有被阻塞的goroutine。如果带buffer，buffer还有空位，就放在buffer里。否则就阻塞挂起当前发送消息的goroutine。&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2&gt;读取消息时：&lt;/h2&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;channel已经关闭，也可以读，只是读出来的数据为空。
看一下有没有阻塞的写操作的goroutine，有的话唤醒它。读取它发送的数据(A)。
读取后的数据(A)放哪，视乎是带buffer还是无buffer。无buffer的话，就直接把写数据(A)给读取者。带buffer的话，就先看buffer里是否有数据(B)，有就把数据(B)给读取者，再把数据(A)放到原来数据(B)空出来的位置上。&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2&gt;chan 结构体解读&lt;/h2&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;go&quot;&gt;&lt;pre class=&quot;language-go&quot;&gt;&lt;code class=&quot;language-go&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;type&lt;/span&gt; hchan &lt;span class=&quot;token keyword&quot;&gt;struct&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
	qcount   &lt;span class=&quot;token builtin&quot;&gt;uint&lt;/span&gt;           &lt;span class=&quot;token comment&quot;&gt;// 队列中的数据量&lt;/span&gt;
	dataqsiz &lt;span class=&quot;token builtin&quot;&gt;uint&lt;/span&gt;           &lt;span class=&quot;token comment&quot;&gt;// 队列的容量&lt;/span&gt;
	buf      unsafe&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;Pointer &lt;span class=&quot;token comment&quot;&gt;// 存储数据的缓冲区&lt;/span&gt;
	elemsize &lt;span class=&quot;token builtin&quot;&gt;uint16&lt;/span&gt;         &lt;span class=&quot;token comment&quot;&gt;//元素的占位大小&lt;/span&gt;
	closed   &lt;span class=&quot;token builtin&quot;&gt;uint32&lt;/span&gt;         &lt;span class=&quot;token comment&quot;&gt;//关闭标志位，0 未关闭，1 关闭&lt;/span&gt;
	elemtype &lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt;_type &lt;span class=&quot;token comment&quot;&gt;// 元素类型&lt;/span&gt;
	sendx    &lt;span class=&quot;token builtin&quot;&gt;uint&lt;/span&gt;   &lt;span class=&quot;token comment&quot;&gt;// 发送index&lt;/span&gt;
	recvx    &lt;span class=&quot;token builtin&quot;&gt;uint&lt;/span&gt;   &lt;span class=&quot;token comment&quot;&gt;// 接收index&lt;/span&gt;
	recvq    waitq  &lt;span class=&quot;token comment&quot;&gt;// 接收等待队列，存储了接收挂起的g&lt;/span&gt;
	sendq    waitq  &lt;span class=&quot;token comment&quot;&gt;// 存储了挂起的发送队列&lt;/span&gt;
    &lt;span class=&quot;token comment&quot;&gt;//锁，保护hchan里面的字段&lt;/span&gt;
	lock mutex
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2&gt;chansend 发送源码解读&lt;/h2&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;go&quot;&gt;&lt;pre class=&quot;language-go&quot;&gt;&lt;code class=&quot;language-go&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;func&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;chansend&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;c &lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt;hchan&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; ep unsafe&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;Pointer&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; block &lt;span class=&quot;token builtin&quot;&gt;bool&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; callerpc &lt;span class=&quot;token builtin&quot;&gt;uintptr&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token builtin&quot;&gt;bool&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
	&lt;span class=&quot;token comment&quot;&gt;//加锁&lt;/span&gt;
	&lt;span class=&quot;token function&quot;&gt;lock&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&amp;amp;&lt;/span&gt;c&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;lock&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;token comment&quot;&gt;//1、如果关闭就panic，不能发送到一个关闭的channel&lt;/span&gt;
	&lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; c&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;closed &lt;span class=&quot;token operator&quot;&gt;!=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
		&lt;span class=&quot;token function&quot;&gt;unlock&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&amp;amp;&lt;/span&gt;c&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;lock&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
		&lt;span class=&quot;token function&quot;&gt;panic&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;plainError&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;send on closed channel&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
	&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;token comment&quot;&gt;//2、接收队列中取出一个g&lt;/span&gt;
	&lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; sg &lt;span class=&quot;token operator&quot;&gt;:=&lt;/span&gt; c&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;recvq&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;dequeue&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; sg &lt;span class=&quot;token operator&quot;&gt;!=&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;nil&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
		&lt;span class=&quot;token comment&quot;&gt;//找到一个等待的接收g，把数据直接复制到g的stack上，并把它安排在下一次调度上&lt;/span&gt;
		&lt;span class=&quot;token function&quot;&gt;send&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;c&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; sg&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; ep&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;func&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;unlock&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&amp;amp;&lt;/span&gt;c&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;lock&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;3&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
		&lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;true&lt;/span&gt;
	&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;token comment&quot;&gt;//3、如果缓冲队列还有空间&lt;/span&gt;
	&lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; c&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;qcount &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt; c&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;dataqsiz &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
		&lt;span class=&quot;token comment&quot;&gt;// 将要发送的消息放入队列中&lt;/span&gt;
		qp &lt;span class=&quot;token operator&quot;&gt;:=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;chanbuf&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;c&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; c&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;sendx&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
		&lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; raceenabled &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
			&lt;span class=&quot;token function&quot;&gt;raceacquire&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;qp&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
			&lt;span class=&quot;token function&quot;&gt;racerelease&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;qp&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
		&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
		&lt;span class=&quot;token function&quot;&gt;typedmemmove&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;c&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;elemtype&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; qp&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; ep&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
		c&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;sendx&lt;span class=&quot;token operator&quot;&gt;++&lt;/span&gt;
		&lt;span class=&quot;token comment&quot;&gt;//记得归位&lt;/span&gt;
		&lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; c&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;sendx &lt;span class=&quot;token operator&quot;&gt;==&lt;/span&gt; c&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;dataqsiz &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
			c&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;sendx &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;
		&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
		&lt;span class=&quot;token comment&quot;&gt;//放入一个+1，取出一个-1&lt;/span&gt;
		c&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;qcount&lt;span class=&quot;token operator&quot;&gt;++&lt;/span&gt;
		&lt;span class=&quot;token function&quot;&gt;unlock&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&amp;amp;&lt;/span&gt;c&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;lock&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
		&lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;true&lt;/span&gt;
	&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

	&lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;!&lt;/span&gt;block &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
		&lt;span class=&quot;token function&quot;&gt;unlock&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&amp;amp;&lt;/span&gt;c&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;lock&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
		&lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;false&lt;/span&gt;
	&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;token comment&quot;&gt;//4、如果没有缓冲区可用，把当前的g挂起，并加入到发送队列中&lt;/span&gt;
	gp &lt;span class=&quot;token operator&quot;&gt;:=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;getg&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
	mysg &lt;span class=&quot;token operator&quot;&gt;:=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;acquireSudog&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
	mysg&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;releasetime &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;
	&lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; t0 &lt;span class=&quot;token operator&quot;&gt;!=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
		mysg&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;releasetime &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;
	&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
	&lt;span class=&quot;token comment&quot;&gt;// No stack splits between assigning elem and enqueuing mysg&lt;/span&gt;
	&lt;span class=&quot;token comment&quot;&gt;// on gp.waiting where copystack can find it.&lt;/span&gt;
	mysg&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;elem &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; ep
	mysg&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;waitlink &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;nil&lt;/span&gt;
	mysg&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;g &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; gp
	mysg&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;isSelect &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;false&lt;/span&gt;
	mysg&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;c &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; c
	gp&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;waiting &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; mysg
	gp&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;param &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;nil&lt;/span&gt;
	c&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;sendq&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;enqueue&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;mysg&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
	&lt;span class=&quot;token function&quot;&gt;goparkunlock&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&amp;amp;&lt;/span&gt;c&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;lock&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; waitReasonChanSend&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; traceEvGoBlockSend&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;3&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
	&lt;span class=&quot;token comment&quot;&gt;// Ensure the value being sent is kept alive until the&lt;/span&gt;
	&lt;span class=&quot;token comment&quot;&gt;// receiver copies it out. The sudog has a pointer to the&lt;/span&gt;
	&lt;span class=&quot;token comment&quot;&gt;// stack object, but sudogs aren&apos;t considered as roots of the&lt;/span&gt;
	&lt;span class=&quot;token comment&quot;&gt;// stack tracer.&lt;/span&gt;
	&lt;span class=&quot;token function&quot;&gt;KeepAlive&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;ep&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;

	&lt;span class=&quot;token comment&quot;&gt;// someone woke us up.&lt;/span&gt;
	&lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; mysg &lt;span class=&quot;token operator&quot;&gt;!=&lt;/span&gt; gp&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;waiting &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
		&lt;span class=&quot;token function&quot;&gt;throw&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;G waiting list is corrupted&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
	&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
	gp&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;waiting &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;nil&lt;/span&gt;
	&lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; gp&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;param &lt;span class=&quot;token operator&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;nil&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
		&lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; c&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;closed &lt;span class=&quot;token operator&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
			&lt;span class=&quot;token function&quot;&gt;throw&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;chansend: spurious wakeup&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
		&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
		&lt;span class=&quot;token function&quot;&gt;panic&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;plainError&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;send on closed channel&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
	&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
	gp&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;param &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;nil&lt;/span&gt;
	&lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; mysg&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;releasetime &lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
		&lt;span class=&quot;token function&quot;&gt;blockevent&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;mysg&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;releasetime&lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;t0&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
	&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
	mysg&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;c &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;nil&lt;/span&gt;
	&lt;span class=&quot;token function&quot;&gt;releaseSudog&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;mysg&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
	&lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;true&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2&gt;chanrecv 接收解读&lt;/h2&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;go&quot;&gt;&lt;pre class=&quot;language-go&quot;&gt;&lt;code class=&quot;language-go&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;func&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;chanrecv&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;c &lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt;hchan&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; ep unsafe&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;Pointer&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; block &lt;span class=&quot;token builtin&quot;&gt;bool&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;selected&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; received &lt;span class=&quot;token builtin&quot;&gt;bool&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
	
    &lt;span class=&quot;token comment&quot;&gt;//先检查如果队列中没有元素，并且发送等待队列中也没有挂起的g，并且未关闭就直接返回&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;!&lt;/span&gt;block &lt;span class=&quot;token operator&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;c&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;dataqsiz &lt;span class=&quot;token operator&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; c&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;sendq&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;first &lt;span class=&quot;token operator&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;nil&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;||&lt;/span&gt;
		c&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;dataqsiz &lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; atomic&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Loaduint&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&amp;amp;&lt;/span&gt;c&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;qcount&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt;
		atomic&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Load&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&amp;amp;&lt;/span&gt;c&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;closed&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
		&lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt;
	&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;token comment&quot;&gt;//加锁&lt;/span&gt;
	&lt;span class=&quot;token function&quot;&gt;lock&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&amp;amp;&lt;/span&gt;c&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;lock&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;token comment&quot;&gt;//1、如果channel已经关闭并且队列元素个数为0，则返回，不会报panic&lt;/span&gt;
	&lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; c&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;closed &lt;span class=&quot;token operator&quot;&gt;!=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; c&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;qcount &lt;span class=&quot;token operator&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
		&lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; raceenabled &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
			&lt;span class=&quot;token function&quot;&gt;raceacquire&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;c&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;raceaddr&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
		&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
		&lt;span class=&quot;token function&quot;&gt;unlock&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&amp;amp;&lt;/span&gt;c&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;lock&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
		&lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; ep &lt;span class=&quot;token operator&quot;&gt;!=&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;nil&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
			&lt;span class=&quot;token function&quot;&gt;typedmemclr&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;c&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;elemtype&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; ep&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
		&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
		&lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;true&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;false&lt;/span&gt;
	&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;token comment&quot;&gt;//2、&lt;/span&gt;
	&lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; sg &lt;span class=&quot;token operator&quot;&gt;:=&lt;/span&gt; c&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;sendq&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;dequeue&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; sg &lt;span class=&quot;token operator&quot;&gt;!=&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;nil&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
		&lt;span class=&quot;token comment&quot;&gt;// Found a waiting sender. If buffer is size 0, receive value&lt;/span&gt;
		&lt;span class=&quot;token comment&quot;&gt;// directly from sender. Otherwise, receive from head of queue&lt;/span&gt;
		&lt;span class=&quot;token comment&quot;&gt;// and add sender&apos;s value to the tail of the queue (both map to&lt;/span&gt;
		&lt;span class=&quot;token comment&quot;&gt;// the same buffer slot because the queue is full).&lt;/span&gt;
		&lt;span class=&quot;token comment&quot;&gt;// 如果buffer是0，从发送中直接获取并接收；除此之外，从队列头接收并且发送值到队尾&lt;/span&gt;
		&lt;span class=&quot;token function&quot;&gt;recv&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;c&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; sg&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; ep&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;func&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;unlock&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&amp;amp;&lt;/span&gt;c&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;lock&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;3&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
		&lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;true&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;true&lt;/span&gt;
	&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;token comment&quot;&gt;//3、如果缓存队列中还有元素，就取出来接收&lt;/span&gt;
	&lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; c&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;qcount &lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
		&lt;span class=&quot;token comment&quot;&gt;// Receive directly from queue&lt;/span&gt;
		qp &lt;span class=&quot;token operator&quot;&gt;:=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;chanbuf&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;c&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; c&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;recvx&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
		&lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; raceenabled &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
			&lt;span class=&quot;token function&quot;&gt;raceacquire&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;qp&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
			&lt;span class=&quot;token function&quot;&gt;racerelease&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;qp&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
		&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
		&lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; ep &lt;span class=&quot;token operator&quot;&gt;!=&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;nil&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
			&lt;span class=&quot;token function&quot;&gt;typedmemmove&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;c&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;elemtype&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; ep&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; qp&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
		&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
		&lt;span class=&quot;token function&quot;&gt;typedmemclr&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;c&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;elemtype&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; qp&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
		c&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;recvx&lt;span class=&quot;token operator&quot;&gt;++&lt;/span&gt;
		&lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; c&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;recvx &lt;span class=&quot;token operator&quot;&gt;==&lt;/span&gt; c&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;dataqsiz &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
			c&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;recvx &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;
		&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
		c&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;qcount&lt;span class=&quot;token operator&quot;&gt;--&lt;/span&gt;
		&lt;span class=&quot;token function&quot;&gt;unlock&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&amp;amp;&lt;/span&gt;c&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;lock&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
		&lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;true&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;true&lt;/span&gt;
	&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

	&lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;!&lt;/span&gt;block &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
		&lt;span class=&quot;token function&quot;&gt;unlock&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&amp;amp;&lt;/span&gt;c&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;lock&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
		&lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;false&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;false&lt;/span&gt;
	&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

	&lt;span class=&quot;token comment&quot;&gt;// 没有可用的，就挂起当前的g，并放入接收等待队列中&lt;/span&gt;
	gp &lt;span class=&quot;token operator&quot;&gt;:=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;getg&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
	mysg &lt;span class=&quot;token operator&quot;&gt;:=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;acquireSudog&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
	mysg&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;releasetime &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;
	&lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; t0 &lt;span class=&quot;token operator&quot;&gt;!=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
		mysg&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;releasetime &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;
	&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
	&lt;span class=&quot;token comment&quot;&gt;// No stack splits between assigning elem and enqueuing mysg&lt;/span&gt;
	&lt;span class=&quot;token comment&quot;&gt;// on gp.waiting where copystack can find it.&lt;/span&gt;
	mysg&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;elem &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; ep
	mysg&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;waitlink &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;nil&lt;/span&gt;
	gp&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;waiting &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; mysg
	mysg&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;g &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; gp
	mysg&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;isSelect &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;false&lt;/span&gt;
	mysg&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;c &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; c
	gp&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;param &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;nil&lt;/span&gt;
	c&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;recvq&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;enqueue&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;mysg&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
	&lt;span class=&quot;token function&quot;&gt;goparkunlock&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&amp;amp;&lt;/span&gt;c&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;lock&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; waitReasonChanReceive&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; traceEvGoBlockRecv&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;3&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;

	&lt;span class=&quot;token comment&quot;&gt;// someone woke us up&lt;/span&gt;
	&lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; mysg &lt;span class=&quot;token operator&quot;&gt;!=&lt;/span&gt; gp&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;waiting &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
		&lt;span class=&quot;token function&quot;&gt;throw&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;G waiting list is corrupted&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
	&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
	gp&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;waiting &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;nil&lt;/span&gt;
	&lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; mysg&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;releasetime &lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
		&lt;span class=&quot;token function&quot;&gt;blockevent&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;mysg&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;releasetime&lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;t0&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
	&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
	closed &lt;span class=&quot;token operator&quot;&gt;:=&lt;/span&gt; gp&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;param &lt;span class=&quot;token operator&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;nil&lt;/span&gt;
	gp&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;param &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;nil&lt;/span&gt;
	mysg&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;c &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;nil&lt;/span&gt;
	&lt;span class=&quot;token function&quot;&gt;releaseSudog&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;mysg&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
	&lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;true&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;!&lt;/span&gt;closed
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h1&gt;waitq 双向链表解读&lt;/h1&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;go&quot;&gt;&lt;pre class=&quot;language-go&quot;&gt;&lt;code class=&quot;language-go&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;// waitq 只保存了一个执行头和一个执行尾的指针，保存的元素都是sudog&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;type&lt;/span&gt; waitq &lt;span class=&quot;token keyword&quot;&gt;struct&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
	first &lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt;sudog
	last  &lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt;sudog
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;// sudog 代表一个go在一个等待队列中&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;type&lt;/span&gt; sudog &lt;span class=&quot;token keyword&quot;&gt;struct&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token comment&quot;&gt;//下面的字段受hchan.lock锁的保护，&lt;/span&gt;
	g &lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt;g

	&lt;span class=&quot;token comment&quot;&gt;// isSelect 为true表示g正在参与select选择，g.selectDone必须被cas算法调用才能唤醒g&lt;/span&gt;
	isSelect &lt;span class=&quot;token builtin&quot;&gt;bool&lt;/span&gt;
	next     &lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt;sudog &lt;span class=&quot;token comment&quot;&gt;// 下一个 这个两个字段组成了一个双向链表&lt;/span&gt;
	prev     &lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt;sudog &lt;span class=&quot;token comment&quot;&gt;// 上一个&lt;/span&gt;
    &lt;span class=&quot;token operator&quot;&gt;...&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h3&gt;入队列&lt;/h3&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;go&quot;&gt;&lt;pre class=&quot;language-go&quot;&gt;&lt;code class=&quot;language-go&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;// 队头和队尾分别指向第一个元素和最后一个元素，如果只有一个元素，那么队头和队尾都指向他&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;func&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;q &lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt;waitq&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;enqueue&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;sgp &lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt;sudog&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
	sgp&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;next &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;nil&lt;/span&gt;
	x &lt;span class=&quot;token operator&quot;&gt;:=&lt;/span&gt; q&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;last
	&lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; x &lt;span class=&quot;token operator&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;nil&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
		sgp&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;prev &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;nil&lt;/span&gt;
		q&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;first &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; sgp
		q&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;last &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; sgp
		&lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt;
	&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
	sgp&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;prev &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; x
	x&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;next &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; sgp
	q&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;last &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; sgp
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h3&gt;出队列&lt;/h3&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;go&quot;&gt;&lt;pre class=&quot;language-go&quot;&gt;&lt;code class=&quot;language-go&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;// 出队列的时候，移动队头往后移动，并设置队头的元素指向下一个为nil，是一个FIFO队列&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;func&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;q &lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt;waitq&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;dequeue&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt;sudog &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
	&lt;span class=&quot;token keyword&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
		sgp &lt;span class=&quot;token operator&quot;&gt;:=&lt;/span&gt; q&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;first
		&lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; sgp &lt;span class=&quot;token operator&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;nil&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
			&lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;nil&lt;/span&gt;
		&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
		y &lt;span class=&quot;token operator&quot;&gt;:=&lt;/span&gt; sgp&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;next
		&lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; y &lt;span class=&quot;token operator&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;nil&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
			q&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;first &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;nil&lt;/span&gt;
			q&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;last &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;nil&lt;/span&gt;
		&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
			y&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;prev &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;nil&lt;/span&gt;
			q&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;first &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; y
			sgp&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;next &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;nil&lt;/span&gt; &lt;span class=&quot;token comment&quot;&gt;// mark as removed (see dequeueSudog)&lt;/span&gt;
		&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
        &lt;span class=&quot;token comment&quot;&gt;//当g是在select阻塞的时候需要设置selectDone为1才能唤醒g&lt;/span&gt;
		&lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; sgp&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;isSelect &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
			&lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;!&lt;/span&gt;atomic&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Cas&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&amp;amp;&lt;/span&gt;sgp&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;g&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;selectDone&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
				&lt;span class=&quot;token keyword&quot;&gt;continue&lt;/span&gt;
			&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
		&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

		&lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; sgp
	&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h1&gt;lock 实现解读&lt;/h1&gt;
&lt;p&gt;加锁和解锁没有使用&lt;code class=&quot;language-text&quot;&gt;mutex&lt;/code&gt;，而是使用了&lt;code class=&quot;language-text&quot;&gt;futex&lt;/code&gt;技术，这个是在&lt;code class=&quot;language-text&quot;&gt;linux&lt;/code&gt;系统环境下的，&lt;code class=&quot;language-text&quot;&gt;futex&lt;/code&gt;是一种高效的加锁方式。&lt;/p&gt;
&lt;h2&gt;lock 加锁&lt;/h2&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;go&quot;&gt;&lt;pre class=&quot;language-go&quot;&gt;&lt;code class=&quot;language-go&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;func&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;lock&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;l &lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt;mutex&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
	gp &lt;span class=&quot;token operator&quot;&gt;:=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;getg&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;

	&lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; gp&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;m&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;locks &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
		&lt;span class=&quot;token function&quot;&gt;throw&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;runtime·lock: lock count&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
	&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
	gp&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;m&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;locks&lt;span class=&quot;token operator&quot;&gt;++&lt;/span&gt;

	&lt;span class=&quot;token comment&quot;&gt;// Speculative grab for lock.&lt;/span&gt;
	v &lt;span class=&quot;token operator&quot;&gt;:=&lt;/span&gt; atomic&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Xchg&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;key32&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&amp;amp;&lt;/span&gt;l&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;key&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; mutex_locked&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
	&lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; v &lt;span class=&quot;token operator&quot;&gt;==&lt;/span&gt; mutex_unlocked &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
		&lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt;
	&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

	&lt;span class=&quot;token comment&quot;&gt;// wait is either MUTEX_LOCKED or MUTEX_SLEEPING&lt;/span&gt;
	&lt;span class=&quot;token comment&quot;&gt;// depending on whether there is a thread sleeping&lt;/span&gt;
	&lt;span class=&quot;token comment&quot;&gt;// on this mutex. If we ever change l-&gt;key from&lt;/span&gt;
	&lt;span class=&quot;token comment&quot;&gt;// MUTEX_SLEEPING to some other value, we must be&lt;/span&gt;
	&lt;span class=&quot;token comment&quot;&gt;// careful to change it back to MUTEX_SLEEPING before&lt;/span&gt;
	&lt;span class=&quot;token comment&quot;&gt;// returning, to ensure that the sleeping thread gets&lt;/span&gt;
	&lt;span class=&quot;token comment&quot;&gt;// its wakeup call.&lt;/span&gt;
	wait &lt;span class=&quot;token operator&quot;&gt;:=&lt;/span&gt; v

	&lt;span class=&quot;token comment&quot;&gt;// On uniprocessors, no point spinning.&lt;/span&gt;
	&lt;span class=&quot;token comment&quot;&gt;// On multiprocessors, spin for ACTIVE_SPIN attempts.&lt;/span&gt;
	spin &lt;span class=&quot;token operator&quot;&gt;:=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;
	&lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; ncpu &lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
		spin &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; active_spin
	&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
	&lt;span class=&quot;token keyword&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
		&lt;span class=&quot;token comment&quot;&gt;// Try for lock, spinning.&lt;/span&gt;
		&lt;span class=&quot;token keyword&quot;&gt;for&lt;/span&gt; i &lt;span class=&quot;token operator&quot;&gt;:=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; i &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt; spin&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; i&lt;span class=&quot;token operator&quot;&gt;++&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
			&lt;span class=&quot;token keyword&quot;&gt;for&lt;/span&gt; l&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;key &lt;span class=&quot;token operator&quot;&gt;==&lt;/span&gt; mutex_unlocked &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
				&lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; atomic&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Cas&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;key32&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&amp;amp;&lt;/span&gt;l&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;key&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; mutex_unlocked&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; wait&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
					&lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt;
				&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
			&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
			&lt;span class=&quot;token function&quot;&gt;procyield&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;active_spin_cnt&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
		&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

		&lt;span class=&quot;token comment&quot;&gt;// Try for lock, rescheduling.&lt;/span&gt;
		&lt;span class=&quot;token keyword&quot;&gt;for&lt;/span&gt; i &lt;span class=&quot;token operator&quot;&gt;:=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; i &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt; passive_spin&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; i&lt;span class=&quot;token operator&quot;&gt;++&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
			&lt;span class=&quot;token keyword&quot;&gt;for&lt;/span&gt; l&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;key &lt;span class=&quot;token operator&quot;&gt;==&lt;/span&gt; mutex_unlocked &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
				&lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; atomic&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Cas&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;key32&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&amp;amp;&lt;/span&gt;l&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;key&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; mutex_unlocked&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; wait&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
					&lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt;
				&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
			&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
			&lt;span class=&quot;token function&quot;&gt;osyield&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
		&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

		&lt;span class=&quot;token comment&quot;&gt;// Sleep.&lt;/span&gt;
		v &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; atomic&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Xchg&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;key32&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&amp;amp;&lt;/span&gt;l&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;key&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; mutex_sleeping&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
		&lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; v &lt;span class=&quot;token operator&quot;&gt;==&lt;/span&gt; mutex_unlocked &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
			&lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt;
		&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
		wait &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; mutex_sleeping
		&lt;span class=&quot;token function&quot;&gt;futexsleep&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;key32&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&amp;amp;&lt;/span&gt;l&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;key&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; mutex_sleeping&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
	&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2&gt;unlock 解锁&lt;/h2&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;go&quot;&gt;&lt;pre class=&quot;language-go&quot;&gt;&lt;code class=&quot;language-go&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;func&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;unlock&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;l &lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt;mutex&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
	v &lt;span class=&quot;token operator&quot;&gt;:=&lt;/span&gt; atomic&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Xchg&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;key32&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&amp;amp;&lt;/span&gt;l&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;key&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; mutex_unlocked&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
	&lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; v &lt;span class=&quot;token operator&quot;&gt;==&lt;/span&gt; mutex_unlocked &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
		&lt;span class=&quot;token function&quot;&gt;throw&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;unlock of unlocked lock&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
	&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
	&lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; v &lt;span class=&quot;token operator&quot;&gt;==&lt;/span&gt; mutex_sleeping &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
		&lt;span class=&quot;token function&quot;&gt;futexwakeup&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;key32&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&amp;amp;&lt;/span&gt;l&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;key&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
	&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

	gp &lt;span class=&quot;token operator&quot;&gt;:=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;getg&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
	gp&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;m&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;locks&lt;span class=&quot;token operator&quot;&gt;--&lt;/span&gt;
	&lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; gp&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;m&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;locks &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
		&lt;span class=&quot;token function&quot;&gt;throw&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;runtime·unlock: lock count&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
	&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
	&lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; gp&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;m&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;locks &lt;span class=&quot;token operator&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; gp&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;preempt &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;token comment&quot;&gt;// restore the preemption request in case we&apos;ve cleared it in newstack&lt;/span&gt;
		gp&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;stackguard0 &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; stackPreempt
	&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h1&gt;Channel 的优点&lt;/h1&gt;
&lt;p&gt;1、和&lt;code class=&quot;language-text&quot;&gt;goroutine&lt;/code&gt;调度结合起来，使得数据传输更加的高效和快速。
2、使用的锁不是操作系统的&lt;code class=&quot;language-text&quot;&gt;mutex&lt;/code&gt;互斥锁，而是使用的&lt;code class=&quot;language-text&quot;&gt;futex&lt;/code&gt;技术。&lt;/p&gt;
&lt;h1&gt;参考&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;http://cbsheng.github.io/posts/go%E7%9A%84channel%E6%BA%90%E7%A0%81%E5%B1%82%E7%90%86%E8%A7%A3/&quot;&gt;http://cbsheng.github.io/posts/go%E7%9A%84channel%E6%BA%90%E7%A0%81%E5%B1%82%E7%90%86%E8%A7%A3/&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://zh.wikipedia.org/wiki/Futex&quot;&gt;https://zh.wikipedia.org/wiki/Futex&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;</content:encoded></item><item><title><![CDATA[Badger源码学习之-SkipList基础篇]]></title><description><![CDATA[Badger源码学习之-SkipList基础篇 SkipList…]]></description><link>https://lengrongfu.github.io/2019-07-03-Badger源码学习之-SkipList基础篇/</link><guid isPermaLink="false">https://lengrongfu.github.io/2019-07-03-Badger源码学习之-SkipList基础篇/</guid><pubDate>Sat, 29 Jun 2019 15:07:15 GMT</pubDate><content:encoded>&lt;h1&gt;Badger源码学习之-SkipList基础篇&lt;/h1&gt;
&lt;p&gt;&lt;a href=&quot;https://en.wikipedia.org/wiki/Skip_list&quot;&gt;SkipList&lt;/a&gt; 全称跳跃表，具体定义可以查看维基百科的定义，或者&lt;a href=&quot;http://homepage.cs.uiowa.edu/~ghosh/skip.pdf&quot;&gt;论文&lt;/a&gt;。&lt;code class=&quot;language-text&quot;&gt;SkipList&lt;/code&gt;是一个有序的高效的链表结构，数组数据结构的&lt;code class=&quot;language-text&quot;&gt;search&lt;/code&gt;的时间复杂度为&lt;code class=&quot;language-text&quot;&gt;O(lgn)&lt;/code&gt;，通过二分法搜索，但是插入和删除的时间复杂度为&lt;code class=&quot;language-text&quot;&gt;O(n)&lt;/code&gt;；链表的&lt;code class=&quot;language-text&quot;&gt;search&lt;/code&gt;的时间复杂度为&lt;code class=&quot;language-text&quot;&gt;O(n)&lt;/code&gt;，插入和删除的时间复杂度为&lt;code class=&quot;language-text&quot;&gt;O(lg)&lt;/code&gt;。&lt;code class=&quot;language-text&quot;&gt;SkipList&lt;/code&gt;这个数据结构很好的结合了这两种数据结构的特性，&lt;code class=&quot;language-text&quot;&gt;search&lt;/code&gt;、&lt;code class=&quot;language-text&quot;&gt;insert&lt;/code&gt;、&lt;code class=&quot;language-text&quot;&gt;delete&lt;/code&gt;的时间复杂度都是&lt;code class=&quot;language-text&quot;&gt;O(lgn)&lt;/code&gt;，但是空间复杂度比其他的高，利用了空间换取时间的做法。&lt;/p&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;SkipList&lt;/code&gt;是根据链表而来的，其数据结构类似与链表。&lt;/p&gt;
&lt;h2&gt;链表&lt;/h2&gt;
&lt;p&gt;&lt;img src=&quot;https://note.youdao.com/yws/api/personal/file/WEBd674a10db06c67251c7f6fa7fdab6816?method=download&amp;#x26;shareKey=d5888342b4deb27fcaaabf4767cfe334&quot; alt=&quot;singl-list.jpg&quot;&gt;&lt;/p&gt;
&lt;p&gt;这就是一个简单的顺序链表，每次&lt;code class=&quot;language-text&quot;&gt;search&lt;/code&gt;、&lt;code class=&quot;language-text&quot;&gt;insert&lt;/code&gt;、&lt;code class=&quot;language-text&quot;&gt;delete&lt;/code&gt;的时间复杂度都是&lt;code class=&quot;language-text&quot;&gt;O(n)&lt;/code&gt;，都需要遍历整个链表。&lt;/p&gt;
&lt;h2&gt;SkipList&lt;/h2&gt;
&lt;p&gt;&lt;img src=&quot;https://note.youdao.com/yws/api/personal/file/WEB2484842e529d992295f5918ed9f99767?method=download&amp;#x26;shareKey=0836909ea6857dd9b6ba2b13c5f81401&quot; alt=&quot;skip list&quot;&gt;
&lt;code class=&quot;language-text&quot;&gt;SkipList&lt;/code&gt;和单链表的不同点就是相邻两层的节点比为&lt;code class=&quot;language-text&quot;&gt;1/2&lt;/code&gt;。查找的时间从最上层开始来查找，这就相对于建了一个索引。&lt;/p&gt;
&lt;p&gt;层级之间节点比为&lt;code class=&quot;language-text&quot;&gt;1/2&lt;/code&gt;实现起来有会边复杂，相当于需要固定维护相邻层级之间的关系。所以作者推荐使用一个随机高度，每个节点的高度随机产生，再去修改节点的前后关系。通过设置一个最大高度和相邻节点比来生成随机高度。如下设置的最大高度是&lt;code class=&quot;language-text&quot;&gt;20&lt;/code&gt;，相邻节点是&lt;code class=&quot;language-text&quot;&gt;1/3&lt;/code&gt;；算法作者推荐这个比最好为&lt;code class=&quot;language-text&quot;&gt;1/2^n&lt;/code&gt;次方,但是我不明白为啥&lt;code class=&quot;language-text&quot;&gt;badger&lt;/code&gt;选择&lt;code class=&quot;language-text&quot;&gt;1/3&lt;/code&gt;.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;go&quot;&gt;&lt;pre class=&quot;language-go&quot;&gt;&lt;code class=&quot;language-go&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;// 这事badger中的随机高度的实现方式，&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;
	maxHeight      &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;20&lt;/span&gt;
	heightIncrease &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; math&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;MaxUint32 &lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;3&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;func&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;randomHeight&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;heightIncrease &lt;span class=&quot;token builtin&quot;&gt;uint32&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token builtin&quot;&gt;int32&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
	h &lt;span class=&quot;token operator&quot;&gt;:=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;
	&lt;span class=&quot;token keyword&quot;&gt;for&lt;/span&gt; h &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt; maxHeight &lt;span class=&quot;token operator&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; rand&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Uint32&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;&amp;lt;=&lt;/span&gt; heightIncrease &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
		h&lt;span class=&quot;token operator&quot;&gt;++&lt;/span&gt;
	&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
	&lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;int32&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;h&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;高度看似是随机产生的，但是是按比例划分的，官方是按照概率去计算的，我通过生成&lt;code class=&quot;language-text&quot;&gt;10000000&lt;/code&gt;个数字来查看数字的分布，基本是和上面的概率比一致的。&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;go&quot;&gt;&lt;pre class=&quot;language-go&quot;&gt;&lt;code class=&quot;language-go&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;func&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;Test_randomHeight1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;t &lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt;testing&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;T&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;  &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
	rand&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Seed&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;time&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Now&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;UnixNano&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
	num &lt;span class=&quot;token operator&quot;&gt;:=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;10000000&lt;/span&gt;
	data2 &lt;span class=&quot;token operator&quot;&gt;:=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;make&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token builtin&quot;&gt;int32&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;num&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
	&lt;span class=&quot;token keyword&quot;&gt;for&lt;/span&gt; i &lt;span class=&quot;token operator&quot;&gt;:=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; i &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt; num &lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; i&lt;span class=&quot;token operator&quot;&gt;++&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
		data2&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;i&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;randomHeight&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;math&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;MaxUint32 &lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
	&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
	scatterData2 &lt;span class=&quot;token operator&quot;&gt;:=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;randomPoints1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;data2&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;

	data3 &lt;span class=&quot;token operator&quot;&gt;:=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;make&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token builtin&quot;&gt;int32&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;num&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
	&lt;span class=&quot;token keyword&quot;&gt;for&lt;/span&gt; i &lt;span class=&quot;token operator&quot;&gt;:=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; i &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt; num &lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; i&lt;span class=&quot;token operator&quot;&gt;++&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
		data3&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;i&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;randomHeight&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;math&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;MaxUint32 &lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;3&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
	&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
	scatterData3 &lt;span class=&quot;token operator&quot;&gt;:=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;randomPoints1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;data3&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;

	data4 &lt;span class=&quot;token operator&quot;&gt;:=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;make&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token builtin&quot;&gt;int32&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;num&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
	&lt;span class=&quot;token keyword&quot;&gt;for&lt;/span&gt; i &lt;span class=&quot;token operator&quot;&gt;:=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; i &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt; num &lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; i&lt;span class=&quot;token operator&quot;&gt;++&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
		data4&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;i&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;randomHeight&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;math&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;MaxUint32 &lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;4&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
	&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
	scatterData4  &lt;span class=&quot;token operator&quot;&gt;:=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;randomPoints1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;data4&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;

	data5 &lt;span class=&quot;token operator&quot;&gt;:=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;make&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token builtin&quot;&gt;int32&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;num&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
	&lt;span class=&quot;token keyword&quot;&gt;for&lt;/span&gt; i &lt;span class=&quot;token operator&quot;&gt;:=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; i &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt; num &lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; i&lt;span class=&quot;token operator&quot;&gt;++&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
		data5&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;i&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;randomHeight&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;math&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;MaxUint32 &lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;5&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
	&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
	scatterData5 &lt;span class=&quot;token operator&quot;&gt;:=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;randomPoints1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;data5&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
	&lt;span class=&quot;token comment&quot;&gt;// Create a new plot, set its title and&lt;/span&gt;
	&lt;span class=&quot;token comment&quot;&gt;// axis labels.&lt;/span&gt;
	p&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; err &lt;span class=&quot;token operator&quot;&gt;:=&lt;/span&gt; plot&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;New&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
	&lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; err &lt;span class=&quot;token operator&quot;&gt;!=&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;nil&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
		&lt;span class=&quot;token function&quot;&gt;panic&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;err&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
	&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
	p&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;Title&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;Text &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;Points Example&quot;&lt;/span&gt;
	p&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;X&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;Label&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;Text &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;X&quot;&lt;/span&gt;
	p&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;Y&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;Label&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;Text &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;Y&quot;&lt;/span&gt;
	&lt;span class=&quot;token comment&quot;&gt;// Draw a grid behind the data&lt;/span&gt;
	&lt;span class=&quot;token comment&quot;&gt;//p.Add(plotter.NewGrid())&lt;/span&gt;
	&lt;span class=&quot;token comment&quot;&gt;//&lt;/span&gt;
	&lt;span class=&quot;token comment&quot;&gt;//// Make a scatter plotter and set its style.&lt;/span&gt;
	&lt;span class=&quot;token comment&quot;&gt;//s, err := plotter.NewScatter(scatterData)&lt;/span&gt;
	&lt;span class=&quot;token comment&quot;&gt;//if err != nil {&lt;/span&gt;
	&lt;span class=&quot;token comment&quot;&gt;//	panic(err)&lt;/span&gt;
	&lt;span class=&quot;token comment&quot;&gt;//}&lt;/span&gt;
	&lt;span class=&quot;token comment&quot;&gt;//s.GlyphStyle.Color = color.RGBA{R: 255, B: 128, A: 255}&lt;/span&gt;
	&lt;span class=&quot;token comment&quot;&gt;//p.Add(s)&lt;/span&gt;
	l2&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; s2&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;_&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;:=&lt;/span&gt; plotter&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;NewLinePoints&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;scatterData2&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
	l2&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;Color &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; plotutil&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Color&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
	l2&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;Dashes &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; plotutil&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Dashes&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
	s2&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;Color &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; plotutil&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Color&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
	s2&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;Shape &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; plotutil&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Shape&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;

	l3&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; s3&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;_&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;:=&lt;/span&gt; plotter&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;NewLinePoints&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;scatterData3&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
	l3&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;Color &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; plotutil&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Color&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
	l3&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;Dashes &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; plotutil&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Dashes&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
	s3&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;Color &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; plotutil&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Color&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
	s3&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;Shape &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; plotutil&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Shape&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;

	l4&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; s4&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;_&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;:=&lt;/span&gt; plotter&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;NewLinePoints&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;scatterData4&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
	l4&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;Color &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; plotutil&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Color&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
	l4&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;Dashes &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; plotutil&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Dashes&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
	s4&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;Color &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; plotutil&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Color&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
	s4&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;Shape &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; plotutil&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Shape&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;

	l5&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; s5&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;_&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;:=&lt;/span&gt; plotter&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;NewLinePoints&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;scatterData5&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
	l5&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;Color &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; plotutil&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Color&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;3&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
	l5&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;Dashes &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; plotutil&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Dashes&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;3&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
	s5&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;Color &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; plotutil&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Color&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;3&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
	s5&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;Shape &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; plotutil&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Shape&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;3&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;

	&lt;span class=&quot;token comment&quot;&gt;//plotutil.AddLinePoints(p, scatterData2,scatterData3,scatterData4,scatterData5)&lt;/span&gt;
	p&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Add&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;l2&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;s2&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;l3&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;s3&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;l4&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;s4&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;l5&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;s5&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
	p&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;Legend&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Add&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;line points 2&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; l2&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; s2&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
	p&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;Legend&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Add&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;line points 3&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; l3&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; s3&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
	p&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;Legend&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Add&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;line points 4&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; l4&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; s4&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
	p&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;Legend&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Add&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;line points 5&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; l5&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; s5&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
	&lt;span class=&quot;token comment&quot;&gt;// Save the plot to a PNG file.&lt;/span&gt;
	&lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; err &lt;span class=&quot;token operator&quot;&gt;:=&lt;/span&gt; p&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Save&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;8&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt;vg&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;Inch&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;8&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt;vg&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;Inch&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;4-points0.5.png&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; err &lt;span class=&quot;token operator&quot;&gt;!=&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;nil&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
		&lt;span class=&quot;token function&quot;&gt;panic&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;err&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
	&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
	t&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Log&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;Test Pass&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;


&lt;span class=&quot;token comment&quot;&gt;// randomPoints returns some random x, y points.&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;func&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;randomPoints1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;n &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token builtin&quot;&gt;int32&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; plotter&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;XYs &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
	m &lt;span class=&quot;token operator&quot;&gt;:=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;make&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;map&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token builtin&quot;&gt;int32&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token builtin&quot;&gt;int&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;

	&lt;span class=&quot;token keyword&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;_&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;v &lt;span class=&quot;token operator&quot;&gt;:=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;range&lt;/span&gt; n &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
		&lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;_&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;ok &lt;span class=&quot;token operator&quot;&gt;:=&lt;/span&gt; m&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;v&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; ok  &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
			m&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;v&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;++&lt;/span&gt;
		&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
			m&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;v&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;
		&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
	&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
	pts &lt;span class=&quot;token operator&quot;&gt;:=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;make&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;plotter&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;XYs&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;len&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;m&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
	&lt;span class=&quot;token keyword&quot;&gt;for&lt;/span&gt; i&lt;span class=&quot;token operator&quot;&gt;:=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; i &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;len&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;m&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
		k &lt;span class=&quot;token operator&quot;&gt;:=&lt;/span&gt; i&lt;span class=&quot;token operator&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;
		v &lt;span class=&quot;token operator&quot;&gt;:=&lt;/span&gt; m&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;int32&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;k&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;
		fmt&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Println&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;k&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;v&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
		pts&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;i&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;X &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;float64&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;k&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
		pts&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;i&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;Y &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;float64&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;v&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
		i &lt;span class=&quot;token operator&quot;&gt;++&lt;/span&gt;
	&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
	fmt&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Printf&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;map:%+v\n&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;m&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
	&lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; pts
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;我写了如上的一个测试程序，并画出数据的分布情况。
&lt;img src=&quot;https://note.youdao.com/yws/api/personal/file/WEB3e6a78c1c7642b5eee88e6752c4ae91a?method=download&amp;#x26;shareKey=cab1b3a195affd9b3e24c9827a290495&quot; alt=&quot;分布&quot;&gt;&lt;/p&gt;
&lt;p&gt;横轴是最大高度，纵轴是分布在高度上的情况，从图上可以看出，&lt;code class=&quot;language-text&quot;&gt;p&lt;/code&gt;越小，衰变的速度越快，数据分布越集中，当&lt;code class=&quot;language-text&quot;&gt;p&lt;/code&gt;为&lt;code class=&quot;language-text&quot;&gt;1/2&lt;/code&gt;是数据基本是按层级间&lt;code class=&quot;language-text&quot;&gt;1/2&lt;/code&gt;的关系递减的。&lt;/p&gt;
&lt;h2&gt;实现&lt;/h2&gt;
&lt;p&gt;官方论文中有实现的伪代码，按照伪代码即可实现。&lt;/p&gt;
&lt;h3&gt;Search&lt;/h3&gt;
&lt;p&gt;如下是查询时的一个伪代码，基本逻辑就是从头节点的最高层级开始变量查询，如果查询节点不为&lt;code class=&quot;language-text&quot;&gt;nil&lt;/code&gt;并且&lt;code class=&quot;language-text&quot;&gt;key&lt;/code&gt;大于当前节点的&lt;code class=&quot;language-text&quot;&gt;key&lt;/code&gt;，就往后查询，否则层级下降。&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;go&quot;&gt;&lt;pre class=&quot;language-go&quot;&gt;&lt;code class=&quot;language-go&quot;&gt;&lt;span class=&quot;token function&quot;&gt;Search&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;list&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; searchKey&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    x &lt;span class=&quot;token operator&quot;&gt;:=&lt;/span&gt; list→header
    &lt;span class=&quot;token operator&quot;&gt;--&lt;/span&gt; loop invariant&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; x→key &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt; searchKey
    &lt;span class=&quot;token keyword&quot;&gt;for&lt;/span&gt; i &lt;span class=&quot;token operator&quot;&gt;:=&lt;/span&gt; list→level downto &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt; do
        while x→forward&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;i&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;!=&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;nil&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&amp;amp;&lt;/span&gt; x→forward&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;i&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;→key &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt; searchKey do
            x &lt;span class=&quot;token operator&quot;&gt;:=&lt;/span&gt; x→forward&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;i&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;
    &lt;span class=&quot;token operator&quot;&gt;--&lt;/span&gt; x→key &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt; searchKey ≤ x→forward&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;→key
    x &lt;span class=&quot;token operator&quot;&gt;:=&lt;/span&gt; x→forward&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; x→key &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; searchKey then 
        &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; x→value
    &lt;span class=&quot;token keyword&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; failure&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h3&gt;Insert&lt;/h3&gt;
&lt;p&gt;插入的不同点就是要记录下查找的路径，后面需要更新插入前后的元素;只记录阶梯变化的最后一个；下面的&lt;code class=&quot;language-text&quot;&gt;update&lt;/code&gt;数组就是记录变化的，然后查找到要插入的地方，如果&lt;code class=&quot;language-text&quot;&gt;key&lt;/code&gt;已经存在就更新值，不存在就插入。&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;go&quot;&gt;&lt;pre class=&quot;language-go&quot;&gt;&lt;code class=&quot;language-go&quot;&gt;&lt;span class=&quot;token function&quot;&gt;Insert&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;list&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; searchKey&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; newValue&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    local update&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1.&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;MaxLevel&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;
    x &lt;span class=&quot;token operator&quot;&gt;:=&lt;/span&gt; list→header
    &lt;span class=&quot;token keyword&quot;&gt;for&lt;/span&gt; i &lt;span class=&quot;token operator&quot;&gt;:=&lt;/span&gt; list→level downto &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt; do
        while x→forward&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;i&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;→key &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt; searchKey do
            x &lt;span class=&quot;token operator&quot;&gt;:=&lt;/span&gt; x→forward&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;i&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;
        update&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;i&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;:=&lt;/span&gt; x
    x &lt;span class=&quot;token operator&quot;&gt;:=&lt;/span&gt; x→forward&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; x→key &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; searchKey then x→value &lt;span class=&quot;token operator&quot;&gt;:=&lt;/span&gt; newValue
    &lt;span class=&quot;token keyword&quot;&gt;else&lt;/span&gt;
        newLevel &lt;span class=&quot;token operator&quot;&gt;:=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;randomLevel&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; newLevel &lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; list→level then
            &lt;span class=&quot;token keyword&quot;&gt;for&lt;/span&gt; i &lt;span class=&quot;token operator&quot;&gt;:=&lt;/span&gt; list→level &lt;span class=&quot;token operator&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt; to newLevel do
                update&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;i&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;:=&lt;/span&gt; list→header
            list→level &lt;span class=&quot;token operator&quot;&gt;:=&lt;/span&gt; newLevel
        x &lt;span class=&quot;token operator&quot;&gt;:=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;makeNode&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;newLevel &lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; searchKey&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; value&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;for&lt;/span&gt; i &lt;span class=&quot;token operator&quot;&gt;:=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt; to newLevel do
            x→forward&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;i&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;:=&lt;/span&gt; update&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;i&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;→forward&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;i&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;
            update&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;i&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;→forward&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;i&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;:=&lt;/span&gt; x&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h3&gt;Delete&lt;/h3&gt;
&lt;p&gt;删除是同样需要记录查找路径，后面需要更新前后的路径。&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;go&quot;&gt;&lt;pre class=&quot;language-go&quot;&gt;&lt;code class=&quot;language-go&quot;&gt;&lt;span class=&quot;token function&quot;&gt;Delete&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;list&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; searchKey&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    local update&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1.&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;MaxLevel&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;
    x &lt;span class=&quot;token operator&quot;&gt;:=&lt;/span&gt; list→header
    &lt;span class=&quot;token keyword&quot;&gt;for&lt;/span&gt; i &lt;span class=&quot;token operator&quot;&gt;:=&lt;/span&gt; list→level downto &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt; do
        while x→forward&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;i&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;→key &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt; searchKey do
            x &lt;span class=&quot;token operator&quot;&gt;:=&lt;/span&gt; x→forward&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;i&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;
        update&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;i&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;:=&lt;/span&gt; x
    x &lt;span class=&quot;token operator&quot;&gt;:=&lt;/span&gt; x→forward&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; x→key &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; searchKey then
        &lt;span class=&quot;token keyword&quot;&gt;for&lt;/span&gt; i &lt;span class=&quot;token operator&quot;&gt;:=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt; to list→level do
            &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; update&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;i&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;→forward&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;i&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; ≠ x then &lt;span class=&quot;token keyword&quot;&gt;break&lt;/span&gt;
            update&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;i&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;→forward&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;i&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;:=&lt;/span&gt; x→forward&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;i&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;
        &lt;span class=&quot;token function&quot;&gt;free&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;x&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
        while list→level &lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt; and
            list→header→forward&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;list→level&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; NIL do
            list→level &lt;span class=&quot;token operator&quot;&gt;:=&lt;/span&gt; list→level – &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2&gt;参考&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;http://zhangtielei.com/posts/blog-redis-skiplist.html&quot;&gt;redis之Skiplist&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;http://homepage.cs.uiowa.edu/~ghosh/skip.pdf&quot;&gt;论文&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://eugene-eeo.github.io/blog/skip-lists.html&quot;&gt;https://eugene-eeo.github.io/blog/skip-lists.html&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://ticki.github.io/blog/skip-lists-done-right/&quot;&gt;https://ticki.github.io/blog/skip-lists-done-right/&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;</content:encoded></item><item><title><![CDATA[linux sed]]></title><description><![CDATA[Sed Command…]]></description><link>https://lengrongfu.github.io/2019-06-19-linux-sed/</link><guid isPermaLink="false">https://lengrongfu.github.io/2019-06-19-linux-sed/</guid><pubDate>Wed, 19 Jun 2019 21:17:02 GMT</pubDate><content:encoded>&lt;h1&gt;Sed Command&lt;/h1&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;sed&lt;/code&gt;是一种流编辑器，它是文本处理中非常中的工具，能够完美的配合正则表达式使用，功能不同凡响。处理时，把当前处理的行存储在临时缓冲区中，称为“模式空间”&lt;code class=&quot;language-text&quot;&gt;（pattern space&lt;/code&gt;），接着用&lt;code class=&quot;language-text&quot;&gt;sed&lt;/code&gt;命令处理缓冲区中的内容，处理完成后，把缓冲区的内容送往屏幕。接着处理下一行，这样不断重复，直到文件末尾。文件内容并没有 改变，除非你使用重定向存储输出。&lt;code class=&quot;language-text&quot;&gt;Sed&lt;/code&gt;主要用来自动编辑一个或多个文件；简化对文件的反复操作；编写转换程序等。&lt;/p&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;Sed&lt;/code&gt;命令我目前主要是用在编写&lt;code class=&quot;language-text&quot;&gt;dockerfile&lt;/code&gt;时用于执行替换配置使用的，如果是这样的话，就不能用最小的&lt;code class=&quot;language-text&quot;&gt;scratch&lt;/code&gt;镜像，因为&lt;code class=&quot;language-text&quot;&gt;sed&lt;/code&gt;命令需要在有&lt;code class=&quot;language-text&quot;&gt;sh&lt;/code&gt;环境中执行，最小的就是&lt;code class=&quot;language-text&quot;&gt;alpine&lt;/code&gt;。&lt;/p&gt;
&lt;p&gt;当遇到不会使用的时在&lt;code class=&quot;language-text&quot;&gt;Linux&lt;/code&gt;系统上查看操作手册&lt;code class=&quot;language-text&quot;&gt;man sed&lt;/code&gt;.&lt;/p&gt;
&lt;h2&gt;替换文件中的内容&lt;/h2&gt;
&lt;h3&gt;文件内容如下&lt;/h3&gt;
&lt;p&gt;比如文件中的内容是&lt;code class=&quot;language-text&quot;&gt;mysql&lt;/code&gt;的配置，功能就是替换&lt;code class=&quot;language-text&quot;&gt;mysql&lt;/code&gt;的的配置。如下就是一个典型的&lt;code class=&quot;language-text&quot;&gt;java&lt;/code&gt;使用&lt;code class=&quot;language-text&quot;&gt;mysql&lt;/code&gt;的配置。&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;properties&quot;&gt;&lt;pre class=&quot;language-properties&quot;&gt;&lt;code class=&quot;language-properties&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;# application.properties&lt;/span&gt;
&lt;span class=&quot;token attr-name&quot;&gt;spring.datasource.druid.url&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token attr-value&quot;&gt;jdbc:mysql://127.0.0.1:3306/demo?autoReconnect=true&amp;amp;useUnicode=true&amp;amp;characterEncoding=utf8&amp;amp;serverTimezone=GM    T&amp;amp;allowMultiQueries=true&amp;amp;useSSL=false&lt;/span&gt;
&lt;span class=&quot;token attr-name&quot;&gt;spring.datasource.druid.username&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token attr-value&quot;&gt;test&lt;/span&gt;
&lt;span class=&quot;token attr-name&quot;&gt;spring.datasource.druid.password&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token attr-value&quot;&gt;test&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h3&gt;替换脚本如下&lt;/h3&gt;
&lt;p&gt;脚本功能就是用于替换上述数据中的&lt;code class=&quot;language-text&quot;&gt;host&lt;/code&gt;、&lt;code class=&quot;language-text&quot;&gt;port&lt;/code&gt;、&lt;code class=&quot;language-text&quot;&gt;username&lt;/code&gt;、&lt;code class=&quot;language-text&quot;&gt;password&lt;/code&gt;、&lt;code class=&quot;language-text&quot;&gt;dbname&lt;/code&gt;这些配置。&lt;/p&gt;
&lt;p&gt;如下是&lt;code class=&quot;language-text&quot;&gt;Dockerfiele&lt;/code&gt;文件内容.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;shell&quot;&gt;&lt;pre class=&quot;language-shell&quot;&gt;&lt;code class=&quot;language-shell&quot;&gt;FROM alpine:3.9.4  
ENV &lt;span class=&quot;token assign-left variable&quot;&gt;DB_USER&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;&quot;&lt;/span&gt; &lt;span class=&quot;token assign-left variable&quot;&gt;DB_HOST&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;&quot;&lt;/span&gt; &lt;span class=&quot;token assign-left variable&quot;&gt;DB_PASSWORD&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;&quot;&lt;/span&gt; &lt;span class=&quot;token assign-left variable&quot;&gt;DB_PORT&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;&quot;&lt;/span&gt; &lt;span class=&quot;token assign-left variable&quot;&gt;DB_NAME&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;&quot;&lt;/span&gt;
ENTRYPOINT &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;/bin/sh&quot;&lt;/span&gt;,&lt;span class=&quot;token string&quot;&gt;&quot;-c&quot;&lt;/span&gt;,&lt;span class=&quot;token string&quot;&gt;&quot;sh /docker-entrypoint.sh&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;如下就是执行的脚本&lt;code class=&quot;language-text&quot;&gt;docker-entrypoint.sh&lt;/code&gt;。&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;shell&quot;&gt;&lt;pre class=&quot;language-shell&quot;&gt;&lt;code class=&quot;language-shell&quot;&gt;&lt;span class=&quot;token shebang important&quot;&gt;#! /bin/bash&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;# 指定文件目录&lt;/span&gt;
APPLICATION_NAME &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;./application.properties&quot;&lt;/span&gt;
&lt;span class=&quot;token function&quot;&gt;sed&lt;/span&gt; -i &lt;span class=&quot;token string&quot;&gt;&quot;s/&quot;&lt;/span&gt;
&lt;span class=&quot;token function&quot;&gt;sed&lt;/span&gt; -i &lt;span class=&quot;token string&quot;&gt;&quot;s/127.0.0.1:3306\/demo/&lt;span class=&quot;token variable&quot;&gt;${DB_HOST}&lt;/span&gt;:&lt;span class=&quot;token variable&quot;&gt;${DB_PORT}&lt;/span&gt;\/&lt;span class=&quot;token variable&quot;&gt;${DB_NAME}&lt;/span&gt;/g&quot;&lt;/span&gt; &lt;span class=&quot;token variable&quot;&gt;${APPLICATION_NAME}&lt;/span&gt;
&lt;span class=&quot;token function&quot;&gt;sed&lt;/span&gt; -i &lt;span class=&quot;token string&quot;&gt;&quot;s/spring.datasource.druid.username=test/spring.datasource.druid.username=&lt;span class=&quot;token variable&quot;&gt;${DB_USER}&lt;/span&gt;/g&quot;&lt;/span&gt; &lt;span class=&quot;token variable&quot;&gt;${APPLICATION_NAME}&lt;/span&gt;
&lt;span class=&quot;token function&quot;&gt;sed&lt;/span&gt; -i &lt;span class=&quot;token string&quot;&gt;&quot;s/spring.datasource.druid.password=test/spring.datasource.druid.password=&lt;span class=&quot;token variable&quot;&gt;${DB_PASSWORD}&lt;/span&gt;/g&quot;&lt;/span&gt; &lt;span class=&quot;token variable&quot;&gt;${APPLICATION_NAME}&lt;/span&gt;

java -jar demo.java&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;如上就可以执行替换一些配置了。&lt;/p&gt;
&lt;h2&gt;使用Tips&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;可以通过命令行先进行验证。&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;shell&quot;&gt;&lt;pre class=&quot;language-shell&quot;&gt;&lt;code class=&quot;language-shell&quot;&gt;$ &lt;span class=&quot;token builtin class-name&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;spring.datasource.druid.url=jdbc:mysql://127.0.0.1:3306/demo?autoReconnect=true&amp;amp;useUnicode=true&amp;amp;characterEncoding=utf8&amp;amp;serverTimezone=GM&quot;&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;sed&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;s/127.0.0.1:3306\/demo/127.0.0.2:3307\/test/g&quot;&lt;/span&gt;
spring.datasource.druid.url&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;jdbc:mysql://127.0.0.2:3307/test?autoReconnect&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;true&lt;span class=&quot;token operator&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;token assign-left variable&quot;&gt;useUnicode&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;true&lt;span class=&quot;token operator&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;token assign-left variable&quot;&gt;characterEncoding&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;utf8&lt;span class=&quot;token operator&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;token assign-left variable&quot;&gt;serverTimezone&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;GM&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;验证好了在修改一下，上面的命令少了&lt;code class=&quot;language-text&quot;&gt;-i&lt;/code&gt;命令选项和文件名,&lt;code class=&quot;language-text&quot;&gt;-i&lt;/code&gt;就是用于修改本地文件的一个选项。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;匹配时尽量使用能唯一命中的&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;shell&quot;&gt;&lt;pre class=&quot;language-shell&quot;&gt;&lt;code class=&quot;language-shell&quot;&gt;$ &lt;span class=&quot;token function&quot;&gt;sed&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;s/spring.datasource.druid.password=test/spring.datasource.druid.password=&lt;span class=&quot;token variable&quot;&gt;${DB_PASSWORD}&lt;/span&gt;/g&quot;&lt;/span&gt;
$ &lt;span class=&quot;token function&quot;&gt;sed&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;s/test/&lt;span class=&quot;token variable&quot;&gt;${DB_PASSWORD}&lt;/span&gt;/g&quot;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;如上的两个匹配规则，第一个最好，第二个会把匹配到&lt;code class=&quot;language-text&quot;&gt;test&lt;/code&gt;的所有地方都更改调，所有最好使用唯一匹配规则。&lt;/p&gt;
&lt;h2&gt;参考&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;man sed&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;http://man.linuxde.net/sed&quot;&gt;man.net&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;</content:encoded></item><item><title><![CDATA[Go sync package]]></title><description><![CDATA[Go sync package 包提供了基本的同步原语，比如同步锁，还有其他的和，大多数都用于低级别的库，高级别的同步控制最好用。 Cond…]]></description><link>https://lengrongfu.github.io/2019-06-18-Go-sync-package/</link><guid isPermaLink="false">https://lengrongfu.github.io/2019-06-18-Go-sync-package/</guid><pubDate>Tue, 18 Jun 2019 20:07:55 GMT</pubDate><content:encoded>&lt;h1&gt;Go sync package&lt;/h1&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;sync&lt;/code&gt;包提供了基本的同步原语，比如同步锁，还有其他的&lt;code class=&quot;language-text&quot;&gt;Once&lt;/code&gt;和&lt;code class=&quot;language-text&quot;&gt;WaitGroup&lt;/code&gt;，大多数都用于低级别的库，高级别的同步控制最好用&lt;code class=&quot;language-text&quot;&gt;channels&lt;/code&gt;。&lt;/p&gt;
&lt;h2&gt;Cond&lt;/h2&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;Cond&lt;/code&gt;实现了一个条件变量,等待或宣布事件发生的&lt;code class=&quot;language-text&quot;&gt;goroutines&lt;/code&gt;的集合点。&lt;/p&gt;
&lt;p&gt;任何一个&lt;code class=&quot;language-text&quot;&gt;Cond&lt;/code&gt;都有任意一个相关的锁对象&lt;code class=&quot;language-text&quot;&gt;L&lt;/code&gt;，可以是同步锁或者读写锁。不论选择哪一个必须在条件改变和等待调用方法前不被改变。&lt;/p&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;Cond&lt;/code&gt;使用之后不能被复制。&lt;/p&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;Cond&lt;/code&gt;主要用于&lt;code class=&quot;language-text&quot;&gt;go&lt;/code&gt;之间的消息通知。&lt;/p&gt;
&lt;h3&gt;func (c *Cond) Wait()&lt;/h3&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;go&quot;&gt;&lt;pre class=&quot;language-go&quot;&gt;&lt;code class=&quot;language-go&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;func&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;c &lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt;Cond&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;Wait&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;等待&lt;code class=&quot;language-text&quot;&gt;c.L&lt;/code&gt;原子解锁以及暂停执行调用&lt;code class=&quot;language-text&quot;&gt;goroutine&lt;/code&gt;，之后再恢复执行，在返回前加锁&lt;code class=&quot;language-text&quot;&gt;c.L&lt;/code&gt;,除非被广播或信号唤醒，否则等待无法返回。&lt;/p&gt;
&lt;p&gt;使用例子:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;go&quot;&gt;&lt;pre class=&quot;language-go&quot;&gt;&lt;code class=&quot;language-go&quot;&gt;c&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;L&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Lock&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;!&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;condition&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    c&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Wait&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token operator&quot;&gt;...&lt;/span&gt; &lt;span class=&quot;token builtin&quot;&gt;make&lt;/span&gt; use of condition &lt;span class=&quot;token operator&quot;&gt;...&lt;/span&gt;
c&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;L&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Unlock&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h3&gt;func (*Cond) Signal&lt;/h3&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;go&quot;&gt;&lt;pre class=&quot;language-go&quot;&gt;&lt;code class=&quot;language-go&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;func&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt;Cond&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; Signal&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;Signal&lt;/code&gt;函数是发送一个信号，用于唤醒一个等待的&lt;code class=&quot;language-text&quot;&gt;go&lt;/code&gt;,如果有多个&lt;code class=&quot;language-text&quot;&gt;go&lt;/code&gt;处于等待状态，则不能控制唤醒那个&lt;code class=&quot;language-text&quot;&gt;go&lt;/code&gt;。&lt;/p&gt;
&lt;h3&gt;func (*Cond) Broadcast&lt;/h3&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;go&quot;&gt;&lt;pre class=&quot;language-go&quot;&gt;&lt;code class=&quot;language-go&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;func&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt;Cond&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; Broadcast&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;Broadcast&lt;/code&gt;广播函数用于唤醒所有等待的&lt;code class=&quot;language-text&quot;&gt;go&lt;/code&gt;。&lt;/p&gt;
&lt;h2&gt;Mutex&lt;/h2&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;Mutex&lt;/code&gt;就是一个互斥锁的。保证任何资源只能被任何一个&lt;code class=&quot;language-text&quot;&gt;go&lt;/code&gt;使用。&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;go&quot;&gt;&lt;pre class=&quot;language-go&quot;&gt;&lt;code class=&quot;language-go&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;type&lt;/span&gt; Mutex &lt;span class=&quot;token keyword&quot;&gt;struct&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
	state &lt;span class=&quot;token builtin&quot;&gt;int32&lt;/span&gt; # 状态
	sema  &lt;span class=&quot;token builtin&quot;&gt;uint32&lt;/span&gt; # 信号量字段semaphore
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h3&gt;func (*Mutex) Lock&lt;/h3&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;go&quot;&gt;&lt;pre class=&quot;language-go&quot;&gt;&lt;code class=&quot;language-go&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;func&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;m &lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt;Mutex&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;Lock&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;锁&lt;code class=&quot;language-text&quot;&gt;m&lt;/code&gt;,如果锁已被使用，则调用&lt;code class=&quot;language-text&quot;&gt;goroutine&lt;/code&gt;将阻塞，直到互斥锁可用。&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;go&quot;&gt;&lt;pre class=&quot;language-go&quot;&gt;&lt;code class=&quot;language-go&quot;&gt;# Lock 函数&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;使用CAS算法，如果锁状态是&lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;，期望值也是&lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;，就修改为&lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;，如果再次加锁时，内存值是&lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;，期望值是&lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;，操作就是失败，得到的就是&lt;span class=&quot;token boolean&quot;&gt;false&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;第一次加锁时m&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;state是&lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; atomic&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;CompareAndSwapInt32&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&amp;amp;&lt;/span&gt;m&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;state&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; mutexLocked&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
		&lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; race&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;Enabled &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
			race&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Acquire&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;unsafe&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Pointer&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;m&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
		&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
		&lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt;
	&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
	&lt;span class=&quot;token operator&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;
# 如果再次加锁就会进入&lt;span class=&quot;token keyword&quot;&gt;go&lt;/span&gt;等待队列中。如果lifo为&lt;span class=&quot;token boolean&quot;&gt;true&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;队列等待在等待队列的头部。	
# m&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;sema 是信号量&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;这个方法可Semacquire方法一样，是为了Mutexes实现的，如果lifo为&lt;span class=&quot;token boolean&quot;&gt;true&lt;/span&gt;，则在等待队列的头部排队服务员
&lt;span class=&quot;token function&quot;&gt;runtime_SemacquireMutex&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&amp;amp;&lt;/span&gt;m&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;sema&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; queueLifo&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;go&quot;&gt;&lt;pre class=&quot;language-go&quot;&gt;&lt;code class=&quot;language-go&quot;&gt;# Semacquire等待直到&lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt; s&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;然后以原子方式递减它。
&lt;span class=&quot;token keyword&quot;&gt;func&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;runtime_Semacquire&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;s &lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;token builtin&quot;&gt;uint32&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h3&gt;func (*Mutex) Unlock&lt;/h3&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;go&quot;&gt;&lt;pre class=&quot;language-go&quot;&gt;&lt;code class=&quot;language-go&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;func&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;m &lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt;Mutex&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;Unlock&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
# 解锁的时候就进行m&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;state原子加&lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;，如果多次解锁就会运行时异常。
&lt;span class=&quot;token builtin&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;:=&lt;/span&gt; atomic&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;AddInt32&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&amp;amp;&lt;/span&gt;m&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;state&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;mutexLocked&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token builtin&quot;&gt;new&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;+&lt;/span&gt;mutexLocked&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&amp;amp;&lt;/span&gt;mutexLocked &lt;span class=&quot;token operator&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
		&lt;span class=&quot;token function&quot;&gt;throw&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;sync: unlock of unlocked mutex&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
	&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token operator&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;
# 这个方法主要是执行原子的递增m&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;sema&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;并通知一个阻塞在Semacquire的等待goroutines
&lt;span class=&quot;token function&quot;&gt;runtime_Semrelease&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&amp;amp;&lt;/span&gt;m&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;sema&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;false&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;互斥锁与&lt;code class=&quot;language-text&quot;&gt;go&lt;/code&gt;不绑定，可以&lt;code class=&quot;language-text&quot;&gt;go1&lt;/code&gt;进行加锁,&lt;code class=&quot;language-text&quot;&gt;go2&lt;/code&gt;进行解锁。只要解锁在加锁后操作就行。&lt;/p&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;go&lt;/code&gt;中的互斥锁是通过信号量和&lt;/p&gt;
&lt;h2&gt;Once&lt;/h2&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;Once&lt;/code&gt;是一个只执行一次动作的对象。一般可以用于连接关闭，保证只执行一次;或者用于执行初始化，保证只初始化一次。&lt;/p&gt;
&lt;h3&gt;func (*Once) Do&lt;/h3&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;go&quot;&gt;&lt;pre class=&quot;language-go&quot;&gt;&lt;code class=&quot;language-go&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;func&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;o &lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt;Once&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;Do&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;f &lt;span class=&quot;token keyword&quot;&gt;func&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
	&lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; atomic&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;LoadUint32&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&amp;amp;&lt;/span&gt;o&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;done&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
		&lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt;
	&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
	&lt;span class=&quot;token comment&quot;&gt;// Slow-path.&lt;/span&gt;
	o&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;m&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Lock&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
	&lt;span class=&quot;token keyword&quot;&gt;defer&lt;/span&gt; o&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;m&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Unlock&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
	&lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; o&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;done &lt;span class=&quot;token operator&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
		&lt;span class=&quot;token keyword&quot;&gt;defer&lt;/span&gt; atomic&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;StoreUint32&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&amp;amp;&lt;/span&gt;o&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;done&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
		&lt;span class=&quot;token function&quot;&gt;f&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
	&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;如果&lt;code class=&quot;language-text&quot;&gt;once.Do(f)&lt;/code&gt;被调用多次，也只会执行一次，即时参数&lt;code class=&quot;language-text&quot;&gt;f&lt;/code&gt;不一致也只会执行一次。每个需要执行一次的函数都需要创建一个&lt;code class=&quot;language-text&quot;&gt;Once&lt;/code&gt;对象。执行&lt;code class=&quot;language-text&quot;&gt;f&lt;/code&gt;函数时如果出现&lt;code class=&quot;language-text&quot;&gt;panics&lt;/code&gt;也会认为执行过了，不会再次调用这个函数。&lt;/p&gt;
&lt;p&gt;如果出现循环调用就会出现死锁；这个点看源码就知道了。&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;go&quot;&gt;&lt;pre class=&quot;language-go&quot;&gt;&lt;code class=&quot;language-go&quot;&gt;once&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Do&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;func&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
		once&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Do&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;func&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
			&lt;span class=&quot;token function&quot;&gt;f&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;test&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
		&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
	&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2&gt;Pool&lt;/h2&gt;
&lt;p&gt;池是一组可以单独保存和检索的临时对象,池中的对象可能会被自动删除，池使用时时安全的；池主要时缓存已经创建但是未使用到对象，这样可以减轻GC的压力；&lt;code class=&quot;language-text&quot;&gt;fmt&lt;/code&gt;包中使用的池时比较好的，在大负载下进行扩展，在负载降低时进行收缩。&lt;/p&gt;
&lt;h2&gt;RWMutex&lt;/h2&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;go&quot;&gt;&lt;pre class=&quot;language-go&quot;&gt;&lt;code class=&quot;language-go&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;type&lt;/span&gt; RWMutex &lt;span class=&quot;token keyword&quot;&gt;struct&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
	w           Mutex  &lt;span class=&quot;token comment&quot;&gt;// 写互斥锁&lt;/span&gt;
	writerSem   &lt;span class=&quot;token builtin&quot;&gt;uint32&lt;/span&gt; &lt;span class=&quot;token comment&quot;&gt;// 写信号量&lt;/span&gt;
	readerSem   &lt;span class=&quot;token builtin&quot;&gt;uint32&lt;/span&gt; &lt;span class=&quot;token comment&quot;&gt;// 读信号量&lt;/span&gt;
	readerCount &lt;span class=&quot;token builtin&quot;&gt;int32&lt;/span&gt;  &lt;span class=&quot;token comment&quot;&gt;// 读阻塞的数量&lt;/span&gt;
	readerWait  &lt;span class=&quot;token builtin&quot;&gt;int32&lt;/span&gt;  &lt;span class=&quot;token comment&quot;&gt;// 读放弃的数量&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; rwmutexMaxReaders &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;30&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;加读锁最大次数是&lt;code class=&quot;language-text&quot;&gt;2^30&lt;/code&gt;次。&lt;/p&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;RWMutex&lt;/code&gt;是一个读写互斥锁，可以拥有多个读锁或者一个写锁，&lt;code class=&quot;language-text&quot;&gt;RWMutex&lt;/code&gt;的零值状态时是互斥锁,写锁的优先级高于读写锁。&lt;/p&gt;
&lt;p&gt;解释一下写锁的优先级高于读锁：比如有&lt;code class=&quot;language-text&quot;&gt;10&lt;/code&gt;个&lt;code class=&quot;language-text&quot;&gt;goroutines&lt;/code&gt;获取了读锁，此时再有一个&lt;code class=&quot;language-text&quot;&gt;go&lt;/code&gt;来获取写锁，这个&lt;code class=&quot;language-text&quot;&gt;go&lt;/code&gt;就会进入阻塞状态,然后又有一组&lt;code class=&quot;language-text&quot;&gt;go&lt;/code&gt;来获取读锁，此时就获取不到读锁了，需要等前面的读锁全部释放完，并且写锁释放过后才能再次获取读锁，所以就是说写锁优先级高于读锁。不这样处理的话写锁会处于永久饥饿中。&lt;/p&gt;
&lt;h3&gt;func (*RWMutex) Lock&lt;/h3&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;go&quot;&gt;&lt;pre class=&quot;language-go&quot;&gt;&lt;code class=&quot;language-go&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;func&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;rw &lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt;RWMutex&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; Lock &lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;用于&lt;code class=&quot;language-text&quot;&gt;rw&lt;/code&gt;的写锁，如果锁是已经被读或写使用，那锁将阻塞知道可用。&lt;/p&gt;
&lt;h3&gt;func (*RWMutex) RLock&lt;/h3&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;go&quot;&gt;&lt;pre class=&quot;language-go&quot;&gt;&lt;code class=&quot;language-go&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;func&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;rw &lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt;RWMutex&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; RLock &lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;用于&lt;code class=&quot;language-text&quot;&gt;rw&lt;/code&gt;的读锁，次锁不能被递归调用。&lt;/p&gt;
&lt;h3&gt;func (*RWMutex) RLocker&lt;/h3&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;go&quot;&gt;&lt;pre class=&quot;language-go&quot;&gt;&lt;code class=&quot;language-go&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;func&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;rw &lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt;RWMutex&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; RLocker&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;RLocker&lt;/code&gt;返回一个&lt;code class=&quot;language-text&quot;&gt;Locker&lt;/code&gt;接口，通过调用&lt;code class=&quot;language-text&quot;&gt;Lock&lt;/code&gt;和&lt;code class=&quot;language-text&quot;&gt;Unlock&lt;/code&gt;来实现&lt;code class=&quot;language-text&quot;&gt;rw.RLock&lt;/code&gt;和&lt;code class=&quot;language-text&quot;&gt;rw.RUnlock&lt;/code&gt;方法。&lt;/p&gt;
&lt;h3&gt;func (*RWMutex) RUnlock&lt;/h3&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;go&quot;&gt;&lt;pre class=&quot;language-go&quot;&gt;&lt;code class=&quot;language-go&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;func&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;rw &lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt;RWMutex&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; RUnlock &lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;RUnlock&lt;/code&gt;用于解锁其中一个读锁，如果没有加的读锁就会出现异常。&lt;/p&gt;
&lt;h3&gt;func (*RWMutex) Unlock&lt;/h3&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;go&quot;&gt;&lt;pre class=&quot;language-go&quot;&gt;&lt;code class=&quot;language-go&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;func&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;rw &lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt;RWMutex&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; Unlock&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;解除&lt;code class=&quot;language-text&quot;&gt;rw&lt;/code&gt;的写锁，如果&lt;code class=&quot;language-text&quot;&gt;rw&lt;/code&gt;是没有加写锁就会出现运行时异常。和互斥锁一样&lt;code class=&quot;language-text&quot;&gt;Mutex&lt;/code&gt;,锁对象和&lt;code class=&quot;language-text&quot;&gt;goroutines&lt;/code&gt;没有关联，可以任意&lt;code class=&quot;language-text&quot;&gt;go&lt;/code&gt;加锁，任意&lt;code class=&quot;language-text&quot;&gt;go&lt;/code&gt;解锁。&lt;/p&gt;
&lt;h2&gt;Context&lt;/h2&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;Context&lt;/code&gt;主要用于在一个&lt;code class=&quot;language-text&quot;&gt;http request&lt;/code&gt;中，启动了多个&lt;code class=&quot;language-text&quot;&gt;go&lt;/code&gt;去访问其他资源，&lt;code class=&quot;language-text&quot;&gt;context&lt;/code&gt;主要用于可以统一控制其他的&lt;code class=&quot;language-text&quot;&gt;go&lt;/code&gt;一起退出。
&lt;code class=&quot;language-text&quot;&gt;Context&lt;/code&gt;方法可以由多个&lt;code class=&quot;language-text&quot;&gt;go&lt;/code&gt;同时使用。&lt;/p&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;Context&lt;/code&gt;定义的接口如下，主要实现如下的几个功能。&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;go&quot;&gt;&lt;pre class=&quot;language-go&quot;&gt;&lt;code class=&quot;language-go&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;type&lt;/span&gt; Context &lt;span class=&quot;token keyword&quot;&gt;interface&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token comment&quot;&gt;//子go用于监听父go是否发起结束当前go的消息&lt;/span&gt;
    &lt;span class=&quot;token function&quot;&gt;Done&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;&amp;lt;-&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;chan&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;struct&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;token comment&quot;&gt;// 返回关闭的原因&lt;/span&gt;
    &lt;span class=&quot;token function&quot;&gt;Err&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token builtin&quot;&gt;error&lt;/span&gt;
    &lt;span class=&quot;token comment&quot;&gt;//返回到期时间，比如设置了5s取消，那返回的值就是5s后的时间，ok is true if your setting deadling&lt;/span&gt;
    &lt;span class=&quot;token function&quot;&gt;Deadline&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;deadline time&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;Time&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; ok &lt;span class=&quot;token builtin&quot;&gt;bool&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;token comment&quot;&gt;//从context中取出key的值&lt;/span&gt;
    &lt;span class=&quot;token function&quot;&gt;Value&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;key &lt;span class=&quot;token keyword&quot;&gt;interface&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;interface&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;使用方法主要由如下：&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;go&quot;&gt;&lt;pre class=&quot;language-go&quot;&gt;&lt;code class=&quot;language-go&quot;&gt;# 设置超时返回，并返回一个新的context
&lt;span class=&quot;token keyword&quot;&gt;func&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;WithTimeout&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;parent Context&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; timeout time&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;Duration&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;Context&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; CancelFunc&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
# 没有超时时间，只是用于通知子&lt;span class=&quot;token keyword&quot;&gt;go&lt;/span&gt;执行关闭
&lt;span class=&quot;token keyword&quot;&gt;func&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;WithCancel&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;parent Context&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;ctx Context&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; cancel CancelFunc&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
# 设置一个值到context中，并返回一个新的ctx
&lt;span class=&quot;token keyword&quot;&gt;func&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;WithValue&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;parent Context&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; key&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; val &lt;span class=&quot;token keyword&quot;&gt;interface&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; Context&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;主要使用的一个&lt;code class=&quot;language-text&quot;&gt;Http&lt;/code&gt;请求中，用来控制子&lt;code class=&quot;language-text&quot;&gt;go&lt;/code&gt;。如下的代码是模拟在一个&lt;code class=&quot;language-text&quot;&gt;demo&lt;/code&gt;的&lt;code class=&quot;language-text&quot;&gt;controller&lt;/code&gt;中，去并发的请求其他资源，比如数据库资源，还有&lt;code class=&quot;language-text&quot;&gt;gRpc&lt;/code&gt;调用等，这些操作都是用子&lt;code class=&quot;language-text&quot;&gt;go&lt;/code&gt;去调用的。&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;go&quot;&gt;&lt;pre class=&quot;language-go&quot;&gt;&lt;code class=&quot;language-go&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;func&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;main&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;

	http&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;HandleFunc&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;/demo&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;demo&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
	http&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;ListenAndServe&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;:8888&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;token boolean&quot;&gt;nil&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;func&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;demo&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;w http&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;ResponseWriter&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;r &lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt;http&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;Request&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;  &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
	timeout&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; err &lt;span class=&quot;token operator&quot;&gt;:=&lt;/span&gt; time&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;ParseDuration&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;r&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;FormValue&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;timeout&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
	&lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; err &lt;span class=&quot;token operator&quot;&gt;!=&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;nil&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
		http&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Error&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;w&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; err&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Error&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; http&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;StatusInternalServerError&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
		&lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt;
	&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
	&lt;span class=&quot;token keyword&quot;&gt;var&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;
		ctx context&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;Context
		cancel context&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;CancelFunc
	&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
	&lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; err &lt;span class=&quot;token operator&quot;&gt;!=&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;nil&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
		ctx&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; cancel &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; context&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;WithTimeout&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;r&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Context&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; timeout&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
	&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
		ctx&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;cancel &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; context&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;WithCancel&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;r&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Context&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
	&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

	&lt;span class=&quot;token keyword&quot;&gt;defer&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;cancel&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
	database &lt;span class=&quot;token operator&quot;&gt;:=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;getDatabaseData&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;ctx&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
	age&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;ct &lt;span class=&quot;token operator&quot;&gt;:=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;gRpcServer&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;ctx&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
	&lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; deadline&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; ok &lt;span class=&quot;token operator&quot;&gt;:=&lt;/span&gt; ctx&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Deadline&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; ok &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
		fmt&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Println&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;deadline&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;String&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
		fmt&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Println&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;time&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Now&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;String&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
	&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
	&lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; err &lt;span class=&quot;token operator&quot;&gt;:=&lt;/span&gt; ctx&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Err&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; err &lt;span class=&quot;token operator&quot;&gt;!=&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;nil&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
		fmt&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Println&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;err&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
	&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
	&lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; value &lt;span class=&quot;token operator&quot;&gt;:=&lt;/span&gt; ct&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Value&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;ageKey&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; value &lt;span class=&quot;token operator&quot;&gt;!=&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;nil&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
		fmt&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Println&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;value:&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;value&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
	&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
	fmt&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Fprint&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;w&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;fmt&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Sprintf&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;Database:%s\nAge:%d&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;database&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;age&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;


&lt;span class=&quot;token keyword&quot;&gt;func&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;getDatabaseData&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;ctx context&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;Context&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token builtin&quot;&gt;string&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
	c &lt;span class=&quot;token operator&quot;&gt;:=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;make&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;chan&lt;/span&gt; &lt;span class=&quot;token builtin&quot;&gt;string&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
	&lt;span class=&quot;token keyword&quot;&gt;go&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;func&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
		time&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Sleep&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;time&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;Second&lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
		c &lt;span class=&quot;token operator&quot;&gt;&amp;lt;-&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;database&quot;&lt;/span&gt;
	&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
	&lt;span class=&quot;token keyword&quot;&gt;select&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
	&lt;span class=&quot;token keyword&quot;&gt;case&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;&amp;lt;-&lt;/span&gt; ctx&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Done&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
		&lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;&quot;&lt;/span&gt;
	&lt;span class=&quot;token keyword&quot;&gt;case&lt;/span&gt; r &lt;span class=&quot;token operator&quot;&gt;:=&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;&amp;lt;-&lt;/span&gt; c&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
		&lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; r
	&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;func&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;gRpcServer&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;ctx context&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;Context&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token builtin&quot;&gt;int&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;context&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;Context&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
	c &lt;span class=&quot;token operator&quot;&gt;:=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;make&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;chan&lt;/span&gt; &lt;span class=&quot;token builtin&quot;&gt;int&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
	&lt;span class=&quot;token keyword&quot;&gt;go&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;func&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
		time&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Sleep&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt;time&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;Second&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
		c &lt;span class=&quot;token operator&quot;&gt;&amp;lt;-&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;24&lt;/span&gt;
	&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
	ct &lt;span class=&quot;token operator&quot;&gt;:=&lt;/span&gt; context&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;WithValue&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;ctx&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; ageKey&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; ageKey&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
	&lt;span class=&quot;token keyword&quot;&gt;select&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
	&lt;span class=&quot;token keyword&quot;&gt;case&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;&amp;lt;-&lt;/span&gt; ctx&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Done&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
		&lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;ct
	&lt;span class=&quot;token keyword&quot;&gt;case&lt;/span&gt; v &lt;span class=&quot;token operator&quot;&gt;:=&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;&amp;lt;-&lt;/span&gt; c&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
		&lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; v&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;ct
	&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;上面这两个方法有点问题，会出现&lt;code class=&quot;language-text&quot;&gt;go&lt;/code&gt;不能会回收，泄漏的情况，在这种情况下会出现：函数中启动的&lt;code class=&quot;language-text&quot;&gt;go&lt;/code&gt;还在休眠，还没有写入到&lt;code class=&quot;language-text&quot;&gt;c&lt;/code&gt;中，此时收到&lt;code class=&quot;language-text&quot;&gt;ctx.Done()&lt;/code&gt;的信号，就返回了，此时就会出现写入不了&lt;code class=&quot;language-text&quot;&gt;c&lt;/code&gt;这个&lt;code class=&quot;language-text&quot;&gt;chan&lt;/code&gt;中，于是这个&lt;code class=&quot;language-text&quot;&gt;go&lt;/code&gt;就永远不能被释放了。&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;解决办法有两种:&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;接收到关闭信号之后等待&lt;code class=&quot;language-text&quot;&gt;c&lt;/code&gt;返回&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;go&quot;&gt;&lt;pre class=&quot;language-go&quot;&gt;&lt;code class=&quot;language-go&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;func&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;getDatabaseData&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;ctx context&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;Context&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token builtin&quot;&gt;string&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
	c &lt;span class=&quot;token operator&quot;&gt;:=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;make&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;chan&lt;/span&gt; &lt;span class=&quot;token builtin&quot;&gt;string&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
	&lt;span class=&quot;token keyword&quot;&gt;go&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;func&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
		time&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Sleep&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;time&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;Second&lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
		c &lt;span class=&quot;token operator&quot;&gt;&amp;lt;-&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;database&quot;&lt;/span&gt;
	&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
	&lt;span class=&quot;token keyword&quot;&gt;select&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
	&lt;span class=&quot;token keyword&quot;&gt;case&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;&amp;lt;-&lt;/span&gt; ctx&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Done&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
	    &lt;span class=&quot;token operator&quot;&gt;&amp;lt;-&lt;/span&gt; c &lt;span class=&quot;token comment&quot;&gt;//在此等待c返回，但是这样就会阻塞http请求，就会出现变成同步操作。&lt;/span&gt;
		&lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;&quot;&lt;/span&gt;
	&lt;span class=&quot;token keyword&quot;&gt;case&lt;/span&gt; r &lt;span class=&quot;token operator&quot;&gt;:=&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;&amp;lt;-&lt;/span&gt; c&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
		&lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; r
	&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
# 下一个方法同上&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;ul&gt;
&lt;li&gt;还有一种就是关闭这个&lt;code class=&quot;language-text&quot;&gt;chan&lt;/code&gt;，这种既可以快速返回，也不会出现&lt;code class=&quot;language-text&quot;&gt;go&lt;/code&gt;不能释放&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;go&quot;&gt;&lt;pre class=&quot;language-go&quot;&gt;&lt;code class=&quot;language-go&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;func&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;getDatabaseData&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;ctx context&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;Context&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token builtin&quot;&gt;string&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
	c &lt;span class=&quot;token operator&quot;&gt;:=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;make&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;chan&lt;/span&gt; &lt;span class=&quot;token builtin&quot;&gt;string&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
	&lt;span class=&quot;token keyword&quot;&gt;go&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;func&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
	    &lt;span class=&quot;token comment&quot;&gt;// 如果加入关闭通道的操作，那就一定要加捕获panic的操作，不然会导致程序推出。因为发送到一个关闭的chan中会出现panic&lt;/span&gt;
	    &lt;span class=&quot;token keyword&quot;&gt;defer&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;func&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
			&lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; err &lt;span class=&quot;token operator&quot;&gt;:=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;recover&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; err &lt;span class=&quot;token operator&quot;&gt;!=&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;nil&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;

			&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
		&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
		time&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Sleep&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;time&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;Second&lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
		c &lt;span class=&quot;token operator&quot;&gt;&amp;lt;-&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;database&quot;&lt;/span&gt;
	&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
	&lt;span class=&quot;token keyword&quot;&gt;select&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
	&lt;span class=&quot;token keyword&quot;&gt;case&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;&amp;lt;-&lt;/span&gt; ctx&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Done&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
	    &lt;span class=&quot;token function&quot;&gt;close&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;c&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
		&lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;&quot;&lt;/span&gt;
	&lt;span class=&quot;token keyword&quot;&gt;case&lt;/span&gt; r &lt;span class=&quot;token operator&quot;&gt;:=&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;&amp;lt;-&lt;/span&gt; c&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
		&lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; r
	&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2&gt;涉及到的算法&lt;/h2&gt;
&lt;h3&gt;CAS 算法&lt;/h3&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;CAS&lt;/code&gt;算法又叫无锁算法，全称是&lt;code class=&quot;language-text&quot;&gt;(Compare-and-swap)&lt;/code&gt;比较交换算法。&lt;code class=&quot;language-text&quot;&gt;CAS&lt;/code&gt;算法是原子操作，是并发安全的。&lt;/p&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;CAS&lt;/code&gt;算法有三个操作数,第一个是内存值V，第二个是旧预期值A，第三个是新值B；当且仅当预期值A和内存值V相同时，将内存值V修改为B，否则什么都不做。&lt;/p&gt;
&lt;h3&gt;信号量算法&lt;/h3&gt;
&lt;p&gt;信号量是&lt;code class=&quot;language-text&quot;&gt;Unix&lt;/code&gt;系统提供的一种保护共享资源的机制，用于防止多个线程同时访问某个资源。&lt;/p&gt;
&lt;p&gt;可简单理解为信号量为一个数值：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;当信号量&gt;0时，表示资源可用，获取信号量时系统自动将信号量减1；&lt;/li&gt;
&lt;li&gt;当信号量==0时，表示资源暂不可用，获取信号量时，当前线程会进入睡眠，当信号量为正时被唤醒；&lt;/li&gt;
&lt;li&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h2&gt;参考&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https://golang.org/pkg/sync/&quot;&gt;https://golang.org/pkg/sync/&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://colobu.com/2019/04/28/gopher-2019-concurrent-in-action/#Cond&quot;&gt;https://colobu.com/2019/04/28/gopher-2019-concurrent-in-action/#Cond&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://blog.golang.org/context&quot;&gt;Go Concurrency Patterns: Context&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;</content:encoded></item><item><title><![CDATA[Go 并发编程测试分析]]></title><description><![CDATA[Go 并发编程测试分析 本文是对晁岳攀老师博客中提到的并发测试例子的讲解。 我按问题类型来分类说明错误原因。 所以P中没有可以调度的G时就会出现死锁 这个问题涉及到的题目为:，. 1、Mutex…]]></description><link>https://lengrongfu.github.io/2019-06-14-Go并发编程测试分解/</link><guid isPermaLink="false">https://lengrongfu.github.io/2019-06-14-Go并发编程测试分解/</guid><pubDate>Fri, 14 Jun 2019 20:09:47 GMT</pubDate><content:encoded>&lt;h1&gt;Go 并发编程测试分析&lt;/h1&gt;
&lt;p&gt;本文是对&lt;code class=&quot;language-text&quot;&gt;https://colobu.com/2019/04/28/go-concurrency-quizzes/&lt;/code&gt;晁岳攀老师博客中提到的并发测试例子的讲解。&lt;/p&gt;
&lt;p&gt;我按问题类型来分类说明错误原因。&lt;/p&gt;
&lt;h2&gt;所以P中没有可以调度的G时就会出现死锁&lt;/h2&gt;
&lt;p&gt;这个问题涉及到的题目为:&lt;code class=&quot;language-text&quot;&gt;1、Mutex&lt;/code&gt;，&lt;code class=&quot;language-text&quot;&gt;2、RWMutex&lt;/code&gt;.&lt;/p&gt;
&lt;h3&gt;1、Mutex&lt;/h3&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;go&quot;&gt;&lt;pre class=&quot;language-go&quot;&gt;&lt;code class=&quot;language-go&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;package&lt;/span&gt; main
&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;
	&lt;span class=&quot;token string&quot;&gt;&quot;fmt&quot;&lt;/span&gt;
	&lt;span class=&quot;token string&quot;&gt;&quot;sync&quot;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;var&lt;/span&gt; mu sync&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;Mutex
&lt;span class=&quot;token keyword&quot;&gt;var&lt;/span&gt; chain &lt;span class=&quot;token builtin&quot;&gt;string&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;func&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;main&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
	chain &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;main&quot;&lt;/span&gt;
	&lt;span class=&quot;token function&quot;&gt;A&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
	fmt&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Println&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;chain&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;func&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;A&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
	mu&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Lock&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
	&lt;span class=&quot;token keyword&quot;&gt;defer&lt;/span&gt; mu&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Unlock&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
	chain &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; chain &lt;span class=&quot;token operator&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot; --&gt; A&quot;&lt;/span&gt;
	&lt;span class=&quot;token function&quot;&gt;B&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;func&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;B&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
	chain &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; chain &lt;span class=&quot;token operator&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot; --&gt; B&quot;&lt;/span&gt;
	&lt;span class=&quot;token function&quot;&gt;C&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;func&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;C&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
	mu&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Lock&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
	&lt;span class=&quot;token keyword&quot;&gt;defer&lt;/span&gt; mu&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Unlock&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
	chain &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; chain &lt;span class=&quot;token operator&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot; --&gt; C&quot;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
$ &lt;span class=&quot;token keyword&quot;&gt;go&lt;/span&gt; run main&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;go&lt;/span&gt;
fatal &lt;span class=&quot;token builtin&quot;&gt;error&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; all goroutines are asleep &lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt; deadlock&lt;span class=&quot;token operator&quot;&gt;!&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;这一题的问题是&lt;code class=&quot;language-text&quot;&gt;runtime&lt;/code&gt;中只有一个&lt;code class=&quot;language-text&quot;&gt;G&lt;/code&gt;，但是当运行到&lt;code class=&quot;language-text&quot;&gt;A()&lt;/code&gt;方法是以及加锁，后面的&lt;code class=&quot;language-text&quot;&gt;C()&lt;/code&gt;方法接着去加锁，就会出现拿不到锁，于是这个&lt;code class=&quot;language-text&quot;&gt;G&lt;/code&gt;的状态就变为不可运行，所以就出现了&lt;code class=&quot;language-text&quot;&gt;deadlock!&lt;/code&gt;.&lt;/p&gt;
&lt;h3&gt;2、RWMutex&lt;/h3&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;go&quot;&gt;&lt;pre class=&quot;language-go&quot;&gt;&lt;code class=&quot;language-go&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;package&lt;/span&gt; main
&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;
	&lt;span class=&quot;token string&quot;&gt;&quot;fmt&quot;&lt;/span&gt;
	&lt;span class=&quot;token string&quot;&gt;&quot;sync&quot;&lt;/span&gt;
	&lt;span class=&quot;token string&quot;&gt;&quot;time&quot;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;var&lt;/span&gt; mu sync&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;RWMutex
&lt;span class=&quot;token keyword&quot;&gt;var&lt;/span&gt; count &lt;span class=&quot;token builtin&quot;&gt;int&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;func&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;main&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
	&lt;span class=&quot;token keyword&quot;&gt;go&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;A&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
	time&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Sleep&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;2&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt; time&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;Second&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
	mu&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Lock&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
	&lt;span class=&quot;token keyword&quot;&gt;defer&lt;/span&gt; mu&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Unlock&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
	count&lt;span class=&quot;token operator&quot;&gt;++&lt;/span&gt;
	fmt&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Println&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;count&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;func&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;A&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
	mu&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;RLock&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
	&lt;span class=&quot;token keyword&quot;&gt;defer&lt;/span&gt; mu&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;RUnlock&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
	&lt;span class=&quot;token function&quot;&gt;B&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;func&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;B&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
	time&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Sleep&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;5&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt; time&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;Second&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
	&lt;span class=&quot;token function&quot;&gt;C&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;func&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;C&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
	mu&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;RLock&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
	&lt;span class=&quot;token keyword&quot;&gt;defer&lt;/span&gt; mu&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;RUnlock&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
$ &lt;span class=&quot;token keyword&quot;&gt;go&lt;/span&gt; run main&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;go&lt;/span&gt;
fatal &lt;span class=&quot;token builtin&quot;&gt;error&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; all goroutines are asleep &lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt; deadlock&lt;span class=&quot;token operator&quot;&gt;!&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;这一题的原因也是一样的，&lt;code class=&quot;language-text&quot;&gt;G&lt;/code&gt;A休眠之后状态就会变为等待，此时,主&lt;code class=&quot;language-text&quot;&gt;G&lt;/code&gt;去那锁也没有那到，就会变为不可运行状态，并让出&lt;code class=&quot;language-text&quot;&gt;cpu&lt;/code&gt;,此时所有的&lt;code class=&quot;language-text&quot;&gt;G&lt;/code&gt;都不可运行就出现死锁了。&lt;/p&gt;
&lt;h2&gt;WaitGroup 使用问题&lt;/h2&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;go&quot;&gt;&lt;pre class=&quot;language-go&quot;&gt;&lt;code class=&quot;language-go&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;package&lt;/span&gt; main
&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;
	&lt;span class=&quot;token string&quot;&gt;&quot;sync&quot;&lt;/span&gt;
	&lt;span class=&quot;token string&quot;&gt;&quot;time&quot;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;func&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;main&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
	&lt;span class=&quot;token keyword&quot;&gt;var&lt;/span&gt; wg sync&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;WaitGroup
	wg&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Add&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
	&lt;span class=&quot;token keyword&quot;&gt;go&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;func&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
		time&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Sleep&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;time&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;Millisecond&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
		wg&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Done&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
		wg&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Add&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
	&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
	wg&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Wait&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
$ &lt;span class=&quot;token keyword&quot;&gt;go&lt;/span&gt; run main&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;go&lt;/span&gt;
&lt;span class=&quot;token builtin&quot;&gt;panic&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; sync&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; WaitGroup is reused before previous Wait has returned&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;原因是多调用了一个&lt;code class=&quot;language-text&quot;&gt;wg.Add(1)&lt;/code&gt;。&lt;/p&gt;
&lt;h2&gt;4、双检查实现单例&lt;/h2&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;go&quot;&gt;&lt;pre class=&quot;language-go&quot;&gt;&lt;code class=&quot;language-go&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;package&lt;/span&gt; doublecheck
&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;
	&lt;span class=&quot;token string&quot;&gt;&quot;sync&quot;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;type&lt;/span&gt; Once &lt;span class=&quot;token keyword&quot;&gt;struct&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
	m    sync&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;Mutex
	done &lt;span class=&quot;token builtin&quot;&gt;uint32&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;func&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;o &lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt;Once&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;Do&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;f &lt;span class=&quot;token keyword&quot;&gt;func&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
	&lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; o&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;done &lt;span class=&quot;token operator&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
		&lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt;
	&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
	o&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;m&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Lock&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
	&lt;span class=&quot;token keyword&quot;&gt;defer&lt;/span&gt; o&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;m&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Unlock&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
	&lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; o&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;done &lt;span class=&quot;token operator&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
		o&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;done &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;
		&lt;span class=&quot;token function&quot;&gt;f&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
	&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;这一题争议最大，博主是想告诉我们类似于&lt;code class=&quot;language-text&quot;&gt;Java&lt;/code&gt;里面缓存变量的问题，我觉得这里是不会出现问题的，因为对象是指针调用；运行本身没有问题，但是会出现数据竞争。使用&lt;code class=&quot;language-text&quot;&gt;go run -race main.go&lt;/code&gt;运行就会发现有数据竞争。&lt;/p&gt;
&lt;h2&gt;5、同步对象使用后不能被拷贝&lt;/h2&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;go&quot;&gt;&lt;pre class=&quot;language-go&quot;&gt;&lt;code class=&quot;language-go&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;package&lt;/span&gt; main
&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;
	&lt;span class=&quot;token string&quot;&gt;&quot;fmt&quot;&lt;/span&gt;
	&lt;span class=&quot;token string&quot;&gt;&quot;sync&quot;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;type&lt;/span&gt; MyMutex &lt;span class=&quot;token keyword&quot;&gt;struct&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
	count &lt;span class=&quot;token builtin&quot;&gt;int&lt;/span&gt;
	sync&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;Mutex
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;func&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;main&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
	&lt;span class=&quot;token keyword&quot;&gt;var&lt;/span&gt; mu MyMutex
	mu&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Lock&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
	&lt;span class=&quot;token keyword&quot;&gt;var&lt;/span&gt; mu2 &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; mu
	mu&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;count&lt;span class=&quot;token operator&quot;&gt;++&lt;/span&gt;
	mu&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Unlock&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
	mu2&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Lock&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
	mu2&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;count&lt;span class=&quot;token operator&quot;&gt;++&lt;/span&gt;
	mu2&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Unlock&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
	fmt&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Println&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;mu&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;count&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; mu2&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;count&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
$ &lt;span class=&quot;token keyword&quot;&gt;go&lt;/span&gt; run main&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;go&lt;/span&gt;
fatal &lt;span class=&quot;token builtin&quot;&gt;error&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; all goroutines are asleep &lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt; deadlock&lt;span class=&quot;token operator&quot;&gt;!&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;这个原因就是同步对象使用过之后不能再被拷贝，如果上面把&lt;code class=&quot;language-text&quot;&gt;mu.Lock()&lt;/code&gt;和&lt;code class=&quot;language-text&quot;&gt;var mu2 = mu&lt;/code&gt;这两行进行交换一下就可以了。
使用过后不可以复制的对象有：&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;go&quot;&gt;&lt;pre class=&quot;language-go&quot;&gt;&lt;code class=&quot;language-go&quot;&gt;
&lt;span class=&quot;token comment&quot;&gt;// A Cond must not be copied after first use.&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;type&lt;/span&gt; Cond &lt;span class=&quot;token keyword&quot;&gt;struct&lt;/span&gt; 
&lt;span class=&quot;token comment&quot;&gt;// A Map must not be copied after first use.&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;type&lt;/span&gt; Map &lt;span class=&quot;token keyword&quot;&gt;struct&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;// A Mutex must not be copied after first use.&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;type&lt;/span&gt; Mutex &lt;span class=&quot;token keyword&quot;&gt;struct&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;// A Pool must not be copied after first use.&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;type&lt;/span&gt; Pool &lt;span class=&quot;token keyword&quot;&gt;struct&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;// A RWMutex must not be copied after first use.&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;type&lt;/span&gt; RWMutex &lt;span class=&quot;token keyword&quot;&gt;struct&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;// A WaitGroup must not be copied after first use.&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;type&lt;/span&gt; WaitGroup &lt;span class=&quot;token keyword&quot;&gt;struct&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;sync&lt;/code&gt;包下的&lt;code class=&quot;language-text&quot;&gt;struct&lt;/code&gt;除了&lt;code class=&quot;language-text&quot;&gt;Once&lt;/code&gt;这个结构体其他的使用过后都不能被复制。不能被复制也包括函数传递参数，比如如下的使用是错误的:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;go&quot;&gt;&lt;pre class=&quot;language-go&quot;&gt;&lt;code class=&quot;language-go&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;func&lt;/span&gt; main&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;var&lt;/span&gt; wa sync&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;WaitGroup
    &lt;span class=&quot;token keyword&quot;&gt;for&lt;/span&gt; i&lt;span class=&quot;token operator&quot;&gt;:=&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;i &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;10&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;i&lt;span class=&quot;token operator&quot;&gt;++&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        wa&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Add&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;go&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;func&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;wa sync&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;WaitGroup&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
            fmt&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Println&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;wa.Down()&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
            wa&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Down&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;wa&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
    wa&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Wait&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;上面的代码就有问题，首先&lt;code class=&quot;language-text&quot;&gt;wa&lt;/code&gt;对象以及使用了&lt;code class=&quot;language-text&quot;&gt;wa.Add(1)&lt;/code&gt;,后面开启一个&lt;code class=&quot;language-text&quot;&gt;go&lt;/code&gt;时确做参数传入，此时传入的是一个副本，就会出现不能正确的执行&lt;code class=&quot;language-text&quot;&gt;wa.Down()&lt;/code&gt;；此处可以修改为传递指针&lt;code class=&quot;language-text&quot;&gt;go func(wa *sync.WaitGroup)&lt;/code&gt;或者使用闭包的方式使用&lt;code class=&quot;language-text&quot;&gt;WaitGroup&lt;/code&gt;对象。&lt;/p&gt;
&lt;h2&gt;7、channel&lt;/h2&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;go&quot;&gt;&lt;pre class=&quot;language-go&quot;&gt;&lt;code class=&quot;language-go&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;package&lt;/span&gt; main
&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;
	&lt;span class=&quot;token string&quot;&gt;&quot;fmt&quot;&lt;/span&gt;
	&lt;span class=&quot;token string&quot;&gt;&quot;runtime&quot;&lt;/span&gt;
	&lt;span class=&quot;token string&quot;&gt;&quot;time&quot;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;func&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;main&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
	&lt;span class=&quot;token keyword&quot;&gt;var&lt;/span&gt; ch &lt;span class=&quot;token keyword&quot;&gt;chan&lt;/span&gt; &lt;span class=&quot;token builtin&quot;&gt;int&lt;/span&gt;
	&lt;span class=&quot;token keyword&quot;&gt;go&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;func&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
		ch &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;make&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;chan&lt;/span&gt; &lt;span class=&quot;token builtin&quot;&gt;int&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
		ch &lt;span class=&quot;token operator&quot;&gt;&amp;lt;-&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;
	&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
	&lt;span class=&quot;token keyword&quot;&gt;go&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;func&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;ch &lt;span class=&quot;token keyword&quot;&gt;chan&lt;/span&gt; &lt;span class=&quot;token builtin&quot;&gt;int&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
		time&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Sleep&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;time&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;Second&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
		&lt;span class=&quot;token operator&quot;&gt;&amp;lt;-&lt;/span&gt;ch
	&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;ch&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
	c &lt;span class=&quot;token operator&quot;&gt;:=&lt;/span&gt; time&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Tick&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt; time&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;Second&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
	&lt;span class=&quot;token keyword&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;range&lt;/span&gt; c &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
		fmt&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Printf&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;#goroutines: %d\n&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; runtime&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;NumGoroutine&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
	&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
$ &lt;span class=&quot;token keyword&quot;&gt;go&lt;/span&gt; run main&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;go&lt;/span&gt;
#goroutines&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;2&lt;/span&gt;
#goroutines&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;2&lt;/span&gt;
#goroutines&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;2&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;这一题比较简单，但是我还是忽略了一个关键点，最后运行中有两个&lt;code class=&quot;language-text&quot;&gt;g&lt;/code&gt;，原因就是&lt;code class=&quot;language-text&quot;&gt;time.Tick&lt;/code&gt;其实是开启了一个&lt;code class=&quot;language-text&quot;&gt;G&lt;/code&gt;来计时的，然后通过&lt;code class=&quot;language-text&quot;&gt;Channel&lt;/code&gt;来通知。&lt;/p&gt;
&lt;p&gt;我们来看一下&lt;code class=&quot;language-text&quot;&gt;time.Tick&lt;/code&gt;里面的实现:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;go&quot;&gt;&lt;pre class=&quot;language-go&quot;&gt;&lt;code class=&quot;language-go&quot;&gt;time 包
&lt;span class=&quot;token keyword&quot;&gt;func&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;NewTicker&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;d Duration&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt;Ticker&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token operator&quot;&gt;...&lt;/span&gt;
    &lt;span class=&quot;token function&quot;&gt;startTimer&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&amp;amp;&lt;/span&gt;t&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;r&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token comment&quot;&gt;// 这个方法对应到runtime.startTimer()方法上&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
runtime 包 
&lt;span class=&quot;token comment&quot;&gt;// startTimer adds t to the timer heap.&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;//go:linkname startTimer time.startTimer&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;func&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;startTimer&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;t &lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt;timer&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
	&lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; raceenabled &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
		&lt;span class=&quot;token function&quot;&gt;racerelease&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;unsafe&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Pointer&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;t&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
	&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
	&lt;span class=&quot;token function&quot;&gt;addtimer&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;t&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;//在addtimer()方法中启动了一个`G`。&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2&gt;13、for range 问题&lt;/h2&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;go&quot;&gt;&lt;pre class=&quot;language-go&quot;&gt;&lt;code class=&quot;language-go&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;package&lt;/span&gt; main
&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;
	&lt;span class=&quot;token string&quot;&gt;&quot;fmt&quot;&lt;/span&gt;
	&lt;span class=&quot;token string&quot;&gt;&quot;sync&quot;&lt;/span&gt;
	&lt;span class=&quot;token string&quot;&gt;&quot;time&quot;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;type&lt;/span&gt; T &lt;span class=&quot;token keyword&quot;&gt;struct&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
	V &lt;span class=&quot;token builtin&quot;&gt;int&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;func&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;t &lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt;T&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;Incr&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;wg &lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt;sync&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;WaitGroup&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
	t&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;V&lt;span class=&quot;token operator&quot;&gt;++&lt;/span&gt;
	wg&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Done&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;func&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;t &lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt;T&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;Print&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
	time&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Sleep&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1e9&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
	fmt&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Print&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;t&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;V&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;func&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;main&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
	&lt;span class=&quot;token keyword&quot;&gt;var&lt;/span&gt; wg sync&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;WaitGroup
	wg&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Add&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;10&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
	&lt;span class=&quot;token keyword&quot;&gt;var&lt;/span&gt; ts &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;make&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;T&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;10&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
	&lt;span class=&quot;token keyword&quot;&gt;for&lt;/span&gt; i &lt;span class=&quot;token operator&quot;&gt;:=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; i &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;10&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; i&lt;span class=&quot;token operator&quot;&gt;++&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
		ts&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;i&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; T&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;i&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
	&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
	&lt;span class=&quot;token keyword&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;_&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; t &lt;span class=&quot;token operator&quot;&gt;:=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;range&lt;/span&gt; ts &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
		&lt;span class=&quot;token keyword&quot;&gt;go&lt;/span&gt; t&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Incr&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&amp;amp;&lt;/span&gt;wg&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
	&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
	wg&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Wait&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
	&lt;span class=&quot;token keyword&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;_&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; t &lt;span class=&quot;token operator&quot;&gt;:=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;range&lt;/span&gt; ts &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
		&lt;span class=&quot;token keyword&quot;&gt;go&lt;/span&gt; t&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Print&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
	&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
	time&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Sleep&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;5&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt; time&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;Second&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
$ &lt;span class=&quot;token keyword&quot;&gt;go&lt;/span&gt; run main&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;go&lt;/span&gt;
&lt;span class=&quot;token number&quot;&gt;999999999&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;这一题可以是因为使用了&lt;code class=&quot;language-text&quot;&gt;for range&lt;/code&gt;的方式，这种方式中的&lt;code class=&quot;language-text&quot;&gt;t&lt;/code&gt;只是一个变量，会一直在边，当使用&lt;code class=&quot;language-text&quot;&gt;go t.Incr()&lt;/code&gt;的时候，此时的&lt;code class=&quot;language-text&quot;&gt;t&lt;/code&gt;已经变为了最后一个值，所以输出都是&lt;code class=&quot;language-text&quot;&gt;9&lt;/code&gt;，这个在使用&lt;code class=&quot;language-text&quot;&gt;map&lt;/code&gt;时也有这个问题，得到 的&lt;code class=&quot;language-text&quot;&gt;k/v&lt;/code&gt;只是值的一个拷贝。&lt;/p&gt;</content:encoded></item><item><title><![CDATA[Go Bootstrap Process]]></title><description><![CDATA[Go Bootstrap Process 一、环境准备 1、 Go版本 2、准备代码…]]></description><link>https://lengrongfu.github.io/2019-06-10-Go-bootstrap-process/</link><guid isPermaLink="false">https://lengrongfu.github.io/2019-06-10-Go-bootstrap-process/</guid><pubDate>Mon, 10 Jun 2019 18:26:18 GMT</pubDate><content:encoded>&lt;h1&gt;Go Bootstrap Process&lt;/h1&gt;
&lt;h2&gt;一、环境准备&lt;/h2&gt;
&lt;p&gt;1、 Go版本&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;$ go version
go version go1.12.4 darwin/amd64&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;2、准备代码&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;go&quot;&gt;&lt;pre class=&quot;language-go&quot;&gt;&lt;code class=&quot;language-go&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;package&lt;/span&gt; main
&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;
	&lt;span class=&quot;token string&quot;&gt;&quot;fmt&quot;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;func&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;main&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
	fmt&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Println&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;hello world&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;3、调试工具&lt;/p&gt;
&lt;p&gt;调试工具我使用的是&lt;code class=&quot;language-text&quot;&gt;dlv&lt;/code&gt;，对&lt;code class=&quot;language-text&quot;&gt;golang&lt;/code&gt;支持最好的调试工具，比&lt;code class=&quot;language-text&quot;&gt;gdb&lt;/code&gt;都好，先按官方文档安装上。编译上述代码&lt;code class=&quot;language-text&quot;&gt;go build main.go&lt;/code&gt;,得到一个可执行文件，执行&lt;code class=&quot;language-text&quot;&gt;dlv exec ./main&lt;/code&gt;就进入了调试空间。&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;shell&quot;&gt;&lt;pre class=&quot;language-shell&quot;&gt;&lt;code class=&quot;language-shell&quot;&gt;$ dlv &lt;span class=&quot;token builtin class-name&quot;&gt;exec&lt;/span&gt; main
Type &lt;span class=&quot;token string&quot;&gt;&apos;help&apos;&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;for&lt;/span&gt; list of commands.
&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;dlv&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;输入&lt;code class=&quot;language-text&quot;&gt;help&lt;/code&gt;就可以看到帮助文档，打断点以及执行下一步都是通过命令进行的，不知道就可以随时进行查看。执行上述的命令之后，程序还没有真正的启动。&lt;/p&gt;
&lt;p&gt;4、&lt;code class=&quot;language-text&quot;&gt;dlv&lt;/code&gt;常用的命令
更具体的命令使用参考官方文档。&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;shell&quot;&gt;&lt;pre class=&quot;language-shell&quot;&gt;&lt;code class=&quot;language-shell&quot;&gt;args ：函数的参数
&lt;span class=&quot;token builtin class-name&quot;&gt;break&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;alias: b&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; ：打一个断点
breakpoints &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;alias: bp&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; ：打印已经添加的断点信息。
&lt;span class=&quot;token function&quot;&gt;clear&lt;/span&gt; ： 通过断点编号删除断点
&lt;span class=&quot;token builtin class-name&quot;&gt;continue&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;alias: c&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; ：运行到有断点的地方
locals ：打印本地变量
next &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;alias: n&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; ：运行到下一行
print &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;alias: p&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; ：可以指定变量进行打印查看，特别对于引用类型变量最有用。
regs ：打印当前cpu寄存器的值。
restart &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;alias: r&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; ：重启进程,重新开始调试.
stack &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;alias: bt&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; ：打印堆栈信息
step &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;alias: s&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; ：单步执行，会进入函数内部
step-instruction &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;alias: si&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;  &lt;span class=&quot;token builtin class-name&quot;&gt;:&lt;/span&gt; cpu的单个指令执行
thread &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;alias: &lt;span class=&quot;token function&quot;&gt;tr&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; ：可以切换到指定的线程
threads ：打印所有线程的信息
goroutine ：显示或者切换当前的go
goroutines &lt;span class=&quot;token builtin class-name&quot;&gt;:&lt;/span&gt; 列出程序的所有go&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2&gt;二、进入调试&lt;/h2&gt;
&lt;h3&gt;1、打断点&lt;/h3&gt;
&lt;p&gt;第一步先打断点，对于第一次才开始调试的人来说，最简单的就是打&lt;code class=&quot;language-text&quot;&gt;main&lt;/code&gt;函数的断点了.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;shell&quot;&gt;&lt;pre class=&quot;language-shell&quot;&gt;&lt;code class=&quot;language-shell&quot;&gt;$ &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;dlv&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; b main.main
Breakpoint &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt; &lt;span class=&quot;token builtin class-name&quot;&gt;set&lt;/span&gt; at 0x1093038 &lt;span class=&quot;token keyword&quot;&gt;for&lt;/span&gt; main.main&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; ./main.go:27
&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;dlv&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; bp
Breakpoint &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt; at 0x1093038 &lt;span class=&quot;token keyword&quot;&gt;for&lt;/span&gt; main.main&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; ./main.go:27 &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h3&gt;2、运行到断点出&lt;/h3&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;b&lt;/code&gt;、&lt;code class=&quot;language-text&quot;&gt;bp&lt;/code&gt;是缩写，对应为打断点和打印所有的断点信息。打了断点之后就可以执行&lt;code class=&quot;language-text&quot;&gt;c&lt;/code&gt;这个命令了。&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;shell&quot;&gt;&lt;pre class=&quot;language-shell&quot;&gt;&lt;code class=&quot;language-shell&quot;&gt;$ &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;dlv&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token builtin class-name&quot;&gt;continue&lt;/span&gt;
&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; main.main&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; ./main.go:27 &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;hits goroutine&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;:1 total:1&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;PC: 0x1093038&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;  &lt;span class=&quot;token number&quot;&gt;27&lt;/span&gt;:	func &lt;span class=&quot;token function-name function&quot;&gt;main&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h3&gt;3、打印堆栈信息&lt;/h3&gt;
&lt;p&gt;执行过后就会出现源代码，并且断点指向了&lt;code class=&quot;language-text&quot;&gt;main&lt;/code&gt;函数上,此时我们通过&lt;code class=&quot;language-text&quot;&gt;stack&lt;/code&gt;命令就可以看到这个&lt;code class=&quot;language-text&quot;&gt;main&lt;/code&gt;函数所在的&lt;code class=&quot;language-text&quot;&gt;goroutine&lt;/code&gt;栈了。&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;shell&quot;&gt;&lt;pre class=&quot;language-shell&quot;&gt;&lt;code class=&quot;language-shell&quot;&gt;$ &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;dlv&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; stack
&lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;  0x0000000001093038 &lt;span class=&quot;token keyword&quot;&gt;in&lt;/span&gt; main.main
   at ./main.go:27
&lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;  0x00000000010297ec &lt;span class=&quot;token keyword&quot;&gt;in&lt;/span&gt; runtime.main
   at ./golang_work/go/src/runtime/proc.go:200
&lt;span class=&quot;token number&quot;&gt;2&lt;/span&gt;  0x0000000001051011 &lt;span class=&quot;token keyword&quot;&gt;in&lt;/span&gt; runtime.goexit
   at ./golang_work/go/src/runtime/asm_amd64.s:1337&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;如上就是显示了一个&lt;code class=&quot;language-text&quot;&gt;goroutine&lt;/code&gt;的堆栈，堆栈中的信息就保证了调用过程，所以我们就可以去分析&lt;code class=&quot;language-text&quot;&gt;go&lt;/code&gt;启动过程了。
我们要从栈底往上看，所以我们首先去分析一下&lt;code class=&quot;language-text&quot;&gt;asm_amd64.s&lt;/code&gt;这个汇编代码。现在是逆向分析调用栈，后续的分析就是正向的过程。&lt;/p&gt;
&lt;h2&gt;三、分析启动过程&lt;/h2&gt;
&lt;h3&gt;1、分析asm_amd64.s这个文件&lt;/h3&gt;
&lt;p&gt;这里面的内容很多，我们不能全部看完，只能找一下重点，开始的两个函数都指向了&lt;code class=&quot;language-text&quot;&gt;JMP	runtime·rt0_go(SB)&lt;/code&gt;这条汇编代码，我们就去查看&lt;code class=&quot;language-text&quot;&gt;rt0_go&lt;/code&gt;这个函数。&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;go&quot;&gt;&lt;pre class=&quot;language-go&quot;&gt;&lt;code class=&quot;language-go&quot;&gt;runtime&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;asm_amd64&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;s 
TEXT runtime·&lt;span class=&quot;token function&quot;&gt;rt0_go&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;SB&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;NOSPLIT&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;$&lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;
	CALL	runtime·&lt;span class=&quot;token function&quot;&gt;args&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;SB&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
	CALL	runtime·&lt;span class=&quot;token function&quot;&gt;osinit&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;SB&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
	CALL	runtime·&lt;span class=&quot;token function&quot;&gt;schedinit&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;SB&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
	CALL	runtime·&lt;span class=&quot;token function&quot;&gt;newproc&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;SB&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
	CALL	runtime·&lt;span class=&quot;token function&quot;&gt;mstart&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;SB&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
	CALL	runtime·&lt;span class=&quot;token function&quot;&gt;abort&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;SB&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;	&lt;span class=&quot;token comment&quot;&gt;// mstart should &lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;文件中的大部分内容都去掉了，我只留下了&lt;code class=&quot;language-text&quot;&gt;CALL&lt;/code&gt; 指令的部分，&lt;code class=&quot;language-text&quot;&gt;call&lt;/code&gt;调用的就是&lt;code class=&quot;language-text&quot;&gt;runtime&lt;/code&gt;包中的源代码，所以我们通过方法名就可以进行搜索了，并且是在可以运行之后的部分，所以上面就是&lt;code class=&quot;language-text&quot;&gt;go&lt;/code&gt;进程启动的过程。下面我们边打断点边查看每个函数都做了写什么内容。&lt;/p&gt;
&lt;p&gt;按顺序总结下runtime.rt0_go里几件重要的事：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;检查运行平台的CPU，设置好程序运行需要相关标志。&lt;/li&gt;
&lt;li&gt;TLS的初始化。&lt;/li&gt;
&lt;li&gt;runtime.args、runtime.osinit、runtime.schedinit 三个方法做好程序运行需要的各种变量与调度器。&lt;/li&gt;
&lt;li&gt;runtime.newproc创建新的goroutine用于绑定用户写的main方法。&lt;/li&gt;
&lt;li&gt;runtime.mstart开始goroutine的调度。&lt;/li&gt;
&lt;/ul&gt;
&lt;h3&gt;2、按顺序打上断点&lt;/h3&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;shell&quot;&gt;&lt;pre class=&quot;language-shell&quot;&gt;&lt;code class=&quot;language-shell&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;dlv&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; b runtime.args
&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;dlv&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; b runtime.osinit
&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;dlv&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; b runtime.schedinit
&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;dlv&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; b runtime.newproc
&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;dlv&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; b runtime.mstart
&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;dlv&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; b runtime.abort

Breakpoint &lt;span class=&quot;token number&quot;&gt;2&lt;/span&gt; at 0x10360ff &lt;span class=&quot;token keyword&quot;&gt;for&lt;/span&gt; runtime.args&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; ./go/src/runtime/runtime1.go:60 &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
Breakpoint &lt;span class=&quot;token number&quot;&gt;3&lt;/span&gt; at 0x102604f &lt;span class=&quot;token keyword&quot;&gt;for&lt;/span&gt; runtime.osinit&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; ./go/src/runtime/os_darwin.go:79 &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
Breakpoint &lt;span class=&quot;token number&quot;&gt;4&lt;/span&gt; at 0x102a843 &lt;span class=&quot;token keyword&quot;&gt;for&lt;/span&gt; runtime.schedinit&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; ./go/src/runtime/proc.go:526 &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
Breakpoint &lt;span class=&quot;token number&quot;&gt;5&lt;/span&gt; at 0x1030f90 &lt;span class=&quot;token keyword&quot;&gt;for&lt;/span&gt; runtime.newproc&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; ./go/src/runtime/proc.go:3239 &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
Breakpoint &lt;span class=&quot;token number&quot;&gt;6&lt;/span&gt; at 0x102c410 &lt;span class=&quot;token keyword&quot;&gt;for&lt;/span&gt; runtime.mstart&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; ./go/src/runtime/proc.go:1153 &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
Breakpoint &lt;span class=&quot;token number&quot;&gt;7&lt;/span&gt; at 0x10509a0 &lt;span class=&quot;token keyword&quot;&gt;for&lt;/span&gt; runtime.abort&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; ./go/src/runtime/asm_amd64.s:837 &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h3&gt;3、runtime.args&lt;/h3&gt;
&lt;p&gt;打好断点之后，可以执行如下命令找到源码所在位置.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;shell&quot;&gt;&lt;pre class=&quot;language-shell&quot;&gt;&lt;code class=&quot;language-shell&quot;&gt;$ &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;dlv&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; s
&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; runtime.args&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; 
./go/src/runtime/runtime1.go:60 &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;hits total:1&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;PC: 0x10360ff&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;  &lt;span class=&quot;token number&quot;&gt;60&lt;/span&gt;:	func args&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;c int32, &lt;span class=&quot;token function&quot;&gt;v&lt;/span&gt; **byte&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;我们找到源码，并且验证了启动过程第一步就是这个&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;go&quot;&gt;&lt;pre class=&quot;language-go&quot;&gt;&lt;code class=&quot;language-go&quot;&gt;runtime&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;runtime1&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;go&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;60&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;func&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;args&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;c &lt;span class=&quot;token builtin&quot;&gt;int32&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; v &lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;token builtin&quot;&gt;byte&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
	argc &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; c
	argv &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; v
	&lt;span class=&quot;token function&quot;&gt;sysargs&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;c&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; v&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
runtime&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;os_darwin&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;go&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;341&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;//go:linkname executablePath os.executablePath&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;var&lt;/span&gt; executablePath &lt;span class=&quot;token builtin&quot;&gt;string&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;func&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;sysargs&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;argc &lt;span class=&quot;token builtin&quot;&gt;int32&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; argv &lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;token builtin&quot;&gt;byte&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
	&lt;span class=&quot;token comment&quot;&gt;// skip over argv, envv and the first string will be the path&lt;/span&gt;
	n &lt;span class=&quot;token operator&quot;&gt;:=&lt;/span&gt; argc &lt;span class=&quot;token operator&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;
	&lt;span class=&quot;token keyword&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;argv_index&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;argv&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; n&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;!=&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;nil&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
		n&lt;span class=&quot;token operator&quot;&gt;++&lt;/span&gt;
	&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
	executablePath &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;gostringnocopy&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;argv_index&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;argv&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; n&lt;span class=&quot;token operator&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;

	&lt;span class=&quot;token comment&quot;&gt;// strip &quot;executable_path=&quot; prefix if available, it&apos;s added after OS X 10.11.&lt;/span&gt;
	&lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; prefix &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;executable_path=&quot;&lt;/span&gt;
	&lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;len&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;executablePath&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;len&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;prefix&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; executablePath&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;len&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;prefix&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;==&lt;/span&gt; prefix &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
		executablePath &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; executablePath&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;len&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;prefix&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;
	&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;这个方法只做了一件事，就是把二进制文件的绝对路径找出来，并存在os.executablePath里。&lt;/p&gt;
&lt;p&gt;按照本文的测试工程：os.executablePath=$GOPATH/test/main&lt;/p&gt;
&lt;h3&gt;4、runtime.osinit&lt;/h3&gt;
&lt;p&gt;再接着运行就会到下一个断点，也就是&lt;code class=&quot;language-text&quot;&gt;runtime.osinit()&lt;/code&gt;这个函数。
&lt;code class=&quot;language-text&quot;&gt;osinit&lt;/code&gt;这个函数是根据操作系统的不同来选择不同的执行函数的，我的是&lt;code class=&quot;language-text&quot;&gt;mac&lt;/code&gt;,所以执行的是&lt;code class=&quot;language-text&quot;&gt;os_darwin.go&lt;/code&gt;里面的函数，同时还有&lt;code class=&quot;language-text&quot;&gt;os_linux.go&lt;/code&gt;里面也有同样的函数。&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;go&quot;&gt;&lt;pre class=&quot;language-go&quot;&gt;&lt;code class=&quot;language-go&quot;&gt;runtime&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;os_darwin&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;go&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;79&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;func&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;osinit&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
	ncpu &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;getncpu&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
	physPageSize &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;getPageSize&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;这个函数主要做来两件事：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;第一是获取当前电脑的&lt;code class=&quot;language-text&quot;&gt;cpu&lt;/code&gt;个数，并赋值给&lt;code class=&quot;language-text&quot;&gt;runtime/runtime2.go&lt;/code&gt;中的&lt;code class=&quot;language-text&quot;&gt;ncpu&lt;/code&gt;变量。&lt;/li&gt;
&lt;li&gt;第二是设置&lt;code class=&quot;language-text&quot;&gt;runtime/malloc.go&lt;/code&gt;中的&lt;code class=&quot;language-text&quot;&gt;physPageSize&lt;/code&gt;变量，这个变量是用于分配内存的，操作系统分配内存或者回收内存都是按这个数字的整数倍来操作的。我获取的是&lt;code class=&quot;language-text&quot;&gt;4096&lt;/code&gt;这个数字，所以是&lt;code class=&quot;language-text&quot;&gt;4k&lt;/code&gt;字节。&lt;/li&gt;
&lt;/ul&gt;
&lt;h3&gt;5、runtime.schedinit&lt;/h3&gt;
&lt;p&gt;再接着运行到下一个断点，就是&lt;code class=&quot;language-text&quot;&gt;runtime.schedinit&lt;/code&gt;这个函数。&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;go&quot;&gt;&lt;pre class=&quot;language-go&quot;&gt;&lt;code class=&quot;language-go&quot;&gt;runtime&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;proc&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;go&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;526&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;func&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;schedinit&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token comment&quot;&gt;//从TLS 中获取g&lt;/span&gt;
	_g_ &lt;span class=&quot;token operator&quot;&gt;:=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;getg&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
	&lt;span class=&quot;token comment&quot;&gt;// 是否开启竞争检测，启动方法go run -race main.go&lt;/span&gt;
	&lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; raceenabled &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
		_g_&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;racectx&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; raceprocctx0 &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;raceinit&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
	&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
	&lt;span class=&quot;token comment&quot;&gt;//运行创建的最大线程数&lt;/span&gt;
	sched&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;maxmcount &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;10000&lt;/span&gt;
	&lt;span class=&quot;token comment&quot;&gt;// 初始化一系列函数所在的PC计数器，用于traceback&lt;/span&gt;
	&lt;span class=&quot;token function&quot;&gt;tracebackinit&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
	&lt;span class=&quot;token comment&quot;&gt;//...&lt;/span&gt;
	&lt;span class=&quot;token function&quot;&gt;moduledataverify&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
	&lt;span class=&quot;token comment&quot;&gt;//栈初始化,初始化了一个栈池，可以直接取，还有一个大栈的全局池.&lt;/span&gt;
	&lt;span class=&quot;token comment&quot;&gt;//golang 使用的是动态栈，初始是2k大小，后面增长，但是golang使用的不是分离栈，是连续栈，就是栈空间是连续的，分配的时候如果之前的空间不连续了，就拷贝一份到新的空间去。&lt;/span&gt;
	&lt;span class=&quot;token function&quot;&gt;stackinit&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
	&lt;span class=&quot;token function&quot;&gt;mallocinit&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
	&lt;span class=&quot;token function&quot;&gt;mcommoninit&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;_g_&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;m&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
	&lt;span class=&quot;token function&quot;&gt;cpuinit&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;       &lt;span class=&quot;token comment&quot;&gt;// must run before alginit&lt;/span&gt;
	&lt;span class=&quot;token function&quot;&gt;alginit&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;       &lt;span class=&quot;token comment&quot;&gt;// maps must not be used before this call&lt;/span&gt;
	&lt;span class=&quot;token function&quot;&gt;modulesinit&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;   &lt;span class=&quot;token comment&quot;&gt;// provides activeModules&lt;/span&gt;
	&lt;span class=&quot;token function&quot;&gt;typelinksinit&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token comment&quot;&gt;// uses maps, activeModules&lt;/span&gt;
	&lt;span class=&quot;token function&quot;&gt;itabsinit&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;     &lt;span class=&quot;token comment&quot;&gt;// uses activeModules&lt;/span&gt;

	&lt;span class=&quot;token function&quot;&gt;msigsave&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;_g_&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;m&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
	initSigmask &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; _g_&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;m&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;sigmask
    &lt;span class=&quot;token comment&quot;&gt;// 启动参数初始化&lt;/span&gt;
	&lt;span class=&quot;token function&quot;&gt;goargs&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
	&lt;span class=&quot;token comment&quot;&gt;//&lt;/span&gt;
	&lt;span class=&quot;token function&quot;&gt;goenvs&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
	&lt;span class=&quot;token comment&quot;&gt;// 解析debug变量，GODEBUG，GOTRACEBACK这些&lt;/span&gt;
	&lt;span class=&quot;token function&quot;&gt;parsedebugvars&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
	&lt;span class=&quot;token comment&quot;&gt;// gc 初始化&lt;/span&gt;
	&lt;span class=&quot;token function&quot;&gt;gcinit&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    
	sched&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;lastpoll &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;uint64&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;nanotime&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
	procs &lt;span class=&quot;token operator&quot;&gt;:=&lt;/span&gt; ncpu
	&lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; n&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; ok &lt;span class=&quot;token operator&quot;&gt;:=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;atoi32&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;gogetenv&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;GOMAXPROCS&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; ok &lt;span class=&quot;token operator&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; n &lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
		procs &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; n
	&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
	&lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;procresize&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;procs&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;!=&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;nil&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
		&lt;span class=&quot;token function&quot;&gt;throw&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;unknown runnable goroutine during bootstrap&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
	&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

	&lt;span class=&quot;token comment&quot;&gt;// For cgocheck &gt; 1, we turn on the write barrier at all times&lt;/span&gt;
	&lt;span class=&quot;token comment&quot;&gt;// and check all pointer writes. We can&apos;t do this until after&lt;/span&gt;
	&lt;span class=&quot;token comment&quot;&gt;// procresize because the write barrier needs a P.&lt;/span&gt;
	&lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; debug&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;cgocheck &lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
		writeBarrier&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;cgo &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;true&lt;/span&gt;
		writeBarrier&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;enabled &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;true&lt;/span&gt;
		&lt;span class=&quot;token keyword&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;_&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; p &lt;span class=&quot;token operator&quot;&gt;:=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;range&lt;/span&gt; allp &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
			p&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;wbBuf&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;reset&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
		&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
	&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

	&lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; buildVersion &lt;span class=&quot;token operator&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;&quot;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
		&lt;span class=&quot;token comment&quot;&gt;// Condition should never trigger. This code just serves&lt;/span&gt;
		&lt;span class=&quot;token comment&quot;&gt;// to ensure runtime·buildVersion is kept in the resulting binary.&lt;/span&gt;
		buildVersion &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;unknown&quot;&lt;/span&gt;
	&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;mallocinit()：这个函数是内存分配器初始化。&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;mcommoninit(mp *m):初始化m0这个线程&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;cpuinit()：cpu初始化&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;alginit()：初始化AES，HASH算法&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h3&gt;6、runtime.newproc()&lt;/h3&gt;
&lt;p&gt;再接着运行到下一个断点，就是&lt;code class=&quot;language-text&quot;&gt;runtime.newproc&lt;/code&gt;这个函数。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;http://cbsheng.github.io/posts/%E6%8E%A2%E7%B4%A2goroutine%E7%9A%84%E5%88%9B%E5%BB%BA/&quot;&gt;http://cbsheng.github.io/posts/%E6%8E%A2%E7%B4%A2goroutine%E7%9A%84%E5%88%9B%E5%BB%BA/&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;go&quot;&gt;&lt;pre class=&quot;language-go&quot;&gt;&lt;code class=&quot;language-go&quot;&gt;runtime&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;proc&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;go&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;3239&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;func&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;newproc&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;siz &lt;span class=&quot;token builtin&quot;&gt;int32&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; fn &lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt;funcval&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
	argp &lt;span class=&quot;token operator&quot;&gt;:=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;add&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;unsafe&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Pointer&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&amp;amp;&lt;/span&gt;fn&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; sys&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;PtrSize&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
	gp &lt;span class=&quot;token operator&quot;&gt;:=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;getg&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
	pc &lt;span class=&quot;token operator&quot;&gt;:=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;getcallerpc&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
	&lt;span class=&quot;token function&quot;&gt;systemstack&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;func&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
		&lt;span class=&quot;token function&quot;&gt;newproc1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;fn&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;token builtin&quot;&gt;uint8&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;argp&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; siz&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; gp&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; pc&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
	&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h3&gt;7、runtime.mstart()&lt;/h3&gt;
&lt;p&gt;再接着运行到下一个断点，就是&lt;code class=&quot;language-text&quot;&gt;runtime.mstart&lt;/code&gt;这个函数。
mstart方法主要的执行路径是：&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;mstart -&gt; mstart1 -&gt; schedule -&gt; execute&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;mstart做一些栈相关的检查，然后就调用mstart1。&lt;/li&gt;
&lt;li&gt;mstart1先做一些初始化与M相关的工作，例如是信号栈和信号处理函数的初始化。最后调用schedule。&lt;/li&gt;
&lt;li&gt;schedule逻辑是这四个方法里最复杂的。简单来说，就是要找出一个可运行的G，不管是从P本地的G队列、全局调度器的G队列、GC - worker、因IO阻塞的G、甚至从别的P里偷。然后传给execute运行。&lt;/li&gt;
&lt;li&gt;execute对传进来的G设置好相关的状态后，就加载G自身记录着的PC、SP等寄存器信息，恢复现场继续执行。&lt;/li&gt;
&lt;/ul&gt;
&lt;h1&gt;参考&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https://github.com/go-delve/delve&quot;&gt;dlv 官网&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;http://cbsheng.github.io/posts/%E6%8E%A2%E7%B4%A2golang%E7%A8%8B%E5%BA%8F%E5%90%AF%E5%8A%A8%E8%BF%87%E7%A8%8B/&quot;&gt;http://cbsheng.github.io/posts/%E6%8E%A2%E7%B4%A2golang%E7%A8%8B%E5%BA%8F%E5%90%AF%E5%8A%A8%E8%BF%87%E7%A8%8B/&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;http://blog.jobbole.com/93100/&quot;&gt;http://blog.jobbole.com/93100/&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;</content:encoded></item><item><title><![CDATA[Linux Tcp 端口耗尽]]></title><description><![CDATA[Linux Tcp 端口耗尽 在连接中如果并发占用的端口过多，就会报。我们一个正常的可以提供多大并发的连接呢？ 端口数量的理论限制 每个连接在操作系统中由…]]></description><link>https://lengrongfu.github.io/2019-06-08-Linux-Tcp-端口耗尽/</link><guid isPermaLink="false">https://lengrongfu.github.io/2019-06-08-Linux-Tcp-端口耗尽/</guid><pubDate>Sat, 08 Jun 2019 10:30:35 GMT</pubDate><content:encoded>&lt;h1&gt;Linux Tcp 端口耗尽&lt;/h1&gt;
&lt;p&gt;在&lt;code class=&quot;language-text&quot;&gt;Tcp&lt;/code&gt;连接中如果并发占用的端口过多，就会报&lt;code class=&quot;language-text&quot;&gt;socket: too many open files&lt;/code&gt;。我们一个正常的&lt;code class=&quot;language-text&quot;&gt;service&lt;/code&gt;可以提供多大并发的连接呢？&lt;/p&gt;
&lt;h2&gt;端口数量的理论限制&lt;/h2&gt;
&lt;p&gt;每个&lt;code class=&quot;language-text&quot;&gt;TCP&lt;/code&gt;连接在操作系统中由4元组唯一标识，包括：&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;(local ip, local port, peer ip, peer port)&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;如果客户端和服务端在统一机器的话&lt;code class=&quot;language-text&quot;&gt;local ip&lt;/code&gt;和&lt;code class=&quot;language-text&quot;&gt;peer ip&lt;/code&gt;是一样的，并且&lt;code class=&quot;language-text&quot;&gt;peer port&lt;/code&gt;是固定的，就是服务端提供的端口，唯一变化的就是&lt;code class=&quot;language-text&quot;&gt;local port&lt;/code&gt;这个变量，这个值是一个&lt;code class=&quot;language-text&quot;&gt;16&lt;/code&gt;字节的数，所以最大值为&lt;code class=&quot;language-text&quot;&gt;65536&lt;/code&gt;，这个是理论上的限制。&lt;/p&gt;
&lt;h2&gt;实际中端口限制&lt;/h2&gt;
&lt;h3&gt;1、当前用户进程可打开的文件数限制&lt;/h3&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;# 通过ulimit 这个命令可以查看操作系统分配给每个进程可以拥有的文件具柄数量。
$ ulimit -n
1024&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h3&gt;2、ip范围&lt;/h3&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;# 这个配置文件中规定了最小端口和最大端口，理论上可以分配的最多端口就是最大端口减去最小端口。
$ cat /proc/sys/net/ipv4/ip_local_port_range
32768	60999&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h3&gt;3、linux 硬件上支持可以打开的最大文件连接数&lt;/h3&gt;
&lt;p&gt;&lt;strong&gt;这个参数的默认值是跟内存大小有关系的，增加物理内存以后重启机器，这个值会增大。大约1G内存10万个句柄的线性关系。这个值是可以修改的，但是不要轻易修改。&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;# 查看最大文件具柄数
$ cat /proc/sys/fs/file-max 
791038
# 查看内存信息
$ cat /proc/meminfo
MemTotal:        8009808 kB
# 查看当前使用的文件具柄
$ cat /proc/sys/fs/file-nr 
5568	0	791038
5568:已分配文件句柄的数目    
0:   分配了但没有使用的句柄数  
791038:文件句柄最大数目&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;strong&gt;端口数量可分配的限制是由最小值限制的，比如上面的三种情况中的1,用户进程可分配的文件句柄为1024,那么就只可以创建这么多的。&lt;/strong&gt;&lt;/p&gt;
&lt;h2&gt;修改可支持的文件具柄数&lt;/h2&gt;
&lt;h3&gt;1、修改用户进程可支持的最大文件具柄数。&lt;/h3&gt;
&lt;p&gt;如果单个进程想要支持更多的文件具柄可以调大，但是对于tcp来说最多就只支持65535个端口数。&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;# 编辑如下的文件，并加入下入的内容
$ vim /etc/security/limits.conf
* soft nofile 65535
* hard nofile 65535&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;上述的配置修改之后当前的会话并不能马上生效，现在使用&lt;code class=&quot;language-text&quot;&gt;ulimit -n&lt;/code&gt;查看，值仍然是&lt;code class=&quot;language-text&quot;&gt;1024&lt;/code&gt;，可以使用&lt;code class=&quot;language-text&quot;&gt;ulimit -n 65535&lt;/code&gt;这样的方式让这次的会话生效。&lt;/p&gt;
&lt;h3&gt;2、ip范围端口也可更改范围&lt;/h3&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;shell&quot;&gt;&lt;pre class=&quot;language-shell&quot;&gt;&lt;code class=&quot;language-shell&quot;&gt;$ &lt;span class=&quot;token function&quot;&gt;vim&lt;/span&gt; /proc/sys/net/ipv4/ip_local_port_range
&lt;span class=&quot;token number&quot;&gt;1024&lt;/span&gt;	&lt;span class=&quot;token number&quot;&gt;65535&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;把可分配的端口范围调大一些。端口分配有上限，就是&lt;strong&gt;65535&lt;/strong&gt;，只能把下限往下调整，一般情况&lt;code class=&quot;language-text&quot;&gt;1024&lt;/code&gt;一下的端口分配的操作系统使用，所以不要调整到&lt;code class=&quot;language-text&quot;&gt;1024&lt;/code&gt;一下去。&lt;/p&gt;
&lt;h2&gt;测试&lt;/h2&gt;
&lt;h3&gt;服务端代码&lt;/h3&gt;
&lt;p&gt;创建一个&lt;code class=&quot;language-text&quot;&gt;service&lt;/code&gt;，并监听&lt;code class=&quot;language-text&quot;&gt;8899&lt;/code&gt;端口,暴露一个&lt;code class=&quot;language-text&quot;&gt;/test&lt;/code&gt;请求，这个请求里面有一个休眠，休眠时间为一个小时，我了模拟并发，把所有的请求都阻塞，不返回。&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;go&quot;&gt;&lt;pre class=&quot;language-go&quot;&gt;&lt;code class=&quot;language-go&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;package&lt;/span&gt; main

&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;
	&lt;span class=&quot;token string&quot;&gt;&quot;fmt&quot;&lt;/span&gt;
	&lt;span class=&quot;token string&quot;&gt;&quot;net/http&quot;&lt;/span&gt;
	&lt;span class=&quot;token string&quot;&gt;&quot;time&quot;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;func&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;test&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;w http&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;ResponseWriter&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; r &lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt;http&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;Request&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
	fmt&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Println&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;r&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;RemoteAddr&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;r&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;RequestURI&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
	time&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Sleep&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;60&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt;time&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;Minute&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
	fmt&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Fprint&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;w&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;this is test https service&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;



&lt;span class=&quot;token keyword&quot;&gt;func&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;main&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
	mux &lt;span class=&quot;token operator&quot;&gt;:=&lt;/span&gt; http&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;NewServeMux&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
	mux&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;HandleFunc&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;/test&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; test&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
	&lt;span class=&quot;token comment&quot;&gt;//http.ListenAndServeTLS(&quot;:8899&quot;, &quot;server.crt&quot;, &quot;server.key&quot;, nil)&lt;/span&gt;
	fmt&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Println&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;http&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;ListenAndServe&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;:8899&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; mux&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h3&gt;客户端代码&lt;/h3&gt;
&lt;p&gt;客户端通过添加请求的数量和请求地址来进行模拟并发请求，保证每个请求都不被释放端口占用。这样可以用于检验上述的配置是否有效。&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;go&quot;&gt;&lt;pre class=&quot;language-go&quot;&gt;&lt;code class=&quot;language-go&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;package&lt;/span&gt; main

&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;
	&lt;span class=&quot;token string&quot;&gt;&quot;errors&quot;&lt;/span&gt;
	&lt;span class=&quot;token string&quot;&gt;&quot;flag&quot;&lt;/span&gt;
	&lt;span class=&quot;token string&quot;&gt;&quot;fmt&quot;&lt;/span&gt;
	&lt;span class=&quot;token string&quot;&gt;&quot;io/ioutil&quot;&lt;/span&gt;
	&lt;span class=&quot;token string&quot;&gt;&quot;net/http&quot;&lt;/span&gt;
	&lt;span class=&quot;token boolean&quot;&gt;_&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;net/http/pprof&quot;&lt;/span&gt;
	&lt;span class=&quot;token string&quot;&gt;&quot;sync&quot;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;var&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;
	num &lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;token builtin&quot;&gt;int&lt;/span&gt;
	url &lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;token builtin&quot;&gt;string&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;


&lt;span class=&quot;token keyword&quot;&gt;var&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;
	client &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; http&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;DefaultClient
&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;func&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;init&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;  &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
	num &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; flag&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Int&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;num&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;http request number&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
	url &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; flag&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;String&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;url&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;http request url&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
	flag&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Parse&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
	&lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt;url &lt;span class=&quot;token operator&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;&quot;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
		&lt;span class=&quot;token function&quot;&gt;panic&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;errors&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;New&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;request url is not nil&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
	&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;func&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;gorequest&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;wait &lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt;sync&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;WaitGroup&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;  &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
	resp&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; err &lt;span class=&quot;token operator&quot;&gt;:=&lt;/span&gt; http&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Get&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt;url&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
	&lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; err &lt;span class=&quot;token operator&quot;&gt;!=&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;nil&lt;/span&gt;  &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
		fmt&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Println&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;err&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
		&lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt;
	&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
	&lt;span class=&quot;token keyword&quot;&gt;defer&lt;/span&gt; resp&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;Body&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Close&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
	bytes&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;_&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;:=&lt;/span&gt; ioutil&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;ReadAll&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;resp&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;Body&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
	fmt&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Println&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;response:&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;string&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;bytes&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
	&lt;span class=&quot;token keyword&quot;&gt;defer&lt;/span&gt; wait&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Done&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;func&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;main&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
	&lt;span class=&quot;token keyword&quot;&gt;var&lt;/span&gt; wait sync&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;WaitGroup
	wait&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Add&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt;num&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
	&lt;span class=&quot;token keyword&quot;&gt;for&lt;/span&gt; i &lt;span class=&quot;token operator&quot;&gt;:=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; i &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt;num &lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; i&lt;span class=&quot;token operator&quot;&gt;++&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
		&lt;span class=&quot;token keyword&quot;&gt;go&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;gorequest&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&amp;amp;&lt;/span&gt;wait&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
	&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
	wait&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Wait&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h1&gt;参考文章&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https://www.jianshu.com/p/ad2754432a4b&quot;&gt;https://www.jianshu.com/p/ad2754432a4b&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://blog.51cto.com/ityunwei2017/1558092&quot;&gt;https://blog.51cto.com/ityunwei2017/1558092&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://making.pusher.com/ephemeral-port-exhaustion-and-how-to-avoid-it/&quot;&gt;https://making.pusher.com/ephemeral-port-exhaustion-and-how-to-avoid-it/&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;</content:encoded></item><item><title><![CDATA[orange原理以及使用]]></title><description><![CDATA[Orange 工具介绍 orange github 设计文档 Orange 使用 Orange 原理 运行时更具文件内容中的来进行匹配规则，通过的执行顺序可知，在阶段就是为了通过分流规则来设置这个变量的值。
location…]]></description><link>https://lengrongfu.github.io/2019-05-21-orange-原理/</link><guid isPermaLink="false">https://lengrongfu.github.io/2019-05-21-orange-原理/</guid><pubDate>Tue, 21 May 2019 15:24:13 GMT</pubDate><content:encoded>&lt;h1&gt;Orange 工具介绍&lt;/h1&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;`Orange`是一个基于`OpenResty`的页面化的网关,提供了页面化的分流规则配置和权限配置。工具更多的信息参考设计文档和源代码。&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https://github.com/sumory/orange/blob/master/README_zh.md&quot;&gt;orange github&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;http://resty.b0.upaiyun.com/orange.pdf&quot;&gt;设计文档&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h1&gt;Orange 使用&lt;/h1&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;使用文档参考官方文档 [http://orange.sumory.com/docs/](http://orange.sumory.com/docs/).&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h1&gt;Orange 原理&lt;/h1&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;orange&lt;/code&gt;运行时更具&lt;code class=&quot;language-text&quot;&gt;nginx.conf&lt;/code&gt;文件内容中的&lt;code class=&quot;language-text&quot;&gt;location&lt;/code&gt;来进行匹配规则，通过&lt;code class=&quot;language-text&quot;&gt;nginx&lt;/code&gt;的执行顺序可知，在&lt;code class=&quot;language-text&quot;&gt;access_by_lua_block&lt;/code&gt;阶段就是为了通过分流规则来设置&lt;code class=&quot;language-text&quot;&gt;upstream_url&lt;/code&gt;这个变量的值。
&lt;img src=&quot;location.png&quot; alt=&quot;location&quot;&gt;
通过规则匹配来赋值给&lt;code class=&quot;language-text&quot;&gt;ngx.upstream_url&lt;/code&gt;这个变量，然后通过执行&lt;code class=&quot;language-text&quot;&gt;proxy_pass $upstream_url;&lt;/code&gt;这个方法就可以实现页面配置来进行转发。
&lt;img src=&quot;code.png&quot; alt=&quot;code&quot;&gt;
&lt;img src=&quot;arch.png&quot; alt=&quot;arch&quot;&gt;&lt;/p&gt;
&lt;h1&gt;Orange 扩展&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https://github.com/linger1216/understanding-orange&quot;&gt;插件开发&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h1&gt;Q&amp;#x26;A&lt;/h1&gt;
&lt;p&gt;再生产中遇到的问题&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;容器部署多个&lt;code class=&quot;language-text&quot;&gt;orange&lt;/code&gt;，共用一个数据库时会出现节点缓存问题,基于&lt;code class=&quot;language-text&quot;&gt;swarm&lt;/code&gt;编排容器。&lt;/li&gt;
&lt;li&gt;添加规则出现&lt;code class=&quot;language-text&quot;&gt;uuid&lt;/code&gt;重复，这是因为&lt;code class=&quot;language-text&quot;&gt;uuid&lt;/code&gt;这个库在容器中生成了冲突，所以需要提花一个包，这个问题在&lt;code class=&quot;language-text&quot;&gt;issues&lt;/code&gt;中提到过。&lt;/li&gt;
&lt;/ul&gt;</content:encoded></item><item><title><![CDATA[散列表数据结构]]></title><description><![CDATA[…]]></description><link>https://lengrongfu.github.io/2019-05-11-Introduction-to-Algorithms-lecture-7/</link><guid isPermaLink="false">https://lengrongfu.github.io/2019-05-11-Introduction-to-Algorithms-lecture-7/</guid><pubDate>Sat, 11 May 2019 15:38:38 GMT</pubDate><content:encoded>&lt;p&gt;在实际应用中我们需要用到一种动态集合结构。散列表是普通数组的推广，可以对数组直接寻址，故可以在&lt;code class=&quot;language-text&quot;&gt;O(1)&lt;/code&gt;时间内访问数组的任意元素。散列表中的思想是把关键字映射到数组下标，是通过计算出来的，散列计算过程中容器出现碰撞，解决碰撞也是散列的一个难点，根本问题是哈希计算的问题。&lt;/p&gt;
&lt;h1&gt;直接访问表&lt;/h1&gt;
&lt;p&gt;当需要存储一个&lt;code class=&quot;language-text&quot;&gt;（1.....m-1）&lt;/code&gt;的元素时，并且&lt;code class=&quot;language-text&quot;&gt;m&lt;/code&gt;比较小，此时就可以用一个数组&lt;code class=&quot;language-text&quot;&gt;T&lt;/code&gt;来存储所有从&lt;code class=&quot;language-text&quot;&gt;1-m&lt;/code&gt;之间的数组。
比如需要存储:&lt;code class=&quot;language-text&quot;&gt;{4,6,8,3}&lt;/code&gt;这几个元素，这里面最大的元素为&lt;code class=&quot;language-text&quot;&gt;8&lt;/code&gt;，所以创建一个数组有&lt;code class=&quot;language-text&quot;&gt;8&lt;/code&gt;个元素，把对应的元素放到数组槽里面即可。&lt;/p&gt;
&lt;p&gt;直接寻址有一个问题就是当&lt;code class=&quot;language-text&quot;&gt;m&lt;/code&gt;很大是，需要的数组&lt;code class=&quot;language-text&quot;&gt;T&lt;/code&gt;就会很大，即使需要存储的元素比较少,比如:&lt;code class=&quot;language-text&quot;&gt;{4,1,6,2^64}&lt;/code&gt;,这里只有四个元素，最大值为&lt;code class=&quot;language-text&quot;&gt;2^64&lt;/code&gt;，如果创建一个&lt;code class=&quot;language-text&quot;&gt;T&lt;/code&gt;的数组则需要很大的存储空间。&lt;/p&gt;
&lt;h1&gt;散列表原理和实现&lt;/h1&gt;
&lt;h2&gt;全域散列&lt;/h2&gt;
&lt;h2&gt;开放寻址法&lt;/h2&gt;
&lt;h1&gt;go map实现&lt;/h1&gt;
&lt;p&gt;golang中map是一个kv对集合。底层使用hash table，用链表来解决冲突，通过编译器配合runtime，所有的map对象都是共用一份代码。&lt;/p&gt;
&lt;h2&gt;hash 函数&lt;/h2&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;hash&lt;/code&gt;函数通过&lt;code class=&quot;language-text&quot;&gt;cpu&lt;/code&gt;的架构来选择不同的计算方式，有&lt;code class=&quot;language-text&quot;&gt;aes&lt;/code&gt;和&lt;code class=&quot;language-text&quot;&gt;memhash&lt;/code&gt;两种实现方式，&lt;code class=&quot;language-text&quot;&gt;memhash&lt;/code&gt;是借鉴&lt;code class=&quot;language-text&quot;&gt;xxhash&lt;/code&gt;和&lt;code class=&quot;language-text&quot;&gt;cityhash&lt;/code&gt;原理进行开发，其速度超级快，且采用的是随机哈希的方式，在每一运行过程中都有一个种子元素，同一个&lt;code class=&quot;language-text&quot;&gt;key&lt;/code&gt;哈希出来的值都是不一样的，这样就避免了哈希碰撞攻击，
源码在&lt;code class=&quot;language-text&quot;&gt;src/runtime/hase64.go&lt;/code&gt;文件中,&lt;/p&gt;
&lt;h2&gt;解决碰撞&lt;/h2&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;map&lt;/code&gt;中主要通过&lt;code class=&quot;language-text&quot;&gt;bmap&lt;/code&gt;这个结构来存储&lt;code class=&quot;language-text&quot;&gt;k/v&lt;/code&gt;的,&lt;code class=&quot;language-text&quot;&gt;bmap&lt;/code&gt;在&lt;code class=&quot;language-text&quot;&gt;hmap&lt;/code&gt;中是一个动态数组，每个&lt;code class=&quot;language-text&quot;&gt;bmap&lt;/code&gt;对象由8个&lt;code class=&quot;language-text&quot;&gt;k/v&lt;/code&gt;组成，如果一个&lt;code class=&quot;language-text&quot;&gt;bmap&lt;/code&gt;填充满了，&lt;code class=&quot;language-text&quot;&gt;bmap&lt;/code&gt;中有一个指向下一个&lt;code class=&quot;language-text&quot;&gt;bmap&lt;/code&gt;的指针，这样就通过链表解决了冲突的情况。&lt;/p&gt;
&lt;h1&gt;参考文章&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https://www.jianshu.com/p/aa0d4808cbb8&quot;&gt;Golang map 的底层实现&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;</content:encoded></item><item><title><![CDATA[文件存储系统设计]]></title><description><![CDATA[存储系统简介 单机存储系统 分布式存储系统 Q&A 如何解决文件写入cache之后系统重启数据丢失的问题…]]></description><link>https://lengrongfu.github.io/2019-05-07-file-save/</link><guid isPermaLink="false">https://lengrongfu.github.io/2019-05-07-file-save/</guid><pubDate>Tue, 07 May 2019 14:40:44 GMT</pubDate><content:encoded>&lt;h1&gt;存储系统简介&lt;/h1&gt;
&lt;h1&gt;单机存储系统&lt;/h1&gt;
&lt;h1&gt;分布式存储系统&lt;/h1&gt;
&lt;h1&gt;Q&amp;#x26;A&lt;/h1&gt;
&lt;h2&gt;如何解决文件写入cache之后系统重启数据丢失的问题&lt;/h2&gt;
&lt;h3&gt;1、单节点&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;可以通过记录操作日志来进行恢复，使用&lt;code class=&quot;language-text&quot;&gt;LVM&lt;/code&gt;数据结构来顺序记录操作日志，然后顺序写入到磁盘，并且写成功了才能进行后续的操作。&lt;code class=&quot;language-text&quot;&gt;Prometheus&lt;/code&gt;、&lt;code class=&quot;language-text&quot;&gt;leveldb&lt;/code&gt;都是这也设计的，通过这种方式来解决缓存丢失的问题。&lt;/li&gt;
&lt;li&gt;定时把缓存刷新到磁盘，这里的缓存不论是操作系统的&lt;code class=&quot;language-text&quot;&gt;Page cache&lt;/code&gt;还是用户空间中的自定义缓存，都可以用这种方法，手动刷新缓存落地。&lt;/li&gt;
&lt;/ul&gt;
&lt;h3&gt;2、分布式&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;集群节点中可以通过副本的方式来保证一定有节点落地成功，典型应用&lt;code class=&quot;language-text&quot;&gt;kafak&lt;/code&gt;,&lt;code class=&quot;language-text&quot;&gt;kafka&lt;/code&gt;通过&lt;code class=&quot;language-text&quot;&gt;mmap&lt;/code&gt;内存映射文件技术，把用户态的内存映射到&lt;code class=&quot;language-text&quot;&gt;Page cache&lt;/code&gt;中去，节省了用户态缓存到&lt;code class=&quot;language-text&quot;&gt;page cache&lt;/code&gt;的复制时间，这样就会出现系统重启之后丢失数据问题，所以&lt;code class=&quot;language-text&quot;&gt;kafak&lt;/code&gt;一般配置为所有的副本分片都接收到了消息才认为成功，这样总有机器数据是完整的。副本也是现在很多分布式系统用的多的解决方案。&lt;/li&gt;
&lt;/ul&gt;
&lt;h2&gt;随机读写、顺序读写概念和性能问题&lt;/h2&gt;
&lt;h3&gt;1、随机读写&lt;/h3&gt;
&lt;p&gt;而每次随机读写的时候，寻道和旋转步骤都需要执行(不考虑操作系统读写缓冲)，并且随机读时缓存命中较低，这样就导致频繁的操作io，读取速度下降。对于随机读取的系统，设计是可以考虑进行&lt;code class=&quot;language-text&quot;&gt;directio&lt;/code&gt;,对文件进行直接读取。&lt;/p&gt;
&lt;h3&gt;2、顺序读写&lt;/h3&gt;
&lt;p&gt;在顺序读写的时候，寻道和旋转步骤只需要执行一次，剩下的全是数据传输所需要的固有开销。&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;2.png&quot; alt=&quot;测试结果&quot;&gt;&lt;/p&gt;
&lt;h2&gt;为什么kafka这么快&lt;/h2&gt;
&lt;p&gt;1、&lt;code class=&quot;language-text&quot;&gt;kafka&lt;/code&gt;写入数据时采用了顺序写入文件并且采用了&lt;code class=&quot;language-text&quot;&gt;mmap&lt;/code&gt;内存映射文件，可以减少一次&lt;code class=&quot;language-text&quot;&gt;copy&lt;/code&gt;，并且直接把数据写入到&lt;code class=&quot;language-text&quot;&gt;page cache&lt;/code&gt;中，操作系统再定期刷新到磁盘上去。这是&lt;code class=&quot;language-text&quot;&gt;produce&lt;/code&gt;写入快。
2、&lt;code class=&quot;language-text&quot;&gt;kafka&lt;/code&gt;使用了&lt;code class=&quot;language-text&quot;&gt;SendFile&lt;/code&gt;技术，&lt;code class=&quot;language-text&quot;&gt;DMA&lt;/code&gt;引擎将文件中的数据拷贝到操作系统内核缓冲区中&lt;code class=&quot;language-text&quot;&gt;page cache&lt;/code&gt;，然后数据被拷贝到与&lt;code class=&quot;language-text&quot;&gt;socket&lt;/code&gt;相关的内核缓冲区。接下来，&lt;code class=&quot;language-text&quot;&gt;DMA&lt;/code&gt;引擎将数据从内核&lt;code class=&quot;language-text&quot;&gt;socket&lt;/code&gt;缓冲区中拷贝到协议引擎。这就是&lt;code class=&quot;language-text&quot;&gt;consumer&lt;/code&gt;速度快的原因，数据流直接从&lt;code class=&quot;language-text&quot;&gt;page cache&lt;/code&gt;发送到了&lt;code class=&quot;language-text&quot;&gt;socket&lt;/code&gt;的缓冲区中。&lt;/p&gt;
&lt;h1&gt;ssd相关的技术&lt;/h1&gt;
&lt;h1&gt;参考文章以及书籍&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https://www.cnkirito.moe/file-io-best-practise/&quot;&gt;文件IO操作的一些最佳实践&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;http://gao-xiao-long.github.io/2016/04/13/file-io/&quot;&gt;leveldb前奏—理解文件I/O&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://manbuyun.github.io/2017/01/13/%E4%B8%BA%E4%BB%80%E4%B9%88Kafka%E9%82%A3%E4%B9%88%E5%BF%AB/&quot;&gt;为什么Kafka那么快&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://m635674608.iteye.com/blog/2397068&quot;&gt;从Apache Kafka 重温文件高效读写&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;http://harlon.org/2018/06/20/database/&quot;&gt;深入理解MySQL底层实现&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://nvmexpress.org/resources/drivers/linux-driver-information/&quot;&gt;nvm&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;</content:encoded></item><item><title><![CDATA[渐进符号、替换、递归树、主方法]]></title><description><![CDATA[这节课的主要知识就是讲诉了使用三种方法去求解递归式。 渐进记号 渐进记号主要有三种，具体定义参考课本。把渐进记号用来描述算法的运行时间。 Θ 记号(上界) 使得存在正数常量,使得对所有 ,有 Ω 记号（下界）  使得存在正数常量和,使得对所有有 . O…]]></description><link>https://lengrongfu.github.io/2019-04-05-Introduction-to-Algorithms-lecture-2/</link><guid isPermaLink="false">https://lengrongfu.github.io/2019-04-05-Introduction-to-Algorithms-lecture-2/</guid><pubDate>Fri, 05 Apr 2019 22:57:18 GMT</pubDate><content:encoded>&lt;p&gt;这节课的主要知识就是讲诉了使用三种方法去求解递归式。&lt;/p&gt;
&lt;h1&gt;渐进记号&lt;/h1&gt;
&lt;p&gt;渐进记号主要有三种，具体定义参考课本。把渐进记号用来描述算法的运行时间。&lt;/p&gt;
&lt;h2&gt;Θ 记号(上界)&lt;/h2&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;f(n) = Θ(g(n))&lt;/code&gt;使得存在正数常量&lt;code class=&quot;language-text&quot;&gt;c1、c2、n0&lt;/code&gt;,使得对所有 &lt;code class=&quot;language-text&quot;&gt;n≥n0&lt;/code&gt;,有&lt;code class=&quot;language-text&quot;&gt;0≤c1g(n) ≤ f(n)≤ c2g(n)&lt;/code&gt;&lt;/p&gt;
&lt;h2&gt;Ω 记号（下界）&lt;/h2&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;f(n)=Ω(g(n))&lt;/code&gt; 使得存在正数常量&lt;code class=&quot;language-text&quot;&gt;c&lt;/code&gt;和&lt;code class=&quot;language-text&quot;&gt;n0&lt;/code&gt;,使得对所有&lt;code class=&quot;language-text&quot;&gt;n≥n0&lt;/code&gt;有 &lt;code class=&quot;language-text&quot;&gt;0 ≤ cg(n) ≤ f(n)&lt;/code&gt;.&lt;/p&gt;
&lt;h2&gt;O 记号&lt;/h2&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;Θ&lt;/code&gt;记号渐进的给出一个函数的上界和下界，当只有一个渐进上界时，使用&lt;code class=&quot;language-text&quot;&gt;O&lt;/code&gt;记号。
&lt;code class=&quot;language-text&quot;&gt;f(n) = O(g(n)) &lt;/code&gt; 使得存在正数常量&lt;code class=&quot;language-text&quot;&gt;c,n0&lt;/code&gt;，使得对所有&lt;code class=&quot;language-text&quot;&gt;n≥n0&lt;/code&gt;,有&lt;code class=&quot;language-text&quot;&gt;0≤f(n)≤cg(n)&lt;/code&gt;&lt;/p&gt;
&lt;h1&gt;求解递归式&lt;/h1&gt;
&lt;p&gt;使用递归式来刻画分治算法的运行时间，如下三种方法便是学习如何求解递归式。
递归式如下：
&lt;img src=&quot;1557153490587.jpg&quot; alt=&quot;递归式&quot;&gt;&lt;/p&gt;
&lt;h2&gt;替换法求解递归式&lt;/h2&gt;
&lt;p&gt;代入法求解递归式分两步：
1、猜测解的形式。需要靠经验，或者借助递归树来得出好的猜测。
2、归纳验证，求解常量。&lt;/p&gt;
&lt;h2&gt;递归树求解递归式&lt;/h2&gt;
&lt;p&gt;此方法参考课本内容。&lt;/p&gt;
&lt;h2&gt;主方法求解递归式&lt;/h2&gt;
&lt;p&gt;主方法定义了一个通用的递归式求解方法，如下&lt;/p&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;T(n) = aT(n/b) + f(n)&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;含义：它将规模为&lt;code class=&quot;language-text&quot;&gt;n&lt;/code&gt;的问题分解为&lt;code class=&quot;language-text&quot;&gt;a&lt;/code&gt;个子问题，每个子问题规模为&lt;code class=&quot;language-text&quot;&gt;n/b&lt;/code&gt;，其中&lt;code class=&quot;language-text&quot;&gt;a&lt;/code&gt;和&lt;code class=&quot;language-text&quot;&gt;b&lt;/code&gt;都是正常数，&lt;code class=&quot;language-text&quot;&gt;a&lt;/code&gt;个子问题递归地进行求解，每个话费时间&lt;code class=&quot;language-text&quot;&gt;T(n/b)&lt;/code&gt;。函数&lt;code class=&quot;language-text&quot;&gt;fn&lt;/code&gt;包含了问题分解和子问题解合并的代价。&lt;/p&gt;
&lt;p&gt;主方法依赖下面的定理：令&lt;code class=&quot;language-text&quot;&gt;a&gt;= 1&lt;/code&gt;和&lt;code class=&quot;language-text&quot;&gt;b&gt;1&lt;/code&gt;是常数，&lt;code class=&quot;language-text&quot;&gt;fn&lt;/code&gt;是一个函数，&lt;code class=&quot;language-text&quot;&gt;Tn&lt;/code&gt;是定义在非负整数上的递归式：
&lt;code class=&quot;language-text&quot;&gt;T(n) = aT(n/b) + f(n)&lt;/code&gt;
&lt;code class=&quot;language-text&quot;&gt;Tn&lt;/code&gt;有如下渐进界：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;1、若对某个常数&lt;code class=&quot;language-text&quot;&gt;ε&gt;0&lt;/code&gt;有&lt;code class=&quot;language-text&quot;&gt;f(n)=O(nlogba–ε)&lt;/code&gt;则&lt;code class=&quot;language-text&quot;&gt; T(n) = Θ(nlogba) .&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;2、若&lt;code class=&quot;language-text&quot;&gt;f(n) = Θ(nlogba)&lt;/code&gt;则&lt;code class=&quot;language-text&quot;&gt;T(n) = Θ(nlogba lgk+1n) .&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;3、若某个常数&lt;code class=&quot;language-text&quot;&gt;ε&gt;0&lt;/code&gt;有&lt;code class=&quot;language-text&quot;&gt;f(n)=Ω(nlogba+ε)&lt;/code&gt;且对某个常数&lt;code class=&quot;language-text&quot;&gt;c&amp;lt;1&lt;/code&gt;和所有足够大的&lt;code class=&quot;language-text&quot;&gt;n&lt;/code&gt;有&lt;code class=&quot;language-text&quot;&gt;af(n/b) &amp;lt; cf(n) &lt;/code&gt;,则&lt;code class=&quot;language-text&quot;&gt;T(n) = Θ( f (n) ) &lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;递归树的高度：&lt;code class=&quot;language-text&quot;&gt;h = logbn&lt;/code&gt;
叶子结点个数：&lt;code class=&quot;language-text&quot;&gt;l =  nlogba&lt;/code&gt;&lt;/p&gt;</content:encoded></item><item><title><![CDATA[算法分析、插入排序、归并排序]]></title><description><![CDATA[…]]></description><link>https://lengrongfu.github.io/2019-03-30-Introduction-to-Algorithms-lecture-1/</link><guid isPermaLink="false">https://lengrongfu.github.io/2019-03-30-Introduction-to-Algorithms-lecture-1/</guid><pubDate>Sat, 30 Mar 2019 16:29:23 GMT</pubDate><content:encoded>&lt;blockquote&gt;
&lt;p&gt;本系列文章是我学习算法概论(第三版)这本书的一些笔记和感悟，我没有纯看书，而是结合了&lt;code class=&quot;language-text&quot;&gt;MIT&lt;/code&gt;的公开课，把书籍作为课本，查看具体细节，主要是看课程，每节课时长&lt;code class=&quot;language-text&quot;&gt;60&lt;/code&gt;分钟左右，视频在网易公开课上有中文字母。次课程会从数学的角度去分析运行时，课程总共有&lt;code class=&quot;language-text&quot;&gt;21&lt;/code&gt;，前&lt;code class=&quot;language-text&quot;&gt;6&lt;/code&gt;课讲解都是排序算法，对应课本上的前三章，这部分不涉及到数据结构,后面的章节都涉及数据结构以及应用。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h1&gt;算法分析&lt;/h1&gt;
&lt;h2&gt;为什么学习算法和性能&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;算法帮助我们去理解可扩展性。&lt;/li&gt;
&lt;li&gt;性能常常用来划分什么是可行的什么是不可行的。&lt;/li&gt;
&lt;li&gt;算法数学提供了一个讨论程序特性的语言。(用数学来刻画程序的特性，比如运行时)。&lt;/li&gt;
&lt;li&gt;性能是计算机的共性。&lt;/li&gt;
&lt;li&gt;程序性能和计算机资源是无关的。比如一台很老的电脑和一台现代的电脑相比，不能说现代电脑就一定比旧电脑运行的快，如果旧电脑运行的算法比较高效的话，一定会在某一时刻运行时间会小于新电脑。&lt;/li&gt;
&lt;/ul&gt;
&lt;h1&gt;排序问题&lt;/h1&gt;
&lt;p&gt;&lt;strong&gt;Input:&lt;/strong&gt; 一个序列 &lt;code class=&quot;language-text&quot;&gt;&amp;lt;a1,a2,a3,.....,an&gt;&lt;/code&gt;
&lt;strong&gt;Output:&lt;/strong&gt; 输出一个排序后的序列&lt;code class=&quot;language-text&quot;&gt;&amp;lt;a1&apos;,a2&apos;,a3&apos;,......,an&apos;&gt;&lt;/code&gt;, 使得 &lt;code class=&quot;language-text&quot;&gt;a1&apos; &amp;lt; a2&apos; &amp;lt; a3&apos; &amp;lt; .... &amp;lt; an&apos;&lt;/code&gt;&lt;/p&gt;
&lt;h2&gt;插入排序&lt;/h2&gt;
&lt;h2&gt;伪代码&lt;/h2&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;c&quot;&gt;&lt;pre class=&quot;language-c&quot;&gt;&lt;code class=&quot;language-c&quot;&gt;Insertion&lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;SORT&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;A&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;n&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;for&lt;/span&gt; j ← &lt;span class=&quot;token number&quot;&gt;2&lt;/span&gt; to n
        &lt;span class=&quot;token keyword&quot;&gt;do&lt;/span&gt; key←A&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;j&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;
            i←j–&lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;
            &lt;span class=&quot;token keyword&quot;&gt;while&lt;/span&gt; i &lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt; and A&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;i&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; key
                &lt;span class=&quot;token keyword&quot;&gt;do&lt;/span&gt; A&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;i&lt;span class=&quot;token operator&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; ← A&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;i&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; 
                i←i–&lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;
        A&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;i&lt;span class=&quot;token operator&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; key&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;go&quot;&gt;&lt;pre class=&quot;language-go&quot;&gt;&lt;code class=&quot;language-go&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;func&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;InsertionSort&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;A &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token builtin&quot;&gt;int&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;  &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
	&lt;span class=&quot;token keyword&quot;&gt;for&lt;/span&gt; i&lt;span class=&quot;token operator&quot;&gt;:=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; i &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;len&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;A&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; i&lt;span class=&quot;token operator&quot;&gt;++&lt;/span&gt;  &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
		key &lt;span class=&quot;token operator&quot;&gt;:=&lt;/span&gt; A&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;i&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;
		j &lt;span class=&quot;token operator&quot;&gt;:=&lt;/span&gt; i&lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;
		&lt;span class=&quot;token keyword&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; j &lt;span class=&quot;token operator&quot;&gt;&gt;=&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; A&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;j&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; key &lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
			A&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;j&lt;span class=&quot;token operator&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; A&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;j&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;
			j &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; j&lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;
		&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
		A&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;j&lt;span class=&quot;token operator&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; key
	&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h3&gt;运行时分析&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;运行时依赖输入，如果输入是排好序的，那是很容易排序的。&lt;/li&gt;
&lt;li&gt;输入元素的个数，短序列比长序列更好排序。&lt;/li&gt;
&lt;li&gt;通常来说，我们分析的是运行时的上限。&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;分析的方式&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;最差情况(通常用次分析)&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;T(n) = 算法的最长运行时在任何的输入下。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;平均情况&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;T(n) = 算法的预期时间在总体输入下。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;最好情况&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;T(n) = 在某些输入下运行时间比较好。&lt;/p&gt;
&lt;h3&gt;插入排序分析&lt;/h3&gt;
&lt;p&gt;$$
T(n)=\sum_{j=2}^{n} \Theta(j)=\Theta\left(n^{2}\right)
$$&lt;/p&gt;
&lt;p&gt;我们分析最差情况，如果输入是逆序的，那么执行的次数就是&lt;code class=&quot;language-text&quot;&gt;n+(n-1)+(n-2)+...+1=n(n-1)/2&lt;/code&gt; 就是一个等差数列求和，就得到如上的公式，&lt;/p&gt;
&lt;p&gt;$$
T(n)=\Theta\left(n^{2}/2\right) + \Theta\left(n-1\right)
$$&lt;/p&gt;
&lt;p&gt;忽略低阶项和高价项的常数，就得到如下运行时间，所以插入排序是和输入大小成平方比。&lt;/p&gt;
&lt;p&gt;$$
T(n) = \Theta\left(n^{2}\right)
$$&lt;/p&gt;
&lt;h2&gt;归并排序&lt;/h2&gt;
&lt;h3&gt;伪代码&lt;/h3&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;c&quot;&gt;&lt;pre class=&quot;language-c&quot;&gt;&lt;code class=&quot;language-c&quot;&gt;&lt;span class=&quot;token macro property&quot;&gt;&lt;span class=&quot;token directive-hash&quot;&gt;#&lt;/span&gt; &lt;span class=&quot;token expression&quot;&gt;MERGE&lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;SORT&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;A&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
    &lt;span class=&quot;token number&quot;&gt;1.&lt;/span&gt; Ifn&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;done&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;
    &lt;span class=&quot;token number&quot;&gt;2.&lt;/span&gt; 递归排序 A&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt; ⎡n&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;2&lt;/span&gt;⎤ &lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; and A&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt; ⎡n&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;2&lt;/span&gt;⎤&lt;span class=&quot;token operator&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt; n &lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt; # ⎡n&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;2&lt;/span&gt;⎤ 向下取整
    &lt;span class=&quot;token number&quot;&gt;3.&lt;/span&gt; 合并这两个`list`&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h3&gt;归并排序分析&lt;/h3&gt;
&lt;p&gt;&lt;img src=&quot;1557153490587.jpg&quot; alt=&quot;公式&quot;&gt;&lt;/p&gt;
&lt;p&gt;这个公式在后面会用主方法来进行分析运行的上界。&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;2.png&quot; alt=&quot;2&quot;&gt;&lt;/p&gt;
&lt;p&gt;递归树的高度是&lt;code class=&quot;language-text&quot;&gt;lgn&lt;/code&gt;，每一个层级运行时为&lt;code class=&quot;language-text&quot;&gt;cn&lt;/code&gt;，所以&lt;code class=&quot;language-text&quot;&gt;Tn = O(cn*lgn)&lt;/code&gt;,就是高度乘以每一层的时间，前面的&lt;code class=&quot;language-text&quot;&gt;c&lt;/code&gt;为常量，可以忽略。&lt;/p&gt;
&lt;h2&gt;结论&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;Θ(nlgn)&lt;/code&gt;比&lt;code class=&quot;language-text&quot;&gt;Θ(n2)&lt;/code&gt;慢的多。&lt;/li&gt;
&lt;li&gt;归并排序在最坏情况下比插入排序好的多。&lt;/li&gt;
&lt;li&gt;实践中，当&lt;code class=&quot;language-text&quot;&gt;n &gt; 30&lt;/code&gt; 时，归并排序就比插入排序好的多。&lt;/li&gt;
&lt;/ul&gt;</content:encoded></item><item><title><![CDATA[Inverted-index]]></title><description><![CDATA[倒排索引(Inverted index) 文章写的有点粗糙，都是只描述了思想，没有去抠具体的细节部分，对这些项目的作者刚到敬仰，把一个理论上的技术用在工程上会遇到很多问题。如果文章中有不妥之处，欢迎去我的提交 issues…]]></description><link>https://lengrongfu.github.io/2019-03-25-Inverted-index/</link><guid isPermaLink="false">https://lengrongfu.github.io/2019-03-25-Inverted-index/</guid><pubDate>Sun, 24 Mar 2019 19:01:19 GMT</pubDate><content:encoded>&lt;h1&gt;倒排索引(Inverted index)&lt;/h1&gt;
&lt;p&gt;文章写的有点粗糙，都是只描述了思想，没有去抠具体的细节部分，对这些项目的作者刚到敬仰，把一个理论上的技术用在工程上会遇到很多问题。如果文章中有不妥之处，欢迎去我的&lt;code class=&quot;language-text&quot;&gt;github&lt;/code&gt;提交 &lt;a href=&quot;https://github.com/lengrongfu/lengrongfu.github.io/issues&quot;&gt;issues&lt;/a&gt;.&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;倒排索引这个数据结构最先是用于搜索引擎的，搜索引擎就通过分析爬虫回来的页面，提取出关键字，记录下关键字对应网页的链接地址，做成一个哈希表，通过搜索关键字即可得到结果。这是理论定义上的倒排索引，工程上实现起来需要考虑很多问题，每个场景下实现的倒排索引都不太一样。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;整个倒排索引分两部分，左边是Term Dictionary(索引表，可简称为Dictionary)，是由一系列的Terms组成的；右边为Postings List(倒排表)，由所有的Term对应的Postings组成。&lt;/p&gt;
&lt;h2&gt;理论上的倒排索引&lt;/h2&gt;
&lt;blockquote&gt;
&lt;p&gt;实现一个简单的倒排索引，通过读取一个文件内容，构造好索引内容，此处用一个&lt;code class=&quot;language-text&quot;&gt;map&lt;/code&gt;来存储这个对应关系，通过关键字搜索时打印出对应的行数据。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;go&quot;&gt;&lt;pre class=&quot;language-go&quot;&gt;&lt;code class=&quot;language-go&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;package&lt;/span&gt; main

&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;
	&lt;span class=&quot;token string&quot;&gt;&quot;fmt&quot;&lt;/span&gt;
	&lt;span class=&quot;token string&quot;&gt;&quot;strings&quot;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;
    &lt;span class=&quot;token comment&quot;&gt;// 这段内容复制自es的网站&lt;/span&gt;
	Content &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;  &lt;span class=&quot;token string&quot;&gt;&quot;The QUICK brown foxes jumped over the lazy dog!\n&quot;&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;+&lt;/span&gt;
		       &lt;span class=&quot;token string&quot;&gt;&quot;An analyzer specified in the query itself.\n&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;+&lt;/span&gt;
			   &lt;span class=&quot;token string&quot;&gt;&quot;The search_analyzer mapping parameter.\n&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;+&lt;/span&gt;
		       &lt;span class=&quot;token string&quot;&gt;&quot;The analyzer mapping parameter.\n&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;+&lt;/span&gt;
			   &lt;span class=&quot;token string&quot;&gt;&quot;An analyzer in the index settings called default_search.\n&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;+&lt;/span&gt;
			   &lt;span class=&quot;token string&quot;&gt;&quot;An analyzer in the index settings called default.\n&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;+&lt;/span&gt;
			   &lt;span class=&quot;token string&quot;&gt;&quot;The standard analyzer&quot;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;var&lt;/span&gt; invertedIndex &lt;span class=&quot;token keyword&quot;&gt;map&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token builtin&quot;&gt;string&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token builtin&quot;&gt;string&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;func&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;main&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;  &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
	invertedIndex &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;make&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;map&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token builtin&quot;&gt;string&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token builtin&quot;&gt;string&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
	contents &lt;span class=&quot;token operator&quot;&gt;:=&lt;/span&gt; strings&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Split&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;Content&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;\n&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
	&lt;span class=&quot;token keyword&quot;&gt;for&lt;/span&gt; i &lt;span class=&quot;token operator&quot;&gt;:=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;range&lt;/span&gt; contents &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
		s &lt;span class=&quot;token operator&quot;&gt;:=&lt;/span&gt; contents&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;i&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;
		s &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; strings&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Trim&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;s&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;.!&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
		fields &lt;span class=&quot;token operator&quot;&gt;:=&lt;/span&gt; strings&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Fields&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;s&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
		&lt;span class=&quot;token keyword&quot;&gt;for&lt;/span&gt; j &lt;span class=&quot;token operator&quot;&gt;:=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;range&lt;/span&gt; fields &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
			field &lt;span class=&quot;token operator&quot;&gt;:=&lt;/span&gt; strings&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;ToLower&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;fields&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;j&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
			&lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;_&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;ok &lt;span class=&quot;token operator&quot;&gt;:=&lt;/span&gt; invertedIndex&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;field&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; ok &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
				invertedIndex&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;field&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;append&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;invertedIndex&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;field&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;s&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
			&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
				ss  &lt;span class=&quot;token operator&quot;&gt;:=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;make&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token builtin&quot;&gt;string&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
				ss&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; s
				invertedIndex&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;field&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; ss
			&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
		&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
	&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
	&lt;span class=&quot;token keyword&quot;&gt;var&lt;/span&gt; word &lt;span class=&quot;token builtin&quot;&gt;string&lt;/span&gt;
	&lt;span class=&quot;token keyword&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
		fmt&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Print&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;search word: &quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
		n&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; err &lt;span class=&quot;token operator&quot;&gt;:=&lt;/span&gt; fmt&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Scanln&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&amp;amp;&lt;/span&gt;word&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
		&lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; n &lt;span class=&quot;token operator&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;||&lt;/span&gt; err &lt;span class=&quot;token operator&quot;&gt;!=&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;nil&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
			&lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt;
		&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
		doc&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;ok &lt;span class=&quot;token operator&quot;&gt;:=&lt;/span&gt; invertedIndex&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;word&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;
		&lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;!&lt;/span&gt;ok &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
			fmt&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Println&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;no match&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
			&lt;span class=&quot;token keyword&quot;&gt;continue&lt;/span&gt;
		&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
		&lt;span class=&quot;token keyword&quot;&gt;for&lt;/span&gt; i &lt;span class=&quot;token operator&quot;&gt;:=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;range&lt;/span&gt; doc &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
			fmt&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Println&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;doc&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;i&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
		&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
	&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;如上就实现了一个简单的倒排索引，通过解析文本内容进行全文搜索，上面只是一个简单版本的搜索，工程中的需要考虑的就比较多了，首先分词器，不同的语言分词规则都不一样，中文、英文都不一样，还有是索引结构，有的用哈希表实现有的用树结构实现，文档内容存储和索引也是一个工程中难处理的问题。&lt;/p&gt;
&lt;h2&gt;Lucene 中的倒排索引&lt;/h2&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;Lucene&lt;/code&gt;把用于存储&lt;code class=&quot;language-text&quot;&gt;Term&lt;/code&gt;的索引文件叫&lt;code class=&quot;language-text&quot;&gt;Terms Index&lt;/code&gt;，它的后缀是&lt;code class=&quot;language-text&quot;&gt;.tip&lt;/code&gt;；把Postings信息分别存储在&lt;code class=&quot;language-text&quot;&gt;.doc&lt;/code&gt;、&lt;code class=&quot;language-text&quot;&gt;.pay&lt;/code&gt;、&lt;code class=&quot;language-text&quot;&gt;.pox&lt;/code&gt;，分别记录Postings的DocId信息和Term的词频、Payload信息、pox是记录位置信息。Terms Dictionary的文件后缀称为&lt;code class=&quot;language-text&quot;&gt;.tim&lt;/code&gt;，它是Term与Postings的关系纽带，存储了Term和其对应的Postings文件指针。&lt;/p&gt;
&lt;p&gt;总体来说，通过&lt;code class=&quot;language-text&quot;&gt;Terms Index(.tip)&lt;/code&gt;能够快速地在Terms Dictionary(.tim)中找到你的想要的Term，以及它对应的Postings文件指针与Term在Segment作用域上的统计信息。&lt;/p&gt;
&lt;p&gt;在&lt;code class=&quot;language-text&quot;&gt;Lucene&lt;/code&gt;中索引和搜索是不一样的，索引是指把&lt;code class=&quot;language-text&quot;&gt;Document&lt;/code&gt;进行分析，存入索引文件中，搜索是从索引文件中进行读取。&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;1.jpg&quot; alt=&quot;img&quot;&gt;&lt;/p&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;Lucene&lt;/code&gt;中的索引操作比较复杂，因为操作的数据量非常大，所以进行了多部索引处理，文件索引到文件就是一个小型的文件系统，倒排索引再映射到文件索引上。为了查找快速。&lt;/p&gt;
&lt;p&gt;文件索引应该是记录了整个文档的开始位置和结束为止，比如下：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;数据文件：test.data&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;1:the man is like dog2:this is a man3:this is a dog&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;文件索引文件&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;1:[2-19]
2:[22-32]
3:[35-48] # 记录的就是数据文件中的具体偏移量&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;倒排索引记录&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;[the](1,1)
[man](1,2)(2,4)
[is](1,3),(2,2),(3,2) # stopwords
[like](1,4)
[dog](1,5),(3,4)&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;上面大概的描述了&lt;code class=&quot;language-text&quot;&gt;Lucene&lt;/code&gt;的存储结构，真实的有很多改进，比如数据文件有压缩，文件索引也有压缩。&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;/var/folders/rh/szl5pw3171d5x6ntky_249g80000gn/T/abnerworks.Typora/image-20190319140311238.png&quot; alt=&quot;image-20190319140311238&quot;&gt;&lt;/p&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;Lucene&lt;/code&gt;对于删除操作，不直接删除索引，而是通过标记为一删除操作。&lt;/p&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;Lucene&lt;/code&gt;中还有一个正向索引，用于存储&lt;code class=&quot;language-text&quot;&gt;DocId&lt;/code&gt;和文档全部的内容。&lt;/p&gt;
&lt;h3&gt;参考&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;http://www.nosqlnotes.com/technotes/searchengine/lucene-invertedindex-3/&quot;&gt;Lucene倒排索引实现原理探秘&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://sease.io/2015/07/exploring-solr-internals-lucene.html&quot;&gt;solr 倒排索引&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h2&gt;Mysql Full index 全文索引中的倒排索引&lt;/h2&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;InnoDB&lt;/code&gt;全文索引是基于倒排索引设计的，倒排索引存储了一个单词对应的列表(倒排列表)，还存储了每个字在文档中的位置信息，作为偏移量。这就是一个用空间换时间的办法。&lt;/p&gt;
&lt;h3&gt;InnoDB 全文索引表&lt;/h3&gt;
&lt;p&gt;创建&lt;code class=&quot;language-text&quot;&gt;InnoDB FullText&lt;/code&gt;索引时，会创建一组索引表：&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;mysql&quot;&gt;&lt;pre class=&quot;language-mysql&quot;&gt;&lt;code class=&quot;language-mysql&quot;&gt;mysql&amp;gt; CREATE TABLE opening_lines (
       id INT UNSIGNED AUTO_INCREMENT NOT NULL PRIMARY KEY,
       opening_line TEXT(500),
       author VARCHAR(200),
       title VARCHAR(200),
       FULLTEXT idx (opening_line)
       ) ENGINE=InnoDB;
# 查看本地的辅助索引文件       
mysql&amp;gt; SELECT table_id, name, space from INFORMATION_SCHEMA.INNODB_SYS_TABLES
       WHERE name LIKE &amp;#39;test/%&amp;#39;;       
4128	test/FTS_000000000000101a_0000000000002049_INDEX_1	4112
4129	test/FTS_000000000000101a_0000000000002049_INDEX_2	4113
4130	test/FTS_000000000000101a_0000000000002049_INDEX_3	4114
4131	test/FTS_000000000000101a_0000000000002049_INDEX_4	4115
4132	test/FTS_000000000000101a_0000000000002049_INDEX_5	4116
4133	test/FTS_000000000000101a_0000000000002049_INDEX_6	4117&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;InnoDB&lt;/code&gt;使用实现的是&lt;code class=&quot;language-text&quot;&gt;Full inverted index&lt;/code&gt;，存储了单词对应的位置信息和&lt;code class=&quot;language-text&quot;&gt;DocId&lt;/code&gt;。这就是&lt;code class=&quot;language-text&quot;&gt;Mysql&lt;/code&gt;实现倒排索引的数据结构。&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;/var/folders/rh/szl5pw3171d5x6ntky_249g80000gn/T/abnerworks.Typora/image-20190319134843287.png&quot; alt=&quot;image-20190319134843287&quot;&gt;&lt;/p&gt;
&lt;p&gt;把上图进行索引之后存储的结构就是如下图，比如单词&lt;code class=&quot;language-text&quot;&gt;days&lt;/code&gt;，值为&lt;code class=&quot;language-text&quot;&gt;(3:2),(6:2)&lt;/code&gt;意思是&lt;code class=&quot;language-text&quot;&gt;DocId&lt;/code&gt;为&lt;code class=&quot;language-text&quot;&gt;3&lt;/code&gt;中的第二个单词和&lt;code class=&quot;language-text&quot;&gt;DocId&lt;/code&gt;为&lt;code class=&quot;language-text&quot;&gt;6&lt;/code&gt;中的第二个单词。&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;/var/folders/rh/szl5pw3171d5x6ntky_249g80000gn/T/abnerworks.Typora/image-20190319134808582.png&quot; alt=&quot;image-20190319134808582&quot;&gt;&lt;/p&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;InnoDB&lt;/code&gt;在内存中维护了一个&lt;code class=&quot;language-text&quot;&gt;FTS Index Cache&lt;/code&gt;全文检索缓存系统，在提交事务或者时超过&lt;code class=&quot;language-text&quot;&gt;32m&lt;/code&gt;时就进行合并到&lt;code class=&quot;language-text&quot;&gt;Auxiliary Table&lt;/code&gt;辅助索引表中；&lt;/p&gt;
&lt;p&gt;在插入或者删除时都是对缓存系统进行操作，删除也是知识记录，不直接进行删除操作。&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;/var/folders/rh/szl5pw3171d5x6ntky_249g80000gn/T/abnerworks.Typora/image-20190319141910280.png&quot; alt=&quot;image-20190319141910280&quot;&gt;&lt;/p&gt;
&lt;h3&gt;参考&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https://dev.mysql.com/doc/refman/5.6/en/innodb-fulltext-index.html&quot;&gt;Mysql 全文索引设计&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h2&gt;Prometheus 中的倒排索引&lt;/h2&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;Prometheus&lt;/code&gt;2.0 版本中也使用了倒排索引来做搜索，架构和&lt;code class=&quot;language-text&quot;&gt;Lucene&lt;/code&gt;很相似，都是按时间分割，然后再合并，都是小文件合并为大文件，小索引合并为大索引，索引使用的不是&lt;code class=&quot;language-text&quot;&gt;hashmap&lt;/code&gt;结构，而是使用&lt;code class=&quot;language-text&quot;&gt;LSM&lt;/code&gt;数据结构。未完全看完，后面看完了之后再补上。&lt;/p&gt;
&lt;h2&gt;总结&lt;/h2&gt;
&lt;p&gt;基于&lt;code class=&quot;language-text&quot;&gt;B+tree&lt;/code&gt;实现的倒排索引会有性能问题，在写入时非常消耗&lt;code class=&quot;language-text&quot;&gt;IO&lt;/code&gt;,因为要进行排序并移动其他节点，&lt;code class=&quot;language-text&quot;&gt;Lucene&lt;/code&gt;的这种方式可以实现更高的并发性。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Mysql 的倒排是基于红黑树实现的&lt;/li&gt;
&lt;li&gt;Lucene 是通过不断的创建小的索引文件，然后定期的把小的索引文件合并为一个大的索引文件。&lt;/li&gt;
&lt;/ul&gt;</content:encoded></item><item><title><![CDATA[PromQL 常用命令]]></title><description><![CDATA[PromQL…]]></description><link>https://lengrongfu.github.io/2019-03-17-PromQL-常用命令/</link><guid isPermaLink="false">https://lengrongfu.github.io/2019-03-17-PromQL-常用命令/</guid><pubDate>Sun, 17 Mar 2019 16:40:42 GMT</pubDate><content:encoded>&lt;h1&gt;PromQL 常用命令&lt;/h1&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;PromQL&lt;/code&gt;可以非常方便的对监控样本数据进行统计分析，&lt;code class=&quot;language-text&quot;&gt;PromQL&lt;/code&gt;支持常见运算符和一些内置的函数，监控告警也是依赖&lt;code class=&quot;language-text&quot;&gt;PromQL&lt;/code&gt;实现的。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2&gt;时间序列&lt;/h2&gt;
&lt;p&gt;在时间序列中，每一个点称之为样本，每个样本由三部分组成：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;指标：由指标名称和描述指标的级别组成的。&lt;/li&gt;
&lt;li&gt;时间戳：一个精确到毫秒级别的时间戳&lt;/li&gt;
&lt;li&gt;值：一个&lt;code class=&quot;language-text&quot;&gt;float64&lt;/code&gt;位的值&lt;/li&gt;
&lt;/ul&gt;
&lt;blockquote&gt;
&lt;p&gt;&amp;#x3C;--------------- metric ---------------------&gt;&amp;#x3C;-timestamp -&gt;&amp;#x3C;-value-&gt;&lt;/p&gt;
&lt;p&gt;http_request_total{status=“200”, method=“GET”}@1434417560938 =&gt; 94355&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h3&gt;指标&lt;/h3&gt;
&lt;p&gt;形式上所有的指标都是由如下的格式标示：&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;metric name&gt;{&lt;label name&gt;=&lt;label value&gt;, …}&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;在&lt;code class=&quot;language-text&quot;&gt;Prometheus&lt;/code&gt;的底层实现中指标名称实际上是以&lt;code class=&quot;language-text&quot;&gt;__name__=&amp;lt;metric name&gt;&lt;/code&gt;的形式保存在数据库中的。&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;api_http_requests_total{method=“POST”, handler=“/messages”}&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;等价于&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;{&lt;strong&gt;name&lt;/strong&gt;=“api_http_requests_total”，method=“POST”, handler=“/messages”}&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;所以底层存储的是&lt;code class=&quot;language-text&quot;&gt;map[string]string&lt;/code&gt;.如下是&lt;code class=&quot;language-text&quot;&gt;Promtheus&lt;/code&gt;中的&lt;code class=&quot;language-text&quot;&gt;Metric&lt;/code&gt;的源码。&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;go&quot;&gt;&lt;pre class=&quot;language-go&quot;&gt;&lt;code class=&quot;language-go&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;type&lt;/span&gt; Metric LabelSet

&lt;span class=&quot;token keyword&quot;&gt;type&lt;/span&gt; LabelSet &lt;span class=&quot;token keyword&quot;&gt;map&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;LabelName&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;LabelValue

&lt;span class=&quot;token keyword&quot;&gt;type&lt;/span&gt; LabelName &lt;span class=&quot;token builtin&quot;&gt;string&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;type&lt;/span&gt; LabelValue &lt;span class=&quot;token builtin&quot;&gt;string&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h3&gt;Metric 类型&lt;/h3&gt;
&lt;blockquote&gt;
&lt;p&gt;每一种指标标示的意义都不一样，因此对应的类型不一样，比如系统负载是随着时间变化而变化的值，cpu使用时间是一个一直递增的值，只要系统不重启。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;ul&gt;
&lt;li&gt;Counter：只增不减的计数器&lt;/li&gt;
&lt;li&gt;Gauge：可增可减的仪表盘&lt;/li&gt;
&lt;li&gt;Histogram和Summary分析数据分布情况 （没讲清楚）&lt;/li&gt;
&lt;/ul&gt;
&lt;h2&gt;初识PromQL&lt;/h2&gt;
&lt;h3&gt;运算符&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;等于：&lt;code class=&quot;language-text&quot;&gt;http_requests_total{instance=&quot;localhost:9090&quot;}&lt;/code&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;不等于：&lt;code class=&quot;language-text&quot;&gt;http_requests_total{instance!=&quot;localhost:9090&quot;}&lt;/code&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;匹配：&lt;code class=&quot;language-text&quot;&gt;http_requests_total{environment=~&quot;staging|testing|development&quot;,method!=&quot;GET&quot;}&lt;/code&gt; 多个值用&lt;code class=&quot;language-text&quot;&gt;|&lt;/code&gt;连接。&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;排除：&lt;code class=&quot;language-text&quot;&gt;http_requests_total{environment!~&quot;staging|testing|development&quot;,method!=&quot;GET&quot;}&lt;/code&gt;不存在这几个值之间。&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;范围查询：&lt;code class=&quot;language-text&quot;&gt;http_request_total{}[5m]&lt;/code&gt; &lt;code class=&quot;language-text&quot;&gt;5m&lt;/code&gt;以内的数据，这叫区间数据，还有瞬时数据，只返回最近的一条&lt;code class=&quot;language-text&quot;&gt;http_request_total{}&lt;/code&gt;。还支持如下的时间范围查询。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;s - 秒&lt;/li&gt;
&lt;li&gt;m - 分钟&lt;/li&gt;
&lt;li&gt;h - 小时&lt;/li&gt;
&lt;li&gt;d - 天&lt;/li&gt;
&lt;li&gt;w - 周&lt;/li&gt;
&lt;li&gt;y - 年&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;时间位移：选择一个参考点，上面的范围查询都是使用的是当前的时间值，位移操作的关键字为&lt;code class=&quot;language-text&quot;&gt;offset&lt;/code&gt;&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;http_request_total{} offset 5m
http_request_total{}[1d] offset 1d&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;聚合操作：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;sum&lt;/code&gt;函数：对指标进行求和，如：&lt;code class=&quot;language-text&quot;&gt;sum(http_request_total)&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;avg&lt;/code&gt;函数：对指标进行求平均值。&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h2&gt;操作符&lt;/h2&gt;
&lt;h3&gt;运算符&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;+&lt;/code&gt; (加法)&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;-&lt;/code&gt; (减法)&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;*&lt;/code&gt; (乘法)&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;/&lt;/code&gt; (除法)&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;%&lt;/code&gt; (求余)&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;^&lt;/code&gt; (幂运算)&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;当瞬时向量与标量之间进行数学运算时，数学运算符会依次作用域瞬时向量中的每一个样本值，从而得到一组新的时间序列。如&lt;/p&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;node_memory_free_bytes_total / (1024 * 1024)&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;如果是瞬时向量与瞬时向量之间进行数学运算时，左边向量元素匹配（标签完全一致）右边向量元素，如果没找到匹配元素，则直接抛弃。如下两个指标进行相加操作，唯一不同的就是值，连时间戳都是一样的。&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;{device=&quot;sda&quot;,instance=&quot;localhost:9100&quot;,job=&quot;node_exporter&quot;}=&gt;1634967552@1518146427.807 + 864551424@1518146427.807
{device=&quot;sdb&quot;,instance=&quot;localhost:9100&quot;,job=&quot;node_exporter&quot;}=&gt;0@1518146427.807 + 1744384@1518146427.807
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h3&gt;布尔运算&lt;/h3&gt;
&lt;p&gt;瞬时向量与标量进行布尔运算时，&lt;code class=&quot;language-text&quot;&gt;PromQL&lt;/code&gt;依次比较向量中的所有时间序列样本的值，如果比较结果为&lt;code class=&quot;language-text&quot;&gt;true&lt;/code&gt;则保留，反之丢弃。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;==&lt;/code&gt; (相等)&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;!=&lt;/code&gt; (不相等)&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;&gt;&lt;/code&gt; (大于)&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;&amp;lt;&lt;/code&gt; (小于)&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;&gt;=&lt;/code&gt; (大于等于)&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;&amp;lt;=&lt;/code&gt; (小于等于)&lt;/li&gt;
&lt;li&gt;瞬时向量和标量直接进行比较&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;img src=&quot;/var/folders/rh/szl5pw3171d5x6ntky_249g80000gn/T/abnerworks.Typora/image-20190311232353111.png&quot; alt=&quot;image-20190311232353111&quot;&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;瞬时向量和瞬时向量之间的比较&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;img src=&quot;/var/folders/rh/szl5pw3171d5x6ntky_249g80000gn/T/abnerworks.Typora/image-20190311232718573.png&quot; alt=&quot;image-20190311232718573&quot;&gt;&lt;/p&gt;
&lt;h3&gt;bool 修饰符&lt;/h3&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;bool&lt;/code&gt;修饰符，使用&lt;code class=&quot;language-text&quot;&gt;bool&lt;/code&gt;修改符后，布尔运算不会对时间序列进行过滤，而是直接依次瞬时向量中的各个样本数据与标量的比较结果&lt;code class=&quot;language-text&quot;&gt;0&lt;/code&gt;或者&lt;code class=&quot;language-text&quot;&gt;1&lt;/code&gt;。从而形成一条新的时间序列.和上面的图进行对比。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;瞬时向量和标量之间比较进行&lt;code class=&quot;language-text&quot;&gt;bool&lt;/code&gt;修饰&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;img src=&quot;/var/folders/rh/szl5pw3171d5x6ntky_249g80000gn/T/abnerworks.Typora/image-20190311232525778.png&quot; alt=&quot;image-20190311232525778&quot;&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;瞬时向量和瞬时向量之间的比较&lt;code class=&quot;language-text&quot;&gt;bool&lt;/code&gt;修饰&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;/var/folders/rh/szl5pw3171d5x6ntky_249g80000gn/T/abnerworks.Typora/image-20190311233001465.png&quot; alt=&quot;image-20190311233001465&quot;&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h3&gt;集合运行&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;and&lt;/code&gt; (并且)&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;or&lt;/code&gt; (或者)&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;unless&lt;/code&gt; (排除)&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;vector1 and vector2&lt;/strong&gt; 会产生一个由vector1的元素组成的新的向量。该向量包含vector1中完全匹配vector2中的元素组成。&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;vector1 or vector2&lt;/strong&gt; 会产生一个新的向量，该向量包含vector1中所有的样本数据，以及vector2中没有与vector1匹配到的样本数据。&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;vector1 unless vector2&lt;/strong&gt; 会产生一个新的向量，新向量中的元素由vector1中没有与vector2匹配的元素组成。&lt;/p&gt;
&lt;h3&gt;操作符优先级&lt;/h3&gt;
&lt;p&gt;如下计算每个实例上每个核心&lt;code class=&quot;language-text&quot;&gt;cpu&lt;/code&gt;的使用率:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;go&quot;&gt;&lt;pre class=&quot;language-go&quot;&gt;&lt;code class=&quot;language-go&quot;&gt;&lt;span class=&quot;token number&quot;&gt;100&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;avg&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;irate&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;node_cpu_seconds_total&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;mode&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;idle&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;5&lt;/span&gt;m&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; by &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;instance&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;cpu&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;在PromQL操作符中优先级由高到低依次为&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;^&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;*, /, %&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;+, -&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;==, !=, &amp;lt;=, &amp;lt;, &gt;=, &gt;&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;and, unless&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;or&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h3&gt;向量匹配模式详解&lt;/h3&gt;
&lt;p&gt;向量与向量之间运算时会基于默认的匹配规则，依次找到右边边向量元素和左边向量元素匹配(标签完全一致)的进行运算，不匹配则丢弃。在&lt;code class=&quot;language-text&quot;&gt;PromQL&lt;/code&gt;中有两种典型的匹配模式。&lt;/p&gt;
&lt;h4&gt;一对一（one to one）&lt;/h4&gt;
&lt;p&gt;一对一匹配模式会从操作符两边获取瞬时向量依次比较并找到唯一匹配的样本值，使用的表达式如下：&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;vector1 &amp;lt;operator&gt; vector2&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;在操作符两边表达式标签不一致的情况下，可以使用&lt;code class=&quot;language-text&quot;&gt;on(label list)&lt;/code&gt;或者&lt;code class=&quot;language-text&quot;&gt;ignoring(label list）&lt;/code&gt;来修改便签的匹配行为。使用&lt;code class=&quot;language-text&quot;&gt;ignoreing&lt;/code&gt;可以在匹配时忽略某些便签。而&lt;code class=&quot;language-text&quot;&gt;on&lt;/code&gt;则用于将匹配行为限定在某些便签之内。&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;&amp;lt;vector expr&gt; &amp;lt;bin-op&gt; ignoring(&amp;lt;label list&gt;) &amp;lt;vector expr&gt;
&amp;lt;vector expr&gt; &amp;lt;bin-op&gt; on(&amp;lt;label list&gt;) &amp;lt;vector expr&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;例如当存在样本：&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;method_code:http_errors:rate5m{method=&quot;get&quot;, code=&quot;500&quot;}  24
method_code:http_errors:rate5m{method=&quot;get&quot;, code=&quot;404&quot;}  30
method_code:http_errors:rate5m{method=&quot;put&quot;, code=&quot;501&quot;}  3
method_code:http_errors:rate5m{method=&quot;post&quot;, code=&quot;500&quot;} 6
method_code:http_errors:rate5m{method=&quot;post&quot;, code=&quot;404&quot;} 21


method:http_requests:rate5m{method=&quot;get&quot;}  600
method:http_requests:rate5m{method=&quot;del&quot;}  34
method:http_requests:rate5m{method=&quot;post&quot;} 120&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;使用PromQL表达式：使用了&lt;code class=&quot;language-text&quot;&gt;ignoring&lt;/code&gt;之后忽略了第一组向量的&lt;code class=&quot;language-text&quot;&gt;code&lt;/code&gt;标签，这样就和第二组向量拥有一样的标签了。&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;method_code:http_errors:rate5m{code=&quot;500&quot;} / ignoring(code) method:http_requests:rate5m&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;该表达式会返回在过去5分钟内，HTTP请求状态码为&lt;code class=&quot;language-text&quot;&gt;500&lt;/code&gt;的在所有请求中的比例。如果没有使用&lt;code class=&quot;language-text&quot;&gt;ignoring(code)&lt;/code&gt;，操作符两边表达式返回的瞬时向量中将找不到任何一个标签完全相同的匹配项。&lt;/p&gt;
&lt;p&gt;因此结果如下：&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;{method=&quot;get&quot;}  0.04            //  24 / 600
{method=&quot;post&quot;} 0.05            //   6 / 120&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;同时由于&lt;code class=&quot;language-text&quot;&gt;method&lt;/code&gt;为&lt;code class=&quot;language-text&quot;&gt;put&lt;/code&gt;和&lt;code class=&quot;language-text&quot;&gt;del&lt;/code&gt;的样本找不到匹配项，因此不会出现在结果当中。&lt;/p&gt;
&lt;h4&gt;多对一和一对多&lt;/h4&gt;
&lt;p&gt;多对一和一对多两种匹配模式指的是“一”侧的每一个向量元素可以与”多”侧的多个元素匹配的情况。在这种情况下，必须使用&lt;code class=&quot;language-text&quot;&gt;group&lt;/code&gt;修饰符：&lt;code class=&quot;language-text&quot;&gt;group_left&lt;/code&gt;或者&lt;code class=&quot;language-text&quot;&gt;group_right&lt;/code&gt;来确定哪一个向量具有更高的基数（充当“多”的角色）。&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;&amp;lt;vector expr&gt; &amp;lt;bin-op&gt; ignoring(&amp;lt;label list&gt;) group_left(&amp;lt;label list&gt;) &amp;lt;vector expr&gt;
&amp;lt;vector expr&gt; &amp;lt;bin-op&gt; ignoring(&amp;lt;label list&gt;) group_right(&amp;lt;label list&gt;) &amp;lt;vector expr&gt;
&amp;lt;vector expr&gt; &amp;lt;bin-op&gt; on(&amp;lt;label list&gt;) group_left(&amp;lt;label list&gt;) &amp;lt;vector expr&gt;
&amp;lt;vector expr&gt; &amp;lt;bin-op&gt; on(&amp;lt;label list&gt;) group_right(&amp;lt;label list&gt;) &amp;lt;vector expr&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;多对一和一对多两种模式一定是出现在操作符两侧表达式返回的向量标签不一致的情况。因此需要使用&lt;code class=&quot;language-text&quot;&gt;ignoring&lt;/code&gt;和&lt;code class=&quot;language-text&quot;&gt;on&lt;/code&gt;修饰符来排除或者限定匹配的标签列表。&lt;/p&gt;
&lt;p&gt;例如,使用表达式：&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;method_code:http_errors:rate5m / ignoring(code) group_left method:http_requests:rate5m&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;该表达式中，左向量&lt;code class=&quot;language-text&quot;&gt;method_code:http_errors:rate5m&lt;/code&gt;包含两个标签&lt;code class=&quot;language-text&quot;&gt;method&lt;/code&gt;和&lt;code class=&quot;language-text&quot;&gt;code&lt;/code&gt;。而右向量&lt;code class=&quot;language-text&quot;&gt;method:http_requests:rate5m&lt;/code&gt;中只包含一个标签&lt;code class=&quot;language-text&quot;&gt;method&lt;/code&gt;，因此匹配时需要使用&lt;code class=&quot;language-text&quot;&gt;ignoring&lt;/code&gt;限定匹配的标签为code。 在限定匹配标签后，右向量中的元素可能匹配到多个左向量中的元素 因此该表达式的匹配模式为多对一，需要使用&lt;code class=&quot;language-text&quot;&gt;group&lt;/code&gt;修饰符&lt;code class=&quot;language-text&quot;&gt;group_left&lt;/code&gt;指定左向量具有更好的基数。&lt;/p&gt;
&lt;p&gt;最终的运算结果如下：&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;{method=&quot;get&quot;, code=&quot;500&quot;}  0.04            //  24 / 600
{method=&quot;get&quot;, code=&quot;404&quot;}  0.05            //  30 / 600
{method=&quot;post&quot;, code=&quot;500&quot;} 0.05            //   6 / 120
{method=&quot;post&quot;, code=&quot;404&quot;} 0.175           //  21 / 120&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;blockquote&gt;
&lt;p&gt;提醒：&lt;code class=&quot;language-text&quot;&gt;group&lt;/code&gt;修饰符只能在比较和数学运算符中使用。在逻辑运算&lt;code class=&quot;language-text&quot;&gt;and&lt;/code&gt;,&lt;code class=&quot;language-text&quot;&gt;unless&lt;/code&gt;和&lt;code class=&quot;language-text&quot;&gt;or&lt;/code&gt;中默认与右向量中的所有元素进行匹配。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2&gt;聚合操作&lt;/h2&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;Prometheus&lt;/code&gt;提供了一些内置的聚合操作符，这些操作符只能作用于瞬时向量，可以将瞬时表达式返回的样本数据进行聚合，形成一个新的时间序列。内置的聚合函数如下：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;sum&lt;/code&gt; (求和)&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;min&lt;/code&gt; (最小值)&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;max&lt;/code&gt; (最大值)&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;avg&lt;/code&gt; (平均值)&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;stddev&lt;/code&gt; (标准差)&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;stdvar&lt;/code&gt; (标准差异)&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;count&lt;/code&gt; (计数)&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;count_values&lt;/code&gt; (对value进行计数)&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;bottomk&lt;/code&gt; (后n条时序)&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;topk&lt;/code&gt; (前n条时序)&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;quantile&lt;/code&gt; (分布统计)&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;使用聚合操作的语法如下：&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;&amp;lt;aggr-op&gt;([parameter,] &amp;lt;vector expression&gt;) [without|by (&amp;lt;label list&gt;)]&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;其中只有&lt;code class=&quot;language-text&quot;&gt;count_values&lt;/code&gt;, &lt;code class=&quot;language-text&quot;&gt;quantile&lt;/code&gt;, &lt;code class=&quot;language-text&quot;&gt;topk&lt;/code&gt;, &lt;code class=&quot;language-text&quot;&gt;bottomk&lt;/code&gt;支持参数(parameter)。&lt;code class=&quot;language-text&quot;&gt;aggr-op&lt;/code&gt;就是上面的聚合函数。&lt;/p&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;without&lt;/code&gt;用于移除计算结果中的标签,&lt;code class=&quot;language-text&quot;&gt;by&lt;/code&gt;则相反，只保留此标签。通过&lt;code class=&quot;language-text&quot;&gt;without&lt;/code&gt;和&lt;code class=&quot;language-text&quot;&gt;by&lt;/code&gt;可以按照样本的问题对数据进行聚合。&lt;/p&gt;
&lt;h2&gt;PromQL 内置函数&lt;/h2&gt;
&lt;h3&gt;计算&lt;code class=&quot;language-text&quot;&gt;Counter&lt;/code&gt;类型的指标增长率&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;increase(v range-vector)&lt;/code&gt;函数：获取区间向量的增长量，&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;rate(v range-vector)&lt;/code&gt;函数：rate函数可以直接计算区间向量v在时间窗口内平均增长速率&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;rate(node_cpu[2m])
increase(node_cpu[2m]) / 120 
上面的两个计算结果是一致的，increase(node_cpu[2m])获取的是两分钟之内的增长量，除以120s之后得到的就是两分钟之间的平均增长率。&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;irate(v range-vector)&lt;/code&gt;函数：&lt;code class=&quot;language-text&quot;&gt;irate&lt;/code&gt;函数是通过区间向量中最后两个两本数据来计算区间向量的增长速率,计算的是一个瞬时增长速率。&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h3&gt;预测Gauge指标变化趋势&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;predict_linear(v range-vector, t scalar)&lt;/code&gt;函数：基于简单的线性回归的方式进行&lt;code class=&quot;language-text&quot;&gt;t&lt;/code&gt;秒后的&lt;code class=&quot;language-text&quot;&gt;v&lt;/code&gt;值的预测。&lt;/li&gt;
&lt;/ul&gt;
&lt;h2&gt;源码解读&lt;/h2&gt;</content:encoded></item><item><title><![CDATA[Prometheus 初探一]]></title><description><![CDATA[Prometheus 初探一 概述 主要特性 由指标名和对确定的一个多维的时序数据模型。 ，灵活的查询语言，以利用此纬度。 不依赖分布式存储，单个服务节点是可用的。 时间序列集合通过HTTP…]]></description><link>https://lengrongfu.github.io/2019-03-16-Prometheus-1/</link><guid isPermaLink="false">https://lengrongfu.github.io/2019-03-16-Prometheus-1/</guid><pubDate>Sat, 16 Mar 2019 10:29:27 GMT</pubDate><content:encoded>&lt;h1&gt;&lt;a href=&quot;https://github.com/prometheus&quot;&gt;Prometheus&lt;/a&gt; 初探一&lt;/h1&gt;
&lt;h2&gt;概述&lt;/h2&gt;
&lt;h3&gt;主要特性&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;由指标名和&lt;code class=&quot;language-text&quot;&gt;k/v&lt;/code&gt;对确定的一个多维的时序数据模型。&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;PromQL&lt;/code&gt;，灵活的查询语言，以利用此纬度。&lt;/li&gt;
&lt;li&gt;不依赖分布式存储，单个服务节点是可用的。&lt;/li&gt;
&lt;li&gt;时间序列集合通过HTTP上的拉模型发生。&lt;/li&gt;
&lt;li&gt;推送时许数据可通过中间网关支持。&lt;/li&gt;
&lt;li&gt;可通过服务发现或者静态配置发现目标。&lt;/li&gt;
&lt;li&gt;多种图形和仪表板支持模式。&lt;/li&gt;
&lt;/ul&gt;
&lt;h3&gt;组件&lt;/h3&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;Prometheus&lt;/code&gt;生态系统由多个系统组件组成，其中许多组件是可选的。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;Prometheus server&lt;/code&gt;用于存储时许数据。&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://prometheus.io/docs/instrumenting/clientlibs/&quot;&gt;client libraries &lt;/a&gt; 用于检测应用程序代码的客户端库。&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://github.com/prometheus/pushgateway&quot;&gt;push gateway &lt;/a&gt; 用于支持简短的任务。&lt;/li&gt;
&lt;li&gt;针对HAProxy，StatsD，Graphite等服务的特殊&lt;code class=&quot;language-text&quot;&gt;exporters&lt;/code&gt;.&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://github.com/prometheus/alertmanager&quot;&gt;alertmanager&lt;/a&gt; 处理&lt;code class=&quot;language-text&quot;&gt;alter&lt;/code&gt;。&lt;/li&gt;
&lt;li&gt;其他支持工具。&lt;/li&gt;
&lt;/ul&gt;
&lt;h3&gt;架构&lt;/h3&gt;
&lt;p&gt;该图说明了&lt;code class=&quot;language-text&quot;&gt;Prometheus&lt;/code&gt;的体系结构及其一些生态系统组件。&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://prometheus.io/assets/architecture.png&quot; alt=&quot;Prometheus architecture&quot;&gt;&lt;/p&gt;
&lt;h3&gt;什么时候适用&lt;/h3&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;Prometheus&lt;/code&gt;非常适合用来记录数字的时许数据，它适用于以机器为中心的监控以及高度动态的面向服务架构的监控，它对多维数据收集和查询的支持是一种特殊的优势，&lt;/p&gt;
&lt;h3&gt;什么时候不适用&lt;/h3&gt;
&lt;p&gt;如果需要收集&lt;code class=&quot;language-text&quot;&gt;100%&lt;/code&gt;的数据，并且系统出问题时也能正常的工作的话，&lt;code class=&quot;language-text&quot;&gt;Prometheus&lt;/code&gt;是不适用的，因为&lt;code class=&quot;language-text&quot;&gt;Prometheus&lt;/code&gt;收集数据时可能会丢失数据。&lt;/p&gt;
&lt;h2&gt;Prometheus 第一步&lt;/h2&gt;
&lt;p&gt;下载相关平台的最新稳定版,&lt;code class=&quot;language-text&quot;&gt;https://github.com/prometheus/prometheus/releases/download/v2.7.2/prometheus-2.7.2.linux-amd64.tar.gz &lt;/code&gt;。&lt;/p&gt;
&lt;blockquote&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;shell&quot;&gt;&lt;pre class=&quot;language-shell&quot;&gt;&lt;code class=&quot;language-shell&quot;&gt;&lt;span class=&quot;token function&quot;&gt;tar&lt;/span&gt; xvfz prometheus-*.tar.gz
&lt;span class=&quot;token builtin class-name&quot;&gt;cd&lt;/span&gt; prometheus-*&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;/blockquote&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt; Prometheus server&lt;/code&gt;再&lt;code class=&quot;language-text&quot;&gt;linux&lt;/code&gt;平台下是一个可执行的二进制文件，可以运行&lt;code class=&quot;language-text&quot;&gt; Prometheus&lt;/code&gt;命令来查看帮助命令。&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;[&lt;a href=&quot;mailto:developer@prometheus-2.7.2.linux-amd64&quot;&gt;developer@prometheus-2.7.2.linux-amd64&lt;/a&gt;]$ ./prometheus —help&lt;/p&gt;
&lt;p&gt;usage: prometheus [&lt;flags&gt;]&lt;/p&gt;
&lt;p&gt;The Prometheus monitoring server&lt;/p&gt;
&lt;p&gt;Flags:&lt;/p&gt;
&lt;p&gt;-h, —help                     Show context-sensitive help (also try —help-long and —help-man).&lt;/p&gt;
&lt;p&gt;​      —version                  Show application version.&lt;/p&gt;
&lt;p&gt;​      —config.file=“prometheus.yml”&lt;/p&gt;
&lt;p&gt;​                                 Prometheus configuration file path.&lt;/p&gt;
&lt;p&gt;​      —web.listen-address=“0.0.0.0:9090”&lt;/p&gt;
&lt;p&gt;​                                 Address to listen on for UI, API, and telemetry.&lt;/p&gt;
&lt;p&gt;​      —web.read-timeout=5m      Maximum duration before timing out read of the request, and closing idle connections.&lt;/p&gt;
&lt;p&gt;​      —web.max-connections=512  Maximum number of simultaneous connections.&lt;/p&gt;
&lt;p&gt;​      —web.external-url=&lt;URL&gt;   The URL under which Prometheus is externally reachable (for example, if Prometheus is served via a reverse proxy). Used for generating relative and absolute links back to&lt;/p&gt;
&lt;p&gt;​                                 Prometheus itself. If the URL has a path portion, it will be used to prefix all HTTP endpoints served by Prometheus. If omitted, relevant URL components will be derived&lt;/p&gt;
&lt;p&gt;​                                 automatically.&lt;/p&gt;
&lt;p&gt;​      —web.route-prefix=&lt;path&gt;  Prefix for the internal routes of web endpoints. Defaults to path of —web.external-url.&lt;/p&gt;
&lt;p&gt;​      —web.user-assets=&lt;path&gt;   Path to static asset directory, available at /user.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h3&gt;配置prometheus&lt;/h3&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;prometheus&lt;/code&gt;通过&lt;code class=&quot;language-text&quot;&gt;prometheus.yml&lt;/code&gt;来进行配置。&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;global:&lt;/p&gt;
&lt;p&gt;scrape_interval:     15s # Set the scrape interval to every 15 seconds. Default is every 1 minute.&lt;/p&gt;
&lt;p&gt;evaluation_interval: 15s # Evaluate rules every 15 seconds. The default is every 1 minute.&lt;/p&gt;
&lt;p&gt;alerting:&lt;/p&gt;
&lt;p&gt;alertmanagers:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;static_configs:&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;​    - targets:&lt;/p&gt;
&lt;p&gt;rule_files:&lt;/p&gt;
&lt;p&gt;scrape_configs:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;job_name: ‘prometheus’&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;​    static_configs:&lt;/p&gt;
&lt;p&gt;​    - targets: [‘localhost:9090’]&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;配置由四个模块组成，&lt;code class=&quot;language-text&quot;&gt;global&lt;/code&gt;,&lt;code class=&quot;language-text&quot;&gt;alerting&lt;/code&gt;,&lt;code class=&quot;language-text&quot;&gt;rule_files&lt;/code&gt;，&lt;code class=&quot;language-text&quot;&gt;scrape_configs&lt;/code&gt;.这个&lt;code class=&quot;language-text&quot;&gt;global&lt;/code&gt;模块用于配置&lt;code class=&quot;language-text&quot;&gt;prometheus server&lt;/code&gt;的全局配置，有两个选择，&lt;code class=&quot;language-text&quot;&gt;scrape_interval&lt;/code&gt;控制普罗米修斯收集目标的频率，可以为单个目标覆盖这个值，&lt;code class=&quot;language-text&quot;&gt;evaluation_interval&lt;/code&gt;选项控制&lt;code class=&quot;language-text&quot;&gt;prometheus&lt;/code&gt;多久校验规则的能力，Prometheus使用规则创建新的时间序列并生成警报。&lt;/p&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;alerting&lt;/code&gt;模块是配置&lt;code class=&quot;language-text&quot;&gt;Alertmanager &lt;/code&gt;的。&lt;/p&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;rule_files&lt;/code&gt;，模块指定我们希望&lt;code class=&quot;language-text&quot;&gt;Prometheus&lt;/code&gt;服务器加载的任何规则的位置。现在我们没有规则.&lt;/p&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;scrape_configs&lt;/code&gt;模块配置&lt;code class=&quot;language-text&quot;&gt;prometheus&lt;/code&gt;要收集的监控资源，由于&lt;code class=&quot;language-text&quot;&gt;Prometheus&lt;/code&gt;还将自己的数据公开为&lt;code class=&quot;language-text&quot;&gt;HTTP&lt;/code&gt;端点，因此它可以抓取并监控自身的健康状况。在默认中有一个叫&lt;code class=&quot;language-text&quot;&gt;prometheus&lt;/code&gt;的&lt;code class=&quot;language-text&quot;&gt;job&lt;/code&gt;,这个是用于收集&lt;code class=&quot;language-text&quot;&gt;Prometheus&lt;/code&gt;自身产生的数据，&lt;code class=&quot;language-text&quot;&gt;static_configs&lt;/code&gt;用于配置服务暴露的端口。&lt;/p&gt;
&lt;h3&gt;启动prometheus&lt;/h3&gt;
&lt;blockquote&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;shell&quot;&gt;&lt;pre class=&quot;language-shell&quot;&gt;&lt;code class=&quot;language-shell&quot;&gt;./prometheus --config.file&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;prometheus.yml&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;/blockquote&gt;
&lt;p&gt;通过访问&lt;a href=&quot;http://localhost:9090/&quot;&gt;http://localhost:9090&lt;/a&gt;. 来验证是否启动成功，&lt;code class=&quot;language-text&quot;&gt;Prometheus&lt;/code&gt;每三十秒向自己请求一次收集数据，请求地址为&lt;code class=&quot;language-text&quot;&gt;http://localhost:9090/metrics&lt;/code&gt;.&lt;/p&gt;
&lt;h3&gt;使用表达式浏览&lt;/h3&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;http://localhost:9090/graph&lt;/code&gt;请求此地址就可以进行页面搜索，比如查询&lt;code class=&quot;language-text&quot;&gt;promhttp_metric_handler_requests_total&lt;/code&gt;这个指标的值，这个指标上有不同的级别，可以通过&lt;code class=&quot;language-text&quot;&gt;promhttp_metric_handler_requests_total{code=&quot;200&quot;}&lt;/code&gt;这种方式查看&lt;code class=&quot;language-text&quot;&gt;http&lt;/code&gt;状态码是&lt;code class=&quot;language-text&quot;&gt;200&lt;/code&gt;的指标，可以执行运算&lt;code class=&quot;language-text&quot;&gt;count(promhttp_metric_handler_requests_total)&lt;/code&gt;统计这个指标有多少个不同的级别。&lt;/p&gt;
&lt;p&gt;更多关于表达式的部分，查看&lt;code class=&quot;language-text&quot;&gt;https://prometheus.io/docs/querying/basics/&lt;/code&gt;详细文档。&lt;/p&gt;
&lt;h3&gt;使用图形界面&lt;/h3&gt;
&lt;p&gt;在&lt;code class=&quot;language-text&quot;&gt;Graph&lt;/code&gt;标签中，如下一个为统计普罗米修斯每分钟返回&lt;code class=&quot;language-text&quot;&gt;http&lt;/code&gt;状态码是&lt;code class=&quot;language-text&quot;&gt;200&lt;/code&gt;的请求数率。&lt;/p&gt;
&lt;blockquote&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;rate(promhttp_metric_handler_requests_total{code=&quot;200&quot;}[1m])&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;/blockquote&gt;
&lt;h3&gt;监控其他目标&lt;/h3&gt;
&lt;p&gt;仅仅查看&lt;code class=&quot;language-text&quot;&gt;prometheus&lt;/code&gt;自身的数据是体现不了它的强大的，可以查看监控一些主机信息&lt;a href=&quot;https://prometheus.io/docs/guides/node-exporter&quot;&gt;Monitoring Linux or macOS host metrics using a node exporter&lt;/a&gt;&lt;/p&gt;
&lt;h2&gt;概念&lt;/h2&gt;
&lt;h3&gt;数据模型&lt;/h3&gt;
&lt;h4&gt;指标名称和级别名称&lt;/h4&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;指标名称和级别,指标名称是必须能被正则匹配到的：&lt;code class=&quot;language-text&quot;&gt;[a-zA-Z_:][a-zA-Z0-9_:]*&lt;/code&gt;,&lt;code class=&quot;language-text&quot;&gt;:&lt;/code&gt;是一个预留符号。&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;级别名字也必须匹配这个正则:&lt;code class=&quot;language-text&quot;&gt;[a-zA-Z_][a-zA-Z0-9_]*&lt;/code&gt;,以&lt;code class=&quot;language-text&quot;&gt;__&lt;/code&gt;开头的标签名称保留供内部使用&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h4&gt;样本&lt;/h4&gt;
&lt;p&gt;每个样本包括如下的数据。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;一个&lt;code class=&quot;language-text&quot;&gt;float64&lt;/code&gt;的值。&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;毫秒级别的时间戳。&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;Element&lt;/th&gt;
&lt;th&gt;Value&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;prometheus_http_request_duration_seconds_count{handler=“/api/v1/query”,instance=“10.40.10.203:9090”,job=“prometheus”}&lt;/td&gt;
&lt;td&gt;146 @1552299953.836&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h4&gt;符号&lt;/h4&gt;
&lt;blockquote&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;&amp;lt;metric name&gt;{&amp;lt;label name&gt;=&amp;lt;label value&gt;, ...}使用这种方式来进行标示。  &lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;/blockquote&gt;
&lt;h3&gt;指标类型&lt;/h3&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;Prometheus&lt;/code&gt;客户端库提供四种核心度量标准类型。&lt;/p&gt;
&lt;h4&gt;Counter&lt;/h4&gt;
&lt;p&gt;计算器是一种只加不减的计数器，除非发生充值，一般在定义&lt;code class=&quot;language-text&quot;&gt;Counter&lt;/code&gt;类型指标的名称时推荐使用&lt;code class=&quot;language-text&quot;&gt;_total&lt;/code&gt;作为后缀。&lt;/p&gt;
&lt;h4&gt;Gauge&lt;/h4&gt;
&lt;p&gt;可增可减的仪表盘,&lt;code class=&quot;language-text&quot;&gt;Gauge&lt;/code&gt;类型的指标侧重于反应系统的当前状态,因此这类指标的样本数据可增可减。&lt;/p&gt;
&lt;h4&gt;Histogram&lt;/h4&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;Histogram&lt;/code&gt;和&lt;code class=&quot;language-text&quot;&gt;Summary&lt;/code&gt;主用用于统计和分析样本的分布情况。&lt;/p&gt;
&lt;h2&gt;最佳实践&lt;/h2&gt;
&lt;h2&gt;指南&lt;/h2&gt;
&lt;h3&gt;Go应用程序监控&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;添加到代码中&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;go&quot;&gt;&lt;pre class=&quot;language-go&quot;&gt;&lt;code class=&quot;language-go&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;package&lt;/span&gt; main

&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;
        &lt;span class=&quot;token string&quot;&gt;&quot;net/http&quot;&lt;/span&gt;

        &lt;span class=&quot;token string&quot;&gt;&quot;github.com/prometheus/client_golang/prometheus/promhttp&quot;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;func&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;main&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        http&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Handle&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;/metrics&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; promhttp&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Handler&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
        http&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;ListenAndServe&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;:2112&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;nil&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;启动&lt;code class=&quot;language-text&quot;&gt;go run main.go&lt;/code&gt;函数&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;查看指标：&lt;code class=&quot;language-text&quot;&gt;curl http://localhost:2112/metrics&lt;/code&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h3&gt;配置文件来做&lt;code class=&quot;language-text&quot;&gt;scrape_configs &lt;/code&gt;的服务发现&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;在&lt;code class=&quot;language-text&quot;&gt;prometheus.yml&lt;/code&gt;中添加一个&lt;code class=&quot;language-text&quot;&gt;scrape_configs&lt;/code&gt;的子配置项&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;scrape_configs:
- job_name: &apos;redis3.2&apos;
  file_sd_configs:
  - files:
    - &apos;redis_targets.json&apos;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;添加一个&lt;code class=&quot;language-text&quot;&gt;redis_targets.json&lt;/code&gt;的文件&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;json&quot;&gt;&lt;pre class=&quot;language-json&quot;&gt;&lt;code class=&quot;language-json&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token property&quot;&gt;&quot;labels&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
      &lt;span class=&quot;token property&quot;&gt;&quot;job&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;redis205&quot;&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;token property&quot;&gt;&quot;targets&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;
      &lt;span class=&quot;token string&quot;&gt;&quot;localhost:9100&quot;&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;当更改了&lt;code class=&quot;language-text&quot;&gt;redis_targets.json&lt;/code&gt;是不用重启服务，&lt;code class=&quot;language-text&quot;&gt;prometheus&lt;/code&gt;会自动添加服务&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;json&quot;&gt;&lt;pre class=&quot;language-json&quot;&gt;&lt;code class=&quot;language-json&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token property&quot;&gt;&quot;labels&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
      &lt;span class=&quot;token property&quot;&gt;&quot;job&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;redis205&quot;&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;token property&quot;&gt;&quot;targets&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;
      &lt;span class=&quot;token string&quot;&gt;&quot;localhost:9100&quot;&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token property&quot;&gt;&quot;targets&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;
      &lt;span class=&quot;token string&quot;&gt;&quot;localhost:9200&quot;&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;token property&quot;&gt;&quot;labels&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
      &lt;span class=&quot;token property&quot;&gt;&quot;job&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;redis206&quot;&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;/li&gt;
&lt;/ul&gt;</content:encoded></item><item><title><![CDATA[go1.12 发行说明]]></title><description><![CDATA[Go1.1…]]></description><link>https://lengrongfu.github.io/2019-02-27-go1-12/</link><guid isPermaLink="false">https://lengrongfu.github.io/2019-02-27-go1-12/</guid><pubDate>Wed, 27 Feb 2019 13:10:57 GMT</pubDate><content:encoded>&lt;h1&gt;Go1.12 概述&lt;/h1&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;Go1.12&lt;/code&gt;是目前最新的&lt;code class=&quot;language-text&quot;&gt;Go&lt;/code&gt;版本，在&lt;code class=&quot;language-text&quot;&gt;Go1.11&lt;/code&gt;发行之后的六个月到来，大多数的改变是工具链、运行时和包，总的来说，该版本依然保持了&lt;code class=&quot;language-text&quot;&gt;Go1&lt;/code&gt;的&lt;a href=&quot;https://golang.org/doc/go1compat&quot;&gt;兼容性承诺&lt;/a&gt;,希望大多数的程序还能和以前一样继续的编译和运行。&lt;/p&gt;
&lt;h1&gt;语言上的改变&lt;/h1&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;语言规范上是没有改变的。&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h1&gt;部分&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;竞争检测现在是支持在&lt;code class=&quot;language-text&quot;&gt;linux/arm64&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;Go1.12&lt;/code&gt;是最后一个支持&lt;code class=&quot;language-text&quot;&gt;FreeBSD 10.x&lt;/code&gt;的版本，&lt;code class=&quot;language-text&quot;&gt;Go1.13&lt;/code&gt;将开始支持&lt;code class=&quot;language-text&quot;&gt;FreeBSD 11.2+ or FreeBSD 12.0+&lt;/code&gt;,&lt;code class=&quot;language-text&quot;&gt; FreeBSD 12.0+&lt;/code&gt;要求设置一个&lt;code class=&quot;language-text&quot;&gt;COMPAT_FREEBSD11&lt;/code&gt;的变量，这是默认设置的。&lt;/li&gt;
&lt;li&gt;在&lt;code class=&quot;language-text&quot;&gt;linux/ppc64&lt;/code&gt;上支持&lt;code class=&quot;language-text&quot;&gt;cgo&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h2&gt;Windows&lt;/h2&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;windows/arm&lt;/code&gt;的部分支持&lt;code class=&quot;language-text&quot;&gt;go&lt;/code&gt;在&lt;code class=&quot;language-text&quot;&gt;windows10 lot&lt;/code&gt;的32位物联网&lt;code class=&quot;language-text&quot;&gt;arm&lt;/code&gt;芯片上，比如树莓派3.&lt;/p&gt;
&lt;h2&gt;AIX&lt;/h2&gt;
&lt;p&gt;Go现在支持AIX 7.2及更高版本的POWER8体系结构（aix / ppc64）。尚不支持外部链接，cgo，pprof和竞赛检测器&lt;/p&gt;
&lt;h2&gt;Darwin&lt;/h2&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;Go 1.12&lt;/code&gt;是最后一个支持运行在&lt;code class=&quot;language-text&quot;&gt;macOS 10.10&lt;/code&gt;系统之上的版本，&lt;code class=&quot;language-text&quot;&gt;Go1.13&lt;/code&gt;将要求操作系统必须是&lt;code class=&quot;language-text&quot;&gt;macOS 10.11&lt;/code&gt;以上。&lt;/p&gt;
&lt;h1&gt;工具&lt;/h1&gt;
&lt;h2&gt;go tool vet 不再支持&lt;/h2&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;go vet&lt;/code&gt;命令将不在支持，关于这部分功能迁移到了&lt;code class=&quot;language-text&quot;&gt;analysis&lt;/code&gt;工具中，更多详情查看包&lt;a href=&quot;https://godoc.org/golang.org/x/tools/go/analysis&quot;&gt;golang.org/x/tools/go/analysis&lt;/a&gt;,使用方式有所改变，不能再使用&lt;code class=&quot;language-text&quot;&gt;go tool vet&lt;/code&gt;此命令，需要更改为&lt;code class=&quot;language-text&quot;&gt;go vet&lt;/code&gt;命令，使用&lt;code class=&quot;language-text&quot;&gt;go vet&lt;/code&gt;可以支持所以的版本。
&lt;code class=&quot;language-text&quot;&gt;-shadow&lt;/code&gt;将不再可用，需要替换。&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;go&quot;&gt;&lt;pre class=&quot;language-go&quot;&gt;&lt;code class=&quot;language-go&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;go&lt;/span&gt; get &lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;u golang&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;org&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;x&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;tools&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;go&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;analysis&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;passes&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;shadow&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;cmd&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;shadow
&lt;span class=&quot;token keyword&quot;&gt;go&lt;/span&gt; vet &lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;vettool&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;$&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;which shadow&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2&gt;Tour将不在默认安装&lt;/h2&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;Go Tour&lt;/code&gt;不会包含再主要的包中，如果需要使用需要自行安装。&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;go&quot;&gt;&lt;pre class=&quot;language-go&quot;&gt;&lt;code class=&quot;language-go&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;go&lt;/span&gt; get &lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;u golang&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;org&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;x&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;tour
tour&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2&gt;Build cache 要求&lt;/h2&gt;
&lt;p&gt;如果设置了&lt;code class=&quot;language-text&quot;&gt;GOCACHE=off&lt;/code&gt;将导致&lt;code class=&quot;language-text&quot;&gt;go&lt;/code&gt;命令行写缓存失败。&lt;/p&gt;
&lt;h2&gt;二进制包&lt;/h2&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;Go 1.12&lt;/code&gt;是最后一个支持二进制包的版本.&lt;/p&gt;
&lt;h2&gt;Cgo&lt;/h2&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;Go1.12&lt;/code&gt;将&lt;code class=&quot;language-text&quot;&gt;C&lt;/code&gt;语言的&lt;code class=&quot;language-text&quot;&gt;EGLDisplay&lt;/code&gt;类型翻译为&lt;code class=&quot;language-text&quot;&gt;go&lt;/code&gt;的&lt;code class=&quot;language-text&quot;&gt;uintptr&lt;/code&gt;类型。更多信息请参考&lt;a href=&quot;https://golang.org/cmd/cgo/#hdr-Special_cases&quot;&gt;cgo 文档&lt;/a&gt;&lt;/p&gt;
&lt;h1&gt;核心库&lt;/h1&gt;
&lt;h2&gt;TLS1.3&lt;/h2&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;Go1.12&lt;/code&gt;添加了对&lt;code class=&quot;language-text&quot;&gt;TLS 1.3&lt;/code&gt;的支持，可以通过设置环境变量&lt;code class=&quot;language-text&quot;&gt;tls13=1GODEBUG&lt;/code&gt;来启用，在&lt;code class=&quot;language-text&quot;&gt;Go1.13&lt;/code&gt;版本中将默认开启。&lt;/p&gt;
&lt;h2&gt;bufio&lt;/h2&gt;
&lt;p&gt;如果在调用完&lt;code class=&quot;language-text&quot;&gt;Peek&lt;/code&gt;方法之后调用&lt;code class=&quot;language-text&quot;&gt;UnreadRune and UnreadByte&lt;/code&gt;将会返回一个错误。&lt;/p&gt;
&lt;h2&gt;bytes&lt;/h2&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;go&quot;&gt;&lt;pre class=&quot;language-go&quot;&gt;&lt;code class=&quot;language-go&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;func&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;ReplaceAll&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;s&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; old&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token builtin&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token builtin&quot;&gt;byte&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token builtin&quot;&gt;byte&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;新函数&lt;code class=&quot;language-text&quot;&gt;ReplaceAll&lt;/code&gt;将返回一个字节切片的副本。&lt;code class=&quot;language-text&quot;&gt;s&lt;/code&gt;是原字节，&lt;code class=&quot;language-text&quot;&gt;old&lt;/code&gt;是匹配字节，&lt;code class=&quot;language-text&quot;&gt;new&lt;/code&gt;是替换为新的字符。&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;go&quot;&gt;&lt;pre class=&quot;language-go&quot;&gt;&lt;code class=&quot;language-go&quot;&gt;
&lt;span class=&quot;token keyword&quot;&gt;package&lt;/span&gt; main

&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;
	&lt;span class=&quot;token string&quot;&gt;&quot;bytes&quot;&lt;/span&gt;
	&lt;span class=&quot;token string&quot;&gt;&quot;fmt&quot;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;func&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;main&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
	fmt&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Printf&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;%s\n&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; bytes&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;ReplaceAll&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;byte&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;oink oink oink&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;byte&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;oink&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;byte&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;moo&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
	fmt&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Printf&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;%s\n&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;bytes&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;ReplaceAll&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;byte&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;this is a demo,place open the demo file&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;byte&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;demo&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;byte&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;test&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;//输出&lt;/span&gt;
moo moo moo
this is a test&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;place open the test file&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2&gt;crypto/rand&lt;/h2&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;Reader.Read&lt;/code&gt;如果超过60s还没有读取到熵，那么将会打印输出。&lt;/p&gt;
&lt;h2&gt;crypto/rc4&lt;/h2&gt;
&lt;p&gt;这个版本移除了其他版本的实现，只保留了&lt;code class=&quot;language-text&quot;&gt;Go&lt;/code&gt;版本。
&lt;code class=&quot;language-text&quot;&gt;RC4&lt;/code&gt;是一种流&lt;a href=&quot;https://zh.wikipedia.org/wiki/RC4&quot;&gt;加密算法&lt;/a&gt;&lt;/p&gt;
&lt;h2&gt;crypto/tls&lt;/h2&gt;
&lt;p&gt;如果客户端发送的初始消息看起来不像TLS，则服务器将不再使用警报进行回复,当TLS记录头无效时，返回&lt;code class=&quot;language-text&quot;&gt;RecordHeaderError&lt;/code&gt;.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;go&quot;&gt;&lt;pre class=&quot;language-go&quot;&gt;&lt;code class=&quot;language-go&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;type&lt;/span&gt; RecordHeaderError &lt;span class=&quot;token keyword&quot;&gt;struct&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;token comment&quot;&gt;// Msg contains a human readable string that describes the error.&lt;/span&gt;
        Msg &lt;span class=&quot;token builtin&quot;&gt;string&lt;/span&gt;
        &lt;span class=&quot;token comment&quot;&gt;// RecordHeader contains the five bytes of TLS record header that&lt;/span&gt;
        &lt;span class=&quot;token comment&quot;&gt;// triggered the error.&lt;/span&gt;
        RecordHeader &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;5&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token builtin&quot;&gt;byte&lt;/span&gt;
        &lt;span class=&quot;token comment&quot;&gt;// Conn provides the underlying net.Conn in the case that a client&lt;/span&gt;
        &lt;span class=&quot;token comment&quot;&gt;// sent an initial handshake that didn&apos;t look like TLS.&lt;/span&gt;
        &lt;span class=&quot;token comment&quot;&gt;// It is nil if there&apos;s already been a handshake or a TLS alert has&lt;/span&gt;
        &lt;span class=&quot;token comment&quot;&gt;// been written to the connection.&lt;/span&gt;
        Conn net&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;Conn &lt;span class=&quot;token comment&quot;&gt;// Go 1.12&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2&gt;database/sql&lt;/h2&gt;
&lt;p&gt;现在可以通过将&lt;code class=&quot;language-text&quot;&gt;*Rows&lt;/code&gt;值传递给&lt;code class=&quot;language-text&quot;&gt;Row.Scan&lt;/code&gt;方法来获取查询光标.&lt;/p&gt;
&lt;h2&gt;expvar&lt;/h2&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;Delete&lt;/code&gt;方法运行删除一个&lt;code class=&quot;language-text&quot;&gt;Map&lt;/code&gt;类型的的&lt;code class=&quot;language-text&quot;&gt;key&lt;/code&gt;.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;go&quot;&gt;&lt;pre class=&quot;language-go&quot;&gt;&lt;code class=&quot;language-go&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;func&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;v &lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt;Map&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;Delete&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;key &lt;span class=&quot;token builtin&quot;&gt;string&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2&gt;lib/time&lt;/h2&gt;
&lt;p&gt;当操作系统未提供时区数据时，将会使用配置的&lt;code class=&quot;language-text&quot;&gt;$GOROOT/lib/time/zoneinfo.zip&lt;/code&gt;数据。&lt;/p&gt;
&lt;h1&gt;参考官方&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https://golang.org/doc/go1.12&quot;&gt;https://golang.org/doc/go1.12&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;</content:encoded></item><item><title><![CDATA[ES cluster reroute]]></title><description><![CDATA[…]]></description><link>https://lengrongfu.github.io/2019-01-24-es-cluster-reroute/</link><guid isPermaLink="false">https://lengrongfu.github.io/2019-01-24-es-cluster-reroute/</guid><pubDate>Thu, 24 Jan 2019 15:13:55 GMT</pubDate><content:encoded>&lt;blockquote&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;ES&lt;/code&gt;集群重新路由命令可以显示的执行包括特定命令的集群重新路由分配命令。例如，可以显示地将分片从一个节点移动到另一个节点，可以取消分配。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h1&gt;使用&lt;/h1&gt;
&lt;h2&gt;支持的命令如下&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;move&lt;/code&gt;
将现有的分片迁移到其他节点。接受 &lt;code class=&quot;language-text&quot;&gt;index&lt;/code&gt;和&lt;code class=&quot;language-text&quot;&gt;shard&lt;/code&gt;索引名称和分片编号，&lt;code class=&quot;language-text&quot;&gt;from_node&lt;/code&gt;节点移动分片&lt;code class=&quot;language-text&quot;&gt;from&lt;/code&gt;，以及&lt;code class=&quot;language-text&quot;&gt;to_node&lt;/code&gt;节点将分片移动到。&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;cancel&lt;/code&gt;
取消分享碎片（或恢复）。接受&lt;code class=&quot;language-text&quot;&gt;index &lt;/code&gt;和&lt;code class=&quot;language-text&quot;&gt;shard&lt;/code&gt;索引名称和分片编号，以及&lt;code class=&quot;language-text&quot;&gt;node&lt;/code&gt;取消分片分配的节点。它还接受&lt;code class=&quot;language-text&quot;&gt;allow_primary&lt;/code&gt;标志以明确指定允许取消主分片的分配。这可以用于强制从主分片重新同步现有副本，方法是取消它们并允许它们通过标准重新分配过程重新初始化。&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;allocate_replica&lt;/code&gt;
将未分配的副本分片分配给节点。接受&lt;code class=&quot;language-text&quot;&gt;index&lt;/code&gt;和&lt;code class=&quot;language-text&quot;&gt;shard&lt;/code&gt;索引名称和分片编号，并将分片分配给&lt;code class=&quot;language-text&quot;&gt;node&lt;/code&gt;。&lt;/li&gt;
&lt;/ul&gt;
&lt;h2&gt;使用场景&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;move&lt;/code&gt;
主要是想要手动控制分片分配到某台固定的机器上。把&lt;code class=&quot;language-text&quot;&gt;node_1&lt;/code&gt;上的&lt;code class=&quot;language-text&quot;&gt;index_name&lt;/code&gt;移动到&lt;code class=&quot;language-text&quot;&gt;node_2&lt;/code&gt;节点上，可能会有各种原因需要进行迁移，比如&lt;code class=&quot;language-text&quot;&gt;node_1&lt;/code&gt;机器的磁盘不够了或者是其他原因等。&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;json&quot;&gt;&lt;pre class=&quot;language-json&quot;&gt;&lt;code class=&quot;language-json&quot;&gt;POST _cluster/reroute
&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token property&quot;&gt;&quot;commands&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
      &lt;span class=&quot;token property&quot;&gt;&quot;move&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;token property&quot;&gt;&quot;index&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;index_name&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
        &lt;span class=&quot;token property&quot;&gt;&quot;shard&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
        &lt;span class=&quot;token property&quot;&gt;&quot;from_node&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;node_1&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
        &lt;span class=&quot;token property&quot;&gt;&quot;to_node&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;node_2&quot;&lt;/span&gt;
      &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;cancel&lt;/code&gt;
主要是把移动中的分片取消，这个是因为其他原因导致分片重新分配了，但是又不想让它重新分配，所以只能取消分片分配的过程。如下是&lt;code class=&quot;language-text&quot;&gt;node_1&lt;/code&gt;这台机器上的&lt;code class=&quot;language-text&quot;&gt;index_name&lt;/code&gt;的分片号&lt;code class=&quot;language-text&quot;&gt;0&lt;/code&gt;进行了移动，所以取消它。&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;json&quot;&gt;&lt;pre class=&quot;language-json&quot;&gt;&lt;code class=&quot;language-json&quot;&gt;POST _cluster/reroute
&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token property&quot;&gt;&quot;commands&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
      &lt;span class=&quot;token property&quot;&gt;&quot;cancel&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;token property&quot;&gt;&quot;index&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;index_name&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
        &lt;span class=&quot;token property&quot;&gt;&quot;shard&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
        &lt;span class=&quot;token property&quot;&gt;&quot;node&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;node_1&quot;&lt;/span&gt;
      &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h1&gt;参考文档&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https://www.elastic.co/guide/en/elasticsearch/reference/5.4/cluster-reroute.html&quot;&gt;https://www.elastic.co/guide/en/elasticsearch/reference/5.4/cluster-reroute.html&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;</content:encoded></item><item><title><![CDATA[18年的回顾,19年的展望]]></title><description><![CDATA[18年的计划 大概说一下年初的计划，1…]]></description><link>https://lengrongfu.github.io/2019-01-04-2018-2019/</link><guid isPermaLink="false">https://lengrongfu.github.io/2019-01-04-2018-2019/</guid><pubDate>Fri, 04 Jan 2019 17:59:16 GMT</pubDate><content:encoded>&lt;h1&gt;18年的计划&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;大概说一下年初的计划，17年毕业，短短的半年体重就有点指数函数上升的趋势，所以呢，新年初的第一个计划就是控制住体重，少吃多运动，控制住体重；&lt;/li&gt;
&lt;li&gt;作为一个刚入门不久的技术小菜鸟来说最大的新年愿望就是来年能吊打哪些曾经鄙视我们的老鸟了，这种想法还是想想就好了。年初的愿望是把自己的技术广度和深度提高一些。&lt;/li&gt;
&lt;li&gt;新年还有一个愿望，就是希望这一年里能挤出更多的时间来看书，只要是自己感兴趣的书。&lt;/li&gt;
&lt;li&gt;还要尽量缩短自己的短板，都是曾经的通。&lt;/li&gt;
&lt;/ul&gt;
&lt;h1&gt;18年完成情况&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;现在的体重，只能用惊讶来形容，不过总体最后一个季度还是比较好的，每周都有运动；&lt;/li&gt;
&lt;li&gt;技术上没有达到预期，广度和深度都有所增加，但是呢都不及预期。&lt;/li&gt;
&lt;li&gt;这一年就看来两类书籍，一类和投资理财以及经济有关，还有一类呢就是技术书籍，看书的过程中呢也会去豆瓣上写写观后感。&lt;/li&gt;
&lt;li&gt;短板还在弥补中。&lt;/li&gt;
&lt;/ul&gt;
&lt;h1&gt;18总结&lt;/h1&gt;
&lt;p&gt;这一年除了工作上还做了这么几件有意义的事：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;其一是，意识到了保险的重要性，所以年初来的时候就各种学习，买了一个一年期的重疾险，因为资金和知识都有限，经过这一年的积累呢，已经有了一些自己的思考，找了一个我们这个年龄比较好的长期重疾险，之后呢医疗险也是要买上的。&lt;/li&gt;
&lt;li&gt;其二是，今年开始学习投资理财了，现在虽然本金不多，但是呢经验最重要，在上半年的时候呢主要都是投了P2P,后来有了危机感，就赶紧全部撤出来，投了活期；年中的时候股票开了户，也看了几本书，积累不多，就买了一只大金融板块股票，后面呢陆续学习，陆续发现自己离”价值投资”(炒股)还很远，就又改买了基金和指数ETF，但是后面贸易战来了，导致股市开始一直下跌，结果呢就是到现在我依然深陷其中，但是呢，我一点都不慌。&lt;/li&gt;
&lt;li&gt;其三是，九月份左右的时候搭建了自己的博客，并开始了持续的输出，积累点滴，十二月份的时候开通了微信公众号，开始了共同成长。      &lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;img src=&quot;kgHIYGF6.jpg&quot; alt=&quot;kgHIYGF6.jpg&quot;&gt;
  &lt;/p&gt;
&lt;h1&gt;19 flag&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;更加深入的学习未掌握的技术。&lt;/li&gt;
&lt;li&gt;每个月10篇博客和10篇公众号。&lt;/li&gt;
&lt;li&gt;对投资理财更加深入的学习。&lt;/li&gt;
&lt;li&gt;体重下降一些。&lt;/li&gt;
&lt;li&gt;每个月看一本书，并且写出读后感。&lt;/li&gt;
&lt;/ul&gt;</content:encoded></item><item><title><![CDATA[spring boot validate 统一处理]]></title><description><![CDATA[统一处理的校验 在开发业务系统的过程中都会设计到一些接口请求参数的校验，之前都是单个接口进行处理，现在介绍一种方法统一处理这个校验。…]]></description><link>https://lengrongfu.github.io/2018-12-27-spring-validate-common-handler/</link><guid isPermaLink="false">https://lengrongfu.github.io/2018-12-27-spring-validate-common-handler/</guid><pubDate>Thu, 27 Dec 2018 11:57:21 GMT</pubDate><content:encoded>&lt;h1&gt;统一处理&lt;code class=&quot;language-text&quot;&gt;validate&lt;/code&gt;的校验&lt;/h1&gt;
&lt;p&gt;在开发业务系统的过程中都会设计到一些接口请求参数的校验，之前都是单个接口进行处理，现在介绍一种方法统一处理这个校验。&lt;/p&gt;
&lt;h2&gt;1、实现&lt;/h2&gt;
&lt;p&gt;通过继承&lt;code class=&quot;language-text&quot;&gt;ResponseEntityExceptionHandler&lt;/code&gt;这个类并实现&lt;code class=&quot;language-text&quot;&gt;handleMethodArgumentNotValid&lt;/code&gt;这个方法，就可以统一处理所以经过&lt;code class=&quot;language-text&quot;&gt;Valid&lt;/code&gt;注解过的接口，方法中的实现根据业务来，此处我写了一个统一返回类&lt;code class=&quot;language-text&quot;&gt;ResponeVo&lt;/code&gt;,主要用这个类和前端进行&lt;code class=&quot;language-text&quot;&gt;REST FULL&lt;/code&gt;交互，只要出现校验命中的就会来进入此方法执行，并且携带具体的错误信息；如下的处理逻辑是：返回和前端约定的固定&lt;code class=&quot;language-text&quot;&gt;code&lt;/code&gt;，&lt;code class=&quot;language-text&quot;&gt;msg&lt;/code&gt;字段用于返回校验时填入的信息，&lt;code class=&quot;language-text&quot;&gt;data&lt;/code&gt;中返回请求的值。&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;java&quot;&gt;&lt;pre class=&quot;language-java&quot;&gt;&lt;code class=&quot;language-java&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;package&lt;/span&gt; &lt;span class=&quot;token namespace&quot;&gt;com&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;demo&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;validatecommondemo&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;controller&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;token namespace&quot;&gt;com&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;alibaba&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;fastjson&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;/span&gt;JSON&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;token namespace&quot;&gt;com&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;demo&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;validatecommondemo&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;vo&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;ResponeVo&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;token namespace&quot;&gt;org&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;springframework&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;http&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;HttpHeaders&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;token namespace&quot;&gt;org&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;springframework&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;http&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;HttpStatus&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;token namespace&quot;&gt;org&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;springframework&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;http&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;ResponseEntity&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;token namespace&quot;&gt;org&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;springframework&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;validation&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;FieldError&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;token namespace&quot;&gt;org&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;springframework&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;web&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;bind&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;MethodArgumentNotValidException&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;token namespace&quot;&gt;org&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;springframework&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;web&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;bind&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;annotation&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;ControllerAdvice&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;token namespace&quot;&gt;org&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;springframework&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;web&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;bind&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;annotation&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;RestController&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;token namespace&quot;&gt;org&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;springframework&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;web&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;context&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;request&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;WebRequest&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;token namespace&quot;&gt;org&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;springframework&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;web&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;servlet&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;mvc&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;method&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;annotation&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;ResponseEntityExceptionHandler&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;token annotation punctuation&quot;&gt;@ControllerAdvice&lt;/span&gt;
&lt;span class=&quot;token annotation punctuation&quot;&gt;@RestController&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;ValidateCommonHandler&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;extends&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;ResponseEntityExceptionHandler&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;


	&lt;span class=&quot;token annotation punctuation&quot;&gt;@Override&lt;/span&gt;
	&lt;span class=&quot;token keyword&quot;&gt;protected&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;ResponseEntity&lt;/span&gt;&lt;span class=&quot;token generics&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;Object&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;handleMethodArgumentNotValid&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;
			&lt;span class=&quot;token class-name&quot;&gt;MethodArgumentNotValidException&lt;/span&gt; ex&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;HttpHeaders&lt;/span&gt; headers&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;HttpStatus&lt;/span&gt; status&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
			&lt;span class=&quot;token class-name&quot;&gt;WebRequest&lt;/span&gt; request&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
		&lt;span class=&quot;token class-name&quot;&gt;ResponeVo&lt;/span&gt; vo &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;ResponeVo&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
		vo&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;setCode&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;400&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
		&lt;span class=&quot;token keyword&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;FieldError&lt;/span&gt; fieldError &lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; ex&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;getBindingResult&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;getFieldErrors&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
			&lt;span class=&quot;token class-name&quot;&gt;String&lt;/span&gt; defaultMessage &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; fieldError&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;getDefaultMessage&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
			vo&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;setMsg&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;defaultMessage&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
			&lt;span class=&quot;token class-name&quot;&gt;Object&lt;/span&gt; value &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; fieldError&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;getRejectedValue&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
			&lt;span class=&quot;token class-name&quot;&gt;String&lt;/span&gt; data &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;请求参数值为:&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;+&lt;/span&gt;JSON&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;toJSONString&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;value&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
			vo&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;setData&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;data&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
			&lt;span class=&quot;token keyword&quot;&gt;break&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
		&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
		&lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;ResponseEntity&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;vo&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;HttpStatus&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;OK&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
	&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2&gt;2、Controller类书写&lt;/h2&gt;
&lt;p&gt;如下的接口中&lt;code class=&quot;language-text&quot;&gt;addStudent&lt;/code&gt;添加了&lt;code class=&quot;language-text&quot;&gt;Valid&lt;/code&gt;注解。&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;java&quot;&gt;&lt;pre class=&quot;language-java&quot;&gt;&lt;code class=&quot;language-java&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;package&lt;/span&gt; &lt;span class=&quot;token namespace&quot;&gt;com&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;demo&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;validatecommondemo&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;controller&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;


&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;token namespace&quot;&gt;com&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;alibaba&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;fastjson&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;/span&gt;JSON&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;token namespace&quot;&gt;com&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;demo&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;validatecommondemo&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;entity&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;Girlfriend&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;token namespace&quot;&gt;com&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;demo&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;validatecommondemo&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;entity&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;Student&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;token namespace&quot;&gt;com&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;demo&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;validatecommondemo&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;vo&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;ResponeVo&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;token namespace&quot;&gt;org&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;springframework&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;web&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;bind&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;annotation&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;GetMapping&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;token namespace&quot;&gt;org&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;springframework&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;web&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;bind&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;annotation&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;PathVariable&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;token namespace&quot;&gt;org&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;springframework&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;web&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;bind&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;annotation&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;PostMapping&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;token namespace&quot;&gt;org&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;springframework&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;web&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;bind&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;annotation&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;RequestBody&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;token namespace&quot;&gt;org&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;springframework&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;web&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;bind&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;annotation&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;RestController&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;token namespace&quot;&gt;javax&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;validation&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;Valid&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;token namespace&quot;&gt;java&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;util&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;ArrayList&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;token namespace&quot;&gt;java&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;util&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;HashMap&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;token namespace&quot;&gt;java&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;util&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;Iterator&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;token namespace&quot;&gt;java&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;util&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;List&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;token namespace&quot;&gt;java&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;util&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;Map&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;token annotation punctuation&quot;&gt;@RestController&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;DemoController&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token annotation punctuation&quot;&gt;@PostMapping&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;path &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;/student&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
	&lt;span class=&quot;token keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;ResponeVo&lt;/span&gt;&lt;span class=&quot;token generics&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;Boolean&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;addStudent&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token annotation punctuation&quot;&gt;@RequestBody&lt;/span&gt; &lt;span class=&quot;token annotation punctuation&quot;&gt;@Valid&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Student&lt;/span&gt; student&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
		studentsMap&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;put&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;student&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;getName&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;student&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
		&lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;ResponeVo&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;create&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token boolean&quot;&gt;true&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
	&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;解释如下的几个东西，这个类没有写&lt;code class=&quot;language-text&quot;&gt;get&lt;/code&gt;和&lt;code class=&quot;language-text&quot;&gt;set&lt;/code&gt;方法，因为使用了&lt;code class=&quot;language-text&quot;&gt;@Data&lt;/code&gt;注解，更多功能请参考 &lt;a href=&quot;http://jnb.ociweb.com/jnb/jnbJan2010.html&quot;&gt;官网&lt;/a&gt;,其他的呢就都是正常的注解，其中&lt;code class=&quot;language-text&quot;&gt;idCard&lt;/code&gt;和&lt;code class=&quot;language-text&quot;&gt;phone&lt;/code&gt;因为没有官方的注解，所以通过正则表达式来进行匹配，这种方法也是支持的。然后就是&lt;code class=&quot;language-text&quot;&gt;backCard&lt;/code&gt;银行卡校验有点问题，感觉规则和中国的不太一样，所以最好是自己用正则去校验。&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;java&quot;&gt;&lt;pre class=&quot;language-java&quot;&gt;&lt;code class=&quot;language-java&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;package&lt;/span&gt; &lt;span class=&quot;token namespace&quot;&gt;com&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;demo&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;validatecommondemo&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;entity&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;token namespace&quot;&gt;com&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;fasterxml&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;jackson&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;annotation&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;JsonFormat&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;token namespace&quot;&gt;lombok&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;Data&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;token namespace&quot;&gt;org&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;hibernate&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;validator&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;constraints&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;CreditCardNumber&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;token namespace&quot;&gt;org&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;hibernate&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;validator&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;constraints&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;Length&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;token namespace&quot;&gt;javax&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;validation&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;Valid&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;token namespace&quot;&gt;javax&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;validation&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;constraints&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;Email&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;token namespace&quot;&gt;javax&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;validation&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;constraints&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;Future&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;token namespace&quot;&gt;javax&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;validation&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;constraints&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;Max&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;token namespace&quot;&gt;javax&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;validation&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;constraints&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;Min&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;token namespace&quot;&gt;javax&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;validation&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;constraints&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;NotEmpty&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;token namespace&quot;&gt;javax&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;validation&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;constraints&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;NotNull&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;token namespace&quot;&gt;javax&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;validation&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;constraints&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;Pattern&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;token namespace&quot;&gt;java&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;util&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;Date&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;token namespace&quot;&gt;java&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;util&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;List&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;token annotation punctuation&quot;&gt;@Data&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Student&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;

	&lt;span class=&quot;token annotation punctuation&quot;&gt;@Length&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;min &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;message &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;姓名不能为空&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
	&lt;span class=&quot;token annotation punctuation&quot;&gt;@NotNull&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;message &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;姓名不能为空&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
	&lt;span class=&quot;token keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;String&lt;/span&gt; name&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

	&lt;span class=&quot;token annotation punctuation&quot;&gt;@NotNull&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;message &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;年龄不能为空&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
	&lt;span class=&quot;token annotation punctuation&quot;&gt;@Min&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;value &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;18&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;message &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;年龄不能小于18岁&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
	&lt;span class=&quot;token annotation punctuation&quot;&gt;@Max&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;value &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;56&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;message &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;年龄不能大于56岁&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
	&lt;span class=&quot;token keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Integer&lt;/span&gt; age&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

	&lt;span class=&quot;token annotation punctuation&quot;&gt;@NotNull&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;message &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;邮箱不能为空&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
	&lt;span class=&quot;token annotation punctuation&quot;&gt;@Email&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;message &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;邮箱地址无效&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
	&lt;span class=&quot;token keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;String&lt;/span&gt; email&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

	&lt;span class=&quot;token annotation punctuation&quot;&gt;@NotEmpty&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;message &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;身份证号不能为空&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
	&lt;span class=&quot;token annotation punctuation&quot;&gt;@Pattern&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;regexp &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;^[1-9]\\d{5}[1-9]\\d{3}((0\\d)|(1[0-2]))(([0|1|2]\\d)|3[0-1])\\d{3}([0-9]|X)$&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;message &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;请输入正确的身份证号&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
	&lt;span class=&quot;token keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;String&lt;/span&gt; idCard&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

	&lt;span class=&quot;token annotation punctuation&quot;&gt;@NotEmpty&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;message &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;手机号码不能为空&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
	&lt;span class=&quot;token annotation punctuation&quot;&gt;@Pattern&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;regexp &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;^1(3|4|5|7|8)\\d{9}$&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;message &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;请输入正确的手机号码&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
	&lt;span class=&quot;token keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;String&lt;/span&gt; phone&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

	&lt;span class=&quot;token annotation punctuation&quot;&gt;@NotNull&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;message &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;请输入合法的时间&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
	&lt;span class=&quot;token annotation punctuation&quot;&gt;@Future&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;message &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;请输入合法的时间&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
	&lt;span class=&quot;token annotation punctuation&quot;&gt;@JsonFormat&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;pattern&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;yyyy-MM-dd HH:mm:ss&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
	&lt;span class=&quot;token keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Date&lt;/span&gt; inSchoolDate&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

	&lt;span class=&quot;token annotation punctuation&quot;&gt;@NotNull&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;message &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;请输入正确的银行卡号&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
	&lt;span class=&quot;token annotation punctuation&quot;&gt;@CreditCardNumber&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;message &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;请输入正确的银行卡号&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
	&lt;span class=&quot;token keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;String&lt;/span&gt; backCard&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

    &lt;span class=&quot;token comment&quot;&gt;//嵌套校验&lt;/span&gt;
    &lt;span class=&quot;token annotation punctuation&quot;&gt;@NotEmpty&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;message &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;请填写女朋友信息&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
	&lt;span class=&quot;token keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;List&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token annotation punctuation&quot;&gt;@Valid&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Girlfriend&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; girlfriends&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;java&quot;&gt;&lt;pre class=&quot;language-java&quot;&gt;&lt;code class=&quot;language-java&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;package&lt;/span&gt; &lt;span class=&quot;token namespace&quot;&gt;com&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;demo&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;validatecommondemo&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;entity&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;token namespace&quot;&gt;lombok&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;Data&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;token namespace&quot;&gt;org&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;hibernate&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;validator&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;constraints&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;Range&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;token namespace&quot;&gt;javax&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;validation&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;constraints&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;Digits&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;token namespace&quot;&gt;javax&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;validation&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;constraints&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;NotEmpty&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;token namespace&quot;&gt;javax&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;validation&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;constraints&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;NotNull&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;token annotation punctuation&quot;&gt;@Data&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Girlfriend&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;

	&lt;span class=&quot;token annotation punctuation&quot;&gt;@NotEmpty&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;message &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;请输入姓名&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
	&lt;span class=&quot;token keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;String&lt;/span&gt; name&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

	&lt;span class=&quot;token annotation punctuation&quot;&gt;@NotNull&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;message &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;请输入年龄&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
	&lt;span class=&quot;token annotation punctuation&quot;&gt;@Range&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;min &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;18&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;max &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;24&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;message &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;对不起，年龄不在合适的范围内&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
	&lt;span class=&quot;token keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Integer&lt;/span&gt; age&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
	&lt;span class=&quot;token annotation punctuation&quot;&gt;@NotNull&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;message &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;请输入性别&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
	&lt;span class=&quot;token annotation punctuation&quot;&gt;@Digits&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;integer &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;fraction &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;message &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;只接受女性为女朋友&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
	&lt;span class=&quot;token keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Integer&lt;/span&gt; gender&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2&gt;3、请求&lt;/h2&gt;
&lt;p&gt;请求参数：&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;json&quot;&gt;&lt;pre class=&quot;language-json&quot;&gt;&lt;code class=&quot;language-json&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
	&lt;span class=&quot;token property&quot;&gt;&quot;name&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;l&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
	&lt;span class=&quot;token property&quot;&gt;&quot;age&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;18&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
	&lt;span class=&quot;token property&quot;&gt;&quot;email&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;1@qq.com&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
	&lt;span class=&quot;token property&quot;&gt;&quot;phone&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;77777777777&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
	&lt;span class=&quot;token property&quot;&gt;&quot;idCard&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;44444444444444444&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
	&lt;span class=&quot;token property&quot;&gt;&quot;backCard&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;44444&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
	&lt;span class=&quot;token property&quot;&gt;&quot;inSchoolDate&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;2019-10-10 10:10:10&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
	&lt;span class=&quot;token property&quot;&gt;&quot;girlfriends&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;
		&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
		&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;响应参数:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;json&quot;&gt;&lt;pre class=&quot;language-json&quot;&gt;&lt;code class=&quot;language-json&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token property&quot;&gt;&quot;code&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;400&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;token property&quot;&gt;&quot;msg&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;请输入性别&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;token property&quot;&gt;&quot;data&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;请求参数值为:null&quot;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;如下说明校验生效了。&lt;/p&gt;
&lt;h1&gt;支持的校验标签&lt;/h1&gt;
&lt;h2&gt;1、javax.validation 包下&lt;/h2&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;meta-data&lt;/th&gt;
&lt;th&gt;comment&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;AssertFalse&lt;/td&gt;
&lt;td&gt;布尔，为False&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;AssertTrue&lt;/td&gt;
&lt;td&gt;布尔，为True&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;DecimalMax&lt;/td&gt;
&lt;td&gt;数字，最大为value&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;DecimalMin&lt;/td&gt;
&lt;td&gt;数字，最小为value&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;Digits&lt;/td&gt;
&lt;td&gt;数字，是否等于某个值&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;Email&lt;/td&gt;
&lt;td&gt;邮箱&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;Future&lt;/td&gt;
&lt;td&gt;是否是未来时间&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;FutureOrPresent&lt;/td&gt;
&lt;td&gt;时间是否是将来或者现在&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;Max&lt;/td&gt;
&lt;td&gt;数字，最大为value&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;Min&lt;/td&gt;
&lt;td&gt;数字，最小为value&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;Negative&lt;/td&gt;
&lt;td&gt;数字，是否是负数&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;NegativeOrZero&lt;/td&gt;
&lt;td&gt;数字，负数或0&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;NotBlank&lt;/td&gt;
&lt;td&gt;字符串，不为空字符串&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;NotEmpty&lt;/td&gt;
&lt;td&gt;集合，不为空,对于List类型或者是数组类型&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;NotNull&lt;/td&gt;
&lt;td&gt;对象，不为空&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;Null&lt;/td&gt;
&lt;td&gt;对象，为空&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;Past&lt;/td&gt;
&lt;td&gt;日期，过去的日期&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;PastOrPresent&lt;/td&gt;
&lt;td&gt;过去或者现在&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;Pattern&lt;/td&gt;
&lt;td&gt;字符串，正则校验&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;Positive&lt;/td&gt;
&lt;td&gt;数字，正数&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;PositiveOrZero&lt;/td&gt;
&lt;td&gt;数字，正数或0&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;Size&lt;/td&gt;
&lt;td&gt;min&amp;#x3C;=value&amp;#x3C;=max&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h1&gt;源码&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;Github&lt;/code&gt;:&lt;code class=&quot;language-text&quot;&gt;https://github.com/lengrongfu/validate-common-demo&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;</content:encoded></item><item><title><![CDATA[Kubernetes 入门学习]]></title><description><![CDATA[Kubernetes创建一个集群 Kubernetes 集群 是一个计算机资源的协调器，将这些计算机连接起来作为一个工作单元。以更有效的方式自动化跨集群分发和调度应用程序容器。主要由两部分组成，协调集群，是应用程序的工作节点。 module_01_cluster…]]></description><link>https://lengrongfu.github.io/2018-12-12-Kubernetes-Setup/</link><guid isPermaLink="false">https://lengrongfu.github.io/2018-12-12-Kubernetes-Setup/</guid><pubDate>Wed, 12 Dec 2018 17:42:32 GMT</pubDate><content:encoded>&lt;h1&gt;Kubernetes创建一个集群&lt;/h1&gt;
&lt;h3&gt;Kubernetes 集群&lt;/h3&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;Kubernetes&lt;/code&gt;是一个计算机资源的协调器，将这些计算机连接起来作为一个工作单元。&lt;code class=&quot;language-text&quot;&gt;Kubernetes&lt;/code&gt;以更有效的方式自动化跨集群分发和调度应用程序容器。&lt;code class=&quot;language-text&quot;&gt;Kubernetes&lt;/code&gt;主要由两部分组成，&lt;code class=&quot;language-text&quot;&gt;Master&lt;/code&gt;协调集群，&lt;code class=&quot;language-text&quot;&gt;Nodes&lt;/code&gt;是应用程序的工作节点。&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;module_01_cluster.svg&quot; alt=&quot;module_01_cluster&quot;&gt;&lt;/p&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;Master&lt;/code&gt;是负责管理集群的，&lt;code class=&quot;language-text&quot;&gt;Noes&lt;/code&gt;是虚拟机或者是物理机，用作&lt;code class=&quot;language-text&quot;&gt;Kubernetes&lt;/code&gt;中的工作节点。每一个&lt;code class=&quot;language-text&quot;&gt;Node&lt;/code&gt;节点都有一个&lt;code class=&quot;language-text&quot;&gt;Kubelet&lt;/code&gt;。
&lt;code class=&quot;language-text&quot;&gt;Minikube&lt;/code&gt;是一种轻量级&lt;code class=&quot;language-text&quot;&gt;Kubernetes&lt;/code&gt;实现，可在本地计算机上创建VM并部署仅包含一个节点的简单集群.可以在&lt;code class=&quot;language-text&quot;&gt;Linux&lt;/code&gt;或者&lt;code class=&quot;language-text&quot;&gt;Macos&lt;/code&gt;上通过&lt;a href=&quot;https://kubernetes.io/docs/tasks/tools/install-minikube/&quot;&gt;Minikube&lt;/a&gt;部署一个只有单节点的&lt;code class=&quot;language-text&quot;&gt;k8s&lt;/code&gt;集群。&lt;/p&gt;
&lt;h3&gt;使用minikube创建一个k8s集群&lt;/h3&gt;
&lt;p&gt;1、先查看本地是否安装&lt;code class=&quot;language-text&quot;&gt;minikube&lt;/code&gt;,执行命令:&lt;code class=&quot;language-text&quot;&gt;minikube version&lt;/code&gt;,如果本地安装就能看到结果。
2、启动集群，使用命令&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;shell&quot;&gt;&lt;pre class=&quot;language-shell&quot;&gt;&lt;code class=&quot;language-shell&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;# 执行启动之后就能看到如下的日志&lt;/span&gt;
$ minikube start
Starting &lt;span class=&quot;token builtin class-name&quot;&gt;local&lt;/span&gt; Kubernetes v1.10.0 cluster&lt;span class=&quot;token punctuation&quot;&gt;..&lt;/span&gt;.
Starting VM&lt;span class=&quot;token punctuation&quot;&gt;..&lt;/span&gt;.
Getting VM IP address&lt;span class=&quot;token punctuation&quot;&gt;..&lt;/span&gt;.
Moving files into cluster&lt;span class=&quot;token punctuation&quot;&gt;..&lt;/span&gt;.
Setting up certs&lt;span class=&quot;token punctuation&quot;&gt;..&lt;/span&gt;.
Connecting to cluster&lt;span class=&quot;token punctuation&quot;&gt;..&lt;/span&gt;.
Setting up kubeconfig&lt;span class=&quot;token punctuation&quot;&gt;..&lt;/span&gt;.
Starting cluster components&lt;span class=&quot;token punctuation&quot;&gt;..&lt;/span&gt;.
Kubectl is now configured to use the cluster.
Loading cached images from config file.&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;3、查看启动的&lt;code class=&quot;language-text&quot;&gt;k8s&lt;/code&gt;集群：&lt;code class=&quot;language-text&quot;&gt;kubectl version&lt;/code&gt;,执行这条命令之后会看到客户端和服务端的版本，客户端版本是&lt;code class=&quot;language-text&quot;&gt;kubectl&lt;/code&gt;的，服务端版本是&lt;code class=&quot;language-text&quot;&gt;Kubernetes&lt;/code&gt;的版本，
4、查看集群详细信息：&lt;code class=&quot;language-text&quot;&gt;kubectl cluster-info&lt;/code&gt;
5、查看拥有节点：&lt;code class=&quot;language-text&quot;&gt;kubectl get nodes&lt;/code&gt;，即可得出所有的可用节点，状态为&lt;code class=&quot;language-text&quot;&gt;Ready&lt;/code&gt;,标示已经准备好可以处理应用。&lt;/p&gt;
&lt;h1&gt;使用kubectl去部署一个应用&lt;/h1&gt;</content:encoded></item><item><title><![CDATA[Container Networking 标准]]></title><description><![CDATA[…]]></description><link>https://lengrongfu.github.io/2018-12-05-Container-Networking-Standards/</link><guid isPermaLink="false">https://lengrongfu.github.io/2018-12-05-Container-Networking-Standards/</guid><pubDate>Wed, 05 Dec 2018 11:53:50 GMT</pubDate><content:encoded>&lt;h1&gt;容器网络概括&lt;/h1&gt;
&lt;p&gt;容器正在改变应用程序的开发方式以及应用程序连接网络的方式，大多数讨论容器都是在讨论容器编排，比如：&lt;code class=&quot;language-text&quot;&gt;k8s&lt;/code&gt;,&lt;code class=&quot;language-text&quot;&gt;swarm&lt;/code&gt;,这是因为开发首先能接触到的就是容器的编排，但是，网络对于生产部署至关重要，因为网络需要自动化，可扩展且安全，以适应于下一代的混合云的应用架构。&lt;/p&gt;
&lt;h1&gt;容器与虚拟机的网络连接&lt;/h1&gt;
&lt;h1&gt;参考指南&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;http://www.nuagenetworks.net/blog/container-networking-standards/&quot;&gt;http://www.nuagenetworks.net/blog/container-networking-standards/&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;</content:encoded></item><item><title><![CDATA[docker 多阶段构建]]></title><description><![CDATA[…]]></description><link>https://lengrongfu.github.io/2018-11-27-docker-multi-stage-builds/</link><guid isPermaLink="false">https://lengrongfu.github.io/2018-11-27-docker-multi-stage-builds/</guid><pubDate>Tue, 27 Nov 2018 18:13:38 GMT</pubDate><content:encoded>&lt;blockquote&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;docker&lt;/code&gt;多阶段构建出现主要是为了解决一些在容器中进行编译工作，然后运行时容器只需要编译时容器的结果，不需要整个编译环境被依赖，减少镜像的大小。
多阶段构建是从&lt;code class=&quot;language-text&quot;&gt;docker&lt;/code&gt;的&lt;code class=&quot;language-text&quot;&gt;17.3&lt;/code&gt;之后开始的，以前一个&lt;code class=&quot;language-text&quot;&gt;Dockerfile&lt;/code&gt;中只能有一个&lt;code class=&quot;language-text&quot;&gt;FROM&lt;/code&gt;指令，从多阶段构建出现之后就可以在一个&lt;code class=&quot;language-text&quot;&gt;Dockerfile&lt;/code&gt;中进行多个&lt;code class=&quot;language-text&quot;&gt;FROM&lt;/code&gt;的引用。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h1&gt;多阶段构建出现以前&lt;/h1&gt;
&lt;blockquote&gt;
&lt;p&gt;在多阶段构建出现以前，需要单独写一个&lt;code class=&quot;language-text&quot;&gt;Dockerfile&lt;/code&gt;出来进行构建，然后再写一个&lt;code class=&quot;language-text&quot;&gt;Dockerfile&lt;/code&gt;来做运行时的镜像，再通过写一个脚步来把两个镜像的结果拼接起来。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;ul&gt;
&lt;li&gt;vim Dockerfile.build&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;dockerfile&quot;&gt;&lt;pre class=&quot;language-dockerfile&quot;&gt;&lt;code class=&quot;language-dockerfile&quot;&gt;&lt;span class=&quot;token instruction&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;FROM&lt;/span&gt; golang:1.7.3&lt;/span&gt;
&lt;span class=&quot;token instruction&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;WORKDIR&lt;/span&gt; /go/src/test/multi-stage-demo&lt;/span&gt;
&lt;span class=&quot;token instruction&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;COPY&lt;/span&gt; . .&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;#RUN cd /test/multi-stage-demo&lt;/span&gt;
&lt;span class=&quot;token instruction&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;RUN&lt;/span&gt; CGO_ENABLED=0 GOOS=linux go build -a -installsuffix cgo -o main .&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;ul&gt;
&lt;li&gt;vim Dockerfile.run&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;dockerfile&quot;&gt;&lt;pre class=&quot;language-dockerfile&quot;&gt;&lt;code class=&quot;language-dockerfile&quot;&gt;&lt;span class=&quot;token instruction&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;FROM&lt;/span&gt; scratch&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;# 多个文件copy&lt;/span&gt;
&lt;span class=&quot;token instruction&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;COPY&lt;/span&gt; main &lt;span class=&quot;token operator&quot;&gt;\&lt;/span&gt;
     config.json &lt;span class=&quot;token operator&quot;&gt;\&lt;/span&gt;
     /root/&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;# 暴露端口    &lt;/span&gt;
&lt;span class=&quot;token instruction&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;EXPOSE&lt;/span&gt; 80&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;# 运行&lt;/span&gt;
&lt;span class=&quot;token instruction&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;ENTRYPOINT&lt;/span&gt; [ &lt;span class=&quot;token string&quot;&gt;&quot;/root/main&quot;&lt;/span&gt;,&lt;span class=&quot;token string&quot;&gt;&quot;-conf=/root/config.json&quot;&lt;/span&gt; ]&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;ul&gt;
&lt;li&gt;vim build.sh&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;shell&quot;&gt;&lt;pre class=&quot;language-shell&quot;&gt;&lt;code class=&quot;language-shell&quot;&gt;&lt;span class=&quot;token shebang important&quot;&gt;#! /bin/bash&lt;/span&gt;
&lt;span class=&quot;token builtin class-name&quot;&gt;echo&lt;/span&gt; Building main:build
&lt;span class=&quot;token comment&quot;&gt;# 开始构建构建镜像&lt;/span&gt;
docker build -t main:build -f Dockerfile.build &lt;span class=&quot;token builtin class-name&quot;&gt;.&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;# 创建构建容器，但是不运行，不能用run，run是包含了create和start两个命令&lt;/span&gt;
docker container create --name extract main:build
&lt;span class=&quot;token comment&quot;&gt;# 复制容器中的两个文件&lt;/span&gt;
docker container &lt;span class=&quot;token function&quot;&gt;cp&lt;/span&gt; extract:/go/src/test/multi-stage-demo/main ./main
docker container &lt;span class=&quot;token function&quot;&gt;cp&lt;/span&gt; extract:/go/src/test/multi-stage-demo/config.json ./config-run.json
&lt;span class=&quot;token comment&quot;&gt;# 删除创建的容器&lt;/span&gt;
docker container &lt;span class=&quot;token function&quot;&gt;rm&lt;/span&gt; -f extract
&lt;span class=&quot;token comment&quot;&gt;# 删除构建镜像&lt;/span&gt;
docker rmi main:build
&lt;span class=&quot;token builtin class-name&quot;&gt;echo&lt;/span&gt; Building main:latest
&lt;span class=&quot;token comment&quot;&gt;# 开始构建运行时镜像&lt;/span&gt;
docker build --no-cache -t main:latest &lt;span class=&quot;token builtin class-name&quot;&gt;.&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;# 删除拷贝到本地的文件&lt;/span&gt;
&lt;span class=&quot;token function&quot;&gt;rm&lt;/span&gt; ./main ./config-run.json
&lt;span class=&quot;token builtin class-name&quot;&gt;echo&lt;/span&gt; Building Success.&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;通过上面的三个步骤就可以进行自动化的构建和打包运行时，但是这样比较麻烦，需要写&lt;code class=&quot;language-text&quot;&gt;Dockerfile.build&lt;/code&gt;和&lt;code class=&quot;language-text&quot;&gt;Dockerfile.run&lt;/code&gt;两个&lt;code class=&quot;language-text&quot;&gt;Dockerfile&lt;/code&gt;文件，还需要写一个构建脚本&lt;code class=&quot;language-text&quot;&gt;build.sh&lt;/code&gt;,最后通过运行脚本来打包镜像，这样比较麻烦，每个项目都需要维护多个文件。&lt;/p&gt;
&lt;h1&gt;多阶段构建出现以后&lt;/h1&gt;
&lt;blockquote&gt;
&lt;p&gt;使用多阶段构建如上的步骤就非常简单&lt;/p&gt;
&lt;/blockquote&gt;
&lt;ul&gt;
&lt;li&gt;vim Dockerfile&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;dockerfile&quot;&gt;&lt;pre class=&quot;language-dockerfile&quot;&gt;&lt;code class=&quot;language-dockerfile&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;# 第一步，构建&lt;/span&gt;
&lt;span class=&quot;token instruction&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;FROM&lt;/span&gt; golang:1.7.3 &lt;span class=&quot;token keyword&quot;&gt;as&lt;/span&gt; build&lt;/span&gt;
&lt;span class=&quot;token instruction&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;WORKDIR&lt;/span&gt; /go/src/test/multi-stage-demo&lt;/span&gt;
&lt;span class=&quot;token instruction&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;COPY&lt;/span&gt; . .&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;#RUN cd /test/multi-stage-demo&lt;/span&gt;
&lt;span class=&quot;token instruction&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;RUN&lt;/span&gt; CGO_ENABLED=0 GOOS=linux go build -a -installsuffix cgo -o main .&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;# 第二部，运行&lt;/span&gt;
&lt;span class=&quot;token instruction&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;FROM&lt;/span&gt; scratch&lt;/span&gt;

&lt;span class=&quot;token instruction&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;COPY&lt;/span&gt; &lt;span class=&quot;token options&quot;&gt;&lt;span class=&quot;token property&quot;&gt;--from&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;build&lt;/span&gt;&lt;/span&gt; /go/src/test/multi-stage-demo/main &lt;span class=&quot;token operator&quot;&gt;\&lt;/span&gt;
                 /go/src/test/multi-stage-demo/config.json &lt;span class=&quot;token operator&quot;&gt;\&lt;/span&gt;
                 /go/src/test/multi-stage-demo/docker-entrypoint.sh &lt;span class=&quot;token operator&quot;&gt;\&lt;/span&gt;
                /root/&lt;/span&gt;
&lt;span class=&quot;token instruction&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;EXPOSE&lt;/span&gt; 80&lt;/span&gt;

&lt;span class=&quot;token instruction&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;ENTRYPOINT&lt;/span&gt; [ &lt;span class=&quot;token string&quot;&gt;&quot;/root/main&quot;&lt;/span&gt;,&lt;span class=&quot;token string&quot;&gt;&quot;-conf=/root/config.json&quot;&lt;/span&gt; ]&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;上面主要是第二步比较陌生，&lt;code class=&quot;language-text&quot;&gt;COPY&lt;/code&gt;命令中的&lt;code class=&quot;language-text&quot;&gt;--from=build&lt;/code&gt;是指从构建阶段中复制文件。而不是当前的上下文中，所以复制的路径需要指定为第一个阶段构建结果存储的路径。&lt;code class=&quot;language-text&quot;&gt;--from=0&lt;/code&gt;也可以这样写，这样就不需要给第一步一个别名，直接这样写就行了，&lt;code class=&quot;language-text&quot;&gt;FROM golang:1.7.3&lt;/code&gt;。其他的都是和正常的&lt;code class=&quot;language-text&quot;&gt;Dockerfile&lt;/code&gt;没有区别的。&lt;/p&gt;
&lt;p&gt;通过&lt;code class=&quot;language-text&quot;&gt;docker build -t main .&lt;/code&gt;就可以进行如上的打包。&lt;/p&gt;
&lt;h1&gt;golang 项目中多阶段构建依赖问题&lt;/h1&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;Golang&lt;/code&gt;项目如果没有使用&lt;code class=&quot;language-text&quot;&gt;vender&lt;/code&gt;进行管理的话，使用多阶段构建就会出现问题，前提是有依赖其他第三方包，因为在&lt;code class=&quot;language-text&quot;&gt;Copy&lt;/code&gt;的时候只会把当前项目下的文件复制进构建容器中，而复制不到项目之外的文件，打包的时候就会因为找不到依赖包而打包不成功，比如一个项目使用了&lt;code class=&quot;language-text&quot;&gt;uber&lt;/code&gt;的日志包&lt;code class=&quot;language-text&quot;&gt;&quot;go.uber.org/zap&quot;&lt;/code&gt;,但是打包的时候会因为找不到依赖包构建不通过。不建议在构建时再去拉取这些依赖包，这样可能会出现开发和生产上使用的依赖包代码不一致的问题。
针对上述问题目前我想到的两个办法时：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;1、修改构建的上下文，改为&lt;code class=&quot;language-text&quot;&gt;src&lt;/code&gt;,把&lt;code class=&quot;language-text&quot;&gt;Golang&lt;/code&gt;的本地的&lt;code class=&quot;language-text&quot;&gt;src&lt;/code&gt;都复制进容器中去构建，这样能通过，但是只能用于个人，公司项目一般都是有单独的服务器进行构建。这样可能会比较大。&lt;/li&gt;
&lt;li&gt;2、使用&lt;code class=&quot;language-text&quot;&gt;dep&lt;/code&gt;管理，就是&lt;code class=&quot;language-text&quot;&gt;Golang&lt;/code&gt;的包管理工具，把依赖包都集成到项目的&lt;code class=&quot;language-text&quot;&gt;vender&lt;/code&gt;中来，这样打包的时候就能找到依赖包。我认为这样时比较好的办法，而且对开发也方便，便于依赖包的统一管理。&lt;/li&gt;
&lt;/ul&gt;
&lt;h1&gt;多阶段构建适用的场景&lt;/h1&gt;
&lt;p&gt;一般只有需要依赖有单独的编译环境的项目使用多阶段构建才比较适合，比如前端的项目，需要使用&lt;code class=&quot;language-text&quot;&gt;node&lt;/code&gt;进行编译，这样就可以写一个编译容器出来进行单独的编译。&lt;/p&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;Golang&lt;/code&gt;和&lt;code class=&quot;language-text&quot;&gt;Docker&lt;/code&gt;集成工具 &lt;a href=&quot;https://github.com/drone/drone&quot;&gt;drone&lt;/a&gt;.&lt;/p&gt;
&lt;h1&gt;参考&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;项目源码路径：&lt;a href=&quot;https://github.com/lengrongfu/multi-stage-demo/tree/master&quot;&gt;https://github.com/lengrongfu/multi-stage-demo/tree/master&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;use-multi-stage-builds：&lt;a href=&quot;https://docs.docker.com/develop/develop-images/multistage-build/#use-multi-stage-builds&quot;&gt;https://docs.docker.com/develop/develop-images/multistage-build/#use-multi-stage-builds&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;</content:encoded></item><item><title><![CDATA[docker 网络概念]]></title><description><![CDATA[容器的网络模型 的网络架构是构建在一组称为容器网络模型(CNM)的接口之上的。这个CNM的原理是为了提供多种不同的基础系统架构的应用程可用性。
最初的容器网络设计只关注如何在单个主机上运行容器并使他们可以从网络访问；在模式下，容器在主机的中运行并使用主机IP…]]></description><link>https://lengrongfu.github.io/2018-11-25-docker-network-concept/</link><guid isPermaLink="false">https://lengrongfu.github.io/2018-11-25-docker-network-concept/</guid><pubDate>Sun, 25 Nov 2018 14:13:48 GMT</pubDate><content:encoded>&lt;h1&gt;容器的网络模型&lt;/h1&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;Docker&lt;/code&gt;的网络架构是构建在一组称为容器网络模型(CNM)的接口之上的。这个CNM的原理是为了提供多种不同的基础系统架构的应用程可用性。
最初的容器网络设计只关注如何在单个主机上运行容器并使他们可以从网络访问；在&lt;code class=&quot;language-text&quot;&gt;host&lt;/code&gt;模式下，容器在主机的&lt;code class=&quot;language-text&quot;&gt;Network Namespace&lt;/code&gt;中运行并使用主机IP地址，暴露容器端口在主机外面，容器会使用主机的端口。
这个&lt;code class=&quot;language-text&quot;&gt;bridge&lt;/code&gt;模式对&lt;code class=&quot;language-text&quot;&gt;host&lt;/code&gt;模式进行了改进，在&lt;code class=&quot;language-text&quot;&gt;Bridge&lt;/code&gt;模式下，容器通过&lt;code class=&quot;language-text&quot;&gt;IPAM&lt;/code&gt;IP地址管理模块来提供IP，从它自己的网络空间中获取自己的网络IP，此时容器有自己的网络命名空间，不会出现端口冲突，但是容器如果要暴露服务在主机外部，仍然需要使用主机IP。该技术是使用的&lt;code class=&quot;language-text&quot;&gt;NAT&lt;/code&gt;网络地址转换实现的，在主机IP:主机端口和容器IP:容器端口之间进行映射，这些转换规则是使用&lt;code class=&quot;language-text&quot;&gt;iptables&lt;/code&gt;实现的，这种实现限制了解决方案的规模和性能。此方案并没有解决多主机的容器网络通信问题。&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;cnm.png&quot; alt=&quot;cnm&quot;&gt;&lt;/p&gt;
&lt;h2&gt;CNM 结构&lt;/h2&gt;
&lt;p&gt;上图是&lt;code class=&quot;language-text&quot;&gt;CNM&lt;/code&gt;中的几个高级结构，他们都是和&lt;code class=&quot;language-text&quot;&gt;&apos;OS&lt;/code&gt;无关的。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Sandbox：沙箱包含网络容器的配置，这包括管理容器的接口，路由表和&lt;code class=&quot;language-text&quot;&gt;DNS&lt;/code&gt;配置，沙箱是通过&lt;code class=&quot;language-text&quot;&gt;Linux&lt;/code&gt;的命名空间实现的。一个容器就是一个沙箱盒子。&lt;/li&gt;
&lt;li&gt;Endpoint：一个&lt;code class=&quot;language-text&quot;&gt;Endpoint&lt;/code&gt;连接一个沙箱和一个网络。&lt;/li&gt;
&lt;li&gt;Network：&lt;code class=&quot;language-text&quot;&gt;CNM&lt;/code&gt;没有根据&lt;code class=&quot;language-text&quot;&gt;OSI&lt;/code&gt;模型指定网络，&lt;/li&gt;
&lt;/ul&gt;
&lt;h1&gt;CNM 驱动接口&lt;/h1&gt;
&lt;p&gt;这个CNM模型提供了两个插件和开放接口提供给用户使用，可以使用他们它们来对网络的功能进行控制。&lt;/p&gt;
&lt;h2&gt;网络驱动的类型&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;网络驱动程序：&lt;code class=&quot;language-text&quot;&gt;Docker&lt;/code&gt;网络驱动程序是网络功能的实现，它们是可拔插的，因此可以使用不同的驱动程序提供给不通的应用使用，在集群中可以使用多个网络驱动器，但是单个&lt;code class=&quot;language-text&quot;&gt;Docker&lt;/code&gt;网络只能通过单个网络驱动程序实现，有两种类型的CNM网络驱动程序。&lt;/li&gt;
&lt;li&gt;
&lt;ul&gt;
&lt;li&gt;内置网络驱动程序：&lt;code class=&quot;language-text&quot;&gt;Docker&lt;/code&gt;引擎内置了几种网络驱动程序，比如，网络驱动，overlay 驱动。&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;ul&gt;
&lt;li&gt;插件网络驱动程序：是由社区或者其他供应商提供的，用于与现有软件和硬件的提成，用户还可以自己实现。&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;IPAM 驱动：&lt;code class=&quot;language-text&quot;&gt;Docker&lt;/code&gt;有内置的&lt;code class=&quot;language-text&quot;&gt;IP&lt;/code&gt;地址管理器，如果未指定，则使用默认的子网和网络，用户也可指定子网和网关。&lt;/li&gt;
&lt;/ul&gt;
&lt;h2&gt;Docker内置网络驱动程序&lt;/h2&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;Docker&lt;/code&gt;内置网络驱动程序是引擎的一部分，不需要任何其他模块，通过使用&lt;code class=&quot;language-text&quot;&gt;docker network&lt;/code&gt;命令来创建和使用网络模块。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Bridge：&lt;code class=&quot;language-text&quot;&gt;Bridge&lt;/code&gt;驱动程序在宿主机上创建&lt;code class=&quot;language-text&quot;&gt;Linux&lt;/code&gt;网桥，网桥上的容器默认可以通信，也可以配置对容器的外部访问。&lt;/li&gt;
&lt;li&gt;Overlay：&lt;code class=&quot;language-text&quot;&gt;overlay&lt;/code&gt;驱动程序在宿主机上创建一个覆盖网络，支持开箱即用的多主机网络，通过使用&lt;code class=&quot;language-text&quot;&gt;linux&lt;/code&gt;网桥和&lt;code class=&quot;language-text&quot;&gt;VXLAN&lt;/code&gt;让宿主机上物理网络来实现容器到容器的多主机通信。&lt;/li&gt;
&lt;li&gt;MACVLAN：&lt;code class=&quot;language-text&quot;&gt;macvlan&lt;/code&gt;驱动程序使用&lt;code class=&quot;language-text&quot;&gt;macvlan&lt;/code&gt;桥接模式在容器和宿主机之间建立连接。&lt;/li&gt;
&lt;li&gt;Host：使用&lt;code class=&quot;language-text&quot;&gt;host&lt;/code&gt;驱动程序，容器将使用宿主机的网络栈，主机上的所有接口都可以由容器使用。&lt;/li&gt;
&lt;li&gt;None：&lt;code class=&quot;language-text&quot;&gt;none&lt;/code&gt;驱动程序为容器提供自己的网络堆栈和命名空间，但不配置接口，如果没有其他配置，容器将于宿主机网络完全隔离。&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;默认情况下一个&lt;code class=&quot;language-text&quot;&gt;Docker&lt;/code&gt;主机上有&lt;code class=&quot;language-text&quot;&gt;none&lt;/code&gt;,&lt;code class=&quot;language-text&quot;&gt;bridge&lt;/code&gt;,&lt;code class=&quot;language-text&quot;&gt;host&lt;/code&gt;三种网络驱动程序，这些网络程序不能被删除，当使用&lt;code class=&quot;language-text&quot;&gt;Swarm&lt;/code&gt;时，会添加两个网络，一个是叫&lt;code class=&quot;language-text&quot;&gt;docker_gwbridge&lt;/code&gt;的&lt;code class=&quot;language-text&quot;&gt;bridge&lt;/code&gt;网络，还有一个是叫&lt;code class=&quot;language-text&quot;&gt;ingress&lt;/code&gt;的&lt;code class=&quot;language-text&quot;&gt;overlay&lt;/code&gt;的网络程序，这两个网络是自动创建在整个集群中的。&lt;/p&gt;
&lt;h1&gt;Linux 网络原理&lt;/h1&gt;
&lt;h1&gt;名词解释&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https://cizixs.com/2017/02/10/network-virtualization-network-namespace/&quot;&gt;Network Namespace&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;网络命名空间。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https://en.wikipedia.org/wiki/Network_address_translation&quot;&gt;NAT&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;网络地址转换，这是一种网络虚拟化的技术，是为了解决IP不够用的问题。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https://en.wikipedia.org/wiki/IP_address_management&quot;&gt;IPAM&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;IP地址管理,对应于CNM模型中的IPAM模块，提供IP管理和生成。&lt;/p&gt;
&lt;h1&gt;参考文档&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https://github.com/docker/libnetwork/blob/master/docs/design.md&quot;&gt;CNM 设计&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://docs.docker.com/engine/extend/legacy_plugins/#installing-a-plugin&quot;&gt;Docker 引擎添加插件&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;</content:encoded></item><item><title><![CDATA[docker Compose 使用]]></title><description><![CDATA[Docker Compose 是什么  是一个用来定义和运行多个应用的工具，通过 可以在一个文件中定一个多个容器，然后通过一个命令启动你的应用程序。 github.com/docker/compose Docker Compose 命令 Command Purpose build…]]></description><link>https://lengrongfu.github.io/2018-11-24-docker-Compose-user/</link><guid isPermaLink="false">https://lengrongfu.github.io/2018-11-24-docker-Compose-user/</guid><pubDate>Sat, 24 Nov 2018 19:25:56 GMT</pubDate><content:encoded>&lt;h1&gt;Docker Compose 是什么&lt;/h1&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;Docker Compose&lt;/code&gt; 是一个用来定义和运行多个&lt;code class=&quot;language-text&quot;&gt;Docker&lt;/code&gt;应用的工具，通过&lt;code class=&quot;language-text&quot;&gt;Compose&lt;/code&gt; 可以在一个文件中定一个多个容器，然后通过一个命令启动你的应用程序。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;github.com/docker/compose&quot;&gt;github.com/docker/compose&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h1&gt;Docker Compose 命令&lt;/h1&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;Command&lt;/th&gt;
&lt;th&gt;Purpose&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;build&lt;/td&gt;
&lt;td&gt;Build or rebuild services&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;help&lt;/td&gt;
&lt;td&gt;Get help on a command&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;kill&lt;/td&gt;
&lt;td&gt;Kill containers&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;logs&lt;/td&gt;
&lt;td&gt;View output from containers&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;port&lt;/td&gt;
&lt;td&gt;Print the public port for a port binding&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;ps&lt;/td&gt;
&lt;td&gt;List containers&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;pull&lt;/td&gt;
&lt;td&gt;Pulls service images&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;restart&lt;/td&gt;
&lt;td&gt;Restart services&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;rm&lt;/td&gt;
&lt;td&gt;Remove stopped containers&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;run&lt;/td&gt;
&lt;td&gt;Run a one-off command&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;scale&lt;/td&gt;
&lt;td&gt;Set number of containers for a service&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;start&lt;/td&gt;
&lt;td&gt;Start services&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;stop&lt;/td&gt;
&lt;td&gt;Stop services&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;up&lt;/td&gt;
&lt;td&gt;Create and start containers&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h1&gt;第一个应用&lt;/h1&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;yml&quot;&gt;&lt;pre class=&quot;language-yml&quot;&gt;&lt;code class=&quot;language-yml&quot;&gt;&lt;span class=&quot;token key atrule&quot;&gt;version&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;3.6&apos;&lt;/span&gt;
&lt;span class=&quot;token key atrule&quot;&gt;services&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;db&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;token key atrule&quot;&gt;container_name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; db
    &lt;span class=&quot;token key atrule&quot;&gt;image&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; mysql&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;8&lt;/span&gt;
    &lt;span class=&quot;token key atrule&quot;&gt;environment&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
      &lt;span class=&quot;token key atrule&quot;&gt;MYSQL_DATABASE&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; employees
      &lt;span class=&quot;token key atrule&quot;&gt;MYSQL_USER&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; mysql
      &lt;span class=&quot;token key atrule&quot;&gt;MYSQL_PASSWORD&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; mysql
      &lt;span class=&quot;token key atrule&quot;&gt;MYSQL_ROOT_PASSWORD&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; supersecret
    &lt;span class=&quot;token key atrule&quot;&gt;ports&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
      &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; 3306&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;3306&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;web&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;token key atrule&quot;&gt;image&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; arungupta/docker&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;javaee&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;dockerconeu17
    &lt;span class=&quot;token key atrule&quot;&gt;ports&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
      &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; 8080&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;8080&lt;/span&gt;
      &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; 9990&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;9990&lt;/span&gt;
    &lt;span class=&quot;token key atrule&quot;&gt;depends_on&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
      &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; db&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;ul&gt;
&lt;li&gt;文件讲解&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;1、此&lt;code class=&quot;language-text&quot;&gt;Compose&lt;/code&gt;文件定义了两个服务，一个是&lt;code class=&quot;language-text&quot;&gt;db&lt;/code&gt;,还有一个是&lt;code class=&quot;language-text&quot;&gt;web&lt;/code&gt;.
2、使用&lt;code class=&quot;language-text&quot;&gt;image&lt;/code&gt;属性定义服务运行的镜像名。
3、&lt;code class=&quot;language-text&quot;&gt;environment&lt;/code&gt;环境变量用来设置服务中写&lt;code class=&quot;language-text&quot;&gt;dockerfile&lt;/code&gt;时的环境变量。
4、&lt;code class=&quot;language-text&quot;&gt;web&lt;/code&gt;服务需要使用&lt;code class=&quot;language-text&quot;&gt;db&lt;/code&gt;服务。
5、&lt;code class=&quot;language-text&quot;&gt;ports&lt;/code&gt;是服务暴露的端口和转发到容器中的端口上。
6、&lt;code class=&quot;language-text&quot;&gt;depends_on&lt;/code&gt;属性是用于设置有依赖关系服务的，此处&lt;code class=&quot;language-text&quot;&gt;web&lt;/code&gt;需要依赖&lt;code class=&quot;language-text&quot;&gt;db&lt;/code&gt;先启动，所以需要如此设置。&lt;/p&gt;
&lt;h1&gt;开始运行&lt;/h1&gt;
&lt;p&gt;创建和启动&lt;code class=&quot;language-text&quot;&gt;Compose&lt;/code&gt;命令：&lt;code class=&quot;language-text&quot;&gt;docker-compose up -d&lt;/code&gt;，如果&lt;code class=&quot;language-text&quot;&gt;compose&lt;/code&gt;的文件名不是默认的，可以通过指定&lt;code class=&quot;language-text&quot;&gt;-f a-compose.yml&lt;/code&gt;一个自定义的文件名。
运行之后如果本地没有这个镜像，那么会先去拉取镜像，然后运行，等运行完后，查看&lt;code class=&quot;language-text&quot;&gt;docker-compose ps&lt;/code&gt;.&lt;/p&gt;
&lt;h1&gt;查看日志&lt;/h1&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;docker-compose logs&lt;/code&gt; 可以查看多个服务的日志。&lt;/p&gt;
&lt;h1&gt;停止服务&lt;/h1&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;docker-compose kill&lt;/code&gt;会停止服务，但是不会删除，感觉和&lt;code class=&quot;language-text&quot;&gt;docker-compose stop&lt;/code&gt;的作用差不多，通过执行&lt;code class=&quot;language-text&quot;&gt;docker-compose start&lt;/code&gt; 命令可以再次启动服务。如果想要停止并删除服务，就需要执行&lt;code class=&quot;language-text&quot;&gt;docker-compose down&lt;/code&gt;命令。&lt;/p&gt;
&lt;h1&gt;自定义网络&lt;/h1&gt;
&lt;p&gt;使用&lt;code class=&quot;language-text&quot;&gt;compose&lt;/code&gt;启动的服务都会启动一个自定义的网络，一般命名是项目名加上网络名，如果未命名网络名，就使用&lt;code class=&quot;language-text&quot;&gt;default&lt;/code&gt;来定义。
比如：如下我创建了一个网络名为&lt;code class=&quot;language-text&quot;&gt;com-demo&lt;/code&gt;的&lt;code class=&quot;language-text&quot;&gt;bridge&lt;/code&gt;网络模型。&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;yml&quot;&gt;&lt;pre class=&quot;language-yml&quot;&gt;&lt;code class=&quot;language-yml&quot;&gt;&lt;span class=&quot;token key atrule&quot;&gt;version&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;3.6&apos;&lt;/span&gt;
&lt;span class=&quot;token key atrule&quot;&gt;services&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;db&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;token key atrule&quot;&gt;container_name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; db
    &lt;span class=&quot;token key atrule&quot;&gt;image&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; mysql&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;8&lt;/span&gt;
    &lt;span class=&quot;token key atrule&quot;&gt;environment&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
      &lt;span class=&quot;token key atrule&quot;&gt;MYSQL_DATABASE&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; employees
      &lt;span class=&quot;token key atrule&quot;&gt;MYSQL_USER&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; mysql
      &lt;span class=&quot;token key atrule&quot;&gt;MYSQL_PASSWORD&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; mysql
      &lt;span class=&quot;token key atrule&quot;&gt;MYSQL_ROOT_PASSWORD&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; supersecret
    &lt;span class=&quot;token key atrule&quot;&gt;ports&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
      &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; 3306&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;3306&lt;/span&gt;
    &lt;span class=&quot;token key atrule&quot;&gt;networks&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; 
      &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; com&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;demo
  &lt;span class=&quot;token key atrule&quot;&gt;web&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;token key atrule&quot;&gt;image&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; arungupta/docker&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;javaee&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;dockerconeu17
    &lt;span class=&quot;token key atrule&quot;&gt;ports&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
      &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; 8080&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;8080&lt;/span&gt;
      &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; 9990&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;9990&lt;/span&gt;
    &lt;span class=&quot;token key atrule&quot;&gt;depends_on&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
      &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; db
    &lt;span class=&quot;token key atrule&quot;&gt;networks&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; 
      &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; com&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;demo
&lt;span class=&quot;token key atrule&quot;&gt;networks&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; 
  &lt;span class=&quot;token key atrule&quot;&gt;com-demo&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;token key atrule&quot;&gt;driver&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; bridge&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;</content:encoded></item><item><title><![CDATA[es-xpack-machinelean]]></title><description><![CDATA[加载数据到中 创建一个机器学习 使用结果来识别数据中可能存储的异常]]></description><link>https://lengrongfu.github.io/2018-11-16-es-xpack-machinelean/</link><guid isPermaLink="false">https://lengrongfu.github.io/2018-11-16-es-xpack-machinelean/</guid><pubDate>Fri, 16 Nov 2018 16:00:53 GMT</pubDate><content:encoded>&lt;ul&gt;
&lt;li&gt;加载数据到&lt;code class=&quot;language-text&quot;&gt;Elasticsearch&lt;/code&gt;中&lt;/li&gt;
&lt;li&gt;创建一个机器学习&lt;code class=&quot;language-text&quot;&gt;job&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;使用结果来识别数据中可能存储的异常&lt;/li&gt;
&lt;/ul&gt;</content:encoded></item><item><title><![CDATA[docker network 入门]]></title><description><![CDATA[Networking Basics 单主机 Bridge Driver 网桥驱动 当创建一个的网络驱动时这个模型是默认的，这个驱动创建了一个私有的网络环境，并在主机提供了一个外部端口以供外部使用。 当一个IP地址不指定时，端口会被映射到所有网卡上，0.0.0.0:800…]]></description><link>https://lengrongfu.github.io/2018-11-13-docker-network-beginner/</link><guid isPermaLink="false">https://lengrongfu.github.io/2018-11-13-docker-network-beginner/</guid><pubDate>Tue, 13 Nov 2018 17:46:17 GMT</pubDate><content:encoded>&lt;h1&gt;Networking Basics&lt;/h1&gt;
&lt;h1&gt;单主机 Bridge Driver 网桥驱动&lt;/h1&gt;
&lt;blockquote&gt;
&lt;p&gt;当创建一个&lt;code class=&quot;language-text&quot;&gt;bridge&lt;/code&gt;的网络驱动时这个模型是默认的，这个驱动创建了一个私有的网络环境，并在主机提供了一个外部端口以供外部使用。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;shell&quot;&gt;&lt;pre class=&quot;language-shell&quot;&gt;&lt;code class=&quot;language-shell&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;#创建一个我们的应用用户定义的网桥网络&lt;/span&gt;
$ docker network create -d bridge catnet

&lt;span class=&quot;token comment&quot;&gt;#使用自定义的网络创建一个redis容器&lt;/span&gt;
$ docker run -d --net catnet --name cat-db redis

&lt;span class=&quot;token comment&quot;&gt;#Instantiate the web frontend on the catnet network and configure it to connect to a container named `cat-db`&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;# 实例这个web容器，使用catnet这个网络并且配置它连接到cat-db的容器实例。&lt;/span&gt;
$ docker run -d --net catnet -p &lt;span class=&quot;token number&quot;&gt;8000&lt;/span&gt;:5000 -e &lt;span class=&quot;token string&quot;&gt;&apos;DB=cat-db&apos;&lt;/span&gt; -e &lt;span class=&quot;token string&quot;&gt;&apos;ROLE=cat&apos;&lt;/span&gt; chrch/web &lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;blockquote&gt;
&lt;p&gt;当一个IP地址不指定时，端口会被映射到所有网卡上，0.0.0.0:8000，可以通过指定一个IP来只开放一个端口，&lt;code class=&quot;language-text&quot;&gt;-p 127.0.0.1:8000:5000&lt;/code&gt;,更多内容查看 &lt;a href=&quot;https://docs.docker.com/engine/reference/run/#/expose-incoming-ports&quot;&gt;Docker doc&lt;/a&gt;.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;&lt;img src=&quot;singlehost-bridge.png&quot; alt=&quot;singlehost-bridge&quot;&gt;&lt;/p&gt;
&lt;p&gt;两个容器通过同一个网桥进行网络通信，上面的&lt;code class=&quot;language-text&quot;&gt;web&lt;/code&gt;这个容器访问&lt;code class=&quot;language-text&quot;&gt;redis&lt;/code&gt;时通过&lt;code class=&quot;language-text&quot;&gt;cat-db&lt;/code&gt;这个域名进行访问，&lt;code class=&quot;language-text&quot;&gt;Docker&lt;/code&gt;引擎内部有&lt;code class=&quot;language-text&quot;&gt;DNS&lt;/code&gt;能将容器域名解析为可以访问的容器&lt;code class=&quot;language-text&quot;&gt;IP&lt;/code&gt;，因此,在&lt;code class=&quot;language-text&quot;&gt;Bridge&lt;/code&gt;模式下，多个容器都是可以通过容器名称进行访问。&lt;/p&gt;
&lt;p&gt;可以通过&lt;code class=&quot;language-text&quot;&gt;docker network inspect catnet&lt;/code&gt;查看这个网络下所以容器。&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;shell&quot;&gt;&lt;pre class=&quot;language-shell&quot;&gt;&lt;code class=&quot;language-shell&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;# 如下可以看出有两个容器是使用了这同一个网络。&lt;/span&gt;
$ docker network inspect catnet
&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;token string&quot;&gt;&quot;Name&quot;&lt;/span&gt;&lt;span class=&quot;token builtin class-name&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;catnet&quot;&lt;/span&gt;,
        &lt;span class=&quot;token string&quot;&gt;&quot;Id&quot;&lt;/span&gt;&lt;span class=&quot;token builtin class-name&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;81e45d3e3bf4f989abe87c42c8db63273f9bf30c1f5a593bae4667d5f0e33145&quot;&lt;/span&gt;,
        &lt;span class=&quot;token string&quot;&gt;&quot;Scope&quot;&lt;/span&gt;&lt;span class=&quot;token builtin class-name&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;local&quot;&lt;/span&gt;,
        &lt;span class=&quot;token string&quot;&gt;&quot;Driver&quot;&lt;/span&gt;&lt;span class=&quot;token builtin class-name&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;bridge&quot;&lt;/span&gt;,
        &lt;span class=&quot;token string&quot;&gt;&quot;EnableIPv6&quot;&lt;/span&gt;&lt;span class=&quot;token builtin class-name&quot;&gt;:&lt;/span&gt; false,
        &lt;span class=&quot;token string&quot;&gt;&quot;IPAM&quot;&lt;/span&gt;&lt;span class=&quot;token builtin class-name&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;token string&quot;&gt;&quot;Driver&quot;&lt;/span&gt;&lt;span class=&quot;token builtin class-name&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;default&quot;&lt;/span&gt;,
            &lt;span class=&quot;token string&quot;&gt;&quot;Options&quot;&lt;/span&gt;&lt;span class=&quot;token builtin class-name&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;,
            &lt;span class=&quot;token string&quot;&gt;&quot;Config&quot;&lt;/span&gt;&lt;span class=&quot;token builtin class-name&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;
                &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
                    &lt;span class=&quot;token string&quot;&gt;&quot;Subnet&quot;&lt;/span&gt;&lt;span class=&quot;token builtin class-name&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;172.19.0.0/16&quot;&lt;/span&gt;,
                    &lt;span class=&quot;token string&quot;&gt;&quot;Gateway&quot;&lt;/span&gt;&lt;span class=&quot;token builtin class-name&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;172.19.0.1/16&quot;&lt;/span&gt;
                &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
            &lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;,
        &lt;span class=&quot;token string&quot;&gt;&quot;Internal&quot;&lt;/span&gt;&lt;span class=&quot;token builtin class-name&quot;&gt;:&lt;/span&gt; false,
        &lt;span class=&quot;token string&quot;&gt;&quot;Attachable&quot;&lt;/span&gt;&lt;span class=&quot;token builtin class-name&quot;&gt;:&lt;/span&gt; false,
        &lt;span class=&quot;token string&quot;&gt;&quot;Containers&quot;&lt;/span&gt;&lt;span class=&quot;token builtin class-name&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;token string&quot;&gt;&quot;2a23faa18fb33b5d07eb4e0affb5da36449a78eeb196c944a5af3aaffe1ada37&quot;&lt;/span&gt;&lt;span class=&quot;token builtin class-name&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
                &lt;span class=&quot;token string&quot;&gt;&quot;Name&quot;&lt;/span&gt;&lt;span class=&quot;token builtin class-name&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;backstabbing_pike&quot;&lt;/span&gt;,
                &lt;span class=&quot;token string&quot;&gt;&quot;EndpointID&quot;&lt;/span&gt;&lt;span class=&quot;token builtin class-name&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;9039dae3218c47739ae327a30c9d9b219159deb1c0a6274c6d994d37baf2f7e3&quot;&lt;/span&gt;,
                &lt;span class=&quot;token string&quot;&gt;&quot;MacAddress&quot;&lt;/span&gt;&lt;span class=&quot;token builtin class-name&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;02:42:ac:13:00:03&quot;&lt;/span&gt;,
                &lt;span class=&quot;token string&quot;&gt;&quot;IPv4Address&quot;&lt;/span&gt;&lt;span class=&quot;token builtin class-name&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;172.19.0.3/16&quot;&lt;/span&gt;,
                &lt;span class=&quot;token string&quot;&gt;&quot;IPv6Address&quot;&lt;/span&gt;&lt;span class=&quot;token builtin class-name&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;&quot;&lt;/span&gt;
            &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;,
            &lt;span class=&quot;token string&quot;&gt;&quot;dbf7f59187801e1bcd2b0a7d4731ca5f0a95236dbc4b4157af01697f295d4528&quot;&lt;/span&gt;&lt;span class=&quot;token builtin class-name&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
                &lt;span class=&quot;token string&quot;&gt;&quot;Name&quot;&lt;/span&gt;&lt;span class=&quot;token builtin class-name&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;cat-db&quot;&lt;/span&gt;,
                &lt;span class=&quot;token string&quot;&gt;&quot;EndpointID&quot;&lt;/span&gt;&lt;span class=&quot;token builtin class-name&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;7f7c51a0468acd849fd575adeadbcb5310c5987195555620d60ee3ffad37c680&quot;&lt;/span&gt;,
                &lt;span class=&quot;token string&quot;&gt;&quot;MacAddress&quot;&lt;/span&gt;&lt;span class=&quot;token builtin class-name&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;02:42:ac:13:00:02&quot;&lt;/span&gt;,
                &lt;span class=&quot;token string&quot;&gt;&quot;IPv4Address&quot;&lt;/span&gt;&lt;span class=&quot;token builtin class-name&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;172.19.0.2/16&quot;&lt;/span&gt;,
                &lt;span class=&quot;token string&quot;&gt;&quot;IPv6Address&quot;&lt;/span&gt;&lt;span class=&quot;token builtin class-name&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;&quot;&lt;/span&gt;
            &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;,
        &lt;span class=&quot;token string&quot;&gt;&quot;Options&quot;&lt;/span&gt;&lt;span class=&quot;token builtin class-name&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;,
        &lt;span class=&quot;token string&quot;&gt;&quot;Labels&quot;&lt;/span&gt;&lt;span class=&quot;token builtin class-name&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h1&gt;多主机 Bridge Driver 网桥模式&lt;/h1&gt;
&lt;p&gt;在多台宿主机中使用&lt;code class=&quot;language-text&quot;&gt;Bridge&lt;/code&gt;网络模式，&lt;code class=&quot;language-text&quot;&gt;redis&lt;/code&gt;部署在&lt;code class=&quot;language-text&quot;&gt;host-A&lt;/code&gt;中，并且需要映射一个外部IP，供&lt;code class=&quot;language-text&quot;&gt;web&lt;/code&gt;去调用，&lt;code class=&quot;language-text&quot;&gt;web&lt;/code&gt;部署在&lt;code class=&quot;language-text&quot;&gt;host-B&lt;/code&gt;中，要调用&lt;code class=&quot;language-text&quot;&gt;db&lt;/code&gt;时，要通过&lt;code class=&quot;language-text&quot;&gt;DB=host-A:6379&lt;/code&gt;指定主机A的&lt;code class=&quot;language-text&quot;&gt;host&lt;/code&gt;和&lt;code class=&quot;language-text&quot;&gt;redis&lt;/code&gt;暴露的端口进行连接。&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;shell&quot;&gt;&lt;pre class=&quot;language-shell&quot;&gt;&lt;code class=&quot;language-shell&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;# 每个docker中都有一个默认的Bridge网络模式&lt;/span&gt;
host-A $ docker run -d -p &lt;span class=&quot;token number&quot;&gt;6379&lt;/span&gt;:6379 redis
host-B $ docker run -d -p &lt;span class=&quot;token number&quot;&gt;8000&lt;/span&gt;:5000 -e &lt;span class=&quot;token string&quot;&gt;&apos;DB=host-A:6379&apos;&lt;/span&gt; -e &lt;span class=&quot;token string&quot;&gt;&apos;ROLE=cat&apos;&lt;/span&gt; --name web chrch/web &lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;img src=&quot;multihost-bridge.png&quot; alt=&quot;多主机模式&quot;&gt;&lt;/p&gt;
&lt;p&gt;主机B通过本机&lt;code class=&quot;language-text&quot;&gt;Host&lt;/code&gt;来解析主机A的IP地址已进行访问。通常不建议这样硬编码的使用服务地址。&lt;/p&gt;
&lt;h1&gt;Overlay Driver&lt;/h1&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;overlay&lt;/code&gt; 网络模式提供了服务发现和自动负载均衡的功能，但是前提是要把多主机部署为&lt;code class=&quot;language-text&quot;&gt;swarm&lt;/code&gt;集群模式。
在&lt;code class=&quot;language-text&quot;&gt;lead&lt;/code&gt;上面查看&lt;code class=&quot;language-text&quot;&gt;swarm&lt;/code&gt;的节点数量。&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;shell&quot;&gt;&lt;pre class=&quot;language-shell&quot;&gt;&lt;code class=&quot;language-shell&quot;&gt;$ docker node &lt;span class=&quot;token function&quot;&gt;ls&lt;/span&gt;
ID                           &lt;span class=&quot;token environment constant&quot;&gt;HOSTNAME&lt;/span&gt;          STATUS  AVAILABILITY  MANAGER STATUS
a8dwuh6gy5898z3yeuvxaetjo    host-B  Ready   Active
elgt0bfuikjrntv3c33hr0752 *  host-A  Ready   Active        Leader&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;创建一个自定义的&lt;code class=&quot;language-text&quot;&gt;overlay&lt;/code&gt;网络。在一个&lt;code class=&quot;language-text&quot;&gt;overlay&lt;/code&gt;网络中开放的&lt;code class=&quot;language-text&quot;&gt;TCP&lt;/code&gt;和&lt;code class=&quot;language-text&quot;&gt;UDP&lt;/code&gt;端口都是开放。&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;shell&quot;&gt;&lt;pre class=&quot;language-shell&quot;&gt;&lt;code class=&quot;language-shell&quot;&gt;$ docker network create -d overlay --subnet &lt;span class=&quot;token number&quot;&gt;192.0&lt;/span&gt;.0.0/24 --gateway &lt;span class=&quot;token number&quot;&gt;192.0&lt;/span&gt;.0.1 dognet
$ docker &lt;span class=&quot;token function&quot;&gt;service&lt;/span&gt; create --network dognet --name dog-db redis
$ docker &lt;span class=&quot;token function&quot;&gt;service&lt;/span&gt; create --network dognet -p &lt;span class=&quot;token number&quot;&gt;8000&lt;/span&gt;:5000  -e &lt;span class=&quot;token string&quot;&gt;&apos;DB=dog-db&apos;&lt;/span&gt; -e &lt;span class=&quot;token string&quot;&gt;&apos;ROLE=dog&apos;&lt;/span&gt; --name dog-web chrch/web&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;img src=&quot;pets-overlay.png&quot; alt=&quot;overlay网络模式&quot;&gt;&lt;/p&gt;
&lt;p&gt;上图讲解了上面的命令中的部署图，首先创建了一个叫&lt;code class=&quot;language-text&quot;&gt;dognet&lt;/code&gt;的&lt;code class=&quot;language-text&quot;&gt;overlay&lt;/code&gt;网络,然后创建一个&lt;code class=&quot;language-text&quot;&gt;service&lt;/code&gt;,使用&lt;code class=&quot;language-text&quot;&gt;dognet&lt;/code&gt;这个创建好的网络，并且不开放任何可访问端口，命令为&lt;code class=&quot;language-text&quot;&gt;dog-db&lt;/code&gt;；然后创建另一个服务，也是使用同一个网络，并且直接指定&lt;code class=&quot;language-text&quot;&gt;redis&lt;/code&gt;的name即可.&lt;/p&gt;
&lt;p&gt;同时访问两个&lt;code class=&quot;language-text&quot;&gt;overlay&lt;/code&gt;的网络模式，比如有一个&lt;code class=&quot;language-text&quot;&gt;admin&lt;/code&gt;需要同时访问&lt;code class=&quot;language-text&quot;&gt;dog-web&lt;/code&gt;和&lt;code class=&quot;language-text&quot;&gt;cat-web&lt;/code&gt;两个服务。我们可以如下操作，先启动一个&lt;code class=&quot;language-text&quot;&gt;catnet&lt;/code&gt;的&lt;code class=&quot;language-text&quot;&gt;overlay&lt;/code&gt;网络。&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;shell&quot;&gt;&lt;pre class=&quot;language-shell&quot;&gt;&lt;code class=&quot;language-shell&quot;&gt;$ docker network create -d overlay --subnet &lt;span class=&quot;token number&quot;&gt;172.0&lt;/span&gt;.0.0/24 --gateway &lt;span class=&quot;token number&quot;&gt;172.0&lt;/span&gt;.0.1 catnet
$ docker &lt;span class=&quot;token function&quot;&gt;service&lt;/span&gt; create --network catnet --name cat-db redis
$ docker &lt;span class=&quot;token function&quot;&gt;service&lt;/span&gt; create --network catnet -p &lt;span class=&quot;token number&quot;&gt;8000&lt;/span&gt;:5000  -e &lt;span class=&quot;token string&quot;&gt;&apos;DB=cat-db&apos;&lt;/span&gt; -e &lt;span class=&quot;token string&quot;&gt;&apos;ROLE=cat&apos;&lt;/span&gt; --name cat-web chrch/web

&lt;span class=&quot;token comment&quot;&gt;# 同时使用两个overlay的网络环境&lt;/span&gt;
$ docker &lt;span class=&quot;token function&quot;&gt;service&lt;/span&gt; create --network catnet --network dognet -p &lt;span class=&quot;token number&quot;&gt;7000&lt;/span&gt;:5000 -e &lt;span class=&quot;token string&quot;&gt;&apos;DB1=dog-db&apos;&lt;/span&gt; -e &lt;span class=&quot;token string&quot;&gt;&apos;DB2=cat-db&apos;&lt;/span&gt; --name admin chrch/admin&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;img src=&quot;multitenant.png&quot; alt=&quot;多主机控制&quot;&gt;
&lt;code class=&quot;language-text&quot;&gt;dog-web&lt;/code&gt;和&lt;code class=&quot;language-text&quot;&gt;dog-db&lt;/code&gt;之间网络可以互通，当时不可以访问&lt;code class=&quot;language-text&quot;&gt;catnet&lt;/code&gt;上的服务,&lt;code class=&quot;language-text&quot;&gt;cat-web&lt;/code&gt;和&lt;code class=&quot;language-text&quot;&gt;cat-db&lt;/code&gt;之间也是可以互相访问的，但是不可以访问&lt;code class=&quot;language-text&quot;&gt;dognet&lt;/code&gt;网络上的服务。&lt;/p&gt;
&lt;h1&gt;参考&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https://github.com/docker/labs/blob/master/networking/tutorials.md&quot;&gt;https://github.com/docker/labs/blob/master/networking/tutorials.md&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;</content:encoded></item><item><title><![CDATA[java.util.concurrency 包]]></title><description><![CDATA[本文主要学习java包中的并发工具学习。 BlockingQueue…]]></description><link>https://lengrongfu.github.io/2018-11-12-java-util-concurrency/</link><guid isPermaLink="false">https://lengrongfu.github.io/2018-11-12-java-util-concurrency/</guid><pubDate>Mon, 12 Nov 2018 10:47:16 GMT</pubDate><content:encoded>&lt;blockquote&gt;
&lt;p&gt;本文主要学习java包中的并发工具学习。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h1&gt;BlockingQueue&lt;/h1&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;java.util.concurrent&lt;/code&gt;包中的阻塞队列接口&lt;code class=&quot;language-text&quot;&gt;BlockingQueue&lt;/code&gt;表示一个线程是可以安全放入实例，并且其他线程可以从中获取。
一个阻塞队列一般是一个线程生产，一个线程消费，&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;blocking-queue.png&quot; alt=&quot;阻塞队列原理图&quot;&gt;&lt;/p&gt;
&lt;p&gt;当队列到达最大限制，生产数据的线程将会被阻塞，直到消费者从队列中取出一个元素。
当一个消费者尝试从一个空队列中获取元素时，会被阻塞。&lt;/p&gt;
&lt;h2&gt;BlockingQueue 方法&lt;/h2&gt;
&lt;p&gt;一个&lt;code class=&quot;language-text&quot;&gt;BlockingQueue&lt;/code&gt;有四种不同的方法插入、删除、检查队列中的元素，每一组方法的功能都不太一样，如下是一个方法表。&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;—&lt;/th&gt;
&lt;th&gt;Throws Exception&lt;/th&gt;
&lt;th&gt;Special Value&lt;/th&gt;
&lt;th&gt;Blocks&lt;/th&gt;
&lt;th&gt;Times Out&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;Insert&lt;/td&gt;
&lt;td&gt;add(o)&lt;/td&gt;
&lt;td&gt;offer(o)&lt;/td&gt;
&lt;td&gt;put(o)&lt;/td&gt;
&lt;td&gt;offer(o, timeout, timeunit)&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;Remove&lt;/td&gt;
&lt;td&gt;remove(o)&lt;/td&gt;
&lt;td&gt;poll()&lt;/td&gt;
&lt;td&gt;take()&lt;/td&gt;
&lt;td&gt;poll(timeout, timeunit)&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;Examine&lt;/td&gt;
&lt;td&gt;element()&lt;/td&gt;
&lt;td&gt;peek()&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;这四种不同的操作有不同的功能
1、Throws Exception
如果不能立即执行这个操作，就会抛出异常，比如，如果队列已满，再往里面插入就会抛出异常，或者队列中没有元素，那么一个线程从队列中取元素就会抛出异常。
2、&lt;/p&gt;</content:encoded></item><item><title><![CDATA[java并发和多线程学习]]></title><description><![CDATA[…]]></description><link>https://lengrongfu.github.io/2018-11-01-java-concurrency/</link><guid isPermaLink="false">https://lengrongfu.github.io/2018-11-01-java-concurrency/</guid><pubDate>Thu, 01 Nov 2018 17:05:42 GMT</pubDate><content:encoded>&lt;h1&gt;并发问题的来历&lt;/h1&gt;
&lt;p&gt;以前的计算机是只有单个&lt;code class=&quot;language-text&quot;&gt;CPU&lt;/code&gt;,并且一次只能执行一个程序，后来出现了多任务处理，但它不是真正的并行处理，单个&lt;code class=&quot;language-text&quot;&gt;CPU&lt;/code&gt;是被两个程序共享的，操作系统在两个程序之间进行来回切换。
随着多任务处理的出现，开发软件有着新的挑战，同一个程序不能长时间的占用着所有的&lt;code class=&quot;language-text&quot;&gt;CPU&lt;/code&gt;资源、内存、以及任何电脑资源。一个好的程序应该能在不使用时释放所有的资源。
后来出现了多线程，意味着同一个程序可以使用多个线程进行执行，当你在程序中使用多线程时，就像是有多个cpu进行执行一样。
多线程是可以提高某些程序的性能的，然而，多线程是比多任务有更大的难度的，多个线程在同一个程序中执行，对于以前的单个cpu来说是没有问题的，因为总的来说每个线程都还是串行的，但是现代的电脑基本是多核cpu或者是多个芯片，这样执行起来之后就真正的达到了并行，因此对应程序开发更具挑战。&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;java-concurrency-tutorial-introduction-1.png&quot; alt=&quot;执行&quot;&gt;&lt;/p&gt;
&lt;p&gt;如果一个线程读取一个本地的内存变量，而另一个线程对这个内存进行写，那么这个第一个线程读取到的值是什么呢？&lt;/p&gt;
&lt;h1&gt;Java 并发学习指南&lt;/h1&gt;
&lt;p&gt;如果你是Java并发学习新手，建议你按找下面的步骤进行学习。&lt;/p&gt;
&lt;h2&gt;Java并发和多线程的理论&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;http://tutorials.jenkov.com/java-concurrency/benefits.html&quot;&gt;Multithreading Benefits&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;http://tutorials.jenkov.com/java-concurrency/costs.html&quot;&gt;Multithreading Costs&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;http://tutorials.jenkov.com/java-concurrency/concurrency-models.html&quot;&gt;Concurrency Models&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;http://tutorials.jenkov.com/java-concurrency/same-threading.html&quot;&gt;Same-threading&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;http://tutorials.jenkov.com/java-concurrency/concurrency-vs-parallelism.html&quot;&gt;Concurrency vs. Parallelism&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h2&gt;Java并发的基础知识&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;&quot;&gt;Creating and Starting Java Threads&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;&quot;&gt;Race Conditions and Critical Sections&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;&quot;&gt;Thread Safety and Shared Resources&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;&quot;&gt;Thread Safety and Immutability&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;&quot;&gt;Java Memory Model&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;&quot;&gt;Java Synchronized Blocks&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;&quot;&gt;Java Volatile Keyword&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;&quot;&gt;Java ThreadLocal&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;&quot;&gt;Java Thread Signaling&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h2&gt;Java并发典型的问题&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;&quot;&gt;Deadlock&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;&quot;&gt;Deadlock Prevention&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;&quot;&gt;Starvation and Fairness&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;&quot;&gt;Nested Monitor Lockout&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;&quot;&gt;Slipped Conditions&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h2&gt;Java并发构造解决上面问题&lt;/h2&gt;
&lt;p&gt;Locks in Java
Read / Write Locks in Java
Reentrance Lockout
Semaphores
Blocking Queues
Thread Pools
Compare and Swap&lt;/p&gt;
&lt;h2&gt;进一步学习&lt;/h2&gt;
&lt;p&gt;Anatomy of a Synchronizer
Non-blocking Algorithms
Amdahl’s Law
References&lt;/p&gt;
&lt;h1&gt;多线程的优点&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;更好的资源利用&lt;/li&gt;
&lt;li&gt;在某些情况下更简单的设计&lt;/li&gt;
&lt;li&gt;更快的程序&lt;/li&gt;
&lt;/ul&gt;
&lt;h1&gt;多线程的成本&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;更复杂的设计&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;多线程的某些部分比单线程更加简单，但是也有部分更加复杂，多线程访问共享变量要特别注意，错误的线程同步引起的错误可能很难重现、检测和修复。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;上下文切换开销&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;当cpu从一个可执行线程切换到另一个可执行现场是，cpu需要保存本地的数据，程序的指针等。&lt;/p&gt;
&lt;h1&gt;并发模型&lt;/h1&gt;
&lt;p&gt;并发系统能够通过不同的并发模型进行实现，并发模型指定一个线程如何和其他线程进行协作以完成指定的任务，不同的并发模型分割任务的方式不同，并且线程可以以不同方式进行通信和协作。&lt;/p&gt;
&lt;h2&gt;并发模型和分布式系统的相似性&lt;/h2&gt;
&lt;p&gt;在并发系统中，不同的线程彼此通信，在分布式系统中，不同的进程批次通信，线程和进程本质上非常相似。
因为并发模型类似于分布式系统体系结构，因此他们通常可以相互借鉴，例如：用工作线程之间分配工作的模型就类似于分布式系统中负载均衡模型。错误处理技术也是如此，日志记录、故障转移、幂等性。&lt;/p&gt;
&lt;h2&gt;并行工作&lt;/h2&gt;
&lt;p&gt;在并行工作着并发模型中，委托者将传入的&lt;code class=&quot;language-text&quot;&gt;job&lt;/code&gt;分发给不同的&lt;code class=&quot;language-text&quot;&gt;worker&lt;/code&gt;，这些&lt;code class=&quot;language-text&quot;&gt;worker&lt;/code&gt;并行运行，在不同的线程中，并且可能在不同的&lt;code class=&quot;language-text&quot;&gt;cpu&lt;/code&gt;上运行。&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;concurrency-models-1.png&quot; alt=&quot;第一个并发模型&quot;&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;并行工作的并发模型的优点&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;并发工作模型的优点是容易理解，如果要增加程序的并行化，只需要添加&lt;code class=&quot;language-text&quot;&gt;worker&lt;/code&gt;即可。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;并行工作的并发模型的缺点&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;并发模型中有一些不可见的问题，容易引发程序&lt;code class=&quot;language-text&quot;&gt;bug&lt;/code&gt;.下面将讲诉具体的问题。&lt;/p&gt;
&lt;p&gt;1、共享状态会变得很复杂
在并发模型中，访问共享的数据会使程序变得复杂，比如访问共享的内存数据或者数据库数据等。访问共享状态数据是就容易出现线程之间的竞争和死锁。当访问共享数据时多线程之间就回出现阻塞，部分并行化就会丢失，虽然有无阻塞并发算法，但是实现比较难。还可以通过使用持久数据结构来解决这一问题。
&lt;img src=&quot;concurrency-models-2.png&quot; alt=&quot;共享模型&quot;&gt;&lt;/p&gt;
&lt;h2&gt;流水线模型&lt;/h2&gt;
&lt;p&gt;如下显示的是流水线模型的流程图&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;concurrency-models-3.png&quot; alt=&quot;流水线&quot;&gt;&lt;/p&gt;
&lt;h2&gt;功能并行化&lt;/h2&gt;
&lt;p&gt;功能并行化的难点在于知道那个函数功能需要调用并行化，跨cpu的调用是需要付出很大的开销的，需要完成的功能要具有一定的复杂度和时间消耗，如果需要完成的功能很小，那么并行化的结果可能比单&lt;code class=&quot;language-text&quot;&gt;cpu&lt;/code&gt;更慢。在&lt;code class=&quot;language-text&quot;&gt;java 8&lt;/code&gt; 中，&lt;code class=&quot;language-text&quot;&gt;streaming&lt;/code&gt; 就是功能并行化的。&lt;/p&gt;
&lt;h1&gt;创建和启动Java线程&lt;/h1&gt;
&lt;p&gt;有两种方法可以指定线程应该执行的代码，第一种是继承父类&lt;code class=&quot;language-text&quot;&gt;Thread&lt;/code&gt;，并重写&lt;code class=&quot;language-text&quot;&gt;run&lt;/code&gt;方法，第二种方法是实现接口&lt;code class=&quot;language-text&quot;&gt;Runnable&lt;/code&gt;,并把实现类对象传入到&lt;code class=&quot;language-text&quot;&gt;Thread&lt;/code&gt;构造函数中。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;第一种写法&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;java&quot;&gt;&lt;pre class=&quot;language-java&quot;&gt;&lt;code class=&quot;language-java&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;MyThread&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;extends&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Thread&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;run&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;token class-name&quot;&gt;System&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;out&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;println&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;Hello MyThread&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token class-name&quot;&gt;Thread&lt;/span&gt; thread &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;MyThread&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
thread&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;start&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;ul&gt;
&lt;li&gt;第二种写法&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;java&quot;&gt;&lt;pre class=&quot;language-java&quot;&gt;&lt;code class=&quot;language-java&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;MyRunnable&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;implements&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Runnable&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;run&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
       &lt;span class=&quot;token class-name&quot;&gt;System&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;out&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;println&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;MyRunnable running&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token class-name&quot;&gt;Thread&lt;/span&gt; thread &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Thread&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;MyRunnable&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
	   thread&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;start&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2&gt;指定线程名称&lt;/h2&gt;
&lt;p&gt;在创建线程是可以指定线程的名称，这样就可以区分去执行的线程。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;第一种方式&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;java&quot;&gt;&lt;pre class=&quot;language-java&quot;&gt;&lt;code class=&quot;language-java&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;MyThread&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;extends&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Thread&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
		
		&lt;span class=&quot;token keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;MyThread&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;String&lt;/span&gt; threadName&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
			&lt;span class=&quot;token keyword&quot;&gt;super&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;threadName&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
		&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

		&lt;span class=&quot;token annotation punctuation&quot;&gt;@Override&lt;/span&gt;
		&lt;span class=&quot;token keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;run&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
			&lt;span class=&quot;token class-name&quot;&gt;System&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;out&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;println&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;hello world!&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
		&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
	&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token class-name&quot;&gt;Thread&lt;/span&gt; thread &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;MyThread&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;demo&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
thread&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;start&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token class-name&quot;&gt;System&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;out&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;println&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;thread&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;getName&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;ul&gt;
&lt;li&gt;第二种方式&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;java&quot;&gt;&lt;pre class=&quot;language-java&quot;&gt;&lt;code class=&quot;language-java&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;MyRunnable&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;implements&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Runnable&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
	&lt;span class=&quot;token annotation punctuation&quot;&gt;@Override&lt;/span&gt;
	&lt;span class=&quot;token keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;run&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
		&lt;span class=&quot;token class-name&quot;&gt;System&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;out&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;println&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;MyRunnable is run.&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
	&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

	&lt;span class=&quot;token keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;main&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;String&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; args&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
		&lt;span class=&quot;token class-name&quot;&gt;Thread&lt;/span&gt; thread &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Thread&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;MyRunnable&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;demo&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
		thread&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;start&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
		&lt;span class=&quot;token class-name&quot;&gt;System&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;out&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;println&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;thread&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;getName&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

	&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2&gt;暂停线程&lt;/h2&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;java&quot;&gt;&lt;pre class=&quot;language-java&quot;&gt;&lt;code class=&quot;language-java&quot;&gt;&lt;span class=&quot;token class-name&quot;&gt;Thread&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;sleep&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;10&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1000L&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;token comment&quot;&gt;//休眠毫秒数，10s&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2&gt;停止线程&lt;/h2&gt;
&lt;p&gt;停止Java 线程需要自己实现一些代码，不推荐使用原生的&lt;code class=&quot;language-text&quot;&gt;stop()&lt;/code&gt;方法，这个方法是被弃用的，这个方法不能保证线程中使用的所以对象的状态，如果应用程序中的其他线程也可以访问这个对象，那么应用程序可能意外的就失败了。
通过自己实现一个&lt;code class=&quot;language-text&quot;&gt;doStop()&lt;/code&gt;方法，来让线程推出，这样做的结果就是进入到&lt;code class=&quot;language-text&quot;&gt;run&lt;/code&gt;方法之后的代码需要都执行完毕才能推出。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;第一种实现&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;java&quot;&gt;&lt;pre class=&quot;language-java&quot;&gt;&lt;code class=&quot;language-java&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;class&lt;/span&gt;  &lt;span class=&quot;token class-name&quot;&gt;MyThread&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;extends&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Thread&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;

		&lt;span class=&quot;token keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;boolean&lt;/span&gt; keepRun &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;true&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

		&lt;span class=&quot;token keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;MyThread&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;String&lt;/span&gt; threadName&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
			&lt;span class=&quot;token keyword&quot;&gt;super&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;threadName&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
		&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

		&lt;span class=&quot;token keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;synchronized&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;doStop&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
			&lt;span class=&quot;token keyword&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;keepRun &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;false&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
		&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

		&lt;span class=&quot;token annotation punctuation&quot;&gt;@Override&lt;/span&gt;
		&lt;span class=&quot;token keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;run&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
			&lt;span class=&quot;token keyword&quot;&gt;while&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;keepRun&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
				&lt;span class=&quot;token keyword&quot;&gt;try&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
					&lt;span class=&quot;token class-name&quot;&gt;Thread&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;sleep&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;5&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1000L&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
				&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;catch&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;InterruptedException&lt;/span&gt; e&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
					e&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;printStackTrace&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
				&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
				&lt;span class=&quot;token class-name&quot;&gt;System&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;out&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;println&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;MyRunnable is run.&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
				&lt;span class=&quot;token class-name&quot;&gt;System&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;out&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;println&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;name:&quot;&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Thread&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;currentThread&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;getName&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
			&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
		&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
	&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token class-name&quot;&gt;MyThread&lt;/span&gt; thread &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;MyThread&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;demo&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
		thread&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;start&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
		&lt;span class=&quot;token class-name&quot;&gt;System&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;out&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;println&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;thread&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;getName&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
		&lt;span class=&quot;token class-name&quot;&gt;Thread&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;sleep&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;5&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1000L&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
		thread&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;doStop&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;ul&gt;
&lt;li&gt;第二种实现&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;java&quot;&gt;&lt;pre class=&quot;language-java&quot;&gt;&lt;code class=&quot;language-java&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;MyRunnable&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;implements&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Runnable&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;boolean&lt;/span&gt; keepRun &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;true&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

	&lt;span class=&quot;token keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;synchronized&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;doStop&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
		&lt;span class=&quot;token keyword&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;keepRun &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;false&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
	&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

    &lt;span class=&quot;token annotation punctuation&quot;&gt;@Override&lt;/span&gt;
	&lt;span class=&quot;token keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;run&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;

		&lt;span class=&quot;token keyword&quot;&gt;while&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;keepRun&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
			&lt;span class=&quot;token keyword&quot;&gt;try&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
				&lt;span class=&quot;token class-name&quot;&gt;Thread&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;sleep&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1000L&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
			&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;catch&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;InterruptedException&lt;/span&gt; e&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
				e&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;printStackTrace&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
			&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
			&lt;span class=&quot;token class-name&quot;&gt;System&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;out&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;println&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;MyRunnable is run.&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
			&lt;span class=&quot;token class-name&quot;&gt;System&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;out&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;println&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;name:&quot;&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Thread&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;currentThread&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;getName&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
		&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

	&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;token class-name&quot;&gt;MyRunnable&lt;/span&gt; myRunnable &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;MyRunnable&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
		&lt;span class=&quot;token class-name&quot;&gt;Thread&lt;/span&gt; thread &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Thread&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;myRunnable&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;demo&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
		thread&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;start&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
		&lt;span class=&quot;token class-name&quot;&gt;System&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;out&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;println&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;thread&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;getName&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
		&lt;span class=&quot;token class-name&quot;&gt;Thread&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;sleep&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;5&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1000L&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
		myRunnable&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;doStop&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h1&gt;线程安全和共享资源&lt;/h1&gt;
&lt;p&gt;多个线程同时调用安全的代码称为线程安全，如果一段代码是线程安全的，那么它不包含竞争条件，只有多个线程对同一个共享资源进行写操作时才会出现竞争条件，因此，了解Java线程在执行是哪些共享的资源非常重要。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;局部变量&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;局部变量是存储在每个线程的堆栈中，这意味这局部变量是不共享资源的，是线程安全的。如下的&lt;code class=&quot;language-text&quot;&gt;value&lt;/code&gt;变量就是局部变量。&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;java&quot;&gt;&lt;pre class=&quot;language-java&quot;&gt;&lt;code class=&quot;language-java&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;add&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;int&lt;/span&gt; value &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    value &lt;span class=&quot;token operator&quot;&gt;++&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;ul&gt;
&lt;li&gt;本地对象引用&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;本地对象引用本身不共享，但是，引用的对象不存储在每个线程的本地堆栈中，而是存储在共享的堆栈中的。&lt;code class=&quot;language-text&quot;&gt;MySum&lt;/code&gt;就是本地对象引用。只要不把这个引用传递给其他线程，这个变量就是线程安全的。&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;java&quot;&gt;&lt;pre class=&quot;language-java&quot;&gt;&lt;code class=&quot;language-java&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;MyCount&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;add&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;int&lt;/span&gt; value&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;token class-name&quot;&gt;MySum&lt;/span&gt; sum &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;MySum&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
            sum&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;sum&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;value&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;token class-name&quot;&gt;MyCount&lt;/span&gt; count &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;MyCount&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Thread&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;MyRunnable&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;count&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;start&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Thread&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;MyRunnable&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;count&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;3&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;start&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;ul&gt;
&lt;li&gt;对象成员变量&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;对象成员变量是与对象一起存储在堆信息上的，如果多个线程同时对同一个对象成员变量进行写操作，则该方法不是线程安全的，如下列子中两个线程都对同一个变量进行了操作。&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;java&quot;&gt;&lt;pre class=&quot;language-java&quot;&gt;&lt;code class=&quot;language-java&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;NotThreadSafe&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; 
    &lt;span class=&quot;token class-name&quot;&gt;StringBuilder&lt;/span&gt; builder &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;StringBuilder&lt;/span&gt;（）&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; 

    &lt;span class=&quot;token keyword&quot;&gt;public&lt;/span&gt; add（&lt;span class=&quot;token class-name&quot;&gt;String&lt;/span&gt; text）&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; 
        &lt;span class=&quot;token keyword&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;builder&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;append（text）&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; 
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; 
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;// 不安全的操作&lt;/span&gt;
&lt;span class=&quot;token class-name&quot;&gt;NotThreadSafe&lt;/span&gt; sharedInstance &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;NotThreadSafe&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Thread&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;MyRunnable&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;sharedInstance&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;start&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Thread&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;MyRunnable&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;sharedInstance&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;start&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;MyRunnable&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;implements&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Runnable&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token class-name&quot;&gt;NotThreadSafe&lt;/span&gt; instance &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;null&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

  &lt;span class=&quot;token keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;MyRunnable&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;NotThreadSafe&lt;/span&gt; instance&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;instance &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; instance&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

  &lt;span class=&quot;token keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;run&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;instance&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;add&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;some text&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;下面是安全的操作，每个线程都操作自己的变量。&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;java&quot;&gt;&lt;pre class=&quot;language-java&quot;&gt;&lt;code class=&quot;language-java&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;NotThreadSafe&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; 
    &lt;span class=&quot;token class-name&quot;&gt;StringBuilder&lt;/span&gt; builder &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;StringBuilder&lt;/span&gt;（）&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; 

    &lt;span class=&quot;token keyword&quot;&gt;public&lt;/span&gt; add（&lt;span class=&quot;token class-name&quot;&gt;String&lt;/span&gt; text）&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; 
        &lt;span class=&quot;token keyword&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;builder&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;append（text）&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; 
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; 
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Thread&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;MyRunnable&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;NotThreadSafe&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;start&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Thread&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;MyRunnable&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;NotThreadSafe&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;start&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;ul&gt;
&lt;li&gt;线程控制规则&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;资源可以是任何共享资源，如对象、数组、文件、数据库、套接字等。在&lt;code class=&quot;language-text&quot;&gt;java&lt;/code&gt;中并不能真正的控制资源，只能得到资源的引用。有时候即使对象的引用是安全的，如果该对象指向了共享资源，那么会导致真个应用处于线程不安全的情况下，比如线程1和线程2各自创建数据库连接，然后两个线程都做同一件事，先判断一个记录是否存在，如果不存在就插入，就回出现线程不安全的情况，插入了两条记录。对于在文件或其它共享资源上运行的线程也可能发生这种情况，因此，区分线程控制的对象是资源还是仅仅是引用资源是很有必要的。&lt;/p&gt;
&lt;h1&gt;线程安全性和不变性&lt;/h1&gt;
&lt;p&gt;当多个线程对同一个资源进行访问，并且有多个线程进行写入时，就会出现竞争条件。可以通过让任何线程都不能更改共享资源来做到线程安全，不能更改资源的方法就是不提供&lt;code class=&quot;language-text&quot;&gt;Set&lt;/code&gt;方法，如下的就是一个线程安全的资源，一旦实例被创建出来就不能在更改，如果需要操作该实例，那就返回一个新实例。&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;java&quot;&gt;&lt;pre class=&quot;language-java&quot;&gt;&lt;code class=&quot;language-java&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;MySum&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;int&lt;/span&gt; sum&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

    &lt;span class=&quot;token keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;MySum&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;int&lt;/span&gt; sum&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;sum &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; sum&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

    &lt;span class=&quot;token keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;getSum&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;sum&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;token comment&quot;&gt;//操作了就返回新实例&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;MySum&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;sum&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;int&lt;/span&gt; value&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;MySum&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;sum&lt;span class=&quot;token operator&quot;&gt;+&lt;/span&gt;value&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2&gt;引用是线程不安全的&lt;/h2&gt;
&lt;p&gt;即使对象是不可变的，并非因此线程就是安全的，因为对象的引用也可能不是线程安全的。&lt;/p&gt;
&lt;h1&gt;Java 内存模型&lt;/h1&gt;
&lt;h2&gt;Java内存模型&lt;/h2&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;JVM&lt;/code&gt;把操作系统到内存划分为自己的一个线程堆栈存储区和统一堆栈存储区，下图说明了这个逻辑，在Java虚拟机中运行的每个线程都有自己的线程堆栈，每个线程堆栈都是一个方法栈，会随着代码的执行栈随着变化。&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;java-memory-model-1.png&quot; alt=&quot;JVM内存模型&quot;&gt;&lt;/p&gt;
&lt;p&gt;线程栈的信息任何其他线程都是不能访问的，每个线程都有自己线程变量信息，线程中是以方法栈来存储的，每个方法栈存储的都是自己方法栈的信息，存储在方法栈中的资源有：基本类型(boolean，byte，short，char，int，long， float，double)的变量是完全存储在线程栈上的以及每个方法栈中的局部变量的引用和线程变量这三种数据是存储在线程栈中的。&lt;/p&gt;
&lt;p&gt;堆包含了整个Java应用程序中创建的所有对象，无论创建该对象的线程是什么，线程栈中保存的都是对象的引用，包括原始类型(Byte,Integer,Long)等，无论是创建该对象的局部变量，还是创建成员变量，该对象都是存在堆上的。
下图说明了存储在线程堆栈上的调用栈和局部变量，以及存储在堆上面的对象。&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;java-memory-model-2.png&quot; alt=&quot;堆栈存储示意图&quot;&gt;&lt;/p&gt;
&lt;p&gt;线程栈中的方法随着调用的代码变化而变化，线程栈中的每个一个元素都是方法栈信息，方法栈中有局部变量以及其他变量的引用，局部变量也可以是基本类型，它存储在线程堆栈中，局部变量也可以是引用变量，也是存储在线程堆栈中的，引用对象本身存储在线程堆上，&lt;/p&gt;
&lt;p&gt;对象的成员变量是和对象本身一起存储在堆上，不论是基本类型变量还是引用类型变量，都是存储在堆上面的，静态变量也是和类对象一起存储在堆上的。&lt;/p&gt;
&lt;p&gt;所有拥有对象引用的线程都可以访问堆上的对象，当一个线程可以访问一个对象时也可以访问一个对象的公开成员变量。如果两个线程同时访问同一个对象的同一个的方法，它们都可以访问这个对象的局部变量，但是每个线程都有自己的局部变量副本。&lt;/p&gt;
&lt;p&gt;下面的调用关系图说明了如上的一个内存模型。两个线程都有一个基本类型的局部变量&lt;code class=&quot;language-text&quot;&gt;Local variable1&lt;/code&gt;,还有一个引用类型的局部变量&lt;code class=&quot;language-text&quot;&gt;Local variable2&lt;/code&gt;,局部变量&lt;code class=&quot;language-text&quot;&gt;v2&lt;/code&gt;两个线程指向的是同一个对象，对象中又有两个引用的成员变量。
&lt;img src=&quot;java-memory-model-3.png&quot; alt=&quot;示意图&quot;&gt;&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;java&quot;&gt;&lt;pre class=&quot;language-java&quot;&gt;&lt;code class=&quot;language-java&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;MyRunnable&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;implements&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Runnable&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;

    &lt;span class=&quot;token keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;run&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;token function&quot;&gt;methodOne&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

    &lt;span class=&quot;token keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;methodOne&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;token comment&quot;&gt;//基本类型的局部变量是存储在线程栈中的&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;int&lt;/span&gt; localVariable1 &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;45&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

        &lt;span class=&quot;token class-name&quot;&gt;MySharedObject&lt;/span&gt; localVariable2 &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;
            &lt;span class=&quot;token class-name&quot;&gt;MySharedObject&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;sharedInstance&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

        &lt;span class=&quot;token comment&quot;&gt;//... do more with local variables.&lt;/span&gt;

        &lt;span class=&quot;token function&quot;&gt;methodTwo&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

    &lt;span class=&quot;token keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;methodTwo&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;token class-name&quot;&gt;Integer&lt;/span&gt; localVariable1 &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Integer&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;99&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

        &lt;span class=&quot;token comment&quot;&gt;//... do more with local variable.&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;MySharedObject&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;

    &lt;span class=&quot;token comment&quot;&gt;//static variable pointing to instance of MySharedObject&lt;/span&gt;

    &lt;span class=&quot;token keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;MySharedObject&lt;/span&gt; sharedInstance &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;MySharedObject&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;


    &lt;span class=&quot;token comment&quot;&gt;//member variables pointing to two objects on the heap&lt;/span&gt;

    &lt;span class=&quot;token keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Integer&lt;/span&gt; object2 &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Integer&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;22&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Integer&lt;/span&gt; object4 &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Integer&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;44&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token comment&quot;&gt;//基本类型的成员变量也是存储在堆上的&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;long&lt;/span&gt; member1 &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;12345&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;long&lt;/span&gt; member1 &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;67890&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;如上的代码的内存模型就是和上面讲的一样，线程栈中依次是线程、&lt;code class=&quot;language-text&quot;&gt;methodOne&lt;/code&gt;、&lt;code class=&quot;language-text&quot;&gt;methodTwo&lt;/code&gt;三个方法栈。&lt;code class=&quot;language-text&quot;&gt;localVariable2&lt;/code&gt;通过读取静态不可变的引用赋值，因此任何一个线程取到到的对象都是同一个。&lt;/p&gt;
&lt;h2&gt;硬件内存模型&lt;/h2&gt;
&lt;p&gt;&lt;img src=&quot;java-memory-model-4.png&quot; alt=&quot;现代cpu内存架构&quot;&gt;&lt;/p&gt;
&lt;p&gt;现代计算机通常有多个&lt;code class=&quot;language-text&quot;&gt;CPU&lt;/code&gt;,再具有多个cpu的现代计算机上，可以同时运行多个线程，每个cpu都能够在任何给定时间运行一个线程，因此，每个cpu的一个线程可能同时在Java应用程序中运行，真正的并行运行。
每个cpu包含一组寄存器，cpu可以在这些寄存器上执行的操作比在主存储器中对变量执行的额操作快很多。每个cpu还具有多级的高速缓存存储器，cpu可以比访问主存储区快的多的速度去访问缓存，但是比访问寄存器慢。
计算机还包含主存储区（RAM），所有cpu都可以访问主存储区，并且主存储区通常比缓存大的多。
通常，当cpu执行某个操作指令时，它会将主存储区中的数据读取到cpu缓存中，把要执行的部分读入到寄存器中，然后对其进行执行操作，当执行完后，它会将内部寄存器刷新到高速缓冲存储区，并在某些时候将值刷新回主存储区。
cpu中的缓存是每次读取内存中的一个存储块，然后一定时间刷新写回到这个存储块中，并不是每次更新时读和写整个缓存。缓存中的数据都是内存中数据的拷贝。&lt;/p&gt;
&lt;h2&gt;Java内存模型和硬件内存之间的差距&lt;/h2&gt;
&lt;p&gt;&lt;img src=&quot;java-memory-model-5.png&quot; alt=&quot;java内存和计算机内存之间的融合&quot;&gt;&lt;/p&gt;
&lt;p&gt;如前面描述的一样，硬件内存架构和Java内存架构是不同的，硬件内存架构不区分线程堆栈和堆，在硬件上，线程堆栈和堆都位于主存储器中，线程堆栈和堆有时可能会存在于&lt;code class=&quot;language-text&quot;&gt;CPU&lt;/code&gt;的高速缓存和内存&lt;code class=&quot;language-text&quot;&gt;CPU&lt;/code&gt;寄存器中。
当对象和变量可以存储在计算机的各种不同存储区域时，可能会出现某些问题，两个主要问题是：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;写共享变量的值时出现线程的可见行问题。&lt;/li&gt;
&lt;li&gt;读、写共享变量的时候会触发竞争条件。&lt;/li&gt;
&lt;/ul&gt;
&lt;h2&gt;共享对象的可见性问题&lt;/h2&gt;
&lt;p&gt;当多个线程共享一个对象时，如果没有使用&lt;code class=&quot;language-text&quot;&gt;volatile&lt;/code&gt;关键字来声明变量或者没有使用同步代码块，就会出现一个线程对共享变量的更新可能对其他线程是不可见的。
比如：最初一个对象的成员变量是存储在主存储器中。然后，在cpu上运行的线程将对象的成员变量拷贝到cpu缓存中，并进行了成员变量的更新，只要cpu缓存未刷新回主内存，成员变量的更改对于其他线程是不可见的，每个线程最终都可以拥有自己的成员变量副本，每个副本都位于不同的cpu缓存中。
下图说明了两个线程对同一个成员变量进行操作时的情况，线程一和线程二分别拷贝了一份数据到cpu缓存中，并且线程一对数据进行了更新，可是并没有写回到主内存中。&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;java-memory-model-6.png&quot; alt=&quot;对象内存示意图&quot;&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;要解决这个问题，可以使用Java的volatile这个关键字来申明这个变量，这个关键字会确保一个给定的变量从主内存中读取和更新的时候总是写回到主内存中。&lt;/strong&gt;&lt;/p&gt;
&lt;h2&gt;竞争条件&lt;/h2&gt;
&lt;p&gt;当多个线程共享一个对象的成员变量时，并且多个线程对这个成员变量进行更新时，可能会发生竞争条件。
比如：如果线程A将count变量读入其cpu缓存中，线程B做同样的事情，但进入不同的cpu缓存，然后，线程A将变量做加一操作，线程B也做同样的操作，现在，变量要被写回到主存储器，但是，两个线程没有进行同步，写回到主存储区中的值只有任意一个线程进行过的累加值结果。&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;java-memory-model-7.png&quot; alt=&quot;竞争&quot;&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;要解决这种竞争问题，需要使用Java synchronized 块，同步块保证在任何给定时间只有一个线程可以进入代码的给定关键部分，同步块还保证在同步块内访问的所有变量都将从主内存读入，当线程退出同步块时，无论变量是否被声明为volatile，所以变量都会被再次写入到主内存中。&lt;/strong&gt;&lt;/p&gt;
&lt;h1&gt;Java 同步快&lt;/h1&gt;
&lt;p&gt;同一对象上的同步代码块只能同时在其中执行一个线程，尝试进入同步块的所有其他线程将被阻塞，直到同步块内的线程退出同步块。
该&lt;code class=&quot;language-text&quot;&gt;synchronized&lt;/code&gt;关键字可用于标记四种不同类型的块：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;实例方法&lt;/li&gt;
&lt;li&gt;静态方法&lt;/li&gt;
&lt;li&gt;实例方法中的代码块&lt;/li&gt;
&lt;li&gt;静态方法中的代码块&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;每一种同步块的作用对象是不一样的，需要根据自己的需求来进行决定使用那种同步块。&lt;/p&gt;
&lt;h2&gt;synchronized的实例方法&lt;/h2&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;java&quot;&gt;&lt;pre class=&quot;language-java&quot;&gt;&lt;code class=&quot;language-java&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Count&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;

    &lt;span class=&quot;token keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;int&lt;/span&gt; count&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

    &lt;span class=&quot;token keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;synchronized&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;add&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;int&lt;/span&gt; value&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
      &lt;span class=&quot;token keyword&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;count &lt;span class=&quot;token operator&quot;&gt;+=&lt;/span&gt; value&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;每个实例都是同步执行的，如果多个线程拥有同一个对象引用，那么每个线程就回同步执行这段代码。如果多个线程拥有的引用都不一样，那么就不会同步执行。&lt;/p&gt;
&lt;h2&gt;Synchronized 静态方法&lt;/h2&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;java&quot;&gt;&lt;pre class=&quot;language-java&quot;&gt;&lt;code class=&quot;language-java&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Count&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;

    &lt;span class=&quot;token keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;int&lt;/span&gt; count&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

    &lt;span class=&quot;token keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;synchronized&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;add&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;int&lt;/span&gt; value&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
      &lt;span class=&quot;token keyword&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;count &lt;span class=&quot;token operator&quot;&gt;+=&lt;/span&gt; value&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;因为静态方法是类方法，一个jvm中只会有一个静态方法，所有给这个静态方法加同步锁就意味着同时只能有一个线程进行访问。&lt;/p&gt;
&lt;h2&gt;Synchronized 实例中的方法块同步&lt;/h2&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;java&quot;&gt;&lt;pre class=&quot;language-java&quot;&gt;&lt;code class=&quot;language-java&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Count&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;

    &lt;span class=&quot;token keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;int&lt;/span&gt; count&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

    &lt;span class=&quot;token keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;add&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;int&lt;/span&gt; value&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;synchronized&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;token keyword&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;count &lt;span class=&quot;token operator&quot;&gt;+=&lt;/span&gt; value&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;这种写法和第一种的同步代码块的方式是一样的，都是对同一个对象的引用被多线程调用时需要进行同步执行，如果是每个线程中都是创建自己的对象引用，那么就不会出现同步执行。&lt;/p&gt;
&lt;h2&gt;Synchronized 静态方法中的代码块&lt;/h2&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;java&quot;&gt;&lt;pre class=&quot;language-java&quot;&gt;&lt;code class=&quot;language-java&quot;&gt;  &lt;span class=&quot;token keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;MyClass&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;

    &lt;span class=&quot;token keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;synchronized&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;log1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;String&lt;/span&gt; msg1&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;String&lt;/span&gt; msg2&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
       log&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;writeln&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;msg1&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
       log&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;writeln&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;msg2&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

  
    &lt;span class=&quot;token keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;log2&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;String&lt;/span&gt; msg1&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;String&lt;/span&gt; msg2&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
       &lt;span class=&quot;token keyword&quot;&gt;synchronized&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;MyClass&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;class&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
          log&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;writeln&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;msg1&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
          log&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;writeln&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;msg2&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
       &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;如果使用静态方法的同步代码块，就可以多个线程同时调用这个方法，只是调用进入方法之后同步执行，和同步静态方法的不同点是阻塞的地方不一样。&lt;/p&gt;
&lt;h1&gt;Java Volatile 关键字&lt;/h1&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;Volatile&lt;/code&gt; 这个关键字上面已经讲过了，每次读取一个此关键字声明的变量都会从主存储区中读取，不会从cpu缓存中读取，写入也是每次都会写入到主存储区中，不会只写入到cpu缓存中。
&lt;code class=&quot;language-text&quot;&gt;Volatile&lt;/code&gt;的可见性超出了变量本身，可见行会影响如下：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;如果线程A写入&lt;code class=&quot;language-text&quot;&gt;volatile&lt;/code&gt;变量,那么在写入时线程A所见的变量都会被写入到主存储中。&lt;/li&gt;
&lt;li&gt;如果线程A读入&lt;code class=&quot;language-text&quot;&gt;volatile&lt;/code&gt;变量，那么在读入时，线程A可见的变量也都将从主存储区中读入。&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;下面用代码说明这两个可见行：&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;java&quot;&gt;&lt;pre class=&quot;language-java&quot;&gt;&lt;code class=&quot;language-java&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;MyClass&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;int&lt;/span&gt; years&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;int&lt;/span&gt; months
    &lt;span class=&quot;token keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;volatile&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;int&lt;/span&gt; days&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;


    &lt;span class=&quot;token keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;update&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;int&lt;/span&gt; years&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;int&lt;/span&gt; months&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;int&lt;/span&gt; days&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;years  &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; years&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;months &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; months&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;days   &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; days&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;这个类中有三个变量，只有一个变量是&lt;code class=&quot;language-text&quot;&gt;volatile&lt;/code&gt;，在线程A执行&lt;code class=&quot;language-text&quot;&gt;update&lt;/code&gt;方法时，会把三个变量都写入到主存储区中，线程B在进行读取时就回对三个变量可见。&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;java&quot;&gt;&lt;pre class=&quot;language-java&quot;&gt;&lt;code class=&quot;language-java&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;MyClass&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;int&lt;/span&gt; years&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;int&lt;/span&gt; months
    &lt;span class=&quot;token keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;volatile&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;int&lt;/span&gt; days&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

    &lt;span class=&quot;token keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;totalDays&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;int&lt;/span&gt; total &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;days&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
        total &lt;span class=&quot;token operator&quot;&gt;+=&lt;/span&gt; months &lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;30&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
        total &lt;span class=&quot;token operator&quot;&gt;+=&lt;/span&gt; years &lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;365&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; total&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

    &lt;span class=&quot;token keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;update&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;int&lt;/span&gt; years&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;int&lt;/span&gt; months&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;int&lt;/span&gt; days&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;years  &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; years&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;months &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; months&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;days   &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; days&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;线程A调用&lt;code class=&quot;language-text&quot;&gt;totalDays&lt;/code&gt;方法时，因为&lt;code class=&quot;language-text&quot;&gt;days&lt;/code&gt;变量是&lt;code class=&quot;language-text&quot;&gt;volatile&lt;/code&gt;的，所以三个变量都将从主内存中读取。
&lt;code class=&quot;language-text&quot;&gt;volatile&lt;/code&gt;变量在写的时候要是最后一个变量，读的时候第一个变量，这样才能让方法中的变量可见行进行改变。&lt;/p&gt;
&lt;h2&gt;指令重排的问题&lt;/h2&gt;
&lt;p&gt;只要指令的语义不变，JVM和cpu就可以处于性能原因重新排序程序中的指令。
如：&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;java&quot;&gt;&lt;pre class=&quot;language-java&quot;&gt;&lt;code class=&quot;language-java&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;int&lt;/span&gt; a &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;int&lt;/span&gt; b &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
a &lt;span class=&quot;token operator&quot;&gt;++&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
b &lt;span class=&quot;token operator&quot;&gt;++&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;上面的语句会被重排&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;java&quot;&gt;&lt;pre class=&quot;language-java&quot;&gt;&lt;code class=&quot;language-java&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;int&lt;/span&gt; a &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
a&lt;span class=&quot;token operator&quot;&gt;++&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;int&lt;/span&gt; b &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
b&lt;span class=&quot;token operator&quot;&gt;++&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;但是如果某个变量是&lt;code class=&quot;language-text&quot;&gt;volatile&lt;/code&gt;的时候，重排可能就会影响到代码的语义，下面两个中如果&lt;code class=&quot;language-text&quot;&gt;update1&lt;/code&gt;方法被指令重排为&lt;code class=&quot;language-text&quot;&gt;update2&lt;/code&gt;方法，那它的语义就改变了，&lt;code class=&quot;language-text&quot;&gt;update1&lt;/code&gt;方法在更新时&lt;code class=&quot;language-text&quot;&gt;volatile&lt;/code&gt;变量是最后更新的，因此会让其他的变量都写入到主存储区中，&lt;code class=&quot;language-text&quot;&gt;update2&lt;/code&gt;方法经过指令重排之后，&lt;code class=&quot;language-text&quot;&gt;volatile&lt;/code&gt;变量就会第一被写入到主存储区中，另外两个变量会出现不再写入到主存储区中，就会出现可见行不一致问题。
这样的指令重排是有问题的，需要进行处理。Java有一个解决这个问题的方法。&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;java&quot;&gt;&lt;pre class=&quot;language-java&quot;&gt;&lt;code class=&quot;language-java&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;MyClass&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;int&lt;/span&gt; years&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;int&lt;/span&gt; months
    &lt;span class=&quot;token keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;volatile&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;int&lt;/span&gt; days&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;


    &lt;span class=&quot;token keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;update1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;int&lt;/span&gt; years&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;int&lt;/span&gt; months&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;int&lt;/span&gt; days&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;years  &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; years&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;months &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; months&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;days   &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; days&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;update2&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;int&lt;/span&gt; years&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;int&lt;/span&gt; months&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;int&lt;/span&gt; days&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;days   &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; days&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;months &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; months&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;years  &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; years&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2&gt;volatile 不能解决并发行问题&lt;/h2&gt;
&lt;p&gt;如果对应两个线程对同一个&lt;code class=&quot;language-text&quot;&gt;volatile&lt;/code&gt;进行读和写的时候是会出现并发问题的。&lt;code class=&quot;language-text&quot;&gt;volatile&lt;/code&gt;是用于解决一个线程对一个变量进行读和写，而其他线程只读取变量，能保证其他线程读取到的变量都是最新的，如果变量不是&lt;code class=&quot;language-text&quot;&gt;volatile&lt;/code&gt;这个类型的，就不能保证读取到的是最最新的值。&lt;/p&gt;
&lt;h2&gt;volatile的性能问题&lt;/h2&gt;
&lt;p&gt;在使用&lt;code class=&quot;language-text&quot;&gt;volatile&lt;/code&gt;变量之后会导致变量读和写都到主存储区，从主存储区读取和写入比从cpu缓存区读取和写入更加耗时，并且，访问&lt;code class=&quot;language-text&quot;&gt;volatile&lt;/code&gt;变量会阻止指令重新排序。因此，只有在真正需要对变量的可见性时才应该使用&lt;code class=&quot;language-text&quot;&gt;volatile&lt;/code&gt;变量。&lt;/p&gt;
&lt;h1&gt;Java ThreadLocal&lt;/h1&gt;
&lt;p&gt;线程变量可以用于线程过程中传递值，即使只有一个引用，线程变量也不会出现并发问题。&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;java&quot;&gt;&lt;pre class=&quot;language-java&quot;&gt;&lt;code class=&quot;language-java&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;ThreadLocal&lt;/span&gt; myThreadLocal &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;ThreadLocal&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
myThreadLocal&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;set&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;A thread local value&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token class-name&quot;&gt;String&lt;/span&gt; threadLocalValue &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;String&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; myThreadLocal&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;get&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h1&gt;Thread Signaling&lt;/h1&gt;
&lt;p&gt;线程信号的目的是使线程发送一个信号到其他线程，另外，线程信号使线程去等待一个其他线程的信号。比如：一个线程B可能会等待一个信号来自于线程A确定数据已经准备好。&lt;/p&gt;
&lt;h2&gt;共享信号变量&lt;/h2&gt;
&lt;p&gt;一种简单的信号共享变量就是通过一个共享对象来设置信号值，线程A可以从同步块内部将布尔变量&lt;code class=&quot;language-text&quot;&gt;hasDataToProcess&lt;/code&gt;设置为&lt;code class=&quot;language-text&quot;&gt;true&lt;/code&gt;,线程B通过读取共享变量来作为信号，下面是一个简单共享信号变量来做线程信号的例子。&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;java&quot;&gt;&lt;pre class=&quot;language-java&quot;&gt;&lt;code class=&quot;language-java&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;MySingle&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;protected&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;boolean&lt;/span&gt; hasDataToProcess &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;false&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

    &lt;span class=&quot;token keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;synchronized&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;boolean&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;hasDataToProcess&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;hasDataToProcess&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;synchronized&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;setHasDateToProcess&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;boolean&lt;/span&gt; hasDate&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;hasDataToProcess &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; hasDate
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;线程A和线程B必须都拥有同一个共享变量的引用，这样才能使信号生效，如果两个线程具有不同的引用，就不能使信号变量生效。如下使用：&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;java&quot;&gt;&lt;pre class=&quot;language-java&quot;&gt;&lt;code class=&quot;language-java&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;package&lt;/span&gt; &lt;span class=&quot;token namespace&quot;&gt;com&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;demo&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;concurrency&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;ThreadSingle&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
	&lt;span class=&quot;token keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;main&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;String&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; args&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
		&lt;span class=&quot;token class-name&quot;&gt;MySingle&lt;/span&gt; single &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;MySingle&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
		&lt;span class=&quot;token class-name&quot;&gt;Thread&lt;/span&gt; threadA &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Thread&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;MyRunable1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;single&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
		threadA&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;start&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
		&lt;span class=&quot;token class-name&quot;&gt;Thread&lt;/span&gt; threadB &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Thread&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;MyRunable2&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;single&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
		threadB&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;start&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
		
	&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
	&lt;span class=&quot;token keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;MyRunable1&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;implements&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Runnable&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;

		&lt;span class=&quot;token keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;MySingle&lt;/span&gt; mySingle&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

		&lt;span class=&quot;token keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;MyRunable1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;MySingle&lt;/span&gt; mySingle&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
			&lt;span class=&quot;token keyword&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;mySingle &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; mySingle&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
		&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
		&lt;span class=&quot;token annotation punctuation&quot;&gt;@Override&lt;/span&gt;
		&lt;span class=&quot;token keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;run&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
			&lt;span class=&quot;token class-name&quot;&gt;System&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;out&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;println&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;线程A开始发送信号&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
			&lt;span class=&quot;token keyword&quot;&gt;try&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
				&lt;span class=&quot;token class-name&quot;&gt;Thread&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;sleep&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1000&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
			&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;catch&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;InterruptedException&lt;/span&gt; e&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
				e&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;printStackTrace&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
			&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
			&lt;span class=&quot;token keyword&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;mySingle&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;setHasDateToProcess&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token boolean&quot;&gt;true&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
		&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
	&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
	&lt;span class=&quot;token keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;MyRunable2&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;implements&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Runnable&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
		&lt;span class=&quot;token keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;MySingle&lt;/span&gt; mySingle&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

		&lt;span class=&quot;token keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;MyRunable2&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;MySingle&lt;/span&gt; mySingle&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
			&lt;span class=&quot;token keyword&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;mySingle &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; mySingle&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
		&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
		&lt;span class=&quot;token annotation punctuation&quot;&gt;@Override&lt;/span&gt;
		&lt;span class=&quot;token keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;run&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
			&lt;span class=&quot;token keyword&quot;&gt;while&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;!&lt;/span&gt;mySingle&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;hasDateToProcess&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
				&lt;span class=&quot;token class-name&quot;&gt;System&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;out&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;println&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;等待中&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
			&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
			&lt;span class=&quot;token class-name&quot;&gt;System&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;out&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;println&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;接受到信号&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
		&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
	&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
	&lt;span class=&quot;token keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;MySingle&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
		&lt;span class=&quot;token keyword&quot;&gt;protected&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;boolean&lt;/span&gt; hasDateToProcess &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;false&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

		&lt;span class=&quot;token keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;synchronized&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;boolean&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;hasDateToProcess&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
			&lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;hasDateToProcess&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
		&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

		&lt;span class=&quot;token keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;synchronized&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;setHasDateToProcess&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;boolean&lt;/span&gt; hasDate&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
			&lt;span class=&quot;token keyword&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;hasDateToProcess &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; hasDate&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
		&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
	&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2&gt;wait(),notify(),notifyAll()&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;http://tutorials.jenkov.com/java-concurrency/thread-signaling.html&quot;&gt;http://tutorials.jenkov.com/java-concurrency/thread-signaling.html&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;线程B在等待是时一只忙等待的，这样是很浪费cpu的，线程应该以某种方式等待或者休眠，直到线程收到在等待的线程。Java中有一个内置的等待机制，可以让线程等待信号是变为非活动状态.&lt;/p&gt;
&lt;h1&gt;死锁&lt;/h1&gt;
&lt;h2&gt;线程死锁&lt;/h2&gt;
&lt;p&gt;线程死锁是指一个或多个线程被阻塞等待获取另一个线程中的所持有的锁。死锁会发生在同一个时刻当多个线程需要相同的锁，但是获取锁的顺序不一样时。
比如，两个线程，线程1拥有A的锁，现在要用于B的锁，同时，线程2拥有B的锁，现在获取A的锁，那么这两个线程就会发生死锁。&lt;/p&gt;
&lt;h2&gt;数据库死锁&lt;/h2&gt;
&lt;p&gt;数据库事务可能是更容易发生死锁的地方，一个数据库事务包含多个更新sql，当一个记录在事务的更新期间，这一条记录是被锁定的，直到这个事务完成，因此一个数据库事务可能会锁多行记录。
如果多个事务在同一时刻发起请求去更新同一条记录，这样就会发生死锁的情况。
数据库中的锁是很难提取知道的，只有开发应用的人才能避免这种情况。&lt;/p&gt;
&lt;h1&gt;死锁预防&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;锁订购&lt;/li&gt;
&lt;li&gt;锁超时&lt;/li&gt;
&lt;li&gt;死锁检测&lt;/li&gt;
&lt;/ul&gt;
&lt;h1&gt;线程饥饿和公平&lt;/h1&gt;
&lt;p&gt;如果一个线程因为其他线程占用了全部的cpu时间而不能获取cpu的使用，这种现象被称为饥饿，这个线程会从饥饿到死亡，因为其他线程完全占用着cpu，线程饥饿的解决办法称为公平。&lt;/p&gt;
&lt;h2&gt;Java中饥饿产生的原因&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;高优先级的线程从低优先级的线程中占有时间。&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;解决办法：可以为每个线程设定优先级，优先级越高，cpu占用的时间越长。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;线程访问同步代码块一只被阻，因为其他线程在这之前一直允许访问。&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Java的同步代码块是另一个线程饥饿的原因，同步代码块不能保证允许进入方法的线程的顺序，可能出现一个线程每次访问时都是被阻塞的状态。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;线程调用了&lt;code class=&quot;language-text&quot;&gt;wait()&lt;/code&gt;方法，一直在等待，因为其他线程一直被唤醒。&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;如果多个线程调用了同一个对象的&lt;code class=&quot;language-text&quot;&gt;wait&lt;/code&gt;方法，则&lt;code class=&quot;language-text&quot;&gt;notiy&lt;/code&gt;方法不能保证唤醒那个线程，因此，可能会出现有线程永远没有被唤醒的机会。&lt;/p&gt;
&lt;h2&gt;Java中使用公平&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;使用锁而不是同步快&lt;/li&gt;
&lt;/ul&gt;</content:encoded></item><item><title><![CDATA[Docker-Source-code-analysis]]></title><description><![CDATA[学习参考 docker源码讲解 docker 源码分析]]></description><link>https://lengrongfu.github.io/2018-10-31-Docker-Source-code-analysis/</link><guid isPermaLink="false">https://lengrongfu.github.io/2018-10-31-Docker-Source-code-analysis/</guid><pubDate>Wed, 31 Oct 2018 22:39:50 GMT</pubDate><content:encoded>&lt;h1&gt;学习参考&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;http://wangfakang.github.io/docker6/&quot;&gt;docker源码讲解&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;http://www.infoq.com/cn/articles/docker-source-code-analysis-part1&quot;&gt;docker 源码分析&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;</content:encoded></item><item><title><![CDATA[DAWN Group]]></title><description><![CDATA[是 和  核心作者之一的  在斯坦福推出的以普及机器学习实践为目的的开源项目，他们想要使人工智能应用程序构建更加容易。
仅以此文记录需要持续关注这个开源项目，里面有很多很好的项目，和很好的。 官网 KVS数据库Anna Anna 设计论文 spatial…]]></description><link>https://lengrongfu.github.io/2018-10-31-DAWN-Group/</link><guid isPermaLink="false">https://lengrongfu.github.io/2018-10-31-DAWN-Group/</guid><pubDate>Wed, 31 Oct 2018 22:23:59 GMT</pubDate><content:encoded>&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;DAWN&lt;/code&gt; 是&lt;code class=&quot;language-text&quot;&gt;Spark&lt;/code&gt; 和 &lt;code class=&quot;language-text&quot;&gt;Mesos&lt;/code&gt; 核心作者之一的 &lt;code class=&quot;language-text&quot;&gt;Matei&lt;/code&gt; 在斯坦福推出的以普及机器学习实践为目的的开源项目，他们想要使人工智能应用程序构建更加容易。
仅以此文记录需要持续关注这个开源项目，里面有很多很好的项目，和很好的&lt;code class=&quot;language-text&quot;&gt;bolg&lt;/code&gt;。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https://dawn.cs.stanford.edu/&quot;&gt;官网&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://juejin.im/post/5aaa5495518825557b4c7966&quot;&gt;KVS数据库Anna&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;http://db.cs.berkeley.edu/jmh/papers/anna_ieee18.pdf&quot;&gt;Anna 设计论文&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://spatial-lang.org/&quot;&gt;spatial 高级语言实现底层硬件&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;spatial&lt;/code&gt; 这个项目很有意思，可以直接用&lt;code class=&quot;language-text&quot;&gt;Java&lt;/code&gt;或者&lt;code class=&quot;language-text&quot;&gt;Scala&lt;/code&gt;来操作硬件编程&lt;code class=&quot;language-text&quot;&gt;FPGA&lt;/code&gt;,以后有可能在&lt;code class=&quot;language-text&quot;&gt;FPGA&lt;/code&gt;上进行编程不再需要学习&lt;code class=&quot;language-text&quot;&gt;verilog&lt;/code&gt;了。&lt;/p&gt;</content:encoded></item><item><title><![CDATA[ZooKeeper kerberos 客户端认证]]></title><description><![CDATA[中的 添加了 认证，写的代码需要操作中的,因此代码需要进行认证才能操作。 spring boot 项目进行认证 项目不需要进行任何修改和添加，在启动参数中加入认证即可，认证方式和的认证不一样，所以实现方式也不一样。 tomcat…]]></description><link>https://lengrongfu.github.io/2018-10-31-ZooKeeper-kerberos/</link><guid isPermaLink="false">https://lengrongfu.github.io/2018-10-31-ZooKeeper-kerberos/</guid><pubDate>Wed, 31 Oct 2018 21:25:55 GMT</pubDate><content:encoded>&lt;blockquote&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;Hadoop&lt;/code&gt;中的&lt;code class=&quot;language-text&quot;&gt;ZooKeeper&lt;/code&gt; 添加了&lt;code class=&quot;language-text&quot;&gt;kerberos&lt;/code&gt; 认证，写的代码需要操作&lt;code class=&quot;language-text&quot;&gt;Hadoop&lt;/code&gt;中的&lt;code class=&quot;language-text&quot;&gt;ZooKeeper&lt;/code&gt;,因此代码需要进行认证才能操作&lt;code class=&quot;language-text&quot;&gt;ZooKeeper&lt;/code&gt;。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h1&gt;spring boot 项目进行认证&lt;/h1&gt;
&lt;p&gt;项目不需要进行任何修改和添加，在启动参数中加入认证即可，认证方式和&lt;code class=&quot;language-text&quot;&gt;Hbase&lt;/code&gt;的&lt;code class=&quot;language-text&quot;&gt;kerberos&lt;/code&gt;认证不一样，所以实现方式也不一样。&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;shell&quot;&gt;&lt;pre class=&quot;language-shell&quot;&gt;&lt;code class=&quot;language-shell&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;# -Dsun.security.krb5.debug=true 开启认证调试日志，这样有助于分析认证失败原因，可以达到事半功倍的效果&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;# -Djava.security.auth.login.config=./jaas.conf 这是zookeeper的认证文件&lt;/span&gt;
java -jar -Djava.security.auth.login.config&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;./jaas.conf -Dsun.security.krb5.debug&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;true demo.jar&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h1&gt;tomcat 项目进行认证&lt;/h1&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;shell&quot;&gt;&lt;pre class=&quot;language-shell&quot;&gt;&lt;code class=&quot;language-shell&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;# tomcat 进行认证需要进行配置到 catalina.sh 中&lt;/span&gt;
&lt;span class=&quot;token assign-left variable&quot;&gt;CATALINA_OPTS&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;&lt;span class=&quot;token variable&quot;&gt;$CATALINA_OPTS&lt;/span&gt;-Djava.security.auth.login.config=./jaas.conf&quot;&lt;/span&gt;
&lt;span class=&quot;token assign-left variable&quot;&gt;CATALINA_OPTS&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;&lt;span class=&quot;token variable&quot;&gt;$CATALINA_OPTS&lt;/span&gt; -Dsun.security.krb5.debug=true&quot;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;重启项目即可进行认证。&lt;/p&gt;
&lt;h1&gt;ZooKeeper kerberos&lt;/h1&gt;
&lt;p&gt;在使用&lt;code class=&quot;language-text&quot;&gt;jaas.conf&lt;/code&gt;文件中要注意，此文件分为服务端和客户端的配置文件，不能给错了，如果使用错误也是不能进行认证，&lt;code class=&quot;language-text&quot;&gt;keytab&lt;/code&gt;也是不一样的，用错了也是不能进行认证通过的。&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;shell&quot;&gt;&lt;pre class=&quot;language-shell&quot;&gt;&lt;code class=&quot;language-shell&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;# 服务端&lt;/span&gt;
Server &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  com.sun.security.auth.module.Krb5LoginModule required
  &lt;span class=&quot;token assign-left variable&quot;&gt;useKeyTab&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;true
  &lt;span class=&quot;token assign-left variable&quot;&gt;keyTab&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;/etc/zookeeper/conf/zookeeper.keytab&quot;&lt;/span&gt;
  &lt;span class=&quot;token assign-left variable&quot;&gt;storeKey&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;true
  &lt;span class=&quot;token assign-left variable&quot;&gt;useTicketCache&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;false
  &lt;span class=&quot;token assign-left variable&quot;&gt;principal&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;zookeeper/cdh1@JAVACHEN.COM&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;token comment&quot;&gt;# 客户端&lt;/span&gt;
Client &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  com.sun.security.auth.module.Krb5LoginModule required
  &lt;span class=&quot;token assign-left variable&quot;&gt;useKeyTab&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;true
  &lt;span class=&quot;token assign-left variable&quot;&gt;keyTab&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;/etc/zookeeper/conf/zkcli.keytab&quot;&lt;/span&gt;
  &lt;span class=&quot;token assign-left variable&quot;&gt;storeKey&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;true
  &lt;span class=&quot;token assign-left variable&quot;&gt;useTicketCache&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;false
  &lt;span class=&quot;token assign-left variable&quot;&gt;principal&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;zkcli@JAVACHEN.COM&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h1&gt;参考&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;http://www.voidcn.com/article/p-hnbafumk-bez.html&quot;&gt;http://www.voidcn.com/article/p-hnbafumk-bez.html&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;</content:encoded></item><item><title><![CDATA[pinpoint 添加 hbase kerberos认证]]></title><description><![CDATA[原生是不支持的的认证的，经过修改源码，现已在版本之后支持了这一功能，并入到项目主分支中，以后可以直接使用。 开源地址: https://github.com/naver/pinpoint kerberos…]]></description><link>https://lengrongfu.github.io/2018-10-18-pinpoint-add-hbase-kerberos-auth/</link><guid isPermaLink="false">https://lengrongfu.github.io/2018-10-18-pinpoint-add-hbase-kerberos-auth/</guid><pubDate>Thu, 18 Oct 2018 09:31:31 GMT</pubDate><content:encoded>&lt;blockquote&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;pinpoint&lt;/code&gt; 原生是不支持的&lt;code class=&quot;language-text&quot;&gt;hbase&lt;/code&gt;的&lt;code class=&quot;language-text&quot;&gt;kerberos&lt;/code&gt;认证的，经过修改源码，现已在&lt;code class=&quot;language-text&quot;&gt;1.8&lt;/code&gt;版本之后支持了这一功能，并入到项目主分支中，以后可以直接使用。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;开源地址: &lt;a href=&quot;https://github.com/naver/pinpoint&quot;&gt;https://github.com/naver/pinpoint&lt;/a&gt;&lt;/p&gt;
&lt;h1&gt;kerberos 认证简介&lt;/h1&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;Kerberos&lt;/code&gt; 是一种基于对称密钥的身份认证协议，它作为一个独立的第三方的身份认证服务，可以为其服务提供身份认证功能，且支持&lt;code class=&quot;language-text&quot;&gt;SSO&lt;/code&gt;(即客户端身份认证后，可以访问多个服务如HBase/HDFS等).
&lt;code class=&quot;language-text&quot;&gt;Kerberos&lt;/code&gt; 协议过程主要有两个阶段，第一个阶段是&lt;code class=&quot;language-text&quot;&gt;KDC&lt;/code&gt;对&lt;code class=&quot;language-text&quot;&gt;client&lt;/code&gt;的身份认证,第二个阶段是&lt;code class=&quot;language-text&quot;&gt;service&lt;/code&gt;对&lt;code class=&quot;language-text&quot;&gt;client&lt;/code&gt;的身份认证.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;&lt;img src=&quot;DingTalk20171127114504.png&quot; alt=&quot;原理图&quot;&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;KDC: Kerberos的服务端程序&lt;/li&gt;
&lt;li&gt;Client: 需要访问服务的用户(principal)，KDC和Service会对用户的身份进行认证&lt;/li&gt;
&lt;li&gt;Service: 集成了Kerberos的服务，如HDFS/YARN/HBase等&lt;/li&gt;
&lt;/ul&gt;
&lt;h2&gt;1、KDC对Client身份认证&lt;/h2&gt;
&lt;p&gt;当客户端用户访问一个集成了&lt;code class=&quot;language-text&quot;&gt;Kerberos&lt;/code&gt;的服务之前，需要先通过&lt;code class=&quot;language-text&quot;&gt;KDC&lt;/code&gt;的身份认证.若身份认证通过则客户端会拿到一个&lt;code class=&quot;language-text&quot;&gt;TGT&lt;/code&gt;,后续就可以拿该&lt;code class=&quot;language-text&quot;&gt;TGT&lt;/code&gt;去访问集成了&lt;code class=&quot;language-text&quot;&gt;Kerberos&lt;/code&gt;的服务。&lt;/p&gt;
&lt;h2&gt;2、Service对Client身份认证&lt;/h2&gt;
&lt;p&gt;当该客户端拿到&lt;code class=&quot;language-text&quot;&gt;TGT&lt;/code&gt;之后，就可以继续访问&lt;code class=&quot;language-text&quot;&gt;Service&lt;/code&gt;服务。它回使用&lt;code class=&quot;language-text&quot;&gt;TGT&lt;/code&gt;以及需要访问的服务名称去&lt;code class=&quot;language-text&quot;&gt;KDC&lt;/code&gt;获取&lt;code class=&quot;language-text&quot;&gt;SGT&lt;/code&gt;,然后使用&lt;code class=&quot;language-text&quot;&gt;SGT&lt;/code&gt;去访问服务&lt;code class=&quot;language-text&quot;&gt;Service&lt;/code&gt;，&lt;code class=&quot;language-text&quot;&gt;Service&lt;/code&gt;会利用相关信息对&lt;code class=&quot;language-text&quot;&gt;Client&lt;/code&gt;进行身份认证,认证通过后就可以正常访问&lt;code class=&quot;language-text&quot;&gt;Service&lt;/code&gt;服务。&lt;/p&gt;
&lt;h1&gt;Hbase kerberos 认证&lt;/h1&gt;
&lt;h2&gt;1、修改源码&lt;/h2&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;pinpoint&lt;/code&gt;中的&lt;code class=&quot;language-text&quot;&gt;hbase&lt;/code&gt;相关代码都是在&lt;code class=&quot;language-text&quot;&gt;commons-hbase&lt;/code&gt;这个项目中，连接都是通过&lt;code class=&quot;language-text&quot;&gt;PooledHTableFactory.java&lt;/code&gt; 这个类创建的，因此修改代码的地方就是这个类，并且只需要添加上&lt;code class=&quot;language-text&quot;&gt;hbase&lt;/code&gt;认证代码即可.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;java&quot;&gt;&lt;pre class=&quot;language-java&quot;&gt;&lt;code class=&quot;language-java&quot;&gt;     &lt;span class=&quot;token keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;PooledHTableFactory&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;Configuration&lt;/span&gt; config&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;ExecutorService&lt;/span&gt; executor&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
         &lt;span class=&quot;token class-name&quot;&gt;Objects&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;requireNonNull&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;config&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;config must not be null&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
         &lt;span class=&quot;token keyword&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;executor &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Objects&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;requireNonNull&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;executor&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;executor must not be null&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
         &lt;span class=&quot;token keyword&quot;&gt;try&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
             &lt;span class=&quot;token class-name&quot;&gt;String&lt;/span&gt; authEnable &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; config&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;get&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;hbase.kerberos.auth&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
             &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;!&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;StringUtils&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;isEmpty&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;authEnable&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Boolean&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;parseBoolean&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;authEnable&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
                 &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;StringUtils&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;isEmpty&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;config&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;get&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;hbase.kerberos.keytab.path&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
                     &lt;span class=&quot;token keyword&quot;&gt;throw&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;KerberosException&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;ErrorType&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;KDC_ERR_NONE&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
                 &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
                 &lt;span class=&quot;token class-name&quot;&gt;System&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;out&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;println&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;hbase.zookeeper.quorum:&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;+&lt;/span&gt;config&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;get&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;hbase.zookeeper.quorum&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
                 &lt;span class=&quot;token class-name&quot;&gt;System&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;out&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;println&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;hbase.kerberos.keytab.path:&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;+&lt;/span&gt;config&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;get&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;hbase.kerberos.keytab.path&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
                 &lt;span class=&quot;token class-name&quot;&gt;System&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;out&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;println&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;hbase.kerberos.user:&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;+&lt;/span&gt;config&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;get&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;hbase.kerberos.user&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
 
                 config&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;set&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;hbase.security.authentication&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;kerberos&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
                 config&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;set&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;hadoop.security.authentication&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;kerberos&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
                 config&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;set&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;hbase.master.kerberos.principal&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;config&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;get&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;hbase.master.kerberos.principal&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
                 config&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;set&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;hbase.regionserver.kerberos.principal&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;config&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;get&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;hbase.regionserver.kerberos.principal&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
                 &lt;span class=&quot;token class-name&quot;&gt;UserGroupInformation&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;setConfiguration&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;config&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
                 &lt;span class=&quot;token class-name&quot;&gt;String&lt;/span&gt; kerberosUser &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; config&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;get&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;hbase.kerberos.user&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
                 &lt;span class=&quot;token class-name&quot;&gt;String&lt;/span&gt; kerberosPath &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; config&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;get&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;hbase.kerberos.keytab.path&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
                 &lt;span class=&quot;token class-name&quot;&gt;UserGroupInformation&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;loginUserFromKeytab&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;kerberosUser&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; kerberosPath&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
             &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
             &lt;span class=&quot;token keyword&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;connection &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;ConnectionFactory&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;createConnection&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;config&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; executor&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
         &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;catch&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;Exception&lt;/span&gt; e&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
             &lt;span class=&quot;token keyword&quot;&gt;throw&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;HbaseSystemException&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;e&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
         &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
     &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;只添加了&lt;code class=&quot;language-text&quot;&gt;if&lt;/code&gt;里面的所以代码，值都通过配置文件传入，设置了开关，可以启用或者禁用认证功能。&lt;/p&gt;
&lt;h2&gt;2、添加配置&lt;/h2&gt;
&lt;blockquote&gt;
&lt;p&gt;添加&lt;code class=&quot;language-text&quot;&gt;hbase.properties&lt;/code&gt;的配置&lt;/p&gt;
&lt;/blockquote&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;properties&quot;&gt;&lt;pre class=&quot;language-properties&quot;&gt;&lt;code class=&quot;language-properties&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;# kerberos&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;# 是否启用或者禁用&lt;/span&gt;
&lt;span class=&quot;token attr-name&quot;&gt;hbase.kerberos.auth&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token attr-value&quot;&gt;true&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;# kerberos 用户&lt;/span&gt;
&lt;span class=&quot;token attr-name&quot;&gt;hbase.kerberos.user&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token attr-value&quot;&gt;test_add@HADOOP.COM&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;# keytab 认证文件路径&lt;/span&gt;
&lt;span class=&quot;token attr-name&quot;&gt;hbase.kerberos.keytab.path&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token attr-value&quot;&gt;./test_add.keytab&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;# 默认配置&lt;/span&gt;
&lt;span class=&quot;token attr-name&quot;&gt;hbase.master.kerberos.principal&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token attr-value&quot;&gt;hbase/_HOST@HADOOP.COM&lt;/span&gt;
&lt;span class=&quot;token attr-name&quot;&gt;hbase.regionserver.kerberos.principal&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token attr-value&quot;&gt;hbase/_HOST@HADOOP.COM&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;blockquote&gt;
&lt;p&gt;添加 &lt;code class=&quot;language-text&quot;&gt;applicationContext-hbase.xml&lt;/code&gt;的配置.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;xml&quot;&gt;&lt;pre class=&quot;language-xml&quot;&gt;&lt;code class=&quot;language-xml&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;bean&lt;/span&gt; &lt;span class=&quot;token attr-name&quot;&gt;id&lt;/span&gt;&lt;span class=&quot;token attr-value&quot;&gt;&lt;span class=&quot;token punctuation attr-equals&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;hbaseConfiguration&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;token attr-name&quot;&gt;class&lt;/span&gt;&lt;span class=&quot;token attr-value&quot;&gt;&lt;span class=&quot;token punctuation attr-equals&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;com.navercorp.pinpoint.common.hbase.HbaseConfigurationFactoryBean&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;
        &lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;property&lt;/span&gt; &lt;span class=&quot;token attr-name&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token attr-value&quot;&gt;&lt;span class=&quot;token punctuation attr-equals&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;properties&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;
            &lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;props&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;
                &lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;prop&lt;/span&gt; &lt;span class=&quot;token attr-name&quot;&gt;key&lt;/span&gt;&lt;span class=&quot;token attr-value&quot;&gt;&lt;span class=&quot;token punctuation attr-equals&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;hbase.zookeeper.quorum&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;${hbase.client.host}&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;/&lt;/span&gt;prop&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;
                &lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;prop&lt;/span&gt; &lt;span class=&quot;token attr-name&quot;&gt;key&lt;/span&gt;&lt;span class=&quot;token attr-value&quot;&gt;&lt;span class=&quot;token punctuation attr-equals&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;hbase.zookeeper.property.clientPort&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;${hbase.client.port}&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;/&lt;/span&gt;prop&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;

               &lt;span class=&quot;token comment&quot;&gt;&amp;lt;!--Root ZNode for HBase in ZooKeeper.--&gt;&lt;/span&gt;
                &lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;prop&lt;/span&gt; &lt;span class=&quot;token attr-name&quot;&gt;key&lt;/span&gt;&lt;span class=&quot;token attr-value&quot;&gt;&lt;span class=&quot;token punctuation attr-equals&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;zookeeper.znode.parent&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;${hbase.zookeeper.znode.parent:/hbase}&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;/&lt;/span&gt;prop&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;
                 &lt;span class=&quot;token comment&quot;&gt;&amp;lt;!-- hbase default:true --&gt;&lt;/span&gt;
                &lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;prop&lt;/span&gt; &lt;span class=&quot;token attr-name&quot;&gt;key&lt;/span&gt;&lt;span class=&quot;token attr-value&quot;&gt;&lt;span class=&quot;token punctuation attr-equals&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;hbase.ipc.client.tcpnodelay&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;${hbase.ipc.client.tcpnodelay}&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;/&lt;/span&gt;prop&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;
                &lt;span class=&quot;token comment&quot;&gt;&amp;lt;!-- hbase default:60000 --&gt;&lt;/span&gt;
                &lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;prop&lt;/span&gt; &lt;span class=&quot;token attr-name&quot;&gt;key&lt;/span&gt;&lt;span class=&quot;token attr-value&quot;&gt;&lt;span class=&quot;token punctuation attr-equals&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;hbase.rpc.timeout&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;${hbase.rpc.timeout}&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;/&lt;/span&gt;prop&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;
                &lt;span class=&quot;token comment&quot;&gt;&amp;lt;!-- hbase default:Integer.MAX_VALUE --&gt;&lt;/span&gt;
                &lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;prop&lt;/span&gt; &lt;span class=&quot;token attr-name&quot;&gt;key&lt;/span&gt;&lt;span class=&quot;token attr-value&quot;&gt;&lt;span class=&quot;token punctuation attr-equals&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;hbase.client.operation.timeout&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;${hbase.client.operation.timeout}&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;/&lt;/span&gt;prop&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;

                &lt;span class=&quot;token comment&quot;&gt;&amp;lt;!-- hbase socket read timeout. default: 200000--&gt;&lt;/span&gt;
                &lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;prop&lt;/span&gt; &lt;span class=&quot;token attr-name&quot;&gt;key&lt;/span&gt;&lt;span class=&quot;token attr-value&quot;&gt;&lt;span class=&quot;token punctuation attr-equals&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;hbase.ipc.client.socket.timeout.read&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;${hbase.ipc.client.socket.timeout.read}&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;/&lt;/span&gt;prop&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;
                &lt;span class=&quot;token comment&quot;&gt;&amp;lt;!-- socket write timeout. hbase default: 600000--&gt;&lt;/span&gt;
                 &lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;prop&lt;/span&gt; &lt;span class=&quot;token attr-name&quot;&gt;key&lt;/span&gt;&lt;span class=&quot;token attr-value&quot;&gt;&lt;span class=&quot;token punctuation attr-equals&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;hbase.ipc.client.socket.timeout.write&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;${hbase.ipc.client.socket.timeout.write}&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;/&lt;/span&gt;prop&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;
 
                 &lt;span class=&quot;token comment&quot;&gt;&amp;lt;!-- hbase async put operation. --&gt;&lt;/span&gt;
                 &lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;prop&lt;/span&gt; &lt;span class=&quot;token attr-name&quot;&gt;key&lt;/span&gt;&lt;span class=&quot;token attr-value&quot;&gt;&lt;span class=&quot;token punctuation attr-equals&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;hbase.client.async.enable&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;${hbase.client.async.enable:false}&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;/&lt;/span&gt;prop&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;
                 &lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;prop&lt;/span&gt; &lt;span class=&quot;token attr-name&quot;&gt;key&lt;/span&gt;&lt;span class=&quot;token attr-value&quot;&gt;&lt;span class=&quot;token punctuation attr-equals&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;hbase.client.async.in.queuesize&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;${hbase.client.async.in.queuesize:10000}&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;/&lt;/span&gt;prop&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;
                 &lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;prop&lt;/span&gt; &lt;span class=&quot;token attr-name&quot;&gt;key&lt;/span&gt;&lt;span class=&quot;token attr-value&quot;&gt;&lt;span class=&quot;token punctuation attr-equals&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;hbase.tablemultiplexer.flush.period.ms&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;${hbase.client.async.flush.period.ms:100}&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;/&lt;/span&gt;prop&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;
                 &lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;prop&lt;/span&gt; &lt;span class=&quot;token attr-name&quot;&gt;key&lt;/span&gt;&lt;span class=&quot;token attr-value&quot;&gt;&lt;span class=&quot;token punctuation attr-equals&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;hbase.client.max.retries.in.queue&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;${hbase.client.async.max.retries.in.queue:10}&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;/&lt;/span&gt;prop&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;
                &lt;span class=&quot;token comment&quot;&gt;&amp;lt;!--hbase kerberos--&gt;&lt;/span&gt;
                &lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;prop&lt;/span&gt; &lt;span class=&quot;token attr-name&quot;&gt;key&lt;/span&gt;&lt;span class=&quot;token attr-value&quot;&gt;&lt;span class=&quot;token punctuation attr-equals&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;hbase.kerberos.auth&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;${hbase.kerberos.auth:false}&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;/&lt;/span&gt;prop&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;
                &lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;prop&lt;/span&gt; &lt;span class=&quot;token attr-name&quot;&gt;key&lt;/span&gt;&lt;span class=&quot;token attr-value&quot;&gt;&lt;span class=&quot;token punctuation attr-equals&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;hbase.kerberos.user&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;${hbase.kerberos.user:test}&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;/&lt;/span&gt;prop&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;
                &lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;prop&lt;/span&gt; &lt;span class=&quot;token attr-name&quot;&gt;key&lt;/span&gt;&lt;span class=&quot;token attr-value&quot;&gt;&lt;span class=&quot;token punctuation attr-equals&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;hbase.kerberos.keytab.path&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;${hbase.kerberos.keytab.path:/tmp}&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;/&lt;/span&gt;prop&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;
                &lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;prop&lt;/span&gt; &lt;span class=&quot;token attr-name&quot;&gt;key&lt;/span&gt;&lt;span class=&quot;token attr-value&quot;&gt;&lt;span class=&quot;token punctuation attr-equals&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;hbase.master.kerberos.principal&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;${hbase.master.kerberos.principal:test}&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;/&lt;/span&gt;prop&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;
                &lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;prop&lt;/span&gt; &lt;span class=&quot;token attr-name&quot;&gt;key&lt;/span&gt;&lt;span class=&quot;token attr-value&quot;&gt;&lt;span class=&quot;token punctuation attr-equals&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;hbase.regionserver.kerberos.principal&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;${hbase.regionserver.kerberos.principal:test}&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;/&lt;/span&gt;prop&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;
            &lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;/&lt;/span&gt;props&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;
        &lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;/&lt;/span&gt;property&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;
    &lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;/&lt;/span&gt;bean&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2&gt;3、添加启动参数配置到&lt;code class=&quot;language-text&quot;&gt;tomcat&lt;/code&gt;中&lt;/h2&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;shell&quot;&gt;&lt;pre class=&quot;language-shell&quot;&gt;&lt;code class=&quot;language-shell&quot;&gt;$ &lt;span class=&quot;token function&quot;&gt;vim&lt;/span&gt; bin/catalina.sh
&lt;span class=&quot;token comment&quot;&gt;# 添加krb配置文件&lt;/span&gt;
&lt;span class=&quot;token assign-left variable&quot;&gt;CATALINA_OPTS&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;&lt;span class=&quot;token variable&quot;&gt;$CATALINA_OPTS&lt;/span&gt; -Djava.security.krb5.conf=./krb5.conf&quot;&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;# 开启krb认证的bug日志&lt;/span&gt;
&lt;span class=&quot;token assign-left variable&quot;&gt;CATALINA_OPTS&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;&lt;span class=&quot;token variable&quot;&gt;$CATALINA_OPTS&lt;/span&gt; -Dsun.security.krb5.debug=true&quot;&lt;/span&gt;
&lt;span class=&quot;token assign-left variable&quot;&gt;CATALINA_OPTS&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;&lt;span class=&quot;token variable&quot;&gt;$CATALINA_OPTS&lt;/span&gt; -Djavax.security.auth.useSubjectCredsOnly=true&quot;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;** 上面步骤都完成之后即可进行重启使用。**&lt;/p&gt;</content:encoded></item><item><title><![CDATA[mysql-install]]></title><description><![CDATA[mysql centos7 安装指南(Yum) 参考文档：https://dev.mysql.com/doc/mysql-yum-repo-quick-guide/en/ 1、添加　mysql yum存储库 下载平台发行包： mysql5.7版本 安装下载的发行包：…]]></description><link>https://lengrongfu.github.io/2018-10-17-mysql-install/</link><guid isPermaLink="false">https://lengrongfu.github.io/2018-10-17-mysql-install/</guid><pubDate>Wed, 17 Oct 2018 23:24:18 GMT</pubDate><content:encoded>&lt;h1&gt;mysql centos7 安装指南(Yum)&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;参考文档：&lt;a href=&quot;https://dev.mysql.com/doc/mysql-yum-repo-quick-guide/en/&quot;&gt;https://dev.mysql.com/doc/mysql-yum-repo-quick-guide/en/&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h3&gt;1、添加　mysql yum存储库&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;下载平台发行包：&lt;code class=&quot;language-text&quot;&gt;wget -c https://repo.mysql.com//mysql57-community-release-el6-11.noarch.rpm&lt;/code&gt; mysql5.7版本&lt;/li&gt;
&lt;li&gt;安装下载的发行包：&lt;code class=&quot;language-text&quot;&gt;$ sudo rpm -Uvh mysql57-community-release-el6-n.noarch.rpm&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h3&gt;2、选择版本&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;默认情况下选择最新的mysql版本进行安装，如果这是能接收的那就跳到安装步骤。&lt;/li&gt;
&lt;li&gt;可以查看启用或禁用的版本：&lt;code class=&quot;language-text&quot;&gt;shell &gt; yum repolist all | grep mysql&lt;/code&gt;，执行结果，默认最新版启用的。&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;shell&quot;&gt;&lt;pre class=&quot;language-shell&quot;&gt;&lt;code class=&quot;language-shell&quot;&gt;Repository epel is listed &lt;span class=&quot;token function&quot;&gt;more&lt;/span&gt; than once &lt;span class=&quot;token keyword&quot;&gt;in&lt;/span&gt; the configuration
&lt;span class=&quot;token operator&quot;&gt;!&lt;/span&gt;mysql-connectors-community/x86_64 MySQL Connectors Community       启用:     &lt;span class=&quot;token number&quot;&gt;36&lt;/span&gt;
mysql-connectors-community-source  MySQL Connectors Community - Sou 禁用
&lt;span class=&quot;token operator&quot;&gt;!&lt;/span&gt;mysql-tools-community/x86_64      MySQL Tools Community            启用:     &lt;span class=&quot;token number&quot;&gt;47&lt;/span&gt;
mysql-tools-community-source       MySQL Tools Community - Source   禁用
mysql-tools-preview/x86_64         MySQL Tools Preview              禁用
mysql-tools-preview-source         MySQL Tools Preview - Source     禁用
mysql55-community/x86_64           MySQL &lt;span class=&quot;token number&quot;&gt;5.5&lt;/span&gt; Community Server       禁用
mysql55-community-source           MySQL &lt;span class=&quot;token number&quot;&gt;5.5&lt;/span&gt; Community Server - Sou 禁用
mysql56-community/x86_64           MySQL &lt;span class=&quot;token number&quot;&gt;5.6&lt;/span&gt; Community Server       禁用
mysql56-community-source           MySQL &lt;span class=&quot;token number&quot;&gt;5.6&lt;/span&gt; Community Server - Sou 禁用
&lt;span class=&quot;token operator&quot;&gt;!&lt;/span&gt;mysql57-community/x86_64          MySQL &lt;span class=&quot;token number&quot;&gt;5.7&lt;/span&gt; Community Server       启用:    &lt;span class=&quot;token number&quot;&gt;187&lt;/span&gt;
mysql57-community-source           MySQL &lt;span class=&quot;token number&quot;&gt;5.7&lt;/span&gt; Community Server - Sou 禁用&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;ul&gt;
&lt;li&gt;启用自定义版本并禁用最新版：&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;shell&quot;&gt;&lt;pre class=&quot;language-shell&quot;&gt;&lt;code class=&quot;language-shell&quot;&gt;shell&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;sudo&lt;/span&gt; yum-config-manager --disable mysql57-community
shell&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;sudo&lt;/span&gt; yum-config-manager --enable mysql56-community&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h3&gt;3、安装 &lt;code class=&quot;language-text&quot;&gt;MySQL&lt;/code&gt;&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;以下是安装命令：&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;shell&quot;&gt;&lt;pre class=&quot;language-shell&quot;&gt;&lt;code class=&quot;language-shell&quot;&gt;  $ &lt;span class=&quot;token function&quot;&gt;sudo&lt;/span&gt; yum &lt;span class=&quot;token function&quot;&gt;install&lt;/span&gt; mysql-community-server&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h3&gt;4、启动MySQL服务器&lt;/h3&gt;
&lt;p&gt;-　使用以下命令启动MySQL：&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;shell&quot;&gt;&lt;pre class=&quot;language-shell&quot;&gt;&lt;code class=&quot;language-shell&quot;&gt; $ &lt;span class=&quot;token function&quot;&gt;sudo&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;service&lt;/span&gt; mysqld start&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;-　如果系统是&lt;code class=&quot;language-text&quot;&gt;Centos7&lt;/code&gt; 首选安装命令是：&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;shell&quot;&gt;&lt;pre class=&quot;language-shell&quot;&gt;&lt;code class=&quot;language-shell&quot;&gt;$ &lt;span class=&quot;token function&quot;&gt;sudo&lt;/span&gt; systemctl start mysqld.service&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;ul&gt;
&lt;li&gt;以下命令是检查MySQL服务器的状态：&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;shell&quot;&gt;&lt;pre class=&quot;language-shell&quot;&gt;&lt;code class=&quot;language-shell&quot;&gt;$ &lt;span class=&quot;token function&quot;&gt;sudo&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;service&lt;/span&gt; mysqld status&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;ul&gt;
&lt;li&gt;对于&lt;code class=&quot;language-text&quot;&gt;CentOs7&lt;/code&gt;平台，首先以下命令：&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;shell&quot;&gt;&lt;pre class=&quot;language-shell&quot;&gt;&lt;code class=&quot;language-shell&quot;&gt;$ &lt;span class=&quot;token function&quot;&gt;sudo&lt;/span&gt; systemctl status mysqld.service&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;MySQL服务初始化(仅适用5.7)&lt;/p&gt;
&lt;h3&gt;5、保护MySQL（仅使用于MySQL5.6）&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;初始化设置MySQL密码，执行以下命令：&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;shell&quot;&gt;&lt;pre class=&quot;language-shell&quot;&gt;&lt;code class=&quot;language-shell&quot;&gt;$ mysqladmin -u root password&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h3&gt;６、安装其他的MySQL工具&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;使用yum来安装和管理MySQL的各个组件，使用以下命令从mysql yum存储库中列出所有mysql：&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;shell&quot;&gt;&lt;pre class=&quot;language-shell&quot;&gt;&lt;code class=&quot;language-shell&quot;&gt;$ yum --disablerepo&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;\&lt;/span&gt;* --enablerepo&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;mysql*-community*&apos;&lt;/span&gt; list available&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;ul&gt;
&lt;li&gt;使用以下命令安装选择软件包：&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;shell&quot;&gt;&lt;pre class=&quot;language-shell&quot;&gt;&lt;code class=&quot;language-shell&quot;&gt;$ &lt;span class=&quot;token function&quot;&gt;sudo&lt;/span&gt; yum &lt;span class=&quot;token function&quot;&gt;install&lt;/span&gt; package-name
//安装mysql workbench
eg: $ &lt;span class=&quot;token function&quot;&gt;sudo&lt;/span&gt; yum &lt;span class=&quot;token function&quot;&gt;install&lt;/span&gt; mysql-workbench-community&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h3&gt;7、使用yum升级MySQL&lt;/h3&gt;
&lt;p&gt;&lt;em&gt;作为一般规则，要从一个版本系列升级到另一个版本，请转到下一个系列，而不是跳过一系列。例如，如果您目前正在运行MySQL 5.5并希望升级到5.7，请先升级到MySQL 5.6，然后升级到5.7。&lt;/em&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;使用以下命令升级MySQL：&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;shell&quot;&gt;&lt;pre class=&quot;language-shell&quot;&gt;&lt;code class=&quot;language-shell&quot;&gt;$ &lt;span class=&quot;token function&quot;&gt;sudo&lt;/span&gt; yum update mysql-server&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;ul&gt;
&lt;li&gt;在Yum更新后，MySQL服务器会重新启动。重启之后运行&lt;code class=&quot;language-text&quot;&gt;mysql_upgrade&lt;/code&gt;命令检查数据和软件升级带来的不兼容问题。&lt;/li&gt;
&lt;/ul&gt;
&lt;h3&gt;8、创建用户和授权、修改密码&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;创建用户命令：&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;mysql&quot;&gt;&lt;pre class=&quot;language-mysql&quot;&gt;&lt;code class=&quot;language-mysql&quot;&gt;#foo表示你要建立的用户名，后面的123表示密码,
#localhost限制在固定地址localhost登陆,如果没有限制则用%，此处也可以指个ｉｐ登录,此处密码也可以为空，如果为空则不需要密码就可以登录
CREATE USER &amp;#39;foo&amp;#39;@&amp;#39;localhost&amp;#39; IDENTIFIED BY &amp;#39;123&amp;#39;;
CREATE USER &amp;#39;foo&amp;#39;@&amp;#39;%&amp;#39;; #不需要密码，任何地址可登录
#删除用户
DROP USER foo;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;ul&gt;
&lt;li&gt;授权命令：&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;mysql&quot;&gt;&lt;pre class=&quot;language-mysql&quot;&gt;&lt;code class=&quot;language-mysql&quot;&gt;#说明: privileges - 用户的操作权限,如SELECT , INSERT , UPDATE 等。如果要授予所的权限则使用 ALL;
#databasename - 数据库名,tablename-表名,如果要授予该用户对所有数据库和表的相应操作权限则可用*表示, 如*.*
GRANT privileges ON databasename.tablename TO &amp;#39;username&amp;#39;@&amp;#39;host&amp;#39;
eg:
GRANT INSERT,DELETE,UPDATE,SELECT ON test.user TO &amp;#39;foo&amp;#39;@&amp;#39;localhost&amp;#39;;
flush privileges;
GRANT all ON user.* TO &amp;#39;foo&amp;#39;@&amp;#39;localhost&amp;#39; #把user表的所有权限赋给foo这个用户&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;ul&gt;
&lt;li&gt;设置与更改用户密码：&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;mysql&quot;&gt;&lt;pre class=&quot;language-mysql&quot;&gt;&lt;code class=&quot;language-mysql&quot;&gt;SET PASSWORD FOR &amp;#39;username&amp;#39;@&amp;#39;host&amp;#39; = PASSWORD(&amp;#39;newpassword&amp;#39;)

#如果是当前登陆用户
SET PASSWORD = PASSWORD(&amp;quot;newpassword&amp;quot;);

#例如：
SET PASSWORD FOR &amp;#39;foo&amp;#39;@&amp;#39;%&amp;#39; = PASSWORD(&amp;quot;123456&amp;quot;);

update mysql.user set password=password(&amp;#39;新密码&amp;#39;) where User=&amp;quot;phplamp&amp;quot; and Host=&amp;quot;localhost&amp;quot;;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;</content:encoded></item><item><title><![CDATA[linux-crond]]></title><description><![CDATA[1.写定时任务要执行的脚本 如:test.sh 2.写 表达式 查看表达式书写 命令使用 如: 服务使用命令 帮助]]></description><link>https://lengrongfu.github.io/2018-10-17-linux-crond/</link><guid isPermaLink="false">https://lengrongfu.github.io/2018-10-17-linux-crond/</guid><pubDate>Wed, 17 Oct 2018 23:22:50 GMT</pubDate><content:encoded>&lt;h2&gt;1.写定时任务要执行的脚本&lt;/h2&gt;
&lt;p&gt;如:test.sh&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;shell&quot;&gt;&lt;pre class=&quot;language-shell&quot;&gt;&lt;code class=&quot;language-shell&quot;&gt;   &lt;span class=&quot;token function&quot;&gt;vim&lt;/span&gt; test.sh
   &lt;span class=&quot;token builtin class-name&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;hello world&quot;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2&gt;2.写&lt;code class=&quot;language-text&quot;&gt;crontab&lt;/code&gt; 表达式&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;查看表达式书写&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;shell&quot;&gt;&lt;pre class=&quot;language-shell&quot;&gt;&lt;code class=&quot;language-shell&quot;&gt;&lt;span class=&quot;token function&quot;&gt;cat&lt;/span&gt; /etc/crontab

&lt;span class=&quot;token assign-left variable&quot;&gt;&lt;span class=&quot;token environment constant&quot;&gt;SHELL&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;/bin/bash
&lt;span class=&quot;token assign-left variable&quot;&gt;&lt;span class=&quot;token environment constant&quot;&gt;PATH&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;/sbin:/bin:/usr/sbin:/usr/bin
&lt;span class=&quot;token assign-left variable&quot;&gt;MAILTO&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;root
&lt;span class=&quot;token assign-left variable&quot;&gt;&lt;span class=&quot;token environment constant&quot;&gt;HOME&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;/

&lt;span class=&quot;token comment&quot;&gt;# For details see man 4 crontabs&lt;/span&gt;

&lt;span class=&quot;token comment&quot;&gt;# Example of job definition:&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;# .---------------- minute (0 - 59)&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;# |  .------------- hour (0 - 23)&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;# |  |  .---------- day of month (1 - 31)&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;# |  |  |  .------- month (1 - 12) OR jan,feb,mar,apr ...&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;# |  |  |  |  .---- day of week (0 - 6) (Sunday=0 or 7) OR sun,mon,tue,wed,thu,fri,sat&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;# |  |  |  |  |&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;# *  *  *  *  * user-name command to be executed&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;ul&gt;
&lt;li&gt;命令使用&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;shell&quot;&gt;&lt;pre class=&quot;language-shell&quot;&gt;&lt;code class=&quot;language-shell&quot;&gt;
&lt;span class=&quot;token function&quot;&gt;crontab&lt;/span&gt; -u //设定某个用户的cron服务，一般root用户在执行这个命令的时候需要此参数
&lt;span class=&quot;token function&quot;&gt;crontab&lt;/span&gt; -l //列出某个用户cron服务的详细内容
&lt;span class=&quot;token function&quot;&gt;crontab&lt;/span&gt; -r //删除没个用户的cron服务
&lt;span class=&quot;token function&quot;&gt;crontab&lt;/span&gt; -e //编辑某个用户的cron服务

&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;如:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;shell&quot;&gt;&lt;pre class=&quot;language-shell&quot;&gt;&lt;code class=&quot;language-shell&quot;&gt;&lt;span class=&quot;token function&quot;&gt;crontab&lt;/span&gt; -e 进入编辑页面

&lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt; 03 * * * /bin/bash test.sh

每天凌晨三点执行这个脚本

&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;ul&gt;
&lt;li&gt;服务使用命令&lt;/li&gt;
&lt;li&gt;帮助&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;shell&quot;&gt;&lt;pre class=&quot;language-shell&quot;&gt;&lt;code class=&quot;language-shell&quot;&gt;$ &lt;span class=&quot;token function&quot;&gt;service&lt;/span&gt; crond
用法：/etc/init.d/crond &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;start&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt;stop&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt;status&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt;restart&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt;condrestart&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt;try-restart&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt;reload&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt;force-reload&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;shell&quot;&gt;&lt;pre class=&quot;language-shell&quot;&gt;&lt;code class=&quot;language-shell&quot;&gt;&lt;span class=&quot;token function&quot;&gt;service&lt;/span&gt; crond start //启动服务
&lt;span class=&quot;token function&quot;&gt;service&lt;/span&gt; crond stop //关闭服务
&lt;span class=&quot;token function&quot;&gt;service&lt;/span&gt; crond restart //重启服务
&lt;span class=&quot;token function&quot;&gt;service&lt;/span&gt; crond reload //重新载入配置
&lt;span class=&quot;token function&quot;&gt;service&lt;/span&gt; crond status //查询运行状态
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;</content:encoded></item><item><title><![CDATA[linux 记录操作记录]]></title><description><![CDATA[记录操作记录 方案一 方案二]]></description><link>https://lengrongfu.github.io/2018-10-17-linux-recording-user-log/</link><guid isPermaLink="false">https://lengrongfu.github.io/2018-10-17-linux-recording-user-log/</guid><pubDate>Wed, 17 Oct 2018 23:19:42 GMT</pubDate><content:encoded>&lt;h1&gt;记录操作记录&lt;/h1&gt;
&lt;h2&gt;方案一&lt;/h2&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;shell&quot;&gt;&lt;pre class=&quot;language-shell&quot;&gt;&lt;code class=&quot;language-shell&quot;&gt;&lt;span class=&quot;token function&quot;&gt;vim&lt;/span&gt; /etc/profile
&lt;span class=&quot;token comment&quot;&gt;# 把如下内容加入/etc/profile文件里面&lt;/span&gt;
&lt;span class=&quot;token assign-left variable&quot;&gt;&lt;span class=&quot;token environment constant&quot;&gt;PS1&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;&lt;span class=&quot;token variable&quot;&gt;&lt;span class=&quot;token variable&quot;&gt;`&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;whoami&lt;/span&gt;&lt;span class=&quot;token variable&quot;&gt;`&lt;/span&gt;&lt;/span&gt;@&lt;span class=&quot;token variable&quot;&gt;&lt;span class=&quot;token variable&quot;&gt;`&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;hostname&lt;/span&gt;&lt;span class=&quot;token variable&quot;&gt;`&lt;/span&gt;&lt;/span&gt;:&quot;&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;[\u@\h \W]\$&apos;&lt;/span&gt;
&lt;span class=&quot;token assign-left variable&quot;&gt;&lt;span class=&quot;token environment constant&quot;&gt;PS1&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;[\u@\h \W]\$&quot;&lt;/span&gt; &lt;span class=&quot;token comment&quot;&gt;# 和上面的线上不一样，这种比较常规&lt;/span&gt;
&lt;span class=&quot;token function&quot;&gt;history&lt;/span&gt;
&lt;span class=&quot;token assign-left variable&quot;&gt;USER_IP&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token variable&quot;&gt;&lt;span class=&quot;token variable&quot;&gt;`&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;who&lt;/span&gt; -u am i &lt;span class=&quot;token operator&quot;&gt;&lt;span class=&quot;token file-descriptor important&quot;&gt;2&lt;/span&gt;&gt;&lt;/span&gt;/dev/null&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;awk&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;{print $NF}&apos;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;sed&lt;/span&gt; -e &lt;span class=&quot;token string&quot;&gt;&apos;s/[()]//g&apos;&lt;/span&gt;&lt;span class=&quot;token variable&quot;&gt;`&lt;/span&gt;&lt;/span&gt; 
&lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;&lt;span class=&quot;token variable&quot;&gt;$USER_IP&lt;/span&gt;&quot;&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;&quot;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; 
&lt;span class=&quot;token keyword&quot;&gt;then&lt;/span&gt;
&lt;span class=&quot;token assign-left variable&quot;&gt;USER_IP&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token variable&quot;&gt;&lt;span class=&quot;token variable&quot;&gt;`&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;hostname&lt;/span&gt;&lt;span class=&quot;token variable&quot;&gt;`&lt;/span&gt;&lt;/span&gt; 
&lt;span class=&quot;token keyword&quot;&gt;fi&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;!&lt;/span&gt; -d /tmp/history &lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; 
&lt;span class=&quot;token keyword&quot;&gt;then&lt;/span&gt;
&lt;span class=&quot;token function&quot;&gt;mkdir&lt;/span&gt; /tmp/history
&lt;span class=&quot;token function&quot;&gt;chmod&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;777&lt;/span&gt; /tmp/history
&lt;span class=&quot;token keyword&quot;&gt;fi&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;!&lt;/span&gt; -d /tmp/history/&lt;span class=&quot;token variable&quot;&gt;${&lt;span class=&quot;token environment constant&quot;&gt;LOGNAME&lt;/span&gt;}&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; 
&lt;span class=&quot;token keyword&quot;&gt;then&lt;/span&gt;
&lt;span class=&quot;token function&quot;&gt;mkdir&lt;/span&gt; /tmp/history/&lt;span class=&quot;token variable&quot;&gt;${&lt;span class=&quot;token environment constant&quot;&gt;LOGNAME&lt;/span&gt;}&lt;/span&gt; 
&lt;span class=&quot;token function&quot;&gt;chmod&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;300&lt;/span&gt; /tmp/history/&lt;span class=&quot;token variable&quot;&gt;${&lt;span class=&quot;token environment constant&quot;&gt;LOGNAME&lt;/span&gt;}&lt;/span&gt; 
&lt;span class=&quot;token keyword&quot;&gt;fi&lt;/span&gt;
&lt;span class=&quot;token builtin class-name&quot;&gt;export&lt;/span&gt; &lt;span class=&quot;token assign-left variable&quot;&gt;&lt;span class=&quot;token environment constant&quot;&gt;HISTSIZE&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;4096&lt;/span&gt; 
&lt;span class=&quot;token assign-left variable&quot;&gt;DT&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token variable&quot;&gt;&lt;span class=&quot;token variable&quot;&gt;`&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;date&lt;/span&gt; +&lt;span class=&quot;token string&quot;&gt;&quot;%Y%m%d_%H%M%S&quot;&lt;/span&gt;&lt;span class=&quot;token variable&quot;&gt;`&lt;/span&gt;&lt;/span&gt; 
&lt;span class=&quot;token builtin class-name&quot;&gt;export&lt;/span&gt; &lt;span class=&quot;token assign-left variable&quot;&gt;&lt;span class=&quot;token environment constant&quot;&gt;HISTFILE&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;/tmp/history/&lt;span class=&quot;token variable&quot;&gt;${&lt;span class=&quot;token environment constant&quot;&gt;LOGNAME&lt;/span&gt;}&lt;/span&gt;/&lt;span class=&quot;token variable&quot;&gt;${USER_IP}&lt;/span&gt; history.&lt;span class=&quot;token variable&quot;&gt;$DT&lt;/span&gt;&quot;&lt;/span&gt;
&lt;span class=&quot;token function&quot;&gt;chmod&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;600&lt;/span&gt; /tmp/history/&lt;span class=&quot;token variable&quot;&gt;${&lt;span class=&quot;token environment constant&quot;&gt;LOGNAME&lt;/span&gt;}&lt;/span&gt;/*history* &lt;span class=&quot;token operator&quot;&gt;&lt;span class=&quot;token file-descriptor important&quot;&gt;2&lt;/span&gt;&gt;&lt;/span&gt;/dev/null

&lt;span class=&quot;token comment&quot;&gt;# source一下&lt;/span&gt;
&lt;span class=&quot;token builtin class-name&quot;&gt;source&lt;/span&gt; /etc/profile
&lt;span class=&quot;token comment&quot;&gt;# 日志记录在 /tmp/history 目录下&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2&gt;方案二&lt;/h2&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;shell&quot;&gt;&lt;pre class=&quot;language-shell&quot;&gt;&lt;code class=&quot;language-shell&quot;&gt;&lt;span class=&quot;token function&quot;&gt;vim&lt;/span&gt; /etc/profile
&lt;span class=&quot;token comment&quot;&gt;# 把如下内容加入到/etc/profile中&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;#设置history格式&lt;/span&gt;
&lt;span class=&quot;token builtin class-name&quot;&gt;export&lt;/span&gt; &lt;span class=&quot;token assign-left variable&quot;&gt;HISTTIMEFORMAT&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;[%Y-%m-%d %H:%M:%S] [&lt;span class=&quot;token variable&quot;&gt;&lt;span class=&quot;token variable&quot;&gt;`&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;who&lt;/span&gt; am i &lt;span class=&quot;token operator&quot;&gt;&lt;span class=&quot;token file-descriptor important&quot;&gt;2&lt;/span&gt;&gt;&lt;/span&gt;/dev/null&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;\&lt;/span&gt;
&lt;span class=&quot;token function&quot;&gt;awk&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;{print $NF}&apos;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;sed&lt;/span&gt; -e &lt;span class=&quot;token string&quot;&gt;&apos;s/[()]//g&apos;&lt;/span&gt;&lt;span class=&quot;token variable&quot;&gt;`&lt;/span&gt;&lt;/span&gt;] &quot;&lt;/span&gt;

&lt;span class=&quot;token comment&quot;&gt;#登录时清空当前缓存&lt;/span&gt;
&lt;span class=&quot;token builtin class-name&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;&quot;&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; .bash_history

&lt;span class=&quot;token comment&quot;&gt;#记录shell执行的每一条命令&lt;/span&gt;
&lt;span class=&quot;token builtin class-name&quot;&gt;export&lt;/span&gt; &lt;span class=&quot;token assign-left variable&quot;&gt;PROMPT_COMMAND&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;\
if [ -z &quot;$OLD_PWD&quot; ];then
export OLD_PWD=$PWD;
fi;
if [ ! -z &quot;$LAST_CMD&quot; ] &amp;amp;&amp;amp; [ &quot;$(history 1)&quot; != &quot;$LAST_CMD&quot; ]; then
logger -t `whoami`_shell_cmd &quot;[$OLD_PWD]$(history 1)&quot;;
fi ;
export LAST_CMD=&quot;$(history 1)&quot;;
export OLD_PWD=$PWD;&apos;&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;#source一下&lt;/span&gt;
&lt;span class=&quot;token builtin class-name&quot;&gt;source&lt;/span&gt; /etc/profile
&lt;span class=&quot;token comment&quot;&gt;# 日志记录&lt;/span&gt;
/var/log/messages&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;</content:encoded></item><item><title><![CDATA[linux-Firewall 配置]]></title><description><![CDATA[主要用于一下,用于以上. Firewall FirewallD 是 iptables 的前端控制器，用于实现持久的网络流量规则。它提供命令行和图形界面，在大多数 Linux 发行版的仓库中都有。与直接控制 iptables 相比，使用 FirewallD 有两个主要区别：…]]></description><link>https://lengrongfu.github.io/2018-10-17-linux-Firewall/</link><guid isPermaLink="false">https://lengrongfu.github.io/2018-10-17-linux-Firewall/</guid><pubDate>Wed, 17 Oct 2018 23:14:40 GMT</pubDate><content:encoded>&lt;blockquote&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;iptables&lt;/code&gt; 主要用于&lt;code class=&quot;language-text&quot;&gt;centos 7&lt;/code&gt;一下,&lt;code class=&quot;language-text&quot;&gt;Firewall&lt;/code&gt;用于&lt;code class=&quot;language-text&quot;&gt;centos7&lt;/code&gt;以上.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h1&gt;Firewall&lt;/h1&gt;
&lt;p&gt;FirewallD 是 iptables 的前端控制器，用于实现持久的网络流量规则。它提供命令行和图形界面，在大多数 Linux 发行版的仓库中都有。与直接控制 iptables 相比，使用 FirewallD 有两个主要区别：&lt;/p&gt;
&lt;p&gt;1、FirewallD 使用区域和服务而不是链式规则。&lt;/p&gt;
&lt;p&gt;2、它动态管理规则集，允许更新规则而不破坏现有会话和连接。&lt;/p&gt;
&lt;p&gt;FirewallD 是 iptables 的一个封装，可以让你更容易地管理 iptables 规则 - 它并不是 iptables 的替代品。虽然 iptables 命令仍可用于 FirewallD，但建议使用 FirewallD 时仅使用 FirewallD 命令。&lt;/p&gt;
&lt;p&gt;本指南将向您介绍 FirewallD 的区域和服务的概念，以及一些基本的配置步骤。&lt;/p&gt;
&lt;h2&gt;安装与管理 FirewallD&lt;/h2&gt;
&lt;p&gt;CentOS 7 和 Fedora 20+ 已经包含了 FirewallD，但是默认没有激活。可以像其它的 systemd 单元那样控制它。&lt;/p&gt;
&lt;p&gt;1、 启动服务，并在系统引导时启动该服务：&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;shell&quot;&gt;&lt;pre class=&quot;language-shell&quot;&gt;&lt;code class=&quot;language-shell&quot;&gt;&lt;span class=&quot;token function&quot;&gt;sudo&lt;/span&gt; systemctl start firewalld
&lt;span class=&quot;token function&quot;&gt;sudo&lt;/span&gt; systemctl &lt;span class=&quot;token builtin class-name&quot;&gt;enable&lt;/span&gt; firewalld&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;要停止并禁用：&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;shell&quot;&gt;&lt;pre class=&quot;language-shell&quot;&gt;&lt;code class=&quot;language-shell&quot;&gt;&lt;span class=&quot;token function&quot;&gt;sudo&lt;/span&gt; systemctl stop firewalld
&lt;span class=&quot;token function&quot;&gt;sudo&lt;/span&gt; systemctl disable firewalld&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;2、 检查防火墙状态。输出应该是 running 或者 not running。&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;shell&quot;&gt;&lt;pre class=&quot;language-shell&quot;&gt;&lt;code class=&quot;language-shell&quot;&gt;&lt;span class=&quot;token function&quot;&gt;sudo&lt;/span&gt; firewall-cmd --state&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;3、 要查看 FirewallD 守护进程的状态：&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;shell&quot;&gt;&lt;pre class=&quot;language-shell&quot;&gt;&lt;code class=&quot;language-shell&quot;&gt;&lt;span class=&quot;token function&quot;&gt;sudo&lt;/span&gt; systemctl status firewalld
示例输出

firewalld.service - firewalld - dynamic firewall daemon
   Loaded: loaded &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;/usr/lib/systemd/system/firewalld.service&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; disabled&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
   Active: active &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;running&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; since Wed &lt;span class=&quot;token number&quot;&gt;2015&lt;/span&gt;-09-02 &lt;span class=&quot;token number&quot;&gt;18&lt;/span&gt;:03:22 UTC&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; 1min 12s ago
 Main PID: &lt;span class=&quot;token number&quot;&gt;11954&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;firewalld&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
   CGroup: /system.slice/firewalld.service
   └─11954 /usr/bin/python -Es /usr/sbin/firewalld --nofork --nopid&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;4、 重新加载 FirewallD 配置：&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;shell&quot;&gt;&lt;pre class=&quot;language-shell&quot;&gt;&lt;code class=&quot;language-shell&quot;&gt;&lt;span class=&quot;token function&quot;&gt;sudo&lt;/span&gt; firewall-cmd --reload&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2&gt;配置 FirewallD&lt;/h2&gt;
&lt;p&gt;FirewallD 使用 XML 进行配置。除非是非常特殊的配置，你不必处理它们，而应该使用 firewall-cmd。&lt;/p&gt;
&lt;p&gt;配置文件位于两个目录中：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;/usr/lib/FirewallD&lt;/code&gt; 下保存默认配置，如默认区域和公用服务。 避免修改它们，因为每次 firewall 软件包更新时都会覆盖这些文件。&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;/etc/firewalld&lt;/code&gt; 下保存系统配置文件。 这些文件将覆盖默认配置。&lt;/li&gt;
&lt;/ul&gt;
&lt;h2&gt;配置集&lt;/h2&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;FirewallD&lt;/code&gt; 使用两个配置集：“运行时”和“持久”。 在系统重新启动或重新启动 &lt;code class=&quot;language-text&quot;&gt;FirewallD&lt;/code&gt; 时，不会保留运行时的配置更改，而对持久配置集的更改不会应用于正在运行的系统。&lt;/p&gt;
&lt;p&gt;默认情况下，&lt;code class=&quot;language-text&quot;&gt;firewall-cmd&lt;/code&gt; 命令适用于运行时配置，但使用 &lt;code class=&quot;language-text&quot;&gt;--permanent&lt;/code&gt; 标志将保存到持久配置中。要添加和激活持久性规则，你可以使用两种方法之一。&lt;/p&gt;
&lt;p&gt;1、 将规则同时添加到持久规则集和运行时规则集中。 &lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;shell&quot;&gt;&lt;pre class=&quot;language-shell&quot;&gt;&lt;code class=&quot;language-shell&quot;&gt;&lt;span class=&quot;token function&quot;&gt;sudo&lt;/span&gt; firewall-cmd --zone&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;public --add-service&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;http --permanent
&lt;span class=&quot;token function&quot;&gt;sudo&lt;/span&gt; firewall-cmd --zone&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;public --add-service&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;http&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;2、 将规则添加到持久规则集中并重新加载 FirewallD。 &lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;shell&quot;&gt;&lt;pre class=&quot;language-shell&quot;&gt;&lt;code class=&quot;language-shell&quot;&gt;&lt;span class=&quot;token function&quot;&gt;sudo&lt;/span&gt; firewall-cmd --zone&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;public --add-service&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;http --permanent
&lt;span class=&quot;token function&quot;&gt;sudo&lt;/span&gt; firewall-cmd --reload&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;em&gt;&lt;code class=&quot;language-text&quot;&gt;reload&lt;/code&gt; 命令会删除所有运行时配置并应用永久配置。因为 firewalld 动态管理规则集，所以它不会破坏现有的连接和会话。&lt;/em&gt;&lt;/p&gt;
&lt;h2&gt;防火墙的区域&lt;/h2&gt;
&lt;p&gt;“区域”是针对给定位置或场景（例如家庭、公共、受信任等）可能具有的各种信任级别的预构建规则集。不同的区域允许不同的网络服务和入站流量类型，而拒绝其他任何流量。 首次启用 FirewallD 后，public 将是默认区域。&lt;/p&gt;
&lt;p&gt;区域也可以用于不同的网络接口。例如，要分离内部网络和互联网的接口，你可以在 internal 区域上允许 DHCP，但在external 区域仅允许 HTTP 和 SSH。未明确设置为特定区域的任何接口将添加到默认区域。&lt;/p&gt;
&lt;p&gt;要找到默认区域： &lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;shell&quot;&gt;&lt;pre class=&quot;language-shell&quot;&gt;&lt;code class=&quot;language-shell&quot;&gt;&lt;span class=&quot;token function&quot;&gt;sudo&lt;/span&gt; firewall-cmd --get-default-zone&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;要修改默认区域：&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;shell&quot;&gt;&lt;pre class=&quot;language-shell&quot;&gt;&lt;code class=&quot;language-shell&quot;&gt;&lt;span class=&quot;token function&quot;&gt;sudo&lt;/span&gt; firewall-cmd --set-default-zone&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;internal&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;要查看你网络接口使用的区域：&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;shell&quot;&gt;&lt;pre class=&quot;language-shell&quot;&gt;&lt;code class=&quot;language-shell&quot;&gt;&lt;span class=&quot;token function&quot;&gt;sudo&lt;/span&gt; firewall-cmd --get-active-zones&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;示例输出：&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;shell&quot;&gt;&lt;pre class=&quot;language-shell&quot;&gt;&lt;code class=&quot;language-shell&quot;&gt;public
  interfaces: eth0&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;要得到特定区域的所有配置：&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;shell&quot;&gt;&lt;pre class=&quot;language-shell&quot;&gt;&lt;code class=&quot;language-shell&quot;&gt;&lt;span class=&quot;token function&quot;&gt;sudo&lt;/span&gt; firewall-cmd --zone&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;public --list-all&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;示例输出：&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;shell&quot;&gt;&lt;pre class=&quot;language-shell&quot;&gt;&lt;code class=&quot;language-shell&quot;&gt;public &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;default, active&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
  interfaces: ens160
  sources:
  services: dhcpv6-client http &lt;span class=&quot;token function&quot;&gt;ssh&lt;/span&gt;
  ports: &lt;span class=&quot;token number&quot;&gt;12345&lt;/span&gt;/tcp
  masquerade: no
  forward-ports:
  icmp-blocks:
  rich rules:&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;要得到所有区域的配置： &lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;shell&quot;&gt;&lt;pre class=&quot;language-shell&quot;&gt;&lt;code class=&quot;language-shell&quot;&gt;&lt;span class=&quot;token function&quot;&gt;sudo&lt;/span&gt; firewall-cmd --list-all-zones&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;示例输出：&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;shell&quot;&gt;&lt;pre class=&quot;language-shell&quot;&gt;&lt;code class=&quot;language-shell&quot;&gt;block
  interfaces:
  sources:
  services:
  ports:
  masquerade: no
  forward-ports:
  icmp-blocks:
  rich rules:
  &lt;span class=&quot;token punctuation&quot;&gt;..&lt;/span&gt;.
work
  interfaces:
  sources:
  services: dhcpv6-client ipp-client &lt;span class=&quot;token function&quot;&gt;ssh&lt;/span&gt;
  ports:
  masquerade: no
  forward-ports:
  icmp-blocks:
  rich rules:&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2&gt;与服务一起使用&lt;/h2&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;FirewallD&lt;/code&gt; 可以根据特定网络服务的预定义规则来允许相关流量。你可以创建自己的自定义系统规则，并将它们添加到任何区域。 默认支持的服务的配置文件位于 &lt;code class=&quot;language-text&quot;&gt;/usr/lib /firewalld/services&lt;/code&gt;，用户创建的服务文件在 &lt;code class=&quot;language-text&quot;&gt;/etc/firewalld/services&lt;/code&gt; 中。&lt;/p&gt;
&lt;p&gt;要查看默认的可用服务：&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;shell&quot;&gt;&lt;pre class=&quot;language-shell&quot;&gt;&lt;code class=&quot;language-shell&quot;&gt;&lt;span class=&quot;token function&quot;&gt;sudo&lt;/span&gt; firewall-cmd --get-services&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;比如，要启用或禁用 HTTP 服务： &lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;shell&quot;&gt;&lt;pre class=&quot;language-shell&quot;&gt;&lt;code class=&quot;language-shell&quot;&gt;&lt;span class=&quot;token function&quot;&gt;sudo&lt;/span&gt; firewall-cmd --zone&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;public --add-service&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;http --permanent
&lt;span class=&quot;token function&quot;&gt;sudo&lt;/span&gt; firewall-cmd --zone&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;public --remove-service&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;http --permanent&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;允许或者拒绝任意端口/协议
比如：允许或者禁用 12345 端口的 TCP 流量。&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;shell&quot;&gt;&lt;pre class=&quot;language-shell&quot;&gt;&lt;code class=&quot;language-shell&quot;&gt;&lt;span class=&quot;token function&quot;&gt;sudo&lt;/span&gt; firewall-cmd --zone&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;public --add-port&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;12345&lt;/span&gt;/tcp --permanent
&lt;span class=&quot;token function&quot;&gt;sudo&lt;/span&gt; firewall-cmd --zone&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;public --remove-port&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;12345&lt;/span&gt;/tcp --permanent&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;端口转发
下面是在同一台服务器上将 80 端口的流量转发到 12345 端口。&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;shell&quot;&gt;&lt;pre class=&quot;language-shell&quot;&gt;&lt;code class=&quot;language-shell&quot;&gt;&lt;span class=&quot;token function&quot;&gt;sudo&lt;/span&gt; firewall-cmd --zone&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;public&quot;&lt;/span&gt; --add-forward-port&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;port&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;80&lt;/span&gt;:proto&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;tcp:toport&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;12345&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;要将端口转发到另外一台服务器上：&lt;/p&gt;
&lt;p&gt;1、 在需要的区域中激活 masquerade。&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;shell&quot;&gt;&lt;pre class=&quot;language-shell&quot;&gt;&lt;code class=&quot;language-shell&quot;&gt;&lt;span class=&quot;token function&quot;&gt;sudo&lt;/span&gt; firewall-cmd --zone&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;public --add-masquerade&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;2、 添加转发规则。例子中是将本地的 80 端口的流量转发到 IP 地址为 ：123.456.78.9 的远程服务器上的  8080 端口。&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;shell&quot;&gt;&lt;pre class=&quot;language-shell&quot;&gt;&lt;code class=&quot;language-shell&quot;&gt;&lt;span class=&quot;token function&quot;&gt;sudo&lt;/span&gt; firewall-cmd --zone&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;public&quot;&lt;/span&gt; --add-forward-port&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;port&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;80&lt;/span&gt;:proto&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;tcp:toport&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;8080&lt;/span&gt;:toaddr&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;123.456&lt;/span&gt;.78.9&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;要删除规则，用 —remove 替换 —add。比如：&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;shell&quot;&gt;&lt;pre class=&quot;language-shell&quot;&gt;&lt;code class=&quot;language-shell&quot;&gt;&lt;span class=&quot;token function&quot;&gt;sudo&lt;/span&gt; firewall-cmd --zone&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;public --remove-masquerade&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;用 &lt;code class=&quot;language-text&quot;&gt;FirewallD&lt;/code&gt; 构建规则集
例如，以下是如何使用&lt;code class=&quot;language-text&quot;&gt; FirewallD&lt;/code&gt; 为你的服务器配置基本规则（如果您正在运行 web 服务器）。&lt;/p&gt;
&lt;p&gt;将 &lt;code class=&quot;language-text&quot;&gt;eth0&lt;/code&gt; 的默认区域设置为 &lt;code class=&quot;language-text&quot;&gt;dmz&lt;/code&gt;。 在所提供的默认区域中，&lt;code class=&quot;language-text&quot;&gt;dmz&lt;/code&gt;（非军事区）是最适合于这个程序的，因为它只允许 &lt;code class=&quot;language-text&quot;&gt;SSH&lt;/code&gt; 和 &lt;code class=&quot;language-text&quot;&gt;ICM&lt;/code&gt;P。&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;shell&quot;&gt;&lt;pre class=&quot;language-shell&quot;&gt;&lt;code class=&quot;language-shell&quot;&gt;&lt;span class=&quot;token function&quot;&gt;sudo&lt;/span&gt; firewall-cmd --set-default-zone&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;dmz
&lt;span class=&quot;token function&quot;&gt;sudo&lt;/span&gt; firewall-cmd --zone&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;dmz --add-interface&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;eth0&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;2、 把 &lt;code class=&quot;language-text&quot;&gt;HTTP&lt;/code&gt; 和 &lt;code class=&quot;language-text&quot;&gt;HTTS&lt;/code&gt; 添加永久的服务规则到 &lt;code class=&quot;language-text&quot;&gt;dmz&lt;/code&gt; 区域中：&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;shell&quot;&gt;&lt;pre class=&quot;language-shell&quot;&gt;&lt;code class=&quot;language-shell&quot;&gt;&lt;span class=&quot;token function&quot;&gt;sudo&lt;/span&gt; firewall-cmd --zone&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;dmz --add-service&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;http --permanent
&lt;span class=&quot;token function&quot;&gt;sudo&lt;/span&gt; firewall-cmd --zone&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;dmz --add-service&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;https --permanent&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt; 3、 重新加载 &lt;code class=&quot;language-text&quot;&gt;FirewallD&lt;/code&gt; 让规则立即生效：&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;shell&quot;&gt;&lt;pre class=&quot;language-shell&quot;&gt;&lt;code class=&quot;language-shell&quot;&gt;&lt;span class=&quot;token function&quot;&gt;sudo&lt;/span&gt; firewall-cmd --reload&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt; 如果你运行 &lt;code class=&quot;language-text&quot;&gt;firewall-cmd --zone=dmz --list-all&lt;/code&gt;， 会有下面的输出：&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;shell&quot;&gt;&lt;pre class=&quot;language-shell&quot;&gt;&lt;code class=&quot;language-shell&quot;&gt;dmz &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;default&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
  interfaces: eth0
  sources:
  services: http https &lt;span class=&quot;token function&quot;&gt;ssh&lt;/span&gt;
  ports:
  masquerade: no
  forward-ports:
  icmp-blocks:
  rich rules:&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt; 这告诉我们，&lt;code class=&quot;language-text&quot;&gt;dmz&lt;/code&gt; 区域是我们的默认区域，它被用于 &lt;code class=&quot;language-text&quot;&gt;eth0&lt;/code&gt; 接口中所有网络的源地址和端口。 允许传入 &lt;code class=&quot;language-text&quot;&gt;HTTP&lt;/code&gt;（端口 80）、&lt;code class=&quot;language-text&quot;&gt;HTTPS&lt;/code&gt;（端口 443）和 SSH（端口 22）的流量，并且由于没有 &lt;code class=&quot;language-text&quot;&gt;IP&lt;/code&gt; 版本控制的限制，这些适用于 &lt;code class=&quot;language-text&quot;&gt;IPv4&lt;/code&gt; 和 &lt;code class=&quot;language-text&quot;&gt;IPv6&lt;/code&gt;。 不允许IP 伪装以及端口转发。 我们没有 &lt;code class=&quot;language-text&quot;&gt;ICMP&lt;/code&gt; 块，所以 &lt;code class=&quot;language-text&quot;&gt;ICMP&lt;/code&gt; 流量是完全允许的。没有丰富Rich规则，允许所有出站流量。&lt;/p&gt;
&lt;h2&gt;高级配置&lt;/h2&gt;
&lt;p&gt;服务和端口适用于基本配置，但对于高级情景可能会限制较多。 丰富Rich规则和直接Direct接口允许你为任何端口、协议、地址和操作向任何区域 添加完全自定义的防火墙规则。&lt;/p&gt;
&lt;h2&gt;丰富规则&lt;/h2&gt;
&lt;p&gt;丰富规则的语法有很多，但都完整地记录在 &lt;code class=&quot;language-text&quot;&gt;firewalld.richlanguage(5)&lt;/code&gt; 的手册页中（或在终端中 man firewalld.richlanguage）。 使用 &lt;code class=&quot;language-text&quot;&gt;--add-rich-rule&lt;/code&gt;、&lt;code class=&quot;language-text&quot;&gt;--list-rich-rules&lt;/code&gt; 、 &lt;code class=&quot;language-text&quot;&gt;--remove-rich-rule&lt;/code&gt; 和 &lt;code class=&quot;language-text&quot;&gt;firewall-cmd&lt;/code&gt; 命令来管理它们。&lt;/p&gt;
&lt;p&gt;这里有一些常见的例子：&lt;/p&gt;
&lt;p&gt;允许来自主机 &lt;code class=&quot;language-text&quot;&gt;192.168.0.14&lt;/code&gt; 的所有 IPv4 流量。&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;shell&quot;&gt;&lt;pre class=&quot;language-shell&quot;&gt;&lt;code class=&quot;language-shell&quot;&gt;&lt;span class=&quot;token function&quot;&gt;sudo&lt;/span&gt; firewall-cmd --zone&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;public --add-rich-rule &lt;span class=&quot;token string&quot;&gt;&apos;rule family=&quot;ipv4&quot; source address=192.168.0.14 accept&apos;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;拒绝来自主机 192.168.1.10 到 22 端口的 IPv4 的 TCP 流量。&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;shell&quot;&gt;&lt;pre class=&quot;language-shell&quot;&gt;&lt;code class=&quot;language-shell&quot;&gt;&lt;span class=&quot;token function&quot;&gt;sudo&lt;/span&gt; firewall-cmd --zone&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;public --add-rich-rule &lt;span class=&quot;token string&quot;&gt;&apos;rule family=&quot;ipv4&quot; source address=&quot;192.168.1.10&quot; port port=22 protocol=tcp reject&apos;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;允许来自主机 10.1.0.3 到 80 端口的 IPv4 的 TCP 流量，并将流量转发到 6532 端口上。 &lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;shell&quot;&gt;&lt;pre class=&quot;language-shell&quot;&gt;&lt;code class=&quot;language-shell&quot;&gt;&lt;span class=&quot;token function&quot;&gt;sudo&lt;/span&gt; firewall-cmd --zone&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;public --add-rich-rule &lt;span class=&quot;token string&quot;&gt;&apos;rule family=ipv4 source address=10.1.0.3 forward-port port=80 protocol=tcp to-port=6532&apos;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;将主机 172.31.4.2 上 80 端口的 IPv4 流量转发到 8080 端口（需要在区域上激活 &lt;code class=&quot;language-text&quot;&gt;masquerade&lt;/code&gt;）。&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;shell&quot;&gt;&lt;pre class=&quot;language-shell&quot;&gt;&lt;code class=&quot;language-shell&quot;&gt;&lt;span class=&quot;token function&quot;&gt;sudo&lt;/span&gt; firewall-cmd --zone&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;public --add-rich-rule &lt;span class=&quot;token string&quot;&gt;&apos;rule family=ipv4 forward-port port=80 protocol=tcp to-port=8080 to-addr=172.31.4.2&apos;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;列出你目前的丰富规则：&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;shell&quot;&gt;&lt;pre class=&quot;language-shell&quot;&gt;&lt;code class=&quot;language-shell&quot;&gt;&lt;span class=&quot;token function&quot;&gt;sudo&lt;/span&gt; firewall-cmd --list-rich-rules&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;iptables&lt;/code&gt; 的直接接口
对于最高级的使用，或对于 &lt;code class=&quot;language-text&quot;&gt;iptables&lt;/code&gt; 专家，&lt;code class=&quot;language-text&quot;&gt;FirewallD&lt;/code&gt; 提供了一个直接Direct接口，允许你给它传递原始 &lt;code class=&quot;language-text&quot;&gt;iptables &lt;/code&gt;命令。 直接接口规则不是持久的，除非使用 &lt;code class=&quot;language-text&quot;&gt;--permanent&lt;/code&gt;。&lt;/p&gt;
&lt;p&gt;要查看添加到 &lt;code class=&quot;language-text&quot;&gt;FirewallD&lt;/code&gt; 的所有自定义链或规则：&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;shell&quot;&gt;&lt;pre class=&quot;language-shell&quot;&gt;&lt;code class=&quot;language-shell&quot;&gt;firewall-cmd --direct --get-all-chains
firewall-cmd --direct --get-all-rules&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;讨论 &lt;code class=&quot;language-text&quot;&gt;iptables&lt;/code&gt; 的具体语法已经超出了这篇文章的范围。如果你想学习更多，你可以查看我们的 &lt;code class=&quot;language-text&quot;&gt;iptables&lt;/code&gt; 指南。&lt;/p&gt;
&lt;h2&gt;更多信息&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https://firewalld.org/&quot;&gt;FirewallD 官方网站&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://access.redhat.com/documentation/zh-cn/red_hat_enterprise_linux/7/html/security_guide/&quot;&gt;RHEL 7 安全指南：FirewallD 简介&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h1&gt;iptables&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;root&lt;/code&gt; 用户登录&lt;/li&gt;
&lt;li&gt;编辑防火墙文件&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;shell&quot;&gt;&lt;pre class=&quot;language-shell&quot;&gt;&lt;code class=&quot;language-shell&quot;&gt;  &lt;span class=&quot;token function&quot;&gt;cat&lt;/span&gt; /etc/sysconfig/iptables&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;ul&gt;
&lt;li&gt;设置禁止进入&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;shell&quot;&gt;&lt;pre class=&quot;language-shell&quot;&gt;&lt;code class=&quot;language-shell&quot;&gt; -A INPUT -m state --state NEW -m tcp -p tcp -s &lt;span class=&quot;token number&quot;&gt;10.1&lt;/span&gt;.4.0/24 --dport &lt;span class=&quot;token number&quot;&gt;5601&lt;/span&gt; -j ACCEPT
 解释: -s 可以访问的ip端
       -dport &lt;span class=&quot;token number&quot;&gt;5601&lt;/span&gt; 可以访问此服务器上的某个端口，如果全部就不用设置这个参数 &lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;ul&gt;
&lt;li&gt;命令 &lt;code class=&quot;language-text&quot;&gt;service iptables &lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;shell&quot;&gt;&lt;pre class=&quot;language-shell&quot;&gt;&lt;code class=&quot;language-shell&quot;&gt; Usage: iptables &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;start&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt;stop&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt;reload&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt;restart&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt;condrestart&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt;status&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt;panic&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt;save&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
 查询iptables状态: &lt;span class=&quot;token function&quot;&gt;service&lt;/span&gt; iptables status
 重启iptables状态: &lt;span class=&quot;token function&quot;&gt;service&lt;/span&gt; iptables restart
 启动iptables状态: &lt;span class=&quot;token function&quot;&gt;service&lt;/span&gt; iptables start
 停止iptables状态: &lt;span class=&quot;token function&quot;&gt;service&lt;/span&gt; iptables stop&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;ul&gt;
&lt;li&gt;FORWAD&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;iptables -t nat -A PREROUTING -d 61.129.93.38 -p tcp -j DNAT --to-destination localhost:8080&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;iptables -t nat -A PREROUTING -d 61.129.93.38 -p tcp —dport 80 -j DNAT —to-destination 10.1.4.172:8080&lt;/p&gt;</content:encoded></item><item><title><![CDATA[linux-Keepalived 使用]]></title><description><![CDATA[Keepalived 构建一个高可用的集群 参考文档： 文档地址 github…]]></description><link>https://lengrongfu.github.io/2018-10-17-linux-Keepalived/</link><guid isPermaLink="false">https://lengrongfu.github.io/2018-10-17-linux-Keepalived/</guid><pubDate>Wed, 17 Oct 2018 23:12:55 GMT</pubDate><content:encoded>&lt;h1&gt;Keepalived 构建一个高可用的集群&lt;/h1&gt;
&lt;p&gt;参考文档：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;a href=&quot;http://www.keepalived.org/doc/case_study_healthcheck.html&quot;&gt;文档地址&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;a href=&quot;https://github.com/acassen/keepalived&quot;&gt;github 地址&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;​&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h3&gt;一、安装&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;centos&lt;/code&gt;上安装：&lt;code class=&quot;language-text&quot;&gt;yum install keepalived&lt;/code&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;源码安装：&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;shell&quot;&gt;&lt;pre class=&quot;language-shell&quot;&gt;&lt;code class=&quot;language-shell&quot;&gt;&lt;span class=&quot;token function&quot;&gt;wget&lt;/span&gt; http://www.keepalived.org/software/keepalived-1.2.24.tar.gz
&lt;span class=&quot;token function&quot;&gt;tar&lt;/span&gt; -zxvf keepalived-1.2.24.tar.gz
&lt;span class=&quot;token builtin class-name&quot;&gt;cd&lt;/span&gt; keepalived-1.2.24
./configure --prefix&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;/usr/local/keepalived
&lt;span class=&quot;token function&quot;&gt;make&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;make&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;install&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;keepalived&lt;/code&gt;启动时会从&lt;code class=&quot;language-text&quot;&gt;/etc/keepalived&lt;/code&gt;目录下查找&lt;code class=&quot;language-text&quot;&gt;keepalived.conf&lt;/code&gt;配置文件，如果没有找到则使用默认的配置文件，使用源码安装时是没有&lt;code class=&quot;language-text&quot;&gt;/etc/keepalived&lt;/code&gt;这个文件夹的。&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;需要将配置文件拷贝到系统对应的目录下&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;shell&quot;&gt;&lt;pre class=&quot;language-shell&quot;&gt;&lt;code class=&quot;language-shell&quot;&gt;shell&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;mkdir&lt;/span&gt; /etc/keepalived
shell&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;cp&lt;/span&gt; /usr/local/keepalived/etc/keepalived.conf /etc/keepalived/keepalived.conf
shell&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;cp&lt;/span&gt; /usr/local/keepalived/etc/rc.d/init.d/keepalived /etc/rc.d/init.d/keepalived
shell&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;cp&lt;/span&gt; /usr/local/keepalived/etc/sysconfig/keepalived /etc/sysconfig/keepalived&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;使用命令介绍&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;shell&quot;&gt;&lt;pre class=&quot;language-shell&quot;&gt;&lt;code class=&quot;language-shell&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;root@dev_file keepalived&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token comment&quot;&gt;# service keepalived&lt;/span&gt;
用法：/etc/init.d/keepalived &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;start&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt;stop&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt;status&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt;restart&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt;condrestart&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt;try-restart&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt;reload&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt;force-reload&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
start:启用
stop:停止
status:状态
restart:重启&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;另外需要注意的一点是，&lt;code class=&quot;language-text&quot;&gt;keepalived&lt;/code&gt;启动时不会检查配置文件的语法是否正确，所以我们在编写配置文件时要特别小心，别写错了，否则会出现一些意想不到的现象&lt;/strong&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;service keepalived start&lt;/code&gt; 执行后服务会加载&lt;code class=&quot;language-text&quot;&gt;/etc/keepalived/keepalived.conf&lt;/code&gt;下的配置文件，可使用&lt;code class=&quot;language-text&quot;&gt;-f&lt;/code&gt; 参数指定配置文件的位置。&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h3&gt;二、使用&lt;code class=&quot;language-text&quot;&gt;Keepalived&lt;/code&gt;实现一个故障转移的高可用服务&lt;/h3&gt;
&lt;h4&gt;１、需求&lt;/h4&gt;
&lt;ul&gt;
&lt;li&gt;一个&lt;code class=&quot;language-text&quot;&gt;golang&lt;/code&gt;的服务部署多个节点，之前只有一个节点，现在为了高可用需要部署两个节点&lt;/li&gt;
&lt;li&gt;不打算使用&lt;code class=&quot;language-text&quot;&gt;nginx&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h4&gt;２、准备工作&lt;/h4&gt;
&lt;ul&gt;
&lt;li&gt;三个节点最少两台服务器&lt;/li&gt;
&lt;li&gt;三台安装了&lt;code class=&quot;language-text&quot;&gt;keepalived&lt;/code&gt;的机器&lt;/li&gt;
&lt;/ul&gt;
&lt;h4&gt;３、使用,&lt;code class=&quot;language-text&quot;&gt;Keepalived&lt;/code&gt;的所有功能都是由配置文件配置的&lt;/h4&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;keepalived&lt;/code&gt;启动之后的日志路径：&lt;code class=&quot;language-text&quot;&gt;/var/log/messages&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;vip&lt;/code&gt; 虚ip地址在三台服务器中只会有一台有，&lt;code class=&quot;language-text&quot;&gt;ip a&lt;/code&gt; 查看是否有虚&lt;code class=&quot;language-text&quot;&gt;ips&lt;/code&gt;是否生成&lt;/li&gt;
&lt;li&gt;如下为&lt;code class=&quot;language-text&quot;&gt;MASTER&lt;/code&gt; 配置&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;shell&quot;&gt;&lt;pre class=&quot;language-shell&quot;&gt;&lt;code class=&quot;language-shell&quot;&gt;vrrp_instance VI_1 &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;token comment&quot;&gt;#vrrp实例名&lt;/span&gt;
	state MASTER &lt;span class=&quot;token comment&quot;&gt;# 实例状态,只有MASTER和BACKUP两种状态，并且需要全部大写，抢占模式下，其中MASTER为工作状态，BACKUP为备用状态，当MASTER服务失效时，BACKUP所在的服务会自动把它的状态由BACKUP切换到MASTER状态,当失效的MASTER所在的服务恢复时，BACKUP从MASTER恢复到BACKUP状态&lt;/span&gt;
	interface eth0 &lt;span class=&quot;token comment&quot;&gt;# 对外提供服务的网卡,即vip绑定的网卡接口,如:eth0,eth1&lt;/span&gt;
    virtual_router_id 01 &lt;span class=&quot;token comment&quot;&gt;#虚拟路由的ID号，每个节点设置必须一样，可选择IP最后一段使用，相同的 VRID 为一个组,一个keepalived集群这个值必须一样&lt;/span&gt;
	priority &lt;span class=&quot;token number&quot;&gt;100&lt;/span&gt; &lt;span class=&quot;token comment&quot;&gt;#节点优先级，取值范围0～254，MASTER要比BACKUP高,值越大，优先级越高&lt;/span&gt;
	advert_int &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt; &lt;span class=&quot;token comment&quot;&gt;# MASTER与BACKUP节点间同步检查的时间间隔，单位为秒&lt;/span&gt;
	nopreempt &lt;span class=&quot;token comment&quot;&gt;# 禁止抢占服务。默认情况，当MASTER服务挂掉之后，BACKUP自动升级为MASTER并接替它的任务，当MASTER服务恢复后，升级为MASTER的BACKUP服务又自动降为BACKUP，把工作权交给原MASTER。当配置了nopreempt，MASTER从挂掉到恢复，不再将服务抢占过来。&lt;/span&gt;
	authentication &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;      &lt;span class=&quot;token comment&quot;&gt;#传递信息的认证方式，密码仅支持8位&lt;/span&gt;
    		auth_type PASS &lt;span class=&quot;token comment&quot;&gt;# 类型主要有 PASS、AH 两种&lt;/span&gt;
    		auth_pass &lt;span class=&quot;token number&quot;&gt;1111&lt;/span&gt; &lt;span class=&quot;token comment&quot;&gt;# 同一vrrp 实例MASTER与BACKUP使用相同的密码才能正常通信&lt;/span&gt;
	&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
	virtual_ipaddress &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;token comment&quot;&gt;#虚拟IP地址池，可以有多个IP，每个IP占一行，不需要指定子网掩码。注意：这个IP必须与我们的设定的vip保持一致。&lt;/span&gt;
		&lt;span class=&quot;token number&quot;&gt;255.255&lt;/span&gt;.10.99
		&lt;span class=&quot;token comment&quot;&gt;### 可以配置多个&lt;/span&gt;
	&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
virtual_server &lt;span class=&quot;token number&quot;&gt;255.255&lt;/span&gt;.10.99 &lt;span class=&quot;token number&quot;&gt;80&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;　&lt;span class=&quot;token comment&quot;&gt;#虚拟服务器virtual_server定义块&lt;/span&gt;
	delay_loop &lt;span class=&quot;token number&quot;&gt;10&lt;/span&gt; &lt;span class=&quot;token comment&quot;&gt;#健康检查时间间隔，单位：秒 &lt;/span&gt;
	lb_algo wrr &lt;span class=&quot;token comment&quot;&gt;# 负载均衡调度算法，互联网应用常用方式为wlc或rr&lt;/span&gt;
	lb_kind NAT &lt;span class=&quot;token comment&quot;&gt;# 负载均衡转发规则。包括DR、NAT、TUN3种，一般使用路由（DR）转发规则，DR和NAT效率最高，但是有使用场景限制&lt;/span&gt;
	persistence_timeout &lt;span class=&quot;token number&quot;&gt;50&lt;/span&gt; &lt;span class=&quot;token comment&quot;&gt;# http服务会话保持时间，单位：秒 &lt;/span&gt;
    protocol TCP &lt;span class=&quot;token comment&quot;&gt;# 转发协议，分为TCP和UDP两种&lt;/span&gt;
   	&lt;span class=&quot;token comment&quot;&gt;# 下面的配置用户检测服务故障，然后剔除到vrrp集群中&lt;/span&gt;
	real_server &lt;span class=&quot;token number&quot;&gt;255.255&lt;/span&gt;.10.203 &lt;span class=&quot;token number&quot;&gt;8081&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;token comment&quot;&gt;#真实服务器IP和端口，可以定义多个&lt;/span&gt;
		weight &lt;span class=&quot;token number&quot;&gt;2&lt;/span&gt;　&lt;span class=&quot;token comment&quot;&gt;# 负载权重，值越大，转发的优先级越高 &lt;/span&gt;
		HTTP_GET &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;token comment&quot;&gt;# 使用HTTP_GET来检查服务的状态，也可以使用 TCP_CHECK&lt;/span&gt;
			url &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
				path /beat
				digest 7bd3d5f5b3cdb13aed632121206e729c &lt;span class=&quot;token comment&quot;&gt;# 这个值是一个md5的求和，安装keepalived之后有一个工具用来求和，&lt;/span&gt;
				&lt;span class=&quot;token comment&quot;&gt;# genhash -s 255.255.10.203 -p 8081 -u /beat 执行这个命令就可以算出digest值&lt;/span&gt;
			&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
			connect_timeout &lt;span class=&quot;token number&quot;&gt;3&lt;/span&gt; &lt;span class=&quot;token comment&quot;&gt;#服务连接超时时长，单位：秒 &lt;/span&gt;
            retry &lt;span class=&quot;token number&quot;&gt;3&lt;/span&gt; &lt;span class=&quot;token comment&quot;&gt;# 重试次数&lt;/span&gt;
            delay_before_retry &lt;span class=&quot;token number&quot;&gt;2&lt;/span&gt; &lt;span class=&quot;token comment&quot;&gt;#重试连接间隔&lt;/span&gt;
		&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
	&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
	
	real_server &lt;span class=&quot;token number&quot;&gt;255.255&lt;/span&gt;.10.204 &lt;span class=&quot;token number&quot;&gt;8081&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;token comment&quot;&gt;#另一个节点&lt;/span&gt;
                weight &lt;span class=&quot;token number&quot;&gt;2&lt;/span&gt;
                HTTP_GET &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
                        url &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
                                path /beat
                                digest 7bd3d5f5b3cdb13aed632121206e729c
                        &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
                        connect_timeout &lt;span class=&quot;token number&quot;&gt;3&lt;/span&gt;
                        retry &lt;span class=&quot;token number&quot;&gt;3&lt;/span&gt;
                        delay_before_retry &lt;span class=&quot;token number&quot;&gt;2&lt;/span&gt;
                &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;如下为&lt;code class=&quot;language-text&quot;&gt;BACKUP&lt;/code&gt;的配置&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;shell&quot;&gt;&lt;pre class=&quot;language-shell&quot;&gt;&lt;code class=&quot;language-shell&quot;&gt;vrrp_instance VI_1 &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        state  BACKUP &lt;span class=&quot;token comment&quot;&gt;# BACKUP&lt;/span&gt;
		interface eth0
        virtual_router_id 01
        priority &lt;span class=&quot;token number&quot;&gt;99&lt;/span&gt;　&lt;span class=&quot;token comment&quot;&gt;# 比master下&lt;/span&gt;
        advert_int &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;
		nopreempt
        authentication &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;      //传递信息的认证方式，密码仅支持8位
                auth_type PASS
                auth_pass &lt;span class=&quot;token number&quot;&gt;1111&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
        virtual_ipaddress &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
                &lt;span class=&quot;token number&quot;&gt;255.255&lt;/span&gt;.10.99
        &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
virtual_server &lt;span class=&quot;token number&quot;&gt;255.255&lt;/span&gt;.10.99 &lt;span class=&quot;token number&quot;&gt;8000&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        delay_loop &lt;span class=&quot;token number&quot;&gt;6&lt;/span&gt;
        lb_algo wrr
        lb_kind NAT
        persistence_timeout &lt;span class=&quot;token number&quot;&gt;50&lt;/span&gt;
        protocol TCP

        real_server &lt;span class=&quot;token number&quot;&gt;255.255&lt;/span&gt;.10.204 &lt;span class=&quot;token number&quot;&gt;8081&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
                weight &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;
				HTTP_GET &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
					url &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
						path /beat
						digest 7bd3d5f5b3cdb13aed632121206e729c
					&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
					connect_timeout &lt;span class=&quot;token number&quot;&gt;3&lt;/span&gt;
            		retry &lt;span class=&quot;token number&quot;&gt;3&lt;/span&gt;
            		delay_before_retry &lt;span class=&quot;token number&quot;&gt;2&lt;/span&gt;
			&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
		real_server &lt;span class=&quot;token number&quot;&gt;255.255&lt;/span&gt;.10.203 &lt;span class=&quot;token number&quot;&gt;8081&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
                weight &lt;span class=&quot;token number&quot;&gt;2&lt;/span&gt;
                HTTP_GET &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
                        url &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
                                path /beat
                                digest 7bd3d5f5b3cdb13aed632121206e729c
                        &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
                        connect_timeout &lt;span class=&quot;token number&quot;&gt;3&lt;/span&gt;
                        retry &lt;span class=&quot;token number&quot;&gt;3&lt;/span&gt;
                        delay_before_retry &lt;span class=&quot;token number&quot;&gt;2&lt;/span&gt;
                &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;​&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;日志查看，停止&lt;code class=&quot;language-text&quot;&gt;255.255.10.204 8081&lt;/code&gt; 上的服务，就会打印如下的日志&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;shell&quot;&gt;&lt;pre class=&quot;language-shell&quot;&gt;&lt;code class=&quot;language-shell&quot;&gt;Mar &lt;span class=&quot;token number&quot;&gt;30&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;18&lt;/span&gt;:36:01 dev_file Keepalived_healthcheckers&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;23744&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;: Error connecting server &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;255.255&lt;/span&gt;.10.204&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;:8081.
Mar &lt;span class=&quot;token number&quot;&gt;30&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;18&lt;/span&gt;:36:01 dev_file Keepalived_healthcheckers&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;23744&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;: Removing &lt;span class=&quot;token function&quot;&gt;service&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;255.255&lt;/span&gt;.10.204&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;:8081 from VS &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;255.255&lt;/span&gt;.10.99&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;:80&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;日志查看，启动&lt;code class=&quot;language-text&quot;&gt;255.255.10.204 8081&lt;/code&gt;服务，打印如下日志&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;shell&quot;&gt;&lt;pre class=&quot;language-shell&quot;&gt;&lt;code class=&quot;language-shell&quot;&gt;Mar &lt;span class=&quot;token number&quot;&gt;30&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;18&lt;/span&gt;:36:49 dev_file Keepalived_healthcheckers&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;23744&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;: MD5 digest success to &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;255.255&lt;/span&gt;.10.204&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;:8081 url&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;.
Mar &lt;span class=&quot;token number&quot;&gt;30&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;18&lt;/span&gt;:36:59 dev_file Keepalived_healthcheckers&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;23744&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;: Remote Web server &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;255.255&lt;/span&gt;.10.204&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;:8081 succeed on service.
Mar &lt;span class=&quot;token number&quot;&gt;30&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;18&lt;/span&gt;:36:59 dev_file Keepalived_healthcheckers&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;23744&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;: Adding &lt;span class=&quot;token function&quot;&gt;service&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;255.255&lt;/span&gt;.10.204&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;:8081 to VS &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;255.255&lt;/span&gt;.10.99&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;:80&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h2&gt;参考文档&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;http://www.linuxvirtualserver.org/zh/lvs1.html&quot;&gt;Linux服务器集群系统&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;http://www.linuxvirtualserver.org/docs/ha/keepalived.html&quot;&gt;keepalived+lvs&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;http://www.linuxvirtualserver.org/zh/&quot;&gt;官方中文文档&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;</content:encoded></item><item><title><![CDATA[自定义 spring-boot-stater]]></title><description><![CDATA[spring boot stater 通过使用将一些层、组件拆分为模块来管理，以便相互依赖复用。 自定义 1、创建一个项目 首先自定义一个项目，中引入依赖。 这里说下的命名问题， 官方 通常命名为如 ， 官方建议非官方命名应遵循的格式.…]]></description><link>https://lengrongfu.github.io/2018-10-17-new-spring-boot-stater/</link><guid isPermaLink="false">https://lengrongfu.github.io/2018-10-17-new-spring-boot-stater/</guid><pubDate>Wed, 17 Oct 2018 23:09:55 GMT</pubDate><content:encoded>&lt;h1&gt;spring boot stater&lt;/h1&gt;
&lt;p&gt;通过使用&lt;code class=&quot;language-text&quot;&gt;Spring Boot Starter&lt;/code&gt;将一些层、组件拆分为模块来管理，以便相互依赖复用。&lt;/p&gt;
&lt;h2&gt;自定义&lt;/h2&gt;
&lt;h3&gt;1、创建一个&lt;code class=&quot;language-text&quot;&gt;Maven&lt;/code&gt;项目&lt;/h3&gt;
&lt;p&gt;首先自定义一个&lt;code class=&quot;language-text&quot;&gt;Maven&lt;/code&gt;项目，&lt;code class=&quot;language-text&quot;&gt;pom.xml&lt;/code&gt;中引入依赖。&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;xml&quot;&gt;&lt;pre class=&quot;language-xml&quot;&gt;&lt;code class=&quot;language-xml&quot;&gt;            &lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;dependency&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;
                &lt;span class=&quot;token comment&quot;&gt;&amp;lt;!-- Import dependency management from Spring Boot --&gt;&lt;/span&gt;
                &lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;groupId&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;org.springframework.boot&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;/&lt;/span&gt;groupId&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;
                &lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;artifactId&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;spring-boot-dependencies&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;/&lt;/span&gt;artifactId&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;
                &lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;version&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;1.5.2.RELEASE&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;/&lt;/span&gt;version&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;
                &lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;type&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;pom&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;/&lt;/span&gt;type&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;
                &lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;scope&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;import&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;/&lt;/span&gt;scope&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;
            &lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;/&lt;/span&gt;dependency&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;这里说下&lt;code class=&quot;language-text&quot;&gt;artifactId&lt;/code&gt;的命名问题，&lt;code class=&quot;language-text&quot;&gt;Spring&lt;/code&gt; 官方 &lt;code class=&quot;language-text&quot;&gt;Starter&lt;/code&gt;通常命名为&lt;code class=&quot;language-text&quot;&gt;spring-boot-starter-{name}&lt;/code&gt;如 &lt;code class=&quot;language-text&quot;&gt;spring-boot-starter-web&lt;/code&gt;， &lt;code class=&quot;language-text&quot;&gt;Spring&lt;/code&gt;&lt;a href=&quot;https://link.juejin.im/?target=http%3A%2F%2Fdocs.spring.io%2Fspring-boot%2Fdocs%2F1.5.2.RELEASE%2Freference%2Fhtmlsingle%2F%23boot-features-custom-starter-naming&quot;&gt;官方建议&lt;/a&gt;非官方&lt;code class=&quot;language-text&quot;&gt;Starter&lt;/code&gt;命名应遵循&lt;code class=&quot;language-text&quot;&gt;{name}-spring-boot-starter&lt;/code&gt;的格式.&lt;/p&gt;
&lt;h3&gt;2、创建一个简单的&lt;code class=&quot;language-text&quot;&gt;Starter&lt;/code&gt;&lt;/h3&gt;
&lt;p&gt;提供一个简单的&lt;code class=&quot;language-text&quot;&gt;Stater&lt;/code&gt;,提供一个&lt;code class=&quot;language-text&quot;&gt;Service&lt;/code&gt;,包含一个能够将字符串加上前后缀的方法String wrap(String word)。&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;java&quot;&gt;&lt;pre class=&quot;language-java&quot;&gt;&lt;code class=&quot;language-java&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;DemoService&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;

	&lt;span class=&quot;token keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;String&lt;/span&gt; prefix&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
	&lt;span class=&quot;token keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;String&lt;/span&gt; suffix&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

	&lt;span class=&quot;token keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;DemoService&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;String&lt;/span&gt; prefix&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;String&lt;/span&gt; suffix&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
		&lt;span class=&quot;token keyword&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;prefix &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; prefix&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
		&lt;span class=&quot;token keyword&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;suffix &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; suffix&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
	&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
	&lt;span class=&quot;token keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;String&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;wrap&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;String&lt;/span&gt; word&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
		&lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; prefix &lt;span class=&quot;token operator&quot;&gt;+&lt;/span&gt; word &lt;span class=&quot;token operator&quot;&gt;+&lt;/span&gt; suffix&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
	&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;前缀、后缀通过读取application.properties(yml)内的参数获得。&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;java&quot;&gt;&lt;pre class=&quot;language-java&quot;&gt;&lt;code class=&quot;language-java&quot;&gt;&lt;span class=&quot;token annotation punctuation&quot;&gt;@ConfigurationProperties&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;demo.service&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;DemoServiceProperties&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
	&lt;span class=&quot;token keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;String&lt;/span&gt; prefix&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
	&lt;span class=&quot;token keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;String&lt;/span&gt; suffix&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
	#省略 set 和 get
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;编写&lt;code class=&quot;language-text&quot;&gt;AutoConfigure&lt;/code&gt;类。&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;java&quot;&gt;&lt;pre class=&quot;language-java&quot;&gt;&lt;code class=&quot;language-java&quot;&gt;&lt;span class=&quot;token annotation punctuation&quot;&gt;@Configuration&lt;/span&gt;
&lt;span class=&quot;token annotation punctuation&quot;&gt;@ConditionalOnClass&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;DemoService&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;class&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token annotation punctuation&quot;&gt;@EnableConfigurationProperties&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;DemoServiceProperties&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;class&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;DemoAutoConfigure&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;

	&lt;span class=&quot;token annotation punctuation&quot;&gt;@Autowired&lt;/span&gt;
	&lt;span class=&quot;token keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;DemoServiceProperties&lt;/span&gt; demoServiceProperties&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;


	&lt;span class=&quot;token annotation punctuation&quot;&gt;@Bean&lt;/span&gt;
	&lt;span class=&quot;token annotation punctuation&quot;&gt;@ConditionalOnMissingBean&lt;/span&gt;
	&lt;span class=&quot;token annotation punctuation&quot;&gt;@ConditionalOnProperty&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;prefix &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;demo.service&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;value &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;enabled&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;havingValue &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;true&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
	&lt;span class=&quot;token class-name&quot;&gt;DemoService&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;demoService&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
		&lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;DemoService&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;demoServiceProperties&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;getPrefix&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;demoServiceProperties&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;getSuffix&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
	&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;解释下用到的几个和Starter相关的注解：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;@ConditionalOnClass&lt;/code&gt;，当&lt;code class=&quot;language-text&quot;&gt;classpath&lt;/code&gt;下发现该类的情况下进行自动配置。&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;@ConditionalOnMissingBean&lt;/code&gt;，当&lt;code class=&quot;language-text&quot;&gt;Spring Context&lt;/code&gt;中不存在该&lt;code class=&quot;language-text&quot;&gt;Bean&lt;/code&gt;时。&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;@ConditionalOnProperty(prefix = &quot;example.service&quot;,value = &quot;enabled&quot;,havingValue = &quot;true&quot;)&lt;/code&gt;，当配置文件中&lt;code class=&quot;language-text&quot;&gt;example.service.enabled=true&lt;/code&gt;时&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;更多相关注解，建议阅读&lt;a href=&quot;https://link.juejin.im/?target=http%3A%2F%2Fdocs.spring.io%2Fspring-boot%2Fdocs%2F1.5.2.RELEASE%2Freference%2Fhtmlsingle%2F%23boot-features-bean-conditions&quot;&gt;官方文档部分&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;最后一步，在resources/META-INF/下创建spring.factories文件，内容供参考下面:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;org.springframework.boot.autoconfigure.EnableAutoConfiguration=com.example.demospringbootstarter.DemoAutoConfigure
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;执行&lt;code class=&quot;language-text&quot;&gt;mvn install&lt;/code&gt; 打包安装。&lt;/p&gt;
&lt;h2&gt;使用&lt;/h2&gt;
&lt;h3&gt;1、新建一个新的&lt;code class=&quot;language-text&quot;&gt;Spring Boot&lt;/code&gt;项目&lt;/h3&gt;
&lt;p&gt;把&lt;code class=&quot;language-text&quot;&gt;stater&lt;/code&gt;的依赖加入项目中。&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;xml&quot;&gt;&lt;pre class=&quot;language-xml&quot;&gt;&lt;code class=&quot;language-xml&quot;&gt;        &lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;dependency&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;
            &lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;groupId&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;com.example&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;/&lt;/span&gt;groupId&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;
            &lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;artifactId&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;demo-spring-boot-starter&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;/&lt;/span&gt;artifactId&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;
            &lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;version&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;0.0.1-SNAPSHOT&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;/&lt;/span&gt;version&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;
        &lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;/&lt;/span&gt;dependency&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;创建&lt;code class=&quot;language-text&quot;&gt;application.properties&lt;/code&gt;，进行配置&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;properties&quot;&gt;&lt;pre class=&quot;language-properties&quot;&gt;&lt;code class=&quot;language-properties&quot;&gt;&lt;span class=&quot;token attr-name&quot;&gt;demo.service.enabled&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token attr-value&quot;&gt;true&lt;/span&gt;
&lt;span class=&quot;token attr-name&quot;&gt;demo.service.prefix&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token attr-value&quot;&gt;####&lt;/span&gt;
&lt;span class=&quot;token attr-name&quot;&gt;demo.service.suffix&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token attr-value&quot;&gt;@@@@&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;使用&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;java&quot;&gt;&lt;pre class=&quot;language-java&quot;&gt;&lt;code class=&quot;language-java&quot;&gt;    &lt;span class=&quot;token annotation punctuation&quot;&gt;@Autowired&lt;/span&gt;
	&lt;span class=&quot;token keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;DemoService&lt;/span&gt; demoService&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

	&lt;span class=&quot;token annotation punctuation&quot;&gt;@GetMapping&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;/input/{word}&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
	&lt;span class=&quot;token keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;String&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;input&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token annotation punctuation&quot;&gt;@PathVariable&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;word&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;String&lt;/span&gt; word&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
		&lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; demoService&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;wrap&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;word&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
	&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2&gt;原理&lt;/h2&gt;
&lt;p&gt;总结下&lt;code class=&quot;language-text&quot;&gt;Starter&lt;/code&gt;的工作原理.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;Spring Boot&lt;/code&gt;在启动时扫描项目所依赖的&lt;code class=&quot;language-text&quot;&gt;JAR&lt;/code&gt;包，寻找包含&lt;code class=&quot;language-text&quot;&gt;spring.factories&lt;/code&gt;文件的&lt;code class=&quot;language-text&quot;&gt;JAR&lt;/code&gt;包&lt;/li&gt;
&lt;li&gt;根据&lt;code class=&quot;language-text&quot;&gt;spring.factories&lt;/code&gt;配置加载&lt;code class=&quot;language-text&quot;&gt;AutoConfigure&lt;/code&gt;类&lt;/li&gt;
&lt;li&gt;根据 &lt;code class=&quot;language-text&quot;&gt;@Conditional&lt;/code&gt;注解的条件，进行自动配置并将&lt;code class=&quot;language-text&quot;&gt;Bean&lt;/code&gt;注入&lt;code class=&quot;language-text&quot;&gt;Spring Context&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h2&gt;参考文档&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https://juejin.im/entry/58d37630570c350058c2c15c&quot;&gt;https://juejin.im/entry/58d37630570c350058c2c15c&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;&quot;&gt;官网文档&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;</content:encoded></item><item><title><![CDATA[elk 搭建]]></title><description><![CDATA[ELK 一、ElasticSearch 1、安装 下载： 解压： 修改配置文件： 启动： 2、常见报错 1、修改配置文件错误 错误信息： 错误原因：配置文件中的”:“后面要有一个空格 解决办法：修改配置文件 2、max_map_count…]]></description><link>https://lengrongfu.github.io/2018-10-17-elk-install/</link><guid isPermaLink="false">https://lengrongfu.github.io/2018-10-17-elk-install/</guid><pubDate>Wed, 17 Oct 2018 22:59:24 GMT</pubDate><content:encoded>&lt;h1&gt;ELK&lt;/h1&gt;
&lt;h2&gt;一、ElasticSearch&lt;/h2&gt;
&lt;h3&gt;1、安装&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;下载：&lt;code class=&quot;language-text&quot;&gt;wget -c https://artifacts.elastic.co/downloads/elasticsearch/elasticsearch-5.2.2.tar.gz&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;解压：&lt;code class=&quot;language-text&quot;&gt;tar -xzvf elasticsearch-5.2.2.tar.gz&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;修改配置文件：&lt;code class=&quot;language-text&quot;&gt;vi elasticsearch.yml&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;cluster.name: my-application
node.name: node-1
path.data: /data/home/elas/data
path/logs: /data/home/elas/logs
network.host: 255.255.255.255(机器ip)
http.port: 9200&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;ul&gt;
&lt;li&gt;启动：&lt;code class=&quot;language-text&quot;&gt;./bin/elasticsearch&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h3&gt;2、常见报错&lt;/h3&gt;
&lt;h5&gt;1、修改配置文件错误&lt;/h5&gt;
&lt;ul&gt;
&lt;li&gt;错误信息：&lt;code class=&quot;language-text&quot;&gt;Failed to load settings from ....,nested: MarkedYAMLException[while scanning a simple key&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;错误原因：配置文件中的”:“后面要有一个空格&lt;/li&gt;
&lt;li&gt;解决办法：修改配置文件&lt;/li&gt;
&lt;/ul&gt;
&lt;h5&gt;2、max_map_count错误&lt;/h5&gt;
&lt;ul&gt;
&lt;li&gt;错误信息：&lt;code class=&quot;language-text&quot;&gt;max virtual memory areas vm.max_map_count [65530] likely too low, increase to at least [262144]&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;错误原因：&lt;code class=&quot;language-text&quot;&gt;/etc/sysctl.conf&lt;/code&gt; 文件中的值过小&lt;/li&gt;
&lt;li&gt;解决办法：在root用户下方可更改，在配置文件中加入 &lt;code class=&quot;language-text&quot;&gt;vm.max_map_count=655360&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;使其生效命令：&lt;code class=&quot;language-text&quot;&gt; sysctl -p&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h5&gt;3、系统最大打开文件数&lt;/h5&gt;
&lt;ul&gt;
&lt;li&gt;错误信息：&lt;code class=&quot;language-text&quot;&gt;max file descriptors [65535] for elasticsearch process likely too low, increase to at least [65536]&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;错误原因：系统打开文件数受限，&lt;code class=&quot;language-text&quot;&gt;/etc/security/limits.conf&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;解决办法：在root用户下，&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;vi /etc/security/limits.conf
//*代表所有用户，可更换为只指定自己需要的用户
*    soft    nproc   65536
*    hard    nproc   65536
*    soft    nofile  65536
*    hard    nofile  65536&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;要使其生效还必须修改elasticsearch的配置文件.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;vi ./elasticsearch.yml
discovery.zen.ping.unicast.hosts: [&quot;255.255.255.255&quot;]
discovery.zen.minimum_master_nodes: 3&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;ul&gt;
&lt;li&gt;使其生效：退出当前用户：&lt;code class=&quot;language-text&quot;&gt;logout&lt;/code&gt;，重新登录就生效了.&lt;/li&gt;
&lt;/ul&gt;
&lt;h5&gt;4、系统版本问题&lt;/h5&gt;
&lt;ul&gt;
&lt;li&gt;错误信息：&lt;code class=&quot;language-text&quot;&gt;ERROR: bootstrap checks failed
system call filters failed to install; check the logs and fix your configuration or disable system call filters at your own risk&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;错误原因：这是在因为Centos6不支持SecComp，而ES5.2.0默认bootstrap.system_call_filter为true进行检测，所以导致检测失败，失败后直接导致ES不能启动。&lt;/li&gt;
&lt;li&gt;解决办法：&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;vi ./elasticsearch.yml
bootstrap.memory_lock: false
bootstrap.system_call_filter: false&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h5&gt;5、访问elasticsearch的url报503错误&lt;/h5&gt;
&lt;ul&gt;
&lt;li&gt;错误：请求URL报503错误&lt;/li&gt;
&lt;li&gt;错误原因：elasticsearch中没有index，可以理解为没有数据库&lt;/li&gt;
&lt;li&gt;解决办法：添加index&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;//创建一个名为customer的index
curl -XPUT &apos;localhost:9200/customer?pretty&amp;amp;pretty&apos;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h5&gt;6、最大线程数&lt;/h5&gt;
&lt;ul&gt;
&lt;li&gt;错误信息：&lt;code class=&quot;language-text&quot;&gt;max number of threads [1024] for user [lish] likely too low, increase to at least [2048]&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;解决办法：要有root权限，&lt;code class=&quot;language-text&quot;&gt;vi /etc/security/limits.d/90-nproc.conf&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;修改：&lt;code class=&quot;language-text&quot;&gt;* soft nproc 2048&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;生效：用户退出，重连就生效了&lt;/li&gt;
&lt;/ul&gt;
&lt;blockquote&gt;
&lt;p&gt;参考：&lt;a href=&quot;http://blog.csdn.net/cardinalzbk/article/details/54924511&quot;&gt;http://blog.csdn.net/cardinalzbk/article/details/54924511&lt;/a&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2&gt;二、LogStach&lt;/h2&gt;
&lt;h3&gt;1、安装&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;下载：&lt;code class=&quot;language-text&quot;&gt;wget -c https://artifacts.elastic.co/downloads/logstash/logstash-5.2.2.tar.gz&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;解压：&lt;code class=&quot;language-text&quot;&gt;tar -xzvf logstash-5.2.2.tar.gz&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;修该配置文件：&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;//新建的配置文件：log4j_to_es.conf
input {
        log4j{
                mode =&gt; &quot;server&quot;
                host =&gt; &quot;255.255.255.255&quot; #when mode is server,listen this host,when mode is client ,client this host
                port =&gt; &quot;4567&quot;
        }
}
filter {

        }
output{
                elasticsearch{
                        action =&gt; &quot;index&quot;
                        hosts  =&gt; [&quot;255.255.255.255:9200&quot;]  #eleasticsearch host,can be array,when model is cluster
                        index  =&gt;&quot;applog&quot;
                }
}&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;ul&gt;
&lt;li&gt;启动：&lt;code class=&quot;language-text&quot;&gt;./bin/logstash -f ./config/log4j_to_es.conf&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h2&gt;三、Kibana&lt;/h2&gt;
&lt;h3&gt;1、安装&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;下载：&lt;code class=&quot;language-text&quot;&gt;wget -c https://artifacts.elastic.co/downloads/kibana/kibana-5.2.2-linux-x86_64.tar.gz&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;解压：&lt;code class=&quot;language-text&quot;&gt;tar -xzvf kibana-5.2.2-linux-x86_64.tar.gz&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;配置文件：&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;server.port: 5601
server.host: &quot;255.255.255.255&quot;
elasticsearch.url: &quot;http://255.255.255.255:9200&quot;
kibana.index: &quot;.kibana&quot;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;ul&gt;
&lt;li&gt;启动：&lt;code class=&quot;language-text&quot;&gt;./bin/kibana&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;//启动成功信息
[listening] Server running at http://255.255.255.255:5601&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2&gt;四、安装x-pakc插件&lt;/h2&gt;
&lt;blockquote&gt;
&lt;p&gt;更详细的可以看我写的&lt;code class=&quot;language-text&quot;&gt;x-pack&lt;/code&gt;安装和破解篇。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;&lt;em&gt;eleasticsearch版本必须是5.0以上&lt;/em&gt;&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;x-pack是elasticsearch的一个扩展包，将安全，警告，监视，图形和报告功能捆绑在一个易于安装的软件包中，也是官方推荐的。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h3&gt;1、elasticsearch&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;进入elasticsearch：&lt;code class=&quot;language-text&quot;&gt;bin/elasticsearch-plugin install x-pack&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;配置elasticsearch.yml：&lt;code class=&quot;language-text&quot;&gt;action.auto_create_index: .security,.monitoring*,.watches,.triggered_watches,.watcher-history*&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;启动&lt;/li&gt;
&lt;/ul&gt;
&lt;h3&gt;2、kianda&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;下载：&lt;code class=&quot;language-text&quot;&gt;bin/kibana-plugin install x-pack&lt;/code&gt;    比较耗时，请耐心等待&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;启动&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;运行：浏览器输入&lt;code class=&quot;language-text&quot;&gt;http://255.255.255.255:5601/&lt;/code&gt;,此时需要输入用户名和密码，默认用户名是&lt;code class=&quot;language-text&quot;&gt;elastic&lt;/code&gt;,密码&lt;code class=&quot;language-text&quot;&gt;changeme&lt;/code&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;卸载插件：&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;bin/elasticsearch-plugin install x-pack
bin/elasticsearch-plugin remove x-pack
bin/kibana-plugin install x-pack
bin/kibana-plugin remove x-pack&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;</content:encoded></item><item><title><![CDATA[es 单节点部署多个服务]]></title><description><![CDATA[ElasticSearch单机双实例的配置方法 从ElasticSearch官方的多份文档中可以看到，官方并不建议部署ES时为实例指定超过32GB的内存，但是现在内存的价格非常便宜，一台实体机服务器仅用32G内存显然是非常浪费的。所以我们要尝试在一个服务器上开多个ES…]]></description><link>https://lengrongfu.github.io/2018-10-17-es-single-node-install/</link><guid isPermaLink="false">https://lengrongfu.github.io/2018-10-17-es-single-node-install/</guid><pubDate>Wed, 17 Oct 2018 22:56:28 GMT</pubDate><content:encoded>&lt;h1&gt;ElasticSearch单机双实例的配置方法&lt;/h1&gt;
&lt;p&gt;从ElasticSearch官方的多份文档中可以看到，官方并不建议部署ES时为实例指定超过32GB的内存，但是现在内存的价格非常便宜，一台实体机服务器仅用32G内存显然是非常浪费的。所以我们要尝试在一个服务器上开多个ES实例，以便达到充分利用资源的目的。本文提供了一些ES单机双实例的配置要点，可扩展至单机多实例，供大家来实际参考。&lt;/p&gt;
&lt;h2&gt;突破32G&lt;/h2&gt;
&lt;p&gt;从ElasticSearch官方的多份文档中可以看到，官方并不建议部署ES时为实例指定超过32GB的内存，例如这些写着大字警告用户的文章： &lt;a href=&quot;https://www.elastic.co/guide/en/elasticsearch/guide/current/heap-sizing.html#compressed_oops&quot;&gt;Don’t Cross 32 GB!&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;但是现在内存的价格非常便宜，一台实体机服务器仅用32G内存显然是非常浪费的。所以我们要尝试在一个服务器上开多个ES实例，以便达到充分利用资源的目的。&lt;/p&gt;
&lt;h2&gt;配置变更&lt;/h2&gt;
&lt;p&gt;要做到单机上开多个实例，需要修改ES的默认配置，以下是一些配置要点：&lt;/p&gt;
&lt;h3&gt;node.max_local_storage_nodes&lt;/h3&gt;
&lt;p&gt;这个配置限制了单节点上可以开启的ES存储实例的个数，我们需要开多个实例，因此需要把这个配置写到配置文件中，并为这个配置赋值为2或者更高。&lt;/p&gt;
&lt;h3&gt;http.port&lt;/h3&gt;
&lt;p&gt;这个配置是elasticsearch对外提供服务的http端口配置，默认情况下ES会取用9200~9299之间的端口，如果9200被占用就会自动使用9201，在单机多实例的配置中这个配置实际是不需要修改的。&lt;/p&gt;
&lt;p&gt;但是为了更好地进行配置管理，以及和老的配置兼容，我们还是手动将第一个实例的http端口配置为9200，第二个实例配置为9201。&lt;/p&gt;
&lt;h3&gt;transport.tcp.port&lt;/h3&gt;
&lt;p&gt;这个配置指定了elasticsearch集群内数据通讯使用的端口，默认情况下为9300，与上面的http.port配置类似，ES也会自动为已占用的端口选择下一个端口号。我们可以将第一个实例的tcp传输端口配置为9300，第二实例配置为9301。
discovery.zen.ping.unicast.hosts&lt;/p&gt;
&lt;p&gt;由于到了2.x版本之后，ES取消了默认的广播模式来发现master节点，需要使用该配置来指定发现master节点。这个配置在单机双实例的配置中需要特别注意下，因为习惯上我们配置时并未指定master节点的tcp端口，如果实例的transport.tcp.port配置为9301，那么实例启动后会认为discovery.zen.ping.unicast.hosts中指定的主机tcp端口也是9301，可能导致这些节点无法找到master节点。因此在该配置中需要指定master节点提供服务的tcp端口。&lt;/p&gt;
&lt;p&gt;配置示例：&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;shell&quot;&gt;&lt;pre class=&quot;language-shell&quot;&gt;&lt;code class=&quot;language-shell&quot;&gt;discovery.zen.ping.unicast.hosts: &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;testes.mydomain:9300&quot;&lt;/span&gt;,&lt;span class=&quot;token string&quot;&gt;&quot;testes1.mydomain:9301&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2&gt;其他配置&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;node.name&lt;/p&gt;
&lt;p&gt;同一主机上的两个实例需要使用不同的node.name&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;path.data&lt;/p&gt;
&lt;p&gt;同一主机上两个实例需要对应不同的数据目录&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;path.logs&lt;/p&gt;
&lt;p&gt;由于默认情况下日志用集群名称来命名，因此同一主机两个实例对应的日志目录需要分开&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h2&gt;完整配置示例&lt;/h2&gt;
&lt;p&gt;以下提供两个完整的配置实例供参考：&lt;/p&gt;
&lt;p&gt;实例1：&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;yml&quot;&gt;&lt;pre class=&quot;language-yml&quot;&gt;&lt;code class=&quot;language-yml&quot;&gt;&lt;span class=&quot;token key atrule&quot;&gt;cluster.name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; testes
&lt;span class=&quot;token key atrule&quot;&gt;node.name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; $&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;HOSTNAME&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token key atrule&quot;&gt;node.box_type&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; M
&lt;span class=&quot;token key atrule&quot;&gt;node.master&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token boolean important&quot;&gt;false&lt;/span&gt;
&lt;span class=&quot;token key atrule&quot;&gt;node.data&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token boolean important&quot;&gt;true&lt;/span&gt;
&lt;span class=&quot;token key atrule&quot;&gt;path.data&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; /data/disk01
&lt;span class=&quot;token key atrule&quot;&gt;path.logs&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; /home/centos/elasticsearch/logs/instance1
&lt;span class=&quot;token key atrule&quot;&gt;network.host&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; 0.0.0.0
&lt;span class=&quot;token key atrule&quot;&gt;http.port&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;9200&lt;/span&gt;
&lt;span class=&quot;token key atrule&quot;&gt;transport.tcp.port&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;9300&lt;/span&gt;
&lt;span class=&quot;token key atrule&quot;&gt;discovery.zen.ping.unicast.hosts&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;testes1.mydomain:9300&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;testes2.mydomain:9301&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;
&lt;span class=&quot;token key atrule&quot;&gt;node.max_local_storage_nodes&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;2&lt;/span&gt;
&lt;span class=&quot;token key atrule&quot;&gt;threadpool.index.queue_size&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;400&lt;/span&gt;
&lt;span class=&quot;token key atrule&quot;&gt;threadpool.bulk.queue_size&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;5000&lt;/span&gt;
&lt;span class=&quot;token key atrule&quot;&gt;bootstrap.mlockall&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token boolean important&quot;&gt;false&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;实例2：&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;yml&quot;&gt;&lt;pre class=&quot;language-yml&quot;&gt;&lt;code class=&quot;language-yml&quot;&gt;&lt;span class=&quot;token key atrule&quot;&gt;cluster.name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; testes
&lt;span class=&quot;token key atrule&quot;&gt;node.name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; $&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;HOSTNAME&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;2&lt;/span&gt;
&lt;span class=&quot;token key atrule&quot;&gt;node.box_type&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; M
&lt;span class=&quot;token key atrule&quot;&gt;node.master&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token boolean important&quot;&gt;false&lt;/span&gt;
&lt;span class=&quot;token key atrule&quot;&gt;node.data&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token boolean important&quot;&gt;true&lt;/span&gt;
&lt;span class=&quot;token key atrule&quot;&gt;path.data&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; /data/disk02
&lt;span class=&quot;token key atrule&quot;&gt;path.logs&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; /home/centos/elasticsearch/logs/instance2
&lt;span class=&quot;token key atrule&quot;&gt;network.host&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; 0.0.0.0
&lt;span class=&quot;token key atrule&quot;&gt;http.port&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;9201&lt;/span&gt;
&lt;span class=&quot;token key atrule&quot;&gt;transport.tcp.port&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;9301&lt;/span&gt;
&lt;span class=&quot;token key atrule&quot;&gt;discovery.zen.ping.unicast.hosts&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;testes1.mydomain:9300&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;testes2.mydomain:9301&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;
&lt;span class=&quot;token key atrule&quot;&gt;node.max_local_storage_nodes&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;2&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2&gt;配置部署&lt;/h2&gt;
&lt;p&gt;默认情况下ES启动时使用ES安装目录的config子目录下的elasticsearch.yml文件来作为配置文件，同时还用到了config子目录下的logging.yml文件来作为日志的配置文件。为了实现单机双实例的分别启动，我们需要创建两个目录来分别存储两个实例的配置文件，如：&lt;/p&gt;
&lt;p&gt;在config子目录下创建instance1和instance2两个目录，分别放置两个实例需要的elasticsearch.yml和logging.yml配置文件。&lt;/p&gt;
&lt;p&gt;注意，ES的配置文件必须使用elasticsearch.yml这个命名，因此必须创建出两个目录来。&lt;/p&gt;
&lt;h2&gt;启动实例&lt;/h2&gt;
&lt;p&gt;以下是两条参考的命令，用于启动单机上的两个实例：&lt;/p&gt;
&lt;h3&gt;实例1:&lt;/h3&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;shell&quot;&gt;&lt;pre class=&quot;language-shell&quot;&gt;&lt;code class=&quot;language-shell&quot;&gt;bin/elasticsearch -Des.path.conf&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;config/instance1 -d -p /tmp/elasticsearch_1.pid&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h3&gt;实例2:&lt;/h3&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;shell&quot;&gt;&lt;pre class=&quot;language-shell&quot;&gt;&lt;code class=&quot;language-shell&quot;&gt;bin/elasticsearch -Des.path.conf&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;config/instance2 -d -p /tmp/elasticsearch_2.pid&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;</content:encoded></item><item><title><![CDATA[es 索引按时间自动创建]]></title><description><![CDATA[index…]]></description><link>https://lengrongfu.github.io/2018-10-17-es-dynamic-index-create/</link><guid isPermaLink="false">https://lengrongfu.github.io/2018-10-17-es-dynamic-index-create/</guid><pubDate>Wed, 17 Oct 2018 22:53:05 GMT</pubDate><content:encoded>&lt;h1&gt;index&lt;/h1&gt;
&lt;p&gt;通过创建&lt;code class=&quot;language-text&quot;&gt;template&lt;/code&gt;来进行动态模版的创建。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;创建模版&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;json&quot;&gt;&lt;pre class=&quot;language-json&quot;&gt;&lt;code class=&quot;language-json&quot;&gt;PUT _template/template_1
&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token property&quot;&gt;&quot;template&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;test-*&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  &lt;span class=&quot;token property&quot;&gt;&quot;settings&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token property&quot;&gt;&quot;number_of_shards&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  &lt;span class=&quot;token property&quot;&gt;&quot;mappings&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token property&quot;&gt;&quot;type1&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
      &lt;span class=&quot;token property&quot;&gt;&quot;_source&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;token property&quot;&gt;&quot;enabled&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;false&lt;/span&gt;
      &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
      &lt;span class=&quot;token property&quot;&gt;&quot;properties&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;token property&quot;&gt;&quot;host_name&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
          &lt;span class=&quot;token property&quot;&gt;&quot;type&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;keyword&quot;&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
        &lt;span class=&quot;token property&quot;&gt;&quot;created_at&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
          &lt;span class=&quot;token property&quot;&gt;&quot;type&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;date&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
          &lt;span class=&quot;token property&quot;&gt;&quot;format&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;EEE MMM dd HH:mm:ss Z YYYY&quot;&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
      &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;ul&gt;
&lt;li&gt;创建第一天的数据&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;json&quot;&gt;&lt;pre class=&quot;language-json&quot;&gt;&lt;code class=&quot;language-json&quot;&gt;PUT test&lt;span class=&quot;token number&quot;&gt;-2018.08&lt;/span&gt;.&lt;span class=&quot;token number&quot;&gt;10&lt;/span&gt;/type1
&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token property&quot;&gt;&quot;host_name&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;token property&quot;&gt;&quot;created_at&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;&quot;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;ul&gt;
&lt;li&gt;创建第二天的数据&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;json&quot;&gt;&lt;pre class=&quot;language-json&quot;&gt;&lt;code class=&quot;language-json&quot;&gt;PUT test&lt;span class=&quot;token number&quot;&gt;-2018.08&lt;/span&gt;.&lt;span class=&quot;token number&quot;&gt;11&lt;/span&gt;/type1
&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token property&quot;&gt;&quot;host_name&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;token property&quot;&gt;&quot;created_at&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;&quot;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;后面都是依次类推。&lt;/p&gt;
&lt;h2&gt;禁止自动创建索引&lt;/h2&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;shell&quot;&gt;&lt;pre class=&quot;language-shell&quot;&gt;&lt;code class=&quot;language-shell&quot;&gt;&lt;span class=&quot;token function&quot;&gt;vim&lt;/span&gt; config/elasticsearch.yml
action.auto_create_index: &lt;span class=&quot;token boolean&quot;&gt;false&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2&gt;删除索引&lt;/h2&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;#用以下的请求来 删除索引:
DELETE /my_index
#你也可以这样删除多个索引：

DELETE /index_one,index_two
DELETE /index_*
#你甚至可以这样删除 全部 索引：
DELETE /_all
DELETE /*&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;为了避免意外的执行了删除所有数据的命令，可加入如下的配置。&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;shell&quot;&gt;&lt;pre class=&quot;language-shell&quot;&gt;&lt;code class=&quot;language-shell&quot;&gt;&lt;span class=&quot;token function&quot;&gt;vim&lt;/span&gt; config/elasticsearch.yml
action.destructive_requires_name: &lt;span class=&quot;token boolean&quot;&gt;true&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;# 配置之后就不能再执行删除所有的数据的命令，只能指定索引的删除&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2&gt;索引设置&lt;/h2&gt;
&lt;p&gt;可以通过修改配置自定义索引行为，详细配置参照&lt;a href=&quot;https://www.elastic.co/guide/en/elasticsearch/reference/5.6/index-modules.html&quot;&gt;索引模块&lt;/a&gt;。&lt;/p&gt;
&lt;h2&gt;参考文档&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https://www.elastic.co/guide/cn/elasticsearch/guide/current/_creating_an_index.html&quot;&gt;https://www.elastic.co/guide/cn/elasticsearch/guide/current/_creating_an_index.html&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://www.elastic.co/guide/cn/elasticsearch/guide/current/index-templates.html&quot;&gt;https://www.elastic.co/guide/cn/elasticsearch/guide/current/index-templates.html&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://www.elastic.co/blog/managing-time-based-indices-efficiently&quot;&gt;有效地管理Elasticsearch基于时间的指数&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://luyiisme.github.io/2017/04/13/es-rollover-index/&quot;&gt;更高效的数据&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;</content:encoded></item><item><title><![CDATA[ES 节点重启问题]]></title><description><![CDATA[ES 节点离线并重启之后，发现本级上的分片已经再开始在平衡了，就会把本级上的所有分片删除，从新从其他集群上拉取，这样就会出现大量的数据迁移。占用超级多的网络资源。 之前已经讲过破解和安装x-pack的教程。本文涉及到的是安装成功之后重启服务的问题。ES…]]></description><link>https://lengrongfu.github.io/2018-10-17-es-node-restart-problme/</link><guid isPermaLink="false">https://lengrongfu.github.io/2018-10-17-es-node-restart-problme/</guid><pubDate>Wed, 17 Oct 2018 22:51:38 GMT</pubDate><content:encoded>&lt;p&gt;&lt;strong&gt;ES 节点离线并重启之后，发现本级上的分片已经再开始在平衡了，就会把本级上的所有分片删除，从新从其他集群上拉取，这样就会出现大量的数据迁移。占用超级多的网络资源。&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;之前已经讲过破解和安装x-pack的教程。本文涉及到的是安装成功之后重启服务的问题。ES集群在其中任何一个节点离线之后都会进行数据再平衡，就是把现有的数据进行重新分片,以达到高可用的目的。但是这样也会有很多问题，比如是因为网络抖动引起节点之间通信阻断，本来马上就能好的，可是就出现大量的数据迁移。&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;生产环境下建议关闭自动平衡。因为集群中集群的节点数是定的，所以分片也是固定的，如果是添加了新节点，就需要打开自动平衡功能，先把分片平衡了再关闭这个功能。&lt;/strong&gt;&lt;/p&gt;
&lt;h2&gt;停机维护时操作步骤&lt;/h2&gt;
&lt;h3&gt;1、关闭分片分配&lt;/h3&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;json&quot;&gt;&lt;pre class=&quot;language-json&quot;&gt;&lt;code class=&quot;language-json&quot;&gt;# 此操作会停止所有的分片动作，以及分片的数据移动。
PUT _cluster/settings
&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token property&quot;&gt;&quot;transient&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token property&quot;&gt;&quot;cluster.routing.allocation.enable&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;none&quot;&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h3&gt;2、执行同步刷新&lt;/h3&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;json&quot;&gt;&lt;pre class=&quot;language-json&quot;&gt;&lt;code class=&quot;language-json&quot;&gt;POST _flush/synced&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h3&gt;3、关闭自动平衡(重要)&lt;/h3&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;json&quot;&gt;&lt;pre class=&quot;language-json&quot;&gt;&lt;code class=&quot;language-json&quot;&gt;# 这一项很重要，如果配置了关闭分片分配，没有关闭自平衡，也会在打开分片分配之后出现集群自平衡
PUT /_cluster/settings?pretty
&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token property&quot;&gt;&quot;transient&quot;&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token property&quot;&gt;&quot;cluster.routing.rebalance.enable&quot;&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;none&quot;&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
# 设置以后需要手动验证一下
curl http&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token comment&quot;&gt;//{host}:9200/_cluster/settings?pretty&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h3&gt;4、延迟副本分片的分配&lt;/h3&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;json&quot;&gt;&lt;pre class=&quot;language-json&quot;&gt;&lt;code class=&quot;language-json&quot;&gt;PUT /_all/_settings
&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token property&quot;&gt;&quot;settings&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token property&quot;&gt;&quot;index.unassigned.node_left.delayed_timeout&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;5m&quot;&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;strong&gt;上面的步骤都做完了，集群自平衡关闭了，分片功能关闭了，就可以停机维护服务&lt;/strong&gt;&lt;/p&gt;
&lt;h3&gt;5、重启之后&lt;/h3&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;json&quot;&gt;&lt;pre class=&quot;language-json&quot;&gt;&lt;code class=&quot;language-json&quot;&gt;# 打开分片分配，就会把分片上数据不一致的进行同步，不会出现再平衡
PUT _cluster/settings
&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token property&quot;&gt;&quot;transient&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token property&quot;&gt;&quot;cluster.routing.allocation.enable&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;all&quot;&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2&gt;参考文档&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https://www.elastic.co/guide/en/elasticsearch/reference/5.4/shards-allocation.html#shards-allocation&quot;&gt;https://www.elastic.co/guide/en/elasticsearch/reference/5.4/shards-allocation.html#shards-allocation&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://juejin.im/post/5ab5f53f518825556b6cbdea&quot;&gt;https://juejin.im/post/5ab5f53f518825556b6cbdea&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://www.elastic.co/guide/en/elasticsearch/reference/5.4/rolling-upgrades.html&quot;&gt;https://www.elastic.co/guide/en/elasticsearch/reference/5.4/rolling-upgrades.html&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;</content:encoded></item><item><title><![CDATA[es-xpack-watch-user]]></title><description><![CDATA[Watcher Es 安装了官方x-pack的插件，可以用来做业务监控。第一次使用请先阅读下面的注意事项。 使用 1、进入页面，从进入，有一个的按钮，进入之后就可以进行添加.…]]></description><link>https://lengrongfu.github.io/2018-10-17-es-xpack-watch-user/</link><guid isPermaLink="false">https://lengrongfu.github.io/2018-10-17-es-xpack-watch-user/</guid><pubDate>Wed, 17 Oct 2018 22:29:46 GMT</pubDate><content:encoded>&lt;h1&gt;Watcher&lt;/h1&gt;
&lt;p&gt;&lt;strong&gt;Es 安装了官方x-pack的插件，可以用来做业务监控。第一次使用请先阅读下面的注意事项。&lt;/strong&gt;&lt;/p&gt;
&lt;h2&gt;使用&lt;/h2&gt;
&lt;p&gt;1、进入&lt;code class=&quot;language-text&quot;&gt;kibana&lt;/code&gt;页面，从&lt;code class=&quot;language-text&quot;&gt;management&lt;/code&gt;进入，有一个&lt;code class=&quot;language-text&quot;&gt;Watcher&lt;/code&gt;的按钮，进入之后就可以进行&lt;code class=&quot;language-text&quot;&gt;watcher&lt;/code&gt;添加.&lt;/p&gt;
&lt;p&gt;2、点击&lt;code class=&quot;language-text&quot;&gt;Addr&lt;/code&gt;进入页面之后添加一个&lt;code class=&quot;language-text&quot;&gt;ID&lt;/code&gt;和&lt;code class=&quot;language-text&quot;&gt;name&lt;/code&gt;.之后编辑&lt;code class=&quot;language-text&quot;&gt;watch Json&lt;/code&gt;内容。&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;json&quot;&gt;&lt;pre class=&quot;language-json&quot;&gt;&lt;code class=&quot;language-json&quot;&gt;
&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token property&quot;&gt;&quot;trigger&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token property&quot;&gt;&quot;schedule&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
      &lt;span class=&quot;token property&quot;&gt;&quot;interval&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;30m&quot;&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  &lt;span class=&quot;token property&quot;&gt;&quot;input&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token property&quot;&gt;&quot;search&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
      &lt;span class=&quot;token property&quot;&gt;&quot;request&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;token property&quot;&gt;&quot;body&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
          &lt;span class=&quot;token property&quot;&gt;&quot;size&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
          &lt;span class=&quot;token property&quot;&gt;&quot;query&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;token property&quot;&gt;&quot;match_all&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
          &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
        &lt;span class=&quot;token property&quot;&gt;&quot;indices&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;
          &lt;span class=&quot;token string&quot;&gt;&quot;*&quot;&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;
      &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  &lt;span class=&quot;token property&quot;&gt;&quot;condition&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token property&quot;&gt;&quot;compare&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
      &lt;span class=&quot;token property&quot;&gt;&quot;ctx.payload.hits.total&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;token property&quot;&gt;&quot;gte&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;10&lt;/span&gt;
      &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  &lt;span class=&quot;token property&quot;&gt;&quot;actions&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token property&quot;&gt;&quot;my-logging-action&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
      &lt;span class=&quot;token property&quot;&gt;&quot;logging&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;token property&quot;&gt;&quot;text&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;There are {{ctx.payload.hits.total}} documents in your index. Threshold is 10.&quot;&lt;/span&gt;
      &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;一个&lt;code class=&quot;language-text&quot;&gt;Watcher&lt;/code&gt;由四部分组成.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;Schedule&lt;/code&gt;：查询和检查的定时任务&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;Query&lt;/code&gt;：查询的语句，支持&lt;code class=&quot;language-text&quot;&gt;es&lt;/code&gt;的完整查询语句。&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;Condition&lt;/code&gt;:判断条件，是否满足&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;Actions&lt;/code&gt;:满足条件之后触发的动作&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;1、上面的定时任务是&lt;code class=&quot;language-text&quot;&gt;30&lt;/code&gt;分钟,可以改为&lt;code class=&quot;language-text&quot;&gt;10s&lt;/code&gt;,&lt;code class=&quot;language-text&quot;&gt;1h&lt;/code&gt;,不建议这个值太小，这样对&lt;code class=&quot;language-text&quot;&gt;es&lt;/code&gt;服务器压力比较大，并且没有太大意义。&lt;/p&gt;
&lt;p&gt;2、上面的&lt;code class=&quot;language-text&quot;&gt;query&lt;/code&gt;就是查询所有&lt;code class=&quot;language-text&quot;&gt;index&lt;/code&gt;的所以数据，具体的查看语句需要自己写。&lt;/p&gt;
&lt;p&gt;3、比较条件，上面的是比较&lt;code class=&quot;language-text&quot;&gt;ctx.payload.hits.total&lt;/code&gt;这个返回的值是否大于&lt;code class=&quot;language-text&quot;&gt;10&lt;/code&gt;,大于等于用&lt;code class=&quot;language-text&quot;&gt;gte&lt;/code&gt;,大于用&lt;code class=&quot;language-text&quot;&gt;gt&lt;/code&gt;,小于用&lt;code class=&quot;language-text&quot;&gt;lt&lt;/code&gt;,小于等于用&lt;code class=&quot;language-text&quot;&gt;lte&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;4、触发动作，上述的触发动作是打印日志。触发动作可以选择发送邮件。&lt;/p&gt;
&lt;h2&gt;场景用列&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;业务系统中一个关键节点异常告警&lt;/li&gt;
&lt;li&gt;监控 &lt;code class=&quot;language-text&quot;&gt;nginx&lt;/code&gt; 一分钟之内&lt;code class=&quot;language-text&quot;&gt;code&lt;/code&gt;为&lt;code class=&quot;language-text&quot;&gt;500&lt;/code&gt;出现次数10次以上则告警&lt;/li&gt;
&lt;/ul&gt;
&lt;h2&gt;注意事项&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;新建的&lt;code class=&quot;language-text&quot;&gt;watcher&lt;/code&gt;的&lt;code class=&quot;language-text&quot;&gt;id&lt;/code&gt;和&lt;code class=&quot;language-text&quot;&gt;name&lt;/code&gt;，不要和已有的重名，不然会把人家的给覆盖掉，并且不能恢复回来，必须重写。所以写的人也要注意，自己写了的也要保存一份。&lt;/li&gt;
&lt;li&gt;定时任务时间不到太短&lt;/li&gt;
&lt;li&gt;上述查询返回是没有内容的，之后返回查询命中多少条，如果要返回多少条，请修改&lt;code class=&quot;language-text&quot;&gt;query&lt;/code&gt;中的&lt;code class=&quot;language-text&quot;&gt;size&lt;/code&gt;字段，这个值不要给太大，最好不要超过&lt;code class=&quot;language-text&quot;&gt;100&lt;/code&gt;,太大，会把服务器内存耗尽。如果需要只返回前面的几条数据即可。&lt;/li&gt;
&lt;li&gt;每个&lt;code class=&quot;language-text&quot;&gt;watch&lt;/code&gt;语句最好都在开发环境上测试一下，开发环境有同样的工具。&lt;/li&gt;
&lt;li&gt;如果&lt;code class=&quot;language-text&quot;&gt;query&lt;/code&gt;语句比较复杂，请在&lt;code class=&quot;language-text&quot;&gt;Dev Tools&lt;/code&gt;控制面板中先写好测试过了之后再使用，添加到线上之前请再三进行测试一下。&lt;/li&gt;
&lt;/ul&gt;
&lt;h2&gt;其他问题&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;如果要获取返回的数据并且序列化为一个字符串需要使用&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;json&quot;&gt;&lt;pre class=&quot;language-json&quot;&gt;&lt;code class=&quot;language-json&quot;&gt;&lt;span class=&quot;token property&quot;&gt;&quot;actions&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token property&quot;&gt;&quot;my_webhook&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
      &lt;span class=&quot;token property&quot;&gt;&quot;transform&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;token property&quot;&gt;&quot;script&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
          &lt;span class=&quot;token property&quot;&gt;&quot;inline&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;return ctx.payload.hits.hits.stream().map(p -&gt; p._source.message).collect(Collectors.toList())&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
          &lt;span class=&quot;token property&quot;&gt;&quot;lang&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;painless&quot;&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
      &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
      &lt;span class=&quot;token property&quot;&gt;&quot;my-logging-action&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
      &lt;span class=&quot;token property&quot;&gt;&quot;logging&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;token property&quot;&gt;&quot;text&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;{{#toJson}}ctx.payload{{/toJson}}&quot;&lt;/span&gt;
      &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2&gt;参考文档&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https://www.elastic.co/guide/en/x-pack/5.4/xpack-alerting.html&quot;&gt;https://www.elastic.co/guide/en/x-pack/5.4/xpack-alerting.html&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://demo.elastic.co&quot;&gt;https://demo.elastic.co&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;</content:encoded></item><item><title><![CDATA[ES X-Pack 5.4.3破解安装]]></title><description><![CDATA[假如已经有和了。 下面的为安装路径. 1、下载xpakc 2、Elasticsearch安装X-Pack 安装有两种方法。 一、手动安装 安装插件 破解 编译 替换class文件 申请license 修改license ps…]]></description><link>https://lengrongfu.github.io/2018-10-17-es-xpack-install/</link><guid isPermaLink="false">https://lengrongfu.github.io/2018-10-17-es-xpack-install/</guid><pubDate>Wed, 17 Oct 2018 22:26:17 GMT</pubDate><content:encoded>&lt;p&gt;假如已经有&lt;code class=&quot;language-text&quot;&gt;es&lt;/code&gt;和&lt;code class=&quot;language-text&quot;&gt;kibana&lt;/code&gt;了。&lt;/p&gt;
&lt;p&gt;下面的为安装路径.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;esHome=/data/home/elastic/elasticsearch-5.4.3
xpackHome=/data/home/xpack
kibanaHome=/data/home/kibana&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2&gt;1、下载xpakc&lt;/h2&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;shell&quot;&gt;&lt;pre class=&quot;language-shell&quot;&gt;&lt;code class=&quot;language-shell&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;# 下载xpack压缩包&lt;/span&gt;
$ &lt;span class=&quot;token builtin class-name&quot;&gt;cd&lt;/span&gt; &lt;span class=&quot;token variable&quot;&gt;${xpackHome}&lt;/span&gt;
$ &lt;span class=&quot;token function&quot;&gt;wget&lt;/span&gt; -c &apos;https://artifacts.elastic.co/downloads/packs/x-pack/x-pack-5.4.3.zip
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2&gt;2、Elasticsearch安装X-Pack&lt;/h2&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;ES&lt;/code&gt;安装&lt;code class=&quot;language-text&quot;&gt;x-pack&lt;/code&gt;有两种方法。&lt;/p&gt;
&lt;h3&gt;一、手动安装&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;安装插件&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;shell&quot;&gt;&lt;pre class=&quot;language-shell&quot;&gt;&lt;code class=&quot;language-shell&quot;&gt;$ ./bin/elasticsearch-plugin &lt;span class=&quot;token function&quot;&gt;install&lt;/span&gt; file://&lt;span class=&quot;token variable&quot;&gt;${xpackHome}&lt;/span&gt;/x-pack-5.4.3.zip&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;ul&gt;
&lt;li&gt;破解&lt;code class=&quot;language-text&quot;&gt;xpack&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;shell&quot;&gt;&lt;pre class=&quot;language-shell&quot;&gt;&lt;code class=&quot;language-shell&quot;&gt;$ &lt;span class=&quot;token builtin class-name&quot;&gt;cd&lt;/span&gt; &lt;span class=&quot;token variable&quot;&gt;${esHome}&lt;/span&gt;/plugins
$ &lt;span class=&quot;token function&quot;&gt;touch&lt;/span&gt; LicenseVerifier.java
$ &lt;span class=&quot;token function&quot;&gt;vim&lt;/span&gt; LicenseVerifier.java

package org.elasticsearch.license&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;token function&quot;&gt;import&lt;/span&gt; java.nio.*&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token function&quot;&gt;import&lt;/span&gt; java.util.*&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token function&quot;&gt;import&lt;/span&gt; java.security.*&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token function&quot;&gt;import&lt;/span&gt; org.elasticsearch.common.xcontent.*&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token function&quot;&gt;import&lt;/span&gt; org.apache.lucene.util.*&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token function&quot;&gt;import&lt;/span&gt; org.elasticsearch.common.io.*&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token function&quot;&gt;import&lt;/span&gt; java.io.*&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

public class LicenseVerifier
&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    public static boolean verifyLicense&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;final License license, final byte&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; encryptedPublicKeyData&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;token builtin class-name&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;true&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

    public static boolean verifyLicense&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;final License license&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;token builtin class-name&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;true&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;ul&gt;
&lt;li&gt;编译&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;shell&quot;&gt;&lt;pre class=&quot;language-shell&quot;&gt;&lt;code class=&quot;language-shell&quot;&gt;$ &lt;span class=&quot;token builtin class-name&quot;&gt;cd&lt;/span&gt; &lt;span class=&quot;token variable&quot;&gt;${esHome}&lt;/span&gt;/plugins
$ javac -cp &lt;span class=&quot;token string&quot;&gt;&quot;&lt;span class=&quot;token variable&quot;&gt;${esHome}&lt;/span&gt;/lib/elasticsearch-5.4.3.jar:&lt;span class=&quot;token variable&quot;&gt;${esHome}&lt;/span&gt;/lib/lucene-core-6.5.1.jar:&lt;span class=&quot;token variable&quot;&gt;${esHome}&lt;/span&gt;/plugins/x-pack/x-pack-5.4.3.jar&quot;&lt;/span&gt; LicenseVerifier.java
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;ul&gt;
&lt;li&gt;替换class文件&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;shell&quot;&gt;&lt;pre class=&quot;language-shell&quot;&gt;&lt;code class=&quot;language-shell&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;# 解压&lt;/span&gt;
$ &lt;span class=&quot;token builtin class-name&quot;&gt;cd&lt;/span&gt; &lt;span class=&quot;token variable&quot;&gt;${esHome}&lt;/span&gt;/plugins/x-pack/
&lt;span class=&quot;token function&quot;&gt;mkdir&lt;/span&gt; &lt;span class=&quot;token builtin class-name&quot;&gt;test&lt;/span&gt;
&lt;span class=&quot;token function&quot;&gt;mv&lt;/span&gt; x-pack-5.4.3.jar test/
&lt;span class=&quot;token builtin class-name&quot;&gt;cd&lt;/span&gt; test/
jar xvf x-pack-5.4.3.jar
&lt;span class=&quot;token comment&quot;&gt;#替换&lt;/span&gt;
&lt;span class=&quot;token builtin class-name&quot;&gt;cd&lt;/span&gt; ./org/elasticsearch/license
&lt;span class=&quot;token function&quot;&gt;rm&lt;/span&gt; -f LicenseVerifier.class
&lt;span class=&quot;token function&quot;&gt;mv&lt;/span&gt; &lt;span class=&quot;token variable&quot;&gt;${esHome}&lt;/span&gt;/plugins/LicenseVerifier.class &lt;span class=&quot;token builtin class-name&quot;&gt;.&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;# 打包&lt;/span&gt;
&lt;span class=&quot;token builtin class-name&quot;&gt;cd&lt;/span&gt; &lt;span class=&quot;token variable&quot;&gt;${esHome}&lt;/span&gt;/plugins/x-pack/test
jar cvf x-pack-5.4.3.jar &lt;span class=&quot;token builtin class-name&quot;&gt;.&lt;/span&gt;
&lt;span class=&quot;token function&quot;&gt;mv&lt;/span&gt; x-pack-5.4.3.jar &lt;span class=&quot;token punctuation&quot;&gt;..&lt;/span&gt;/
&lt;span class=&quot;token comment&quot;&gt;#删除临时文件&lt;/span&gt;
&lt;span class=&quot;token builtin class-name&quot;&gt;cd&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;..&lt;/span&gt;/
&lt;span class=&quot;token function&quot;&gt;rm&lt;/span&gt; -rf &lt;span class=&quot;token builtin class-name&quot;&gt;test&lt;/span&gt;
&lt;span class=&quot;token builtin class-name&quot;&gt;cd&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;..&lt;/span&gt;/
&lt;span class=&quot;token function&quot;&gt;rm&lt;/span&gt; LicenseVerifier.java&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;ul&gt;
&lt;li&gt;申请license&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;shell&quot;&gt;&lt;pre class=&quot;language-shell&quot;&gt;&lt;code class=&quot;language-shell&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;#来此注册，并下载license文件&lt;/span&gt;
https://license.elastic.co/registration&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;ul&gt;
&lt;li&gt;修改license&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;json&quot;&gt;&lt;pre class=&quot;language-json&quot;&gt;&lt;code class=&quot;language-json&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;                                                                                                                                                                                                       
       &lt;span class=&quot;token property&quot;&gt;&quot;license&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
           &lt;span class=&quot;token property&quot;&gt;&quot;uid&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;01957577-fa6e-426f-9257-200ccdfaee73&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
           &lt;span class=&quot;token property&quot;&gt;&quot;type&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;platinum&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
           &lt;span class=&quot;token property&quot;&gt;&quot;issue_date_in_millis&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1534464000000&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
           &lt;span class=&quot;token property&quot;&gt;&quot;expiry_date_in_millis&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;2524579200999&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
           &lt;span class=&quot;token property&quot;&gt;&quot;max_nodes&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;100&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
           &lt;span class=&quot;token property&quot;&gt;&quot;issued_to&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;leng rongfu (no)&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
           &lt;span class=&quot;token property&quot;&gt;&quot;issuer&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;Web Form&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
          &lt;span class=&quot;token property&quot;&gt;&quot;signature&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;AAAAAwAAAA0p6LA0HKNGcIOkCCRqAAABmC9ZN0hjZDBGYnVyRXpCOW5Bb3FjZDAxOWpSbTVoMVZwUzRxVk1PSmkxaktJRVl5MUYvUWh3bHZVUTllbXNPbzBUemtnbWpBbmlWRmRZb25KNFlBR2x0TXc2K2p1Y1VtMG1UQU9TRGZVSGRwaE   JGUjE3bXd3LzRqZ05iLzRteWFNekdxRGpIYlFwYkJiNUs0U1hTVlJKNVlXekMrSlVUdFIvV0FNeWdOYnlESDc3MWhlY3hSQmdKSjJ2ZTcvYlBFOHhPQlV3ZHdDQ0tHcG5uOElCaDJ4K1hob29xSG85N0kvTWV3THhlQk9NL01VMFRjNDZpZEVXeUtUMXIyMlIveFpJUk    k2WUdveEZaME9XWitGUi9WNTZVQW1FMG1DenhZU0ZmeXlZakVEMjZFT2NvOWxpZGlqVmlHNC8rWVVUYzMwRGVySHpIdURzKzFiRDl4TmM1TUp2VTBOUlJZUlAyV0ZVL2kvVk10L0NsbXNFYVZwT3NSU082dFNNa2prQ0ZsclZ4NTltbU1CVE5lR09Bck93V2J1Y3c9PQ    AAAQBENsHqhC2OW/yYxaKP5tS/GHT9TrEbcEtI62k//Id9p2DzSHUv+xekDbfiu550wMrBnoeOi4xV4X6C2WcJCYLSM/QRTotlm11SGvWnUgRXFst83n/nceh3l3Y9D3Odec4zAhrhrYynisls2WfCFGSEW5EUO1II+3C5xhyKMyLROlAxkwNco0H4zD3GlEjZNqC3CK    8cQRRmeJ1lIPvb/Tw8JbbG5zjQuYhQakMAbXqIeL9BLla7sAP4+M8lmvh4Z6bwUGy1MQ9j1+ijdswWMNVs8Vr7CnxZ1j4pla2ZWkGSr4sNfI0LF6U25HC4ofb8CQkrKoAq80EPdINnrfyr56CU&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
          &lt;span class=&quot;token property&quot;&gt;&quot;start_date_in_millis&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1534464000000&lt;/span&gt;
      &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token property&quot;&gt;&quot;license&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;token property&quot;&gt;&quot;uid&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;01957577-fa6e-426f-9257-200ccdfaee73&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
        &lt;span class=&quot;token property&quot;&gt;&quot;type&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;platinum&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
        &lt;span class=&quot;token property&quot;&gt;&quot;issue_date_in_millis&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1534464000000&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
        &lt;span class=&quot;token property&quot;&gt;&quot;expiry_date_in_millis&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;2524579200999&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
        &lt;span class=&quot;token property&quot;&gt;&quot;max_nodes&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;100&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
        &lt;span class=&quot;token property&quot;&gt;&quot;issued_to&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;leng rongfu (no)&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
        &lt;span class=&quot;token property&quot;&gt;&quot;issuer&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;Web Form&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
        &lt;span class=&quot;token property&quot;&gt;&quot;signature&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;AAAAAwAAAA0p6LA0HKNGcIOkCCRqAAABmC9ZN0hjZDBGYnVyRXpCOW5Bb3FjZDAxOWpSbTVoMVZwUzRxVk1PSmkxaktJRVl5MUYvUWh3bHZVUTllbXNPbzBUemtnbWpBbmlWRmRZb25KNFlBR2x0TXc2K2p1Y1VtMG1UQU9TRGZVSGRwaEJGUjE3bXd3LzRqZ05iLzRteWFNekdxRGpIYlFwYkJiNUs0U1hTVlJKNVlXekMrSlVUdFIvV0FNeWdOYnlESDc3MWhlY3hSQmdKSjJ2ZTcvYlBFOHhPQlV3ZHdDQ0tHcG5uOElCaDJ4K1hob29xSG85N0kvTWV3THhlQk9NL01VMFRjNDZpZEVXeUtUMXIyMlIveFpJUkk2WUdveEZaME9XWitGUi9WNTZVQW1FMG1DenhZU0ZmeXlZakVEMjZFT2NvOWxpZGlqVmlHNC8rWVVUYzMwRGVySHpIdURzKzFiRDl4TmM1TUp2VTBOUlJZUlAyV0ZVL2kvVk10L0NsbXNFYVZwT3NSU082dFNNa2prQ0ZsclZ4NTltbU1CVE5lR09Bck93V2J1Y3c9PQAAAQBENsHqhC2OW/yYxaKP5tS/GHT9TrEbcEtI62k//Id9p2DzSHUv+xekDbfiu550wMrBnoeOi4xV4X6C2WcJCYLSM/QRTotlm11SGvWnUgRXFst83n/nceh3l3Y9D3Odec4zAhrhrYynisls2WfCFGSEW5EUO1II+3C5xhyKMyLROlAxkwNco0H4zD3GlEjZNqC3CK8cQRRmeJ1lIPvb/Tw8JbbG5zjQuYhQakMAbXqIeL9BLla7sAP4+M8lmvh4Z6bwUGy1MQ9j1+ijdswWMNVs8Vr7CnxZ1j4pla2ZWkGSr4sNfI0LF6U25HC4ofb8CQkrKoAq80EPdINnrfyr56CU&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
        &lt;span class=&quot;token property&quot;&gt;&quot;start_date_in_millis&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1534464000000&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;ps：&lt;code class=&quot;language-text&quot;&gt;platinum&lt;/code&gt;表示白金版，可以使用所有功能。其他的如&lt;code class=&quot;language-text&quot;&gt;expiry_date_in_millis&lt;/code&gt;、&lt;code class=&quot;language-text&quot;&gt;max_nodes&lt;/code&gt;等根据自己需要修改即可,&lt;code class=&quot;language-text&quot;&gt;expiry_date_in_millis&lt;/code&gt;是过期时间,使用的是&lt;code class=&quot;language-text&quot;&gt;uninx时间&lt;/code&gt;,我设置的是到&lt;code class=&quot;language-text&quot;&gt;2049&lt;/code&gt;年.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;查看lience&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;shell&quot;&gt;&lt;pre class=&quot;language-shell&quot;&gt;&lt;code class=&quot;language-shell&quot;&gt;$ &lt;span class=&quot;token function&quot;&gt;curl&lt;/span&gt; -XGET -u elastic:changeme &lt;span class=&quot;token string&quot;&gt;&apos;http://{host}:9200/_license&apos;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;ul&gt;
&lt;li&gt;注册新修改的lience&lt;/li&gt;
&lt;li&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;shell&quot;&gt;&lt;pre class=&quot;language-shell&quot;&gt;&lt;code class=&quot;language-shell&quot;&gt;$ &lt;span class=&quot;token function&quot;&gt;curl&lt;/span&gt; -XPUT -u elastic:changeme &lt;span class=&quot;token string&quot;&gt;&apos;http://{host}:9200/_xpack/license?acknowledge=true&apos;&lt;/span&gt; -d @lience.json&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h3&gt;二、直接导入文件&lt;/h3&gt;
&lt;p&gt;如果有破解好的文件，直接把&lt;code class=&quot;language-text&quot;&gt;plugins&lt;/code&gt;下的&lt;code class=&quot;language-text&quot;&gt;x-pack&lt;/code&gt;文件夹进行压缩，复制到其它节点的&lt;code class=&quot;language-text&quot;&gt;plugins&lt;/code&gt;路径下，重启就可以使用。&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;
# 下载地址
$ wget -c https://note.youdao.com/yws/api/personal/file/WEBe693b8fab3b4cad482e5b354cd4176cd?method=download&amp;amp;shareKey=a16d1e40a0ec4461a4f619f325c3f150
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2&gt;3、kibana安装X-Pack&lt;/h2&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;shell&quot;&gt;&lt;pre class=&quot;language-shell&quot;&gt;&lt;code class=&quot;language-shell&quot;&gt;$ &lt;span class=&quot;token builtin class-name&quot;&gt;cd&lt;/span&gt; &lt;span class=&quot;token variable&quot;&gt;${kibanaHome}&lt;/span&gt;
$ ./bin/kibana-plugin &lt;span class=&quot;token function&quot;&gt;install&lt;/span&gt; file://&lt;span class=&quot;token variable&quot;&gt;${xpackHome}&lt;/span&gt;/x-pack-5.4.3.zip
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h1&gt;参考文档&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https://my.oschina.net/guol/blog/1204258&quot;&gt;https://my.oschina.net/guol/blog/1204258&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://mp.weixin.qq.com/s/NN01SalzLz2Ue6Q4exCfAw&quot;&gt;https://mp.weixin.qq.com/s/NN01SalzLz2Ue6Q4exCfAw&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;</content:encoded></item><item><title><![CDATA[cloudera 问题解决]]></title><description><![CDATA[如下为记录 使用过程中的一些常见问题。…]]></description><link>https://lengrongfu.github.io/2018-10-16-cloudera-problem/</link><guid isPermaLink="false">https://lengrongfu.github.io/2018-10-16-cloudera-problem/</guid><pubDate>Tue, 16 Oct 2018 17:18:01 GMT</pubDate><content:encoded>&lt;blockquote&gt;
&lt;p&gt;如下为记录&lt;code class=&quot;language-text&quot;&gt;cloudera&lt;/code&gt; 使用过程中的一些常见问题。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h1&gt;1、服务没有设置&lt;code class=&quot;language-text&quot;&gt;/opt&lt;/code&gt;这个挂载点&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;cloudera&lt;/code&gt;所有的数据都是存储在&lt;code class=&quot;language-text&quot;&gt;/opt&lt;/code&gt;这个根目录下的，所以服务器在安装系统的时候最好让运维同事挂载一个大空间到这个目录下。&lt;/li&gt;
&lt;li&gt;如果安装的时候不知道，安装软件的时候可以选择存储空间,如果安装的时候也不知道，没有设置的话那就很悲催了。&lt;/li&gt;
&lt;li&gt;如果没有设置就回存到根目录的&lt;code class=&quot;language-text&quot;&gt;/opt&lt;/code&gt;下，这里面的存储空间一般都很小。说一下解决办法。&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;1、重装（我没这精力）
2、把&lt;code class=&quot;language-text&quot;&gt;/opt&lt;/code&gt;这个目录移动到一个大的挂载点上去，然后使用软连接，本人就是这么做的。&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;shell&quot;&gt;&lt;pre class=&quot;language-shell&quot;&gt;&lt;code class=&quot;language-shell&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;# 步骤&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;#1、先停掉集群。&lt;/span&gt;
$ &lt;span class=&quot;token function&quot;&gt;mv&lt;/span&gt; cloudera cloudera.bak
$ &lt;span class=&quot;token function&quot;&gt;mv&lt;/span&gt; cloudera.bak /data/cloudera
$ &lt;span class=&quot;token function&quot;&gt;ln&lt;/span&gt; -sv /data/cloudera cloudera
&lt;span class=&quot;token comment&quot;&gt;# 经过上面的步骤之后再重启集群就可以了。&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h1&gt;2、Error creating LevelDB timeseries store in directory /var/lib/cloudera-service-monitor/ts&lt;/h1&gt;
&lt;blockquote&gt;
&lt;p&gt;具体现象如下，报找不到一个文件。解释一下出现这个问题的原因，还是由于根目录下的空间不够了，因此我移动了一个占有很&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;大空间的包，就是错误中的 &lt;code class=&quot;language-text&quot;&gt;/var/lib/cloudera-service-monitor&lt;/code&gt; 这个目录，然后通过软连接进行访问的。&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;shell&quot;&gt;&lt;pre class=&quot;language-shell&quot;&gt;&lt;code class=&quot;language-shell&quot;&gt;&lt;span class=&quot;token number&quot;&gt;2018&lt;/span&gt;-10-16 &lt;span class=&quot;token number&quot;&gt;16&lt;/span&gt;:24:25,993 INFO com.cloudera.cmon.firehose.Main: Cluster size: SMALL
&lt;span class=&quot;token number&quot;&gt;2018&lt;/span&gt;-10-16 &lt;span class=&quot;token number&quot;&gt;16&lt;/span&gt;:24:26,056 INFO com.cloudera.cmon.tstore.leveldb.LDBResourceManager: Max &lt;span class=&quot;token function&quot;&gt;file&lt;/span&gt; descriptors: &lt;span class=&quot;token number&quot;&gt;32768&lt;/span&gt;
&lt;span class=&quot;token number&quot;&gt;2018&lt;/span&gt;-10-16 &lt;span class=&quot;token number&quot;&gt;16&lt;/span&gt;:24:26,057 INFO com.cloudera.cmon.tstore.leveldb.LDBResourceManager: Setting maximum &lt;span class=&quot;token function&quot;&gt;open&lt;/span&gt; fds to: &lt;span class=&quot;token number&quot;&gt;768&lt;/span&gt;
&lt;span class=&quot;token number&quot;&gt;2018&lt;/span&gt;-10-16 &lt;span class=&quot;token number&quot;&gt;16&lt;/span&gt;:24:26,181 ERROR com.cloudera.cmon.firehose.Main: Error creating LevelDB timeseries store &lt;span class=&quot;token keyword&quot;&gt;in&lt;/span&gt; directory /var/lib/cloudera-service-monitor/ts
org.fusesource.leveldbjni.internal.NativeDB&lt;span class=&quot;token variable&quot;&gt;$DBException&lt;/span&gt;&lt;span class=&quot;token builtin class-name&quot;&gt;:&lt;/span&gt; Corruption: &lt;span class=&quot;token number&quot;&gt;3&lt;/span&gt; missing files&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; e.g.: /data/lib/ts/ts_entity_metadata/000072.sst
        at org.fusesource.leveldbjni.internal.NativeDB.checkStatus&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;NativeDB.java:194&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
        at org.fusesource.leveldbjni.internal.NativeDB.open&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;NativeDB.java:212&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
        at org.fusesource.leveldbjni.JniDBFactory.open&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;JniDBFactory.java:168&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
        at com.cloudera.cmon.tstore.leveldb.LDBUtils.openVersionedDB&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;LDBUtils.java:264&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
        at com.cloudera.cmon.tstore.leveldb.LDBUtils.openVersionedDB&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;LDBUtils.java:212&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
        at com.cloudera.cmon.tstore.leveldb.LDBTimeSeriesMetadataStore.openMetadataDB&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;LDBTimeSeriesMetadataStore.java:148&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
        at com.cloudera.cmon.tstore.leveldb.LDBTimeSeriesMetadataStore.&lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;init&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;LDBTimeSeriesMetadataStore.java:138&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
        at com.cloudera.cmon.firehose.Main.main&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;Main.java:453&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;ul&gt;
&lt;li&gt;说一下解决办法：&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;shell&quot;&gt;&lt;pre class=&quot;language-shell&quot;&gt;&lt;code class=&quot;language-shell&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;# 进行如下的操作，再重启就可以了。亲测可以&lt;/span&gt;
$ &lt;span class=&quot;token function&quot;&gt;mv&lt;/span&gt; /var/lib/cloudera-service-monitor /var/lib/cloudera-service-monitor.moved

$ &lt;span class=&quot;token function&quot;&gt;mv&lt;/span&gt; /var/lib/cloudera-host-monitor /var/lib/cloudera-host-monitor.moved&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;ul&gt;
&lt;li&gt;参考：&lt;a href=&quot;https://community.cloudera.com/t5/Security-Apache-Sentry/Host-Monitor-and-Service-Monitor-is-not-starting-after/td-p/49207&quot;&gt;https://community.cloudera.com/t5/Security-Apache-Sentry/Host-Monitor-and-Service-Monitor-is-not-starting-after/td-p/49207&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;</content:encoded></item><item><title><![CDATA[Sqoop User Guide(Sqoop使用指南)]]></title><description><![CDATA[1、简介 是一种用于转换和关系型数据库之间的数据。你可以导出关系型数据库如到上，在上进行数据转换，然后在导出到关系型数据库中。依靠数据库来描述要导入的数据的模式，使用来做数据的导入和导出，它提供并行操作和容错. sqoop…]]></description><link>https://lengrongfu.github.io/2018-09-11-Sqoop/</link><guid isPermaLink="false">https://lengrongfu.github.io/2018-09-11-Sqoop/</guid><pubDate>Tue, 11 Sep 2018 13:58:54 GMT</pubDate><content:encoded>&lt;h1&gt;1、简介&lt;/h1&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;Sqoop&lt;/code&gt;是一种用于转换&lt;code class=&quot;language-text&quot;&gt;Hadoop&lt;/code&gt;和关系型数据库之间的数据。你可以导出关系型数据库如&lt;code class=&quot;language-text&quot;&gt;mysql&lt;/code&gt;到&lt;code class=&quot;language-text&quot;&gt;HDFS&lt;/code&gt;上，在&lt;code class=&quot;language-text&quot;&gt;Hadoop MapReduce&lt;/code&gt;上进行数据转换，然后在导出到关系型数据库中。&lt;code class=&quot;language-text&quot;&gt;Sqoop&lt;/code&gt;依靠数据库来描述要导入的数据的模式，&lt;code class=&quot;language-text&quot;&gt;Sqoop&lt;/code&gt;使用&lt;code class=&quot;language-text&quot;&gt;MapReduce&lt;/code&gt;来做数据的导入和导出，它提供并行操作和容错.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;&lt;img src=&quot;sqoop.png&quot; alt=&quot;sqoop&quot;&gt;&lt;/p&gt;
&lt;h1&gt;2、基本使用&lt;/h1&gt;
&lt;blockquote&gt;
&lt;p&gt;使用&lt;code class=&quot;language-text&quot;&gt;Sqoop&lt;/code&gt;，可以把关系型数据库中的数据导入到&lt;code class=&quot;language-text&quot;&gt;HDFS&lt;/code&gt;中。对于数据库，&lt;code class=&quot;language-text&quot;&gt;Sqoop&lt;/code&gt;将逐行读取表格到&lt;code class=&quot;language-text&quot;&gt;HDFS&lt;/code&gt;,此导入过程的输出是一组文件，其中包含导入的表或数据集的副本(&lt;code class=&quot;language-text&quot;&gt;parquet&lt;/code&gt;)，导入是由&lt;code class=&quot;language-text&quot;&gt;MapReduce&lt;/code&gt;并行执行的，因此输出会在多个&lt;code class=&quot;language-text&quot;&gt;parquet&lt;/code&gt;文件中。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;blockquote&gt;
&lt;p&gt;导入过程的副产品是生成的java类，&lt;/p&gt;
&lt;/blockquote&gt;
&lt;blockquote&gt;
&lt;p&gt;在进行数据操作之后(使用&lt;code class=&quot;language-text&quot;&gt;MapReduce&lt;/code&gt;或者&lt;code class=&quot;language-text&quot;&gt;Hive&lt;/code&gt;)计算之后，会有一个结果集，然后你可以将其导出回关系型数据库中，&lt;code class=&quot;language-text&quot;&gt;Sqoop&lt;/code&gt;的导出过程将并行读取&lt;code class=&quot;language-text&quot;&gt;HDFS&lt;/code&gt;中的一组分割文本文件，将他们解析为记录，并将它们作为新行插入目录数据库表中，供外部应用程序或用户使用。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;Sqoop&lt;/code&gt;包含一些其它命令，如：可以列出目前所有可用的数据库，&lt;code class=&quot;language-text&quot;&gt;sqoop-list-databases --connect=jdbc:mysql://10.1.4.99:3306/test --username=lrf --password=lrf&lt;/code&gt;,列出数据库中的所有表：&lt;code class=&quot;language-text&quot;&gt;sqoop-list-tables --connect=jdbc:mysql://10.1.4.99:3306/test --username=lrf --password=lrf&lt;/code&gt;,还包括一个原始的SQl执行shell:&lt;code class=&quot;language-text&quot;&gt;sqoop-eval&lt;/code&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;blockquote&gt;
&lt;p&gt;可以自定义导入,对于数据库，可以控制导入的特定行范围或列，&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h1&gt;3、Sqoop 工具&lt;/h1&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;Sqoop&lt;/code&gt;时相关工具的集合，要使用&lt;code class=&quot;language-text&quot;&gt;Sqoop&lt;/code&gt;,需要指定要使用的工具和控制工具的参数。&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;shell&quot;&gt;&lt;pre class=&quot;language-shell&quot;&gt;&lt;code class=&quot;language-shell&quot;&gt;$ sqoop -help
usage: sqoop COMMAND &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;ARGS&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;

Available commands:
  codegen            Generate code to interact with database records &lt;span class=&quot;token comment&quot;&gt;#生成与数据库交互的代码&lt;/span&gt;
  create-hive-table  Import a table definition into Hive &lt;span class=&quot;token comment&quot;&gt;# 导入表定义到hive&lt;/span&gt;
  &lt;span class=&quot;token builtin class-name&quot;&gt;eval&lt;/span&gt;               Evaluate a SQL statement and display the results &lt;span class=&quot;token comment&quot;&gt;# 评估sql语句并显示结果&lt;/span&gt;
  &lt;span class=&quot;token builtin class-name&quot;&gt;export&lt;/span&gt;             Export an HDFS directory to a database table &lt;span class=&quot;token comment&quot;&gt;# 将HDFS目录导出到数据库&lt;/span&gt;
  &lt;span class=&quot;token builtin class-name&quot;&gt;help&lt;/span&gt;               List available commands &lt;span class=&quot;token comment&quot;&gt;# 列出可用命令&lt;/span&gt;
  &lt;span class=&quot;token function&quot;&gt;import&lt;/span&gt;             Import a table from a database to HDFS &lt;span class=&quot;token comment&quot;&gt;# 从数据库中导入一个指定表到HDFS&lt;/span&gt;
  import-all-tables  Import tables from a database to HDFS &lt;span class=&quot;token comment&quot;&gt;# 把一个数据库中的表都导入到HDFS&lt;/span&gt;
  import-mainframe   Import mainframe datasets to HDFS &lt;span class=&quot;token comment&quot;&gt;# 导入主数据库到HDFS&lt;/span&gt;
  list-databases     List available databases on a server &lt;span class=&quot;token comment&quot;&gt;# &lt;/span&gt;
  list-tables        List available tables &lt;span class=&quot;token keyword&quot;&gt;in&lt;/span&gt; a database
  version            Display version information

See &lt;span class=&quot;token string&quot;&gt;&apos;sqoop help COMMAND&apos;&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;for&lt;/span&gt; information on a specific command.&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h1&gt;4、从mysql 到 HDFS&lt;/h1&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;shell&quot;&gt;&lt;pre class=&quot;language-shell&quot;&gt;&lt;code class=&quot;language-shell&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;# 导入指定的表&lt;/span&gt;
$ sqoop &lt;span class=&quot;token function&quot;&gt;import&lt;/span&gt; --connect jdbc:mysql://&lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;dburi&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;/&lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;dbname&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;?zeroDateTimeBehavior&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;CONVERT_TO_NULL &lt;span class=&quot;token comment&quot;&gt;# db&lt;/span&gt;
                --username &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;username&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; &lt;span class=&quot;token comment&quot;&gt;# db user&lt;/span&gt;
                --password &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;password&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; &lt;span class=&quot;token comment&quot;&gt;# db pwd&lt;/span&gt;
                --table &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;tablename&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; &lt;span class=&quot;token comment&quot;&gt;# db table&lt;/span&gt;
                --check-column &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;col&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; &lt;span class=&quot;token comment&quot;&gt;# 要检查的列的名称&lt;/span&gt;
                --incremental &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;mode&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;  &lt;span class=&quot;token comment&quot;&gt;# 改模式决定sqoop如何定义哪些行为新的行。取值为append或lastmodified&lt;/span&gt;
                --last-value &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;value&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; &lt;span class=&quot;token comment&quot;&gt;# 前一个导入中检查列的最大值&lt;/span&gt;
                --target-dir &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;hdfs-dir&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; &lt;span class=&quot;token comment&quot;&gt;# HDFS 的写入目录，例如：/user/hdfs/result.&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;# 列子&lt;/span&gt;
sqoop &lt;span class=&quot;token function&quot;&gt;import&lt;/span&gt; --connect jdbc:mysql://10.1.4.99:3306/test?zeroDateTimeBehavior&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;CONVERT_TO_NULL --table student --username lrf --password lrf --target-dir hdfs://hadoop-11.146.dev.net/user/hdfs/test/student

&lt;span class=&quot;token comment&quot;&gt;# 导入数据库下的所有表&lt;/span&gt;
sqoop import-all-tables &lt;span class=&quot;token punctuation&quot;&gt;\&lt;/span&gt;
    --username &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;username&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; &lt;span class=&quot;token comment&quot;&gt;# db user&lt;/span&gt;
    --password &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;password&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; &lt;span class=&quot;token comment&quot;&gt;# db pwd&lt;/span&gt;
    --check-column &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;col&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; &lt;span class=&quot;token comment&quot;&gt;# 要检查的列的名称&lt;/span&gt;
    --incremental &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;mode&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;  &lt;span class=&quot;token comment&quot;&gt;# 改模式决定sqoop如何定义哪些行为新的行。取值为append或lastmodified&lt;/span&gt;
    --last-value &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;value&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; &lt;span class=&quot;token comment&quot;&gt;# 前一个导入中检查列的最大值&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;# 列子,不能指定导入，默认会全部导入到/user/hdfs目录下&lt;/span&gt;
sqoop import-all-tables --connect jdbc:mysql://10.1.4.99:3306/test?zeroDateTimeBehavior&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;CONVERT_TO_NULL --username lrf --password lrf &lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h1&gt;5、从HDFS 到Mysql&lt;/h1&gt;
&lt;blockquote&gt;
&lt;p&gt;需要先创建好对应 HDFS 中的数据结构的 MySQL 表，然后在集群的 Master 节点上执行如下命令，指定要导的数据文件的路径&lt;/p&gt;
&lt;/blockquote&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;shell&quot;&gt;&lt;pre class=&quot;language-shell&quot;&gt;&lt;code class=&quot;language-shell&quot;&gt;$ sqoop &lt;span class=&quot;token builtin class-name&quot;&gt;export&lt;/span&gt; --connect jdbc:mysql://&lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;dburi&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;/&lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;dbname&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; 
               --username &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;username&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; 
               --password &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;password&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; 
               --table &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;tablename&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; 
               --export-dir &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;hdfs-dir&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;# 列子&lt;/span&gt;
sqoop &lt;span class=&quot;token builtin class-name&quot;&gt;export&lt;/span&gt; --connect jdbc:mysql://10.1.4.99:3306/test --username lrf --password lrf --table student 
--export-dir hdfs://hadoop-11.146.dev.net/user/hdfs/test/student&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h1&gt;6、从mysql 到Hive&lt;/h1&gt;
&lt;blockquote&gt;
&lt;p&gt;在集群的 Master 节点上执行如下命令后，从MySQL数据库导入数据的同时，也会新建一个 Hive 表。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;shell&quot;&gt;&lt;pre class=&quot;language-shell&quot;&gt;&lt;code class=&quot;language-shell&quot;&gt;$ sqoop &lt;span class=&quot;token function&quot;&gt;import&lt;/span&gt; --connect jdbc:mysql://&lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;dburi&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;/&lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;dbname&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; 
               --username &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;username&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; 
               --password &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;password&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; 
               --table &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;tablename&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; 
               --check-column &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;col&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; 
               --incremental &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;mode&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; 
               --last-value &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;value&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; 
               --fields-terminated-by &lt;span class=&quot;token string&quot;&gt;&quot;&lt;span class=&quot;token entity&quot; title=&quot;\t&quot;&gt;\t&lt;/span&gt;&quot;&lt;/span&gt; 
               --lines-terminated-by &lt;span class=&quot;token string&quot;&gt;&quot;&lt;span class=&quot;token entity&quot; title=&quot;\n&quot;&gt;\n&lt;/span&gt;&quot;&lt;/span&gt; 
               --hive-import 
               --warehouse-dir &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;hdfs-dir&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; 
               --hive-table &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;hive-tablename&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;# 列子&lt;/span&gt;
sqoop import-all-tables &lt;span class=&quot;token punctuation&quot;&gt;\&lt;/span&gt;
    -m &lt;span class=&quot;token number&quot;&gt;3&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;\&lt;/span&gt; 
    --connect jdbc:mysql://10.1.4.99:3306/test?zeroDateTimeBehavior&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;CONVERT_TO_NULL &lt;span class=&quot;token punctuation&quot;&gt;\&lt;/span&gt; &lt;span class=&quot;token comment&quot;&gt;#mysql连接，zeroDateTimeBehavior 处理异常时间的配置,比如0，&lt;/span&gt;
    --username&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;lrf &lt;span class=&quot;token punctuation&quot;&gt;\&lt;/span&gt;
    --password&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;lrf &lt;span class=&quot;token punctuation&quot;&gt;\&lt;/span&gt;
    --compression-codec&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;snappy &lt;span class=&quot;token punctuation&quot;&gt;\&lt;/span&gt;
    --as-parquetfile &lt;span class=&quot;token punctuation&quot;&gt;\&lt;/span&gt;
    --warehouse-dir&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;/user/hive/warehouse &lt;span class=&quot;token punctuation&quot;&gt;\&lt;/span&gt;
    --hive-import&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h1&gt;7、从Hive到mysql&lt;/h1&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;shell&quot;&gt;&lt;pre class=&quot;language-shell&quot;&gt;&lt;code class=&quot;language-shell&quot;&gt;$ sqoop &lt;span class=&quot;token builtin class-name&quot;&gt;export&lt;/span&gt; --connect jdbc:mysql://&lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;dburi&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;/&lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;dbname&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; 
               --username &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;username&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; 
               --password &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;password&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; 
               --table &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;tablename&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; 
               --export-dir &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;hive-dir&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;

&lt;span class=&quot;token comment&quot;&gt;# 例子,如果导出时要指定hive表的字段，不然分割不了，导出默认是使用逗号分割的，需要指定hive的列对应上mysql中的列，下列中的columns字段就是hive表中的字段。&lt;/span&gt;
sqoop &lt;span class=&quot;token builtin class-name&quot;&gt;export&lt;/span&gt; --connect jdbc:mysql://10.1.4.99:3306/test --username lrf --password lrf --table nginx_access_logs --columns reote_addr,time_local,request,status,body_bytes_sent,http_referer,http_user_agent,http_x_forwarded_for --export-dir hdfs://hadoop-11.146.dev.net/user/hive/warehouse/nginx_access_logs&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h1&gt;8、使用sql条件导入到hdfs或hive&lt;/h1&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;shell&quot;&gt;&lt;pre class=&quot;language-shell&quot;&gt;&lt;code class=&quot;language-shell&quot;&gt;sqoop &lt;span class=&quot;token function&quot;&gt;import&lt;/span&gt; --connect jdbc:mysql://&lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;dburi&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;/&lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;dbname&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; 
             --username &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;username&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; 
             --password &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;password&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; 
             --query &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;query-sql&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; 
             --split-by &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;sp-column&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; &lt;span class=&quot;token comment&quot;&gt;# 查询的条件,如:&apos;select * from student where age &gt; 20&apos;&lt;/span&gt;
             --hive-import 
             --hive-table &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;hive-tablename&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; 
             --target-dir &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;hdfs-dir&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h1&gt;参考&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https://sqoop.apache.org/docs/1.4.7/SqoopUserGuide.html&quot;&gt;https://sqoop.apache.org/docs/1.4.7/SqoopUserGuide.html&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://sqoop.apache.org/docs/1.4.7/SqoopUserGuide.html#_connecting_to_a_database_server&quot;&gt;https://sqoop.apache.org/docs/1.4.7/SqoopUserGuide.html#_connecting_to_a_database_server&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;</content:encoded></item><item><title><![CDATA[cloudera hadoop 安装]]></title><description><![CDATA[一、准备 1、JAVA 安装 要求： 必须使用位，不能使用位. 以上版本需要用。 必须在每台集群上安装相同版本的。 必须被安装在 ,后来发现只要配置了可以在任何目录。  必须是不能是。 2、Mysql 安装  会存储一些信息到数据库中，所以需要使用,也可以使用其他，如：,…]]></description><link>https://lengrongfu.github.io/2018-09-06-cloudera/</link><guid isPermaLink="false">https://lengrongfu.github.io/2018-09-06-cloudera/</guid><pubDate>Thu, 06 Sep 2018 15:57:43 GMT</pubDate><content:encoded>&lt;h1&gt;一、准备&lt;/h1&gt;
&lt;h2&gt;1、JAVA 安装&lt;/h2&gt;
&lt;p&gt;要求：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;JDK&lt;/code&gt;必须使用&lt;code class=&quot;language-text&quot;&gt;64&lt;/code&gt;位，不能使用&lt;code class=&quot;language-text&quot;&gt;32&lt;/code&gt;位.&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;cloudera5.3&lt;/code&gt;以上版本需要用&lt;code class=&quot;language-text&quot;&gt;JDK8&lt;/code&gt;。&lt;/li&gt;
&lt;li&gt;必须在每台集群上安装相同版本的&lt;code class=&quot;language-text&quot;&gt;Oracle JDK&lt;/code&gt;。&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;JDK&lt;/code&gt;必须被安装在&lt;code class=&quot;language-text&quot;&gt;/usr/java/jdk-(version)&lt;/code&gt; ,后来发现只要配置了&lt;code class=&quot;language-text&quot;&gt;JAVA_HOME&lt;/code&gt;可以在任何目录。&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;jdk&lt;/code&gt; 必须是&lt;code class=&quot;language-text&quot;&gt;Oracle JDK&lt;/code&gt;不能是&lt;code class=&quot;language-text&quot;&gt;open jdk&lt;/code&gt;。&lt;/li&gt;
&lt;/ul&gt;
&lt;h2&gt;2、Mysql 安装&lt;/h2&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;cloudera manage&lt;/code&gt; 会存储一些信息到数据库中，所以需要使用&lt;code class=&quot;language-text&quot;&gt;mysq&lt;/code&gt;,也可以使用其他&lt;code class=&quot;language-text&quot;&gt;DB&lt;/code&gt;，如：&lt;code class=&quot;language-text&quot;&gt;postgresql&lt;/code&gt;,&lt;code class=&quot;language-text&quot;&gt;mariadb&lt;/code&gt;&lt;/p&gt;
&lt;h2&gt;3、集群hostname配置&lt;/h2&gt;
&lt;p&gt;集群之间需要修改&lt;code class=&quot;language-text&quot;&gt;hostname&lt;/code&gt;,并且绑定&lt;code class=&quot;language-text&quot;&gt;hosts&lt;/code&gt;.使用&lt;code class=&quot;language-text&quot;&gt;hostnamectl set-hostname hadoop-11.142.dev.net&lt;/code&gt; 来修改主机的&lt;code class=&quot;language-text&quot;&gt;hostname&lt;/code&gt;，修改之后验证。&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;shell&quot;&gt;&lt;pre class=&quot;language-shell&quot;&gt;&lt;code class=&quot;language-shell&quot;&gt;$ &lt;span class=&quot;token function&quot;&gt;vim&lt;/span&gt; /ets/hosts
host1 hadoop-11.142.dev.net
host2 hadoop-11.143.dev.net
host3 hadoop-11.144.dev.net
host4 hadoop-11.145.dev.net
host5 hadoop-11.146.dev.net&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2&gt;4、ssh 免密登陆配置&lt;/h2&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;cloudera manage&lt;/code&gt;需要访问和分发数据到&lt;code class=&quot;language-text&quot;&gt;salve&lt;/code&gt;节点,所以需要&lt;code class=&quot;language-text&quot;&gt;ssh&lt;/code&gt;免密登陆，只需要&lt;code class=&quot;language-text&quot;&gt;manage&lt;/code&gt;节点能免密登陆到&lt;code class=&quot;language-text&quot;&gt;salve&lt;/code&gt;节点即可.配置步骤如下。&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;shell&quot;&gt;&lt;pre class=&quot;language-shell&quot;&gt;&lt;code class=&quot;language-shell&quot;&gt; &lt;span class=&quot;token comment&quot;&gt;# 在manage节点上配置,先清除所以节点上的.ssh文件夹下的内容&lt;/span&gt;
$ ssh-keygen &lt;span class=&quot;token comment&quot;&gt;# 生成公钥和似钥&lt;/span&gt;
$ ssh-copy-id hadoop-11.142.dev.net &lt;span class=&quot;token comment&quot;&gt;#拷贝公钥到其他集群上，首先拷贝到自己上面，重复执行上面的步骤，直到拷贝完所有的节点。&lt;/span&gt;
$ &lt;span class=&quot;token function&quot;&gt;ssh&lt;/span&gt; hadoop-11.143.dev.net &lt;span class=&quot;token comment&quot;&gt;#检验是否可以实现免密登陆。&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2&gt;5、安装所需模块和系统设置&lt;/h2&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;shell&quot;&gt;&lt;pre class=&quot;language-shell&quot;&gt;&lt;code class=&quot;language-shell&quot;&gt;$ yum &lt;span class=&quot;token function&quot;&gt;install&lt;/span&gt; psmisc 
&lt;span class=&quot;token comment&quot;&gt;# 每一台宿主机都要设置&lt;/span&gt;
$ &lt;span class=&quot;token builtin class-name&quot;&gt;echo&lt;/span&gt; never &lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; /sys/kernel/mm/transparent_hugepage/defrag
$ &lt;span class=&quot;token builtin class-name&quot;&gt;echo&lt;/span&gt; never &lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; /sys/kernel/mm/transparent_hugepage/enabled
$ &lt;span class=&quot;token builtin class-name&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;10&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;&gt;&gt;&lt;/span&gt; /proc/sys/vm/swappiness &lt;span class=&quot;token comment&quot;&gt;#&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2&gt;6、下载parcel&lt;/h2&gt;
&lt;p&gt;此处下载是为了使用离线安装，不然安装的时候再下载，如果网络不好就会出现多次安装都没有不成功。此处下载比较耗时，可以先进行下载，下载存放目录可以任意，安装时可以指定。&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;shell&quot;&gt;&lt;pre class=&quot;language-shell&quot;&gt;&lt;code class=&quot;language-shell&quot;&gt;$ &lt;span class=&quot;token function&quot;&gt;wget&lt;/span&gt; -c http://archive.cloudera.com/cdh5/parcels/5.12/CDH-5.12.2-1.cdh5.12.2.p0.4-el7.parcel
$ &lt;span class=&quot;token function&quot;&gt;wget&lt;/span&gt; -c http://archive.cloudera.com/cdh5/parcels/5.12/CDH-5.12.2-1.cdh5.12.2.p0.4-el7.parcel.sha1
$ &lt;span class=&quot;token function&quot;&gt;wget&lt;/span&gt; -c http://archive.cloudera.com/cdh5/parcels/5.12/manifest.json&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h1&gt;二、安装&lt;/h1&gt;
&lt;h2&gt;1、 Cloudera Manager Server 安装&lt;/h2&gt;
&lt;p&gt;上面的准备工作都完成了之后就可以进行下载安装了，&lt;/p&gt;
&lt;h2&gt;1、命令安装&lt;/h2&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;shell&quot;&gt;&lt;pre class=&quot;language-shell&quot;&gt;&lt;code class=&quot;language-shell&quot;&gt;$ &lt;span class=&quot;token function&quot;&gt;sudo&lt;/span&gt; yum &lt;span class=&quot;token function&quot;&gt;install&lt;/span&gt; cloudera-manager-daemons cloudera-manager-agent cloudera-manager-server&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2&gt;2、下载manager&lt;/h2&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;shell&quot;&gt;&lt;pre class=&quot;language-shell&quot;&gt;&lt;code class=&quot;language-shell&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;# http://archive.cloudera.com/cm5/cm/5/&lt;/span&gt;
$ &lt;span class=&quot;token function&quot;&gt;wget&lt;/span&gt; -c http://archive.cloudera.com/cm5/cm/5/cloudera-manager-centos7-cm5.12.2_x86_64.tar.gz
$ &lt;span class=&quot;token function&quot;&gt;tar&lt;/span&gt; -zxf cloudera-manager-centos7-cm5.12.2_x86_64.tar.gz
$ &lt;span class=&quot;token builtin class-name&quot;&gt;cd&lt;/span&gt; ./cm-5.12.2&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2&gt;3、下载mysql-connector-java&lt;/h2&gt;
&lt;p&gt;下载&lt;code class=&quot;language-text&quot;&gt;mysql-connector-java&lt;/code&gt;并放入&lt;code class=&quot;language-text&quot;&gt;/usr/local/cloudera/cm-5.12.2/share/cmf/lib&lt;/code&gt;路径中,&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;shell&quot;&gt;&lt;pre class=&quot;language-shell&quot;&gt;&lt;code class=&quot;language-shell&quot;&gt;$ &lt;span class=&quot;token function&quot;&gt;wget&lt;/span&gt; -c https://cdn.mysql.com//Downloads/Connector-J/mysql-connector-java-8.0.12.tar.gz
$ &lt;span class=&quot;token function&quot;&gt;tar&lt;/span&gt; -zxf mysql-connector-java-8.0.12.tar.gz 
$ &lt;span class=&quot;token builtin class-name&quot;&gt;cd&lt;/span&gt; mysql-connector-java-8.0.12
$ &lt;span class=&quot;token function&quot;&gt;cp&lt;/span&gt; mysql-connector-java-8.0.12.jar /usr/local/cloudera/cm-5.12.2/share/cmf/lib&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2&gt;4、创建db&lt;/h2&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;shell&quot;&gt;&lt;pre class=&quot;language-shell&quot;&gt;&lt;code class=&quot;language-shell&quot;&gt;$ &lt;span class=&quot;token builtin class-name&quot;&gt;cd&lt;/span&gt; ./cm-5.12.2/share/cmf/schema
&lt;span class=&quot;token comment&quot;&gt;# https://www.cloudera.com/documentation/enterprise/6/6.0/topics/prepare_cm_database.html 次命令有很多参数，具体参考&lt;/span&gt;
$ &lt;span class=&quot;token function&quot;&gt;bash&lt;/span&gt; scm_prepare_database.sh mysql cm root password &lt;span class=&quot;token comment&quot;&gt;# 执行命令，创建db&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2&gt;5、修改agent配置&lt;/h2&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;shell&quot;&gt;&lt;pre class=&quot;language-shell&quot;&gt;&lt;code class=&quot;language-shell&quot;&gt;$ &lt;span class=&quot;token builtin class-name&quot;&gt;cd&lt;/span&gt; ./etc/cloudera-scm-agent/
$ &lt;span class=&quot;token function&quot;&gt;vim&lt;/span&gt; config.ini
&lt;span class=&quot;token comment&quot;&gt;# Hostname of the CM server.&lt;/span&gt;
&lt;span class=&quot;token assign-left variable&quot;&gt;server_host&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;hadoop-11.142.dev.net&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2&gt;6、把agent分发到其他机器上&lt;/h2&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;shell&quot;&gt;&lt;pre class=&quot;language-shell&quot;&gt;&lt;code class=&quot;language-shell&quot;&gt;$ &lt;span class=&quot;token function&quot;&gt;tar&lt;/span&gt; -zcf cm-5.12.2.tar.gz cm-5.12.2/
$ &lt;span class=&quot;token function&quot;&gt;scp&lt;/span&gt; cm-5.12.2.tar.gz root@host2:/usr/local/cloudera
$ &lt;span class=&quot;token function&quot;&gt;scp&lt;/span&gt; cm-5.12.2.tar.gz root@host3:/usr/local/cloudera
$ &lt;span class=&quot;token function&quot;&gt;scp&lt;/span&gt; cm-5.12.2.tar.gz root@host4:/usr/local/cloudera
$ &lt;span class=&quot;token function&quot;&gt;scp&lt;/span&gt; cm-5.12.2.tar.gz root@host5:/usr/local/cloudera&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2&gt;7、启动manage&lt;/h2&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;shell&quot;&gt;&lt;pre class=&quot;language-shell&quot;&gt;&lt;code class=&quot;language-shell&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;# 添加用户&lt;/span&gt;
$ &lt;span class=&quot;token function&quot;&gt;useradd&lt;/span&gt; --system --home&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;/usr/local/cloudera/cm-5.12.2/run/cloudera-scm-server/ --no-create-home --shell&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;/bin/false --comment &lt;span class=&quot;token string&quot;&gt;&quot;Cloudera SCM User&quot;&lt;/span&gt; cloudera-scm
$ &lt;span class=&quot;token builtin class-name&quot;&gt;cd&lt;/span&gt; ./cm-5.12.2/run/cloudera-scm-server
$ ./cm-5.12.2/etc/init.d/cloudera-scm-server start&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2&gt;8、启动agent&lt;/h2&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;shell&quot;&gt;&lt;pre class=&quot;language-shell&quot;&gt;&lt;code class=&quot;language-shell&quot;&gt;$ ./cm-5.12.2/etc/init.d/cloudera-scm-agent start
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2&gt;9、启动hadoop集群&lt;/h2&gt;
&lt;p&gt;浏览器中访问&lt;code class=&quot;language-text&quot;&gt;manage&lt;/code&gt;服务器的&lt;code class=&quot;language-text&quot;&gt;ip:port&lt;/code&gt;,&lt;code class=&quot;language-text&quot;&gt;http://host1:7180/&lt;/code&gt;,密码账号为&lt;code class=&quot;language-text&quot;&gt;admin/amdin&lt;/code&gt;.进入执行页面&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;1.png&quot; alt=&quot;1&quot;&gt;
&lt;img src=&quot;2.png&quot; alt=&quot;2&quot;&gt;
&lt;img src=&quot;3.png&quot; alt=&quot;3&quot;&gt;
&lt;img src=&quot;4.png&quot; alt=&quot;4&quot;&gt;
&lt;img src=&quot;5.png&quot; alt=&quot;5&quot;&gt;&lt;/p&gt;
&lt;p&gt;如果&lt;code class=&quot;language-text&quot;&gt;Parcel&lt;/code&gt;没有存放在&lt;code class=&quot;language-text&quot;&gt;/opt/cloudera/parcels&lt;/code&gt; 这个目录，就可以修改为自己存放文件的路径，需要修改一个文件名&lt;code class=&quot;language-text&quot;&gt;cp CDH-5.12.2-1.cdh5.12.2.p0.4-el7.parcel.sha1 CDH-5.12.2-1.cdh5.12.2.p0.4-el7.parcel.sha&lt;/code&gt;,把&lt;code class=&quot;language-text&quot;&gt;sha1&lt;/code&gt;文件改为&lt;code class=&quot;language-text&quot;&gt;sha&lt;/code&gt;,之后的都默认一直继续。&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;6.png&quot; alt=&quot;6&quot;&gt;
如果有警告，需要解决警告，上面有提示解决方法，如果没有警告就继续执行下一步。&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;7.png&quot; alt=&quot;7&quot;&gt;
可以自定义选择安装的软件。&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;8.png&quot; alt=&quot;8&quot;&gt;
通过自己服务的情况，来分配角色，除了&lt;code class=&quot;language-text&quot;&gt;manage servie&lt;/code&gt;不能修改。&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;9.png&quot; alt=&quot;9&quot;&gt;&lt;/p&gt;
&lt;p&gt;连接之前安装的mysql，要有能连接上的权限的账号和密码。写完之后可以测试连接一下。在安装过程中会出现&lt;code class=&quot;language-text&quot;&gt;hive&lt;/code&gt;和&lt;code class=&quot;language-text&quot;&gt;Ooize&lt;/code&gt;没有数据库连接的包报错，此时需要把之前下载好的&lt;code class=&quot;language-text&quot;&gt;jar&lt;/code&gt;包分发到&lt;code class=&quot;language-text&quot;&gt;hive&lt;/code&gt;和&lt;code class=&quot;language-text&quot;&gt;Ooize&lt;/code&gt;的主机上去。&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;shell&quot;&gt;&lt;pre class=&quot;language-shell&quot;&gt;&lt;code class=&quot;language-shell&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;# hive 主机在配置角色页面上指定&lt;/span&gt;
$ &lt;span class=&quot;token function&quot;&gt;scp&lt;/span&gt; mysql-connector-java-8.0.12.jar root@host5:/opt/cloudera/parcels/CDH/lib/hive/lib
&lt;span class=&quot;token comment&quot;&gt;# oozie 主机在配置角色页面上指定&lt;/span&gt;
$ &lt;span class=&quot;token function&quot;&gt;scp&lt;/span&gt; mysql-connector-java-8.0.12.jar root@host3:/var/lib/oozie&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;img src=&quot;10.png&quot; alt=&quot;10&quot;&gt;
&lt;img src=&quot;11.png&quot; alt=&quot;11&quot;&gt;&lt;/p&gt;
&lt;h1&gt;三、 下载地址&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;http://archive.cloudera.com/cm5/cm/5/&quot;&gt;cloudera manage&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;http://archive.cloudera.com/cdh5/parcels/5.12/&quot;&gt;CDH &lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h1&gt;四、参考&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https://blog.csdn.net/mergerly/article/details/75127392&quot;&gt;https://blog.csdn.net/mergerly/article/details/75127392&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;http://www.cnblogs.com/lion.net/p/5477899.html&quot;&gt;http://www.cnblogs.com/lion.net/p/5477899.html&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;</content:encoded></item><item><title><![CDATA[搭建一个自己的blog]]></title><description><![CDATA[要求 账号和基本的命令使用。 会用文章。 会配置基于的访问。 环境 使用 GitHub Pages 和 hexo…]]></description><link>https://lengrongfu.github.io/2018-09-03-搭建一个自己的blog/</link><guid isPermaLink="false">https://lengrongfu.github.io/2018-09-03-搭建一个自己的blog/</guid><pubDate>Mon, 03 Sep 2018 11:18:34 GMT</pubDate><content:encoded>&lt;!-- more --&gt;
&lt;!-- 搭建自己的一个博客系统。--&gt;
&lt;h2&gt;要求&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;Git&lt;/code&gt;账号和基本的&lt;code class=&quot;language-text&quot;&gt;Git&lt;/code&gt;命令使用。&lt;/li&gt;
&lt;li&gt;会用&lt;code class=&quot;language-text&quot;&gt;Markdown&lt;/code&gt;文章。&lt;/li&gt;
&lt;li&gt;会配置基于&lt;code class=&quot;language-text&quot;&gt;SSH&lt;/code&gt;的&lt;code class=&quot;language-text&quot;&gt;Git&lt;/code&gt;访问。&lt;/li&gt;
&lt;/ul&gt;
&lt;h2&gt;环境&lt;/h2&gt;
&lt;p&gt;使用 &lt;a href=&quot;https://pages.github.com/&quot;&gt;GitHub Pages&lt;/a&gt; 和 &lt;a href=&quot;https://hexo.io/&quot;&gt;hexo&lt;/a&gt; 搭建一个属于自己的无限流量的博客系统。自己不需要拥有服务器，不需要拥有域名。&lt;/p&gt;
&lt;p&gt;使用&lt;code class=&quot;language-text&quot;&gt;Mac&lt;/code&gt;做教程，其他系统请自行研究。&lt;/p&gt;
&lt;h2&gt;搭建&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;第一步：创建一个仓库&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;img src=&quot;1.png&quot; alt=&quot;第一步&quot;&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;第二步：拉取到本地仓库&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;img src=&quot;2.png&quot; alt=&quot;第二步&quot;&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;第三步：写&lt;code class=&quot;language-text&quot;&gt;index.html&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;img src=&quot;3.png&quot; alt=&quot;第三步&quot;&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;第四步：提交&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;img src=&quot;4.png&quot; alt=&quot;第四步&quot;&gt;&lt;/p&gt;
&lt;p&gt;之后在浏览器中输入&lt;code class=&quot;language-text&quot;&gt;https://username.github.io.&lt;/code&gt; 就可以进行访问了。可直接参考官网步骤。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;第五步：安装&lt;code class=&quot;language-text&quot;&gt;hexo&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;shell&quot;&gt;&lt;pre class=&quot;language-shell&quot;&gt;&lt;code class=&quot;language-shell&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;# 本地安装hexo,需要先安装npm。&lt;/span&gt;
$ brew &lt;span class=&quot;token function&quot;&gt;install&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;npm&lt;/span&gt;
$ &lt;span class=&quot;token function&quot;&gt;npm&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;install&lt;/span&gt; hexo-cli -g
&lt;span class=&quot;token comment&quot;&gt;# 安装完成之后,验证是否成功&lt;/span&gt;
$ hexo -v&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;ul&gt;
&lt;li&gt;第六步：初始化项目&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;shell&quot;&gt;&lt;pre class=&quot;language-shell&quot;&gt;&lt;code class=&quot;language-shell&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;# 初始化一个hexo 项目&lt;/span&gt;
$ hexo init blog
$ &lt;span class=&quot;token builtin class-name&quot;&gt;cd&lt;/span&gt; blog
$ &lt;span class=&quot;token function&quot;&gt;npm&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;install&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;# 上面三步就初始化好一个项目了，执行如下命令，启动查看。&lt;/span&gt;
$ hexo server&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;ul&gt;
&lt;li&gt;第七步：部署项目到&lt;code class=&quot;language-text&quot;&gt;GitHub Pages&lt;/code&gt;上&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;shell&quot;&gt;&lt;pre class=&quot;language-shell&quot;&gt;&lt;code class=&quot;language-shell&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;#首先需要配置ssh key到github上&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;# 生产sshkey&lt;/span&gt;
$ ssh-keygen -t rsa -C &lt;span class=&quot;token string&quot;&gt;&quot;邮箱&quot;&lt;/span&gt;
$ clip &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt; ~/.ssh/id_rsa.pub
&lt;span class=&quot;token comment&quot;&gt;#1.复制key到剪贴板&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;#2.登录github&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;#3.点击右上方的Accounting settings图标&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;#4.选择 SSH key&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;#5.点击 Add SSH key&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;# 测试是否配置成功&lt;/span&gt;
$ &lt;span class=&quot;token function&quot;&gt;ssh&lt;/span&gt; -T git@github.com
&lt;span class=&quot;token comment&quot;&gt;# 修改项目下的_config.yml文件,修改如下内容&lt;/span&gt;
deploy:
  type: &lt;span class=&quot;token function&quot;&gt;git&lt;/span&gt;
  repo: git@github.com:lengrongfu/lengrongfu.github.io.git
  branch: master
&lt;span class=&quot;token comment&quot;&gt;# 安装如下扩展&lt;/span&gt;
$ &lt;span class=&quot;token function&quot;&gt;npm&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;install&lt;/span&gt; hexo-deployer-git --save
&lt;span class=&quot;token comment&quot;&gt;# 部署&lt;/span&gt;
$ hexo deploy
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2&gt;主题设置&lt;/h2&gt;
&lt;p&gt;我使用的是 &lt;a href=&quot;http://theme-next.iissnan.com/getting-started.html&quot;&gt;next&lt;/a&gt; 主题，如果需要使用其他的，请官网找，设置方法一样。&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;shell&quot;&gt;&lt;pre class=&quot;language-shell&quot;&gt;&lt;code class=&quot;language-shell&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;# 下载最新版，使用方法查看官网。&lt;/span&gt;
$ &lt;span class=&quot;token builtin class-name&quot;&gt;cd&lt;/span&gt; your-hexo-site
$ &lt;span class=&quot;token function&quot;&gt;git&lt;/span&gt; clone https://github.com/iissnan/hexo-theme-next themes/next
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2&gt;图片插入问题&lt;/h2&gt;
&lt;p&gt;使用 &lt;a href=&quot;https://github.com/CodeFalling/hexo-asset-image&quot;&gt;hexo-asset-image&lt;/a&gt; 来使用本地的图片，不使用其他存储。具体使用方法参考官方配置。&lt;/p&gt;
&lt;h2&gt;其他问题参考&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;多个&lt;code class=&quot;language-text&quot;&gt;ssh&lt;/code&gt;问题,参考：&lt;a href=&quot;http://riny.net/2014/git-ssh-key/&quot;&gt;http://riny.net/2014/git-ssh-key/&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;</content:encoded></item></channel></rss>